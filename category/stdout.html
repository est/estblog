<!DOCTYPE html>
<html>
  <head>
    <title>est の 输入 输出和出入 - stdout category</title>

    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta http-equiv="Content-Security-Policy" content="frame-ancestors 'self' https://disqus.com https://player.bilibili.com https://www.youtube.com;">
    <link href="https://feeds.feedburner.com/initiative" type="application/rss+xml" rel="alternate" title="est の 输入 输出和出入 RSS Feed" />

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="This blog is rated 🔞, viewer discretion is advised" />

    <meta property="og:url" content="https://blog.est.im">
    <meta property="og:type" content="website">
    <meta property="og:title" content="est の 输入 输出和出入">
    <meta property="og:description" content="This blog is rated 🔞, viewer discretion is advised">

    <link rel="stylesheet" href="/theme/css/normalize.min.css" />
    <link rel="stylesheet" href="/theme/css/style.css" />


    <style>
      body {
        background: #ecedef url("/theme/img/ignasi_pattern_s.png") repeat;
      }
    </style>
  </head>
  <body class="list-body">
<nav class="nav-bar side-padding">
  <h1 class="nav-header"><a href="/" class="nav-text">
    est の 输入 输出和出入
  </a></h1>
  <div class="hamburger-menu">
    <button>
      <span></span>
      <span></span>
    </button>
    <ul id="menu" class="hamburger-menu-overlay">
      <li><a href="/" class="hamburger-menu-overlay-link">Home</a></li>
      <li><a href="https://feeds.feedburner.com/initiative" class="hamburger-menu-overlay-link">RSS</a></li>
      <li><a href="/about" class="hamburger-menu-overlay-link">About</a></li>

      <li><a href="/category/archive" class="hamburger-menu-overlay-link">archive</a></li>
      <li><a href="/category/stderr" class="hamburger-menu-overlay-link">stderr</a></li>
      <li><a href="/category/stdin" class="hamburger-menu-overlay-link">stdin</a></li>
      <li><a href="/category/stdout" class="hamburger-menu-overlay-link active">stdout</a></li>

    </ul>
  </div>
</nav>    <main class="card-container side-gutter">
      <header class="list-header">
        <p class="list-header-subtext">This blog is rated 🔞, viewer discretion is advised</p>
        <!-- <h1 class="list-header-title">est の 输入 输出和出入</h1> -->
      </header>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2025/stdout-09"  rel="bookmark" >
              <h2 class="card-title">Fix WestData SN550/SN570 SSD slow read problem</h2>
            </a>
            <p class="card-text"><p>I had a painful slow game load experience during the past few days. In the beginning, I tried everything I can to tweak the Win10 system, cleanup the PC box, but the disk IO was always pegging at 2MB/s to 5MB/s at taskmgr.exe.</p>
<p>The real culprit? The WD ssd I bought some years ago. Turns out if the data was old enough, the firmware had real trouble recognizing the volatile bits and throttles the throughput.</p>
<p>The fix? read the file again and write them back. Since my disk is almost full (another reason here), a inline replace would be prefered.</p>
<p>I spent next few hours vibe coding an HTML5 utility</p>
<p><a href="https://lab.est.im/ssd-warmup/">https://lab.est.im/ssd-warmup/</a></p>
<p>The code works as intended, however the File System API in Javascript writes a .crswap file instead of the original. <br />
It's a <a href="https://issues.chromium.org/issues/40777458">Chromium thing</a> thus makes the JS method completely useless.</p>
<p>I wrote a Python version instead.</p>
<p><a href="https://github.com/est/snippets/blob/master/ssd-warmup/ssd_warmup.py">https://github.com/est/snippets/blob/master/ssd-warmup/ssd_warmup.py</a></p>
<p>The AI wrote code using <code>os.path.walk</code> and I changed it with <code>pathlib.Path</code>, which was more pleasant with its <code>rglob</code> method.</p>
<p>You can try it:</p>
<p><code>python ssd_warmup.py /path/to/fix/</code></p>
<p>The lesson learned: Don't buy Sandick or WestData. At least the low-end ones.</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2025-10-09T10:30:00+08:00">2025-10-09</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2025/stdout-08"  rel="bookmark" >
              <h2 class="card-title">xHTML5</h2>
            </a>
            <p class="card-text"><p>有 ChatGPT学姿势就是快</p>
<pre><code class="language-html">&lt;!DOCTYPE html [
  &lt;!ENTITY myEntity &quot;Hello World&quot;&gt;
  &lt;!ENTITY wow &quot;alert('hi')&quot;&gt;
]&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
&lt;body&gt;
  &amp;myEntity;
  &lt;script&gt;
    &amp;wow;
  &lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>保存到本地 1.xhtml，双击浏览器打开。谁能想到这也行？xml entity 还可以这样玩？</p>
<p>只要MIME为 <code>application/xhtml+xml</code> 就可以把HTML5当XML渲染。</p>
<p>部署了个在线demo： <a href="https://lab.est.im/svg-text/entity.xhtml">https://lab.est.im/svg-text/entity.xhtml</a></p>
<p>不敢相信自己眼睛，确认下是HTML5:</p>
<ul>
<li><code>document.compatMode</code> 返回 <code>CSS1Compat</code> 没问题</li>
<li><code>ocument.doctype</code> 返回 <code>&lt;!DOCTYPE html&gt;</code> 没毛病</li>
</ul>
<p>如果是老的兼容模式：</p>
<ul>
<li><code>document.compatMode</code> 为 <code>BackCompat</code></li>
<li><code>document.doctype.publicId</code> 为 <code>-//W3C//DTD HTML 4.01//EN</code></li>
<li><code>document.doctype.systemId</code> 为 <code>http://www.w3.org/TR/html4/strict.dtd</code></li>
</ul>
<p>思路打开了。哈哈</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2025-09-15T00:12:00+08:00">2025-09-15</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2025/stdout-07"  rel="bookmark" >
              <h2 class="card-title">disqus已卸载，手搓了套blog评论系统 - req4cmt</h2>
            </a>
            <p class="card-text"><p>一直用 disqus 主要是觉得方便（懒）。但是自从被墙了就很不方便了。加上近期开始强制插入广告，就更讨厌了</p>
<p>想找个替代品，很多基于 github 的，在 issue 盖楼，我觉得不方便备份，希望是能直接写入 repo的。这样一个 git clone 就搬家了。更不用说几乎都是基于 OAuth 的 github 登录实际上能拿到你所有 <code>repo</code> 的 scope，也就是能读写你所有公开（甚至私有）仓库内容。我一般都不点</p>
<p>于是决定手搓一个。</p>
<p>首先考虑的就是如何把内容写入 git repo。这个在做 <a href="https://blog.est.im/2025/stdout-05">gitweets</a> 已经调研尝试过了。</p>
<p>本着在 cloudflare worker 白嫖的心态，这种 serverless 的环境肯定不允许装 git 命令行或者 libgit 这种 .so，所以考虑 pure python 的 <a href="https://github.com/jelmer/dulwich">dulwich</a>。折腾了一下 python binding 发现CF居然是个WASM转译。那还不如js。还好nodejs生态也很丰富，有个纯js的实现 <a href="https://isomorphic-git.org/">isomorphic-git</a> 。</p>
<p>然后手搓了一下发现需要个 memfs 在内存里模拟文件IO。</p>
<p>其次是如何读取内容，评论列表以 <code>域名/路径.jsonl</code> 格式保存为纯文本，一行一条评论JSON，方便diff。将来可以做成 pull request 当成 moderation</p>
<p>本来想通过 git-http 来读文件，发现太慢了。干脆走捷径直接反代 <code>https://raw.githubusercontent.com/</code> 就行。本来也不用反代，一是这个域名被DNS屏蔽，二是加一个该死的CORS头才能跨域。</p>
<p>跑通之后接着就模仿disqus实现页面一段.js嵌入，渲染表单，展示评论列表等等，我的 js/css 实在捉急就搓了套最基础的。</p>
<p>能用就行！</p>
<p>防止spam这方面也没多想，看很多人说做 hidden input 就能拦住绝大部分，那就先这样跑着。除了评论框这个 <code>textarea</code> 甚至名字都是选填</p>
<p>尽可能做兼容，让在没有 .js 的情况下也能提交表单。当然得在嵌入页面的时候弄 <code>&lt;noscript&gt;</code></p>
<p>该项目严重依赖 cloudflare 和 github 两位赛博菩萨的免费额度，所以请求过多会被控频。实在不行弄个KV队列之类的。但是我这博客这么冷清，多虑了？</p>
<p>最后，把 disqus 老的评论都导出来了。毕竟是多年的回忆。</p>
<p>项目放在 <a href="https://github.com/est/req4cmt">https://github.com/est/req4cmt</a> 欢迎点评。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2025-09-10T22:38:00+08:00">2025-09-10</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2025/stdout-06"  rel="bookmark" >
              <h2 class="card-title">抗日</h2>
            </a>
            <p class="card-text"><p>看完阅兵式直播，记录一些最近几年才了解到的抗战细节：</p>
<ul>
<li><code>1941年4月13日</code>，苏联承认伪满洲国</li>
<li><code>1945年2月08日</code>，雅尔塔会议，罗斯福同意斯大林，保障大连港、中东铁路、南满铁路的利益，以及恢复俄罗斯海军在旅顺口的租赁  <br />
<img alt="Yalta Conference" src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d2/Yalta_summit_1945_with_Churchill%2C_Roosevelt%2C_Stalin.jpg/330px-Yalta_summit_1945_with_Churchill%2C_Roosevelt%2C_Stalin.jpg" /><br />
-<code>1945年6月24日</code>，苏联在莫斯科红场举行「伟大的卫国战争」胜利阅兵仪式，🇯🇵帝国陆军武官<code>矢部忠太</code>，帝国海军武官 <code>臼井淑郎</code>作为嘉宾受邀列席检阅红军。<br />
<img alt="" src="https://q0.itc.cn/q_70/images03/20250318/21d1f83e535a4d338b7ef9e4b51614b3.jpeg" /></li>
</ul>
<p><img referrerpolicy="no-referrer" width="600" src="http://i0.hdslb.com/bfs/new_dyn/343e8081690f82fefdc150af38c222f3518085624.jpg" /><br />
- <code>1945年8月06日</code>，美军用「Little Boy」核平广岛<br />
- <code>1945年8月08日</code>，苏联撕毁 《苏日中立条约》向🇯🇵宣战<br />
- <code>1945年8月09日</code>，美军用「Fat Man」核平长崎<br />
- <code>1945年9月02日</code>，🇯🇵在东京湾「USS Missouri」战列舰上向盟军投降<br />
- <code>1955年5月26日</code>，12万苏军的最后一批撤离旅顺、大连。至此大陆外国驻军清零。</p>
<p>东北就是东亚的波兰？</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2025-09-03T11:34:00+08:00">2025-09-03</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2025/stdout-05"  rel="bookmark" >
              <h2 class="card-title">gitweets：单html实现独立微博，拿git历史当feed流发推</h2>
            </a>
            <p class="card-text"><p>twitter争议不断持续多年，先是各种 cancel culture 闹得动静很大，被一龙马买了之后更甚，社区分裂到 mstdn nostr bsky支流，各种话题炒上天，在众多替代品里，2022年看到个<a href="https://twitter.com/bcrypt/status/1588416861552582657">最别具一格</a>的：</p>
<p>拿 git 当微博使</p>
<ul>
<li>发推： <code>git commit --allow-empty</code></li>
<li>加关注： <code>git remote add &lt;alias&gt; &lt;their fork url&gt;</code></li>
<li>转发： <code>git cherry-pick &lt;their "tweet"&gt;</code></li>
</ul>
<p>脑洞大开。而且git基于merkle tree的，p2p 历史不可篡改，有web3那味了。</p>
<p>当时就饶有兴趣，挖了个坑准备搓个web界面。但是限于涣散的注意力，以及对css这种抽象排版玩不转，一直拖沓没做好。</p>
<p>周末心血来潮，外带 AI 工具加持，进展神速。目前已经基本可用。</p>
<p>项目叫 gitweets ，意思是用 git 发 tweets，网址在 <a href="https://f.est.im/">https://f.est.im/</a> 。二级域名 <code>f</code> 即 <code>feed</code> ，<code>f.est</code> 也就是 fest 表示。。。 盛会的意思。 </p>
<h3>feature list</h3>
<ol>
<li>把任意 github repo 渲染成微博</li>
<li>给任意 github repo 发推。其原理是，通过REST API新增一条 commit 。</li>
<li><a href="https://f.est.im/est/e0d4c46445517ba52ceda06d788e09760aaccce5">发图</a>！如果 commit message 以冒号结尾，而且恰好也在本次新增加了位于 static 下面的图片文件 那么会尝试去加载图片作为附件渲染</li>
<li>写 commit 基于 OAuth app 实现。浏览器记录 access_token 到 cookie，理论上可用 8个小时。过期重登</li>
<li>如果你的 commit 有是通过 <code>-S</code> 参数提交带签名 ，那么展示为蓝色表示verified</li>
</ol>
<h3>记录一些坑</h3>
<ol>
<li>OAuth app vs Github App。前者是代客做事；后者是独立主体单独账号，类人行为，多用于 CI/CD</li>
<li>OAuth app 的 <code>scope</code> 如果是 <code>repo</code> 可以读写你所有仓库代码，包括私有仓库！网上的很多基于 github 的第三方评论系统有这个隐患！</li>
<li>我这里用的是 <code>public_repo</code>，读写所有公开仓库。毕竟 github是个开源社区，拿公开git来当feed使，要安全一些。</li>
<li>更安全的办法是只能读写单个指定的repo。要实现API读写git，在github有下列几种方法：<ul>
<li>REST API。可以用 fine grained PAT 读写一个repo</li>
<li>GraphQL API。</li>
<li>git 协议。走 <code>github.com:22</code> 端口。可以采用 deploy key 或者私人账号 ssh key</li>
<li>git-http。走 <code>https://github.com:443</code></li>
</ul>
</li>
<li>Private Access Token （缩写 PAT） 可以完全控制个人或者团队账号，fine grained PAT 可以只控制指定的几个仓库</li>
<li>deploy key默认只读，可以改成读写，一库一用，不能复用</li>
<li>REST API 列举 commits 不能获得当前 commit 改了哪些文件。需要额外N+1每个commit再次查询详情。背后的原因估计是 git 内部 ref 和 blob 是严格区分的。甚至可能是分开存的数据库表</li>
<li>网站是跑在赛博菩萨 cloudflare worker 上的。这种所谓“serverless”平台很强大了。功能齐全没啥缺的。甚至可以发起 tcp 连接。</li>
<li>本来计划走 git-ssh 或者 git-http 协议，想了下js操作binary太复杂了，弄个 libgit2 之类的库估计很重。还是REST方便</li>
<li>REST API 新增一个 empty commit 有多复杂？ 1. 获得当前branch 的 sha 2. 获得该 sha 的 tree 3. 新增一个 sha+tree 的commit 4. 把 ref 指向第三步的 sha 。啊，就不能一步完成么。下次有机会看看GraphQL 能不能一次调用完成</li>
<li>Github 的API 强制要求 User-Agent 。你可以乱写但是不能没有</li>
<li>Github 虽然返回了 <code>Access-Control-Allow-Origin: *</code>，但是现代浏览器他妈的不认这个 <code>*</code> 。所以在浏览器只能匿名调用 <code>GET</code> ，如果 <code>POST</code>， <code>PATCH</code> 带了 <code>credentials: "include"</code> 直接拒绝。网站必须显式指定允许哪个具体的 origin </li>
<li>cloudflare的 <code>Response.redirect('/')</code> 直接挂掉。原来是 3xx 跳转不允许相对路径。</li>
</ol>
<h3>why？</h3>
<p>由于习惯，古法写web，一个html包含了 css js 。无二次加载，无第三方依赖库。除了不能写死的全部写死 🤣。无需build。</p>
<p>源码放在 <a href="https://github.com/est/gitweets/">https://github.com/est/gitweets/</a> 。该仓库的 commit 历史也作为feed展示在 <a href="https://f.est.im/">https://f.est.im/</a> </p>
<p>接下来准备用类似的思路实现网站评论系统，代替现在的 disqus ，虽然它是免费的，但是广告太多了。</p>
<p>可能有人要问：why ？闲的蛋痛？</p>
<p>我想，首先的确蛋痛，because we can。其次是不想在平台，处处受人限制。然后也是最重要的，self-host。所有数据资料都在一个repo打包带走，备份什么的很方便。比如以前wordpress受众多功能全，但是后来大家都 hexo 之类的静态blog了。</p>
<p>我心目中 gitweets 就是“静态”微博的一种。虽然它现在还是依赖 github API。等有空了可以试试生成纯静态页面。</p>
<h3>ToDo</h3>
<ol>
<li>如何发视频 音频</li>
<li>如何转发</li>
<li>如何混合展示多个repo的feed。基于 pull request ？</li>
</ol>
<p>欢迎评论或者提 <a href="https://github.com/est/gitweets/issues">issue</a></p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2025-08-17T00:00:00+08:00">2025-08-17</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2025/stdout-04"  rel="bookmark" >
              <h2 class="card-title">A single Python function for both async/sync</h2>
            </a>
            <p class="card-text"><p>Scenario: I often need to write Python functions like:</p>
<ol>
<li>take some parameters and format them</li>
<li>call an API with the formatted parameters</li>
<li>parse the result and return chosen values</li>
</ol>
<p>There's a huge problem in step #2.</p>
<p>In today's Python world, troubles arise because async/await are "infectious", In practice this function is splitted - like in Python stdlib, where a vanilla <code>method</code> and its async counterpart <code>amethod</code> often come in pairs. Package authors scramble to provide sync transport and another async transport. I discovered this ugly fact while reading the source code of<code>redis-py</code>, <code>httpx</code> and <code>elasticsearch-py</code>.  Duplicate and lookalike code was always written twice. All it takes is some random async IOs in one place and your code would be forced to change forever.</p>
<p>Is there a way to write the function in one place, but callable both with async and without?</p>
<p>I pondered this question for ages, and today I stumbled upon something interesting:</p>
<pre><code class="language-python">
  def s1():
    return asyncio.sleep(1)

  async def s2():
    return await async.sleep(1)
</code></pre>
<p>There's virtually no difference when calling <code>await s1()</code> and <code>await s2()</code></p>
<p>I vaguely remembered how Python’s coroutines were designed, and after some tinkering, I came up with this snippet:</p>
<pre><code class="language-python">
import asyncio, types, functools

def aa(f):
    &quot;&quot;&quot;
    make a function both awaitable and sync
    idk how to property name this. anti-asyncio (aa) maybe?
    &quot;&quot;&quot;
    @functools.wraps(f)
    def wrapper(func, *args, **kwargs):
        if asyncio.iscoroutinefunction(func):
            return types.coroutine(f)(func, *args, **kwargs)
        else:
            async def afunc(*a, **kw):
                return func(*a, **kw)
            g = types.coroutine(f)(afunc, *args, **kwargs)
            try:
                while True: next(g)
            except StopIteration as ex:
                return ex.value
    return wrapper


@aa
def my_func(func, *args, **kwargs):
    # prepare args, kwargs here
    # add a prefix `yield from` everywhere, for either sync/async
    result = yield from func(*args, **kwargs)
    # handle the result here
    return result


import httpx

# async
async def main():
    # the same as `await httpx.AsyncClient(timeout=3).get('https://est.im')`
    print(await my_func(httpx.AsyncClient(timeout=3).get, 'https://est.im/'))
asyncio.run(main())


# sync
print(my_func(httpx.get, 'https://est.im'))
# works the same as httpx.get('https://est.im')

</code></pre>
<p>The above shows a single function called <code>my_func</code>, dependency injection of an HTTP <code>get</code>  call of either sync/async, allows for customizable  pre- and post-processing logic, and returns the result with clean syntax.</p>
<p><strike>The only mental tax: inside <code>my_func</code>, you have to replace all <code>await</code> keyword with `yield from.</strike></p>
<p>Update 2025-05-16: The only mental tax: add a <code>yield from</code> prefix for every <code>func</code>calls for IO or API, either sync or async.</p>
<p>It solves all problems for my scenario and I’ve yet to find a simpler solution. If you have a good name for the <code>@aa</code> decorator please comment!</p>
<p>A sidenote, I am not sure if this method affects async schedulers and blocks something maybe? Like the <code>while True</code> might be a new kind of GIL. Also i haven't looked at problems with contextvars.</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2025-05-14T14:35:00+08:00">2025-05-14</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2025/stdout-03"  rel="bookmark" >
              <h2 class="card-title">Windows 自动设置开机锁屏壁纸 V3</h2>
            </a>
            <p class="card-text"><p>之前也写过，Windows下自动设置墙纸 <a href="/202104/stdout-005">V1</a>，<a href="/2021/stdout-024">V2</a>，今天发现两种方法都失效了。</p>
<p>于是一气之下搞了个 Bing Image of the Day 版本的。</p>
<p>保存为 change_wallpaper.bat 双击执行。加入自启动或者定时触发。</p>
<pre><code>@if (@X)==(@Y) @end /* set Win10 wallpaper to Bing Image of The Day. By est.im
@echo off
cscript //Nologo //U //E:JScript "%~F0"
exit /b %errorlevel%
*/

function http_get(url){
  var xhr = new ActiveXObject("MSXML2.XMLHTTP")
  xhr.open("GET", url, false)
  xhr.setRequestHeader("Accept-Encoding", "identity")
  xhr.send()
  return xhr
}

var rss_req = http_get('https://www.bing.com/HPImageArchive.aspx?format=rss&amp;idx=0&amp;n=1&amp;mkt=en-US')
// WScript.Echo(rss_req.getAllResponseHeaders())
var img_url = 'https://www.bing.com' + rss_req.responseXML.selectSingleNode("//rss/channel/item/link").text
WScript.echo(img_url)
var fso = new ActiveXObject("Scripting.FileSystemObject")  // shit cant handle binary data
var stream = new ActiveXObject("ADODB.Stream")
var img_path = fso.GetSpecialFolder(2)+"\\bing_iotd.jpg"
WScript.echo(img_path)
stream.Open()
stream.Type = 1
var img_req = http_get(img_url)
stream.Write(img_req.responseBody)
stream.SaveToFile(img_path, 2)
stream.Close()

var WshShell = new ActiveXObject("WScript.Shell")  
WshShell.RegWrite("HKEY_CURRENT_USER\\Control Panel\\Desktop\\Wallpaper", img_path, "REG_SZ")
WshShell.Run("RUNDLL32.EXE user32.dll,UpdatePerUserSystemParameters")
</code></pre>
<p>其中 <code>format=rss</code> 可以改成 <code>=js</code> 或者 <code>=xml</code> 本来想解析 json 但是发现老的 IE6 引擎不能支持双引号这种JSON，而且只能用 <code>eval()</code> 就放弃了。还好有 xpath 还挺方便。</p>
<p>要用 .bat 套一层是因为 win10 貌似禁止 <code>.js</code> 或者 <code>.vbs</code> 双击执行了。病毒木马太多了。这种一份源码同时被两种语言解析还有点<a href="/cnblogs/600416">技巧</a>可以参考下。</p>
<p>很久没写 .jscript 了用了 ChatGPT 这个 vibe coding 真爽。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2025-04-25T23:49:00+08:00">2025-04-25</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2025/stdout-02"  rel="bookmark" >
              <h2 class="card-title">正则获得国际电话前缀</h2>
            </a>
            <p class="card-text"><p><a href="https://blog.est.im/post/48751778838">2013年</a>的时候喷过ITU这个国际电话号码，前缀是变长的问题</p>
<p>今天遇到问题，需要按国际区号初步分析归属地和供应商，<a href="https://stackoverflow.com/questions/2113908/">stackoverflow</a>和AI给的都很渣，写了个正则：</p>
<pre><code>re.compile(r"""\+
    (1  # north america
    |(?:  # 3 digits
        21|22|23|24|25|26|29|35|37|38|42|
        50|59|67|68|69|80|85|87|88|96|97|99)\d
    |[2-9]\d)  # two digits
""", re.VERBOSE)
</code></pre>
<p><code>+1</code> 开头的是北美，然后依次寻找3位的，再匹配2位的。</p>
<p><code>+7</code> 本来是苏联的，现在给 哈萨克斯坦 和 俄罗斯 了，就当成两位的判定吧。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2025-02-25T11:38:00+08:00">2025-02-25</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2025/stdout-01"  rel="bookmark" >
              <h2 class="card-title">面向老外最容易理解的“春节”定义，以及其它</h2>
            </a>
            <p class="card-text"><h3>用英语把 春节 讲明白</h3>
<p>最近小红书 #tiktokrefugee 以及所谓的“中美对账”很火，然后又吵到 Chinese new year, 和 lunar new year 怎么叫，案例说闲来无事，我想搞明白究竟春节是怎么定的？</p>
<blockquote>
<p>最接近立春之朔日（月缺之日）为正月初一</p>
</blockquote>
<p>依赖历法，那么接着查</p>
<blockquote>
<p>冬至所在之朔望月为十一月</p>
</blockquote>
<p>这又是太阳历又是月亮历的，还有二十四节气。要把“春节”这玩意脱离汉文化的基础背景定义下来，很麻烦。在翻二十四节气的时候，灵机一动，因为二十四节气是太阳历，和公历几乎严丝合缝，公历又和星座能对应的上。那么春节其实可以最大程度的简化定义为：</p>
<blockquote>
<p>水瓶座的新月夜。</p>
</blockquote>
<p>新月就是看不到一丁点月亮，和满月相对。</p>
<h3>AI 能理解 春节 吗</h3>
<p>为了验证我这个说法，我问了ChatGPT：</p>
<blockquote>
<p>What's the new moon day of 2025 Aquarius zodiac sign?<br />
The new moon in Aquarius for 2025 will occur on January 29, 2025.<br />
What's the new moon day of 2024 Aquarius zodiac sign <br />
The New Moon in Aquarius in 2024 will occur on February 9, 2024</p>
</blockquote>
<p>2024年差了一天怎么回事？新月 (new moon) 作为天文现象是发生在一个确定时间的。但是对应到世界各地，当地时区的原因，可能差1天。所以我感觉这个说法是 close enough 了。</p>
<p>国产AI Deepseek 思考的也不错：</p>
<blockquote>
<p>What's the new moon day of 2025 Aquarius zodiac sign?<br />
the new moon day for the Aquarius zodiac sign in 2025 is January 29, 2025.<br />
how about 2024<br />
the new moon day for the Aquarius zodiac sign in 2024 is February 9, 2024</p>
</blockquote>
<p>我想看下 R1 推理能力，于是问了一嘴：</p>
<blockquote>
<p>what's the special holiday of this day?<br />
For January 29, 2025, the new moon day in Aquarius, there are no major globally recognized holidays</p>
</blockquote>
<p>看来傻了。我换了下 ChatGPT</p>
<blockquote>
<p>any holiday on that day?<br />
Yes! January 29, 2025, falls on Lunar New Year’s Eve, which is the day before the Chinese New Year (Year of the Snake).</p>
</blockquote>
<p>R1 对自己上下文可能不太重视。</p>
<h3>春节 怎么翻译</h3>
<p>这个问题想完，回到一开始的问题，有人说 CNY 和 LNY 都不好，不如直接叫 Spring Festival 。我觉得，很有道理。毕竟英语对所有外来词都是音译。<a href="https://www.zhihu.com/question/11047706645/answer/96973692909">比如</a></p>
<ul>
<li>春卷，英语一般称为 Spring Roll，而不是 Chinese Burrito</li>
<li>馒头，英语一般称为 Mantou或者 Steamed Bun。而不是 Chinese Bread</li>
<li>云吞，英语一般称为 Won Ton。而不是「Chinese Ravioli</li>
</ul>
<p>但是进一步想，英语为啥就能接受 burrito、ravioli 这样的外来词汇，不如干脆直接叫 Chunjie ？</p>
<p>其实，全世界的主要语言里，只有汉语还在坚持“意译”。别的语言早弃疗了，直接音译或者 transliteration。原因很简单，全世界主要语言里，只有“中文”是非 alphabet 体系。其它的文字都是表音的。只要发音一样，就是同一件事物，按不同的字母表书写而已。</p>
<p>如果按照这个思路，全世界的拼音语言，不出意外，都会趋势都会被英语统一，成为 Lingua franca。这也是我前一篇blog说为啥<a href="https://blog.est.im/2025/stdin-02">要学习英语</a>。</p>
<p>除了一个例外——中文。主要语言里，只有中文还在孜孜不倦的把一切外来和新鲜事物，用古老的文字重新描述 “reinterpret” 一番。久远一点的，国外叫 twitter，国内非得叫 sina microblog, sohu microblog, tencent microblog，近一点的，全世界都叫 AI，LLM这样的缩写，就国内坚持叫 “人工智能”，“大模型”。 大模型还省略“语言”两个字</p>
<h3>homeless 和房产税</h3>
<p>又想起这段时间 “中美对账”引发的第二个问题。老美很多 homeless，所以有讨论国内为啥没流浪汉。很多人说是因为城管，户籍制度。因为社会主义有一个操作叫“遣返原籍”，无论你去哪个城市流浪，总能根据身份证地址把你搞回老家。</p>
<p>既然有老“家”，其实按字面意思，不能算 home-less 了。只能说当地无房而已。</p>
<p>由此想到一个问题，房产税和户籍制度是矛盾的。老美因为没有 property  所以变 homeless 所以没有 bill address 所以无法申请社保和银行卡，无法参与社会生产从而只能乞讨。如果国内也开始搞 property tax，那么首先的技术问题就是在哪个环节征收？</p>
<p>最大的可能性就是交易环节。那么大不了不卖了，就出租，子子孙孙传一辈子。退一步说，你欠房产税，行政部门会把你房子拍卖吗？如果你觉得会，那么问题来了，和欧美最大的不同，请问你没房之后，户籍地址写哪里？</p>
<p>有人说，上集体户啊。集体户其实从设计上来说，必须得有“单位”挂靠的。就算最近几年搞出来所谓“人才落户”，这也建立在你在当地有一定就业能力，有潜在的“雇主”背书的。你都交不起房产税了，哪个人才中心敢接收你的户口啊？接收户口，意味着以后所有关于这个“人”的麻烦都归属地管理。</p>
<p>按照这个推演，房产税只有三个结果：</p>
<ol>
<li>不实施；或者实施了不怎么收（参考重庆上海）</li>
<li>实施+欠费没收，动摇户籍制度</li>
<li>只针对多套房产实施，那么必然会带来大量的技术性离婚。</li>
</ol>
<h3>中美最卷</h3>
<p>和朋友聊中美话题，说现在贸易战产业转移，印度和东南亚有没有可能崛起。我说了几个反驳的理由：</p>
<ol>
<li>东南亚是产业“回流”，不是转移。别人70年代红红火火的，是广东抢走了饭碗。现在是吐出去</li>
<li>东南亚基本上都是“发达国家”。我觉得 "developed" 在英语里，压根不是“发达”的意思，而是 过去时，表示 发展到头了，没进步空间了，天花板了。去过几次东南亚旅游发现当地20年、30年前怎么样，现在还是那样。</li>
<li>一个国家能否崛起，从草根视角，就是看喜欢打拼的人，有没有出头之日？有的话，这个国家就会超过中美，如果没有，中美就会收割。。。印度和东南亚里，有这样的制度和文化的吗？在国内，这样的制度和文化其实不是好事，而是一种压迫。</li>
<li>全世界只有华人和老美最卷。前几天听到一个老美vlogger说了个事让我震惊，她说老美觉得休假是“可耻”的。之前也有耳闻，老美吃午饭特别怕耽误老板时间，也不敢午休。Hacker News上一些欧洲人也经常评论说老美的 work culture 是非常 toxic 的，太拼了。</li>
</ol>
<p>全世界只有老中和老美最拼，这个说法，是我从一个拿了中国绿卡的美国演员 曹操 那里听到的</p>
<p><a href="https://www.bilibili.com/video/BV1xe4y1o7wg/">https://www.bilibili.com/video/BV1xe4y1o7wg/</a></p>
<p>他的理论是，全世界绝大部分的人，都是挣钱能凑合过日子就行了。work to live。那种不要命挣钱，live to work的文化只有儒家有。美国出发点不一样，全世界那种少数天生喜欢拼命挣钱的人，都受不了当地懒散和松弛，润美去干大事挣大钱了。</p>
<p>言之有理啊。以前欧洲那种日子过不下去敢去一个陌生的未知的新大陆打拼的，都不是等闲之辈。所以一代传一代搞出来这么一个打拼的文化。</p>
<hr />
<p>今日份的胡思乱想就到这了。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2025-02-12T16:06:00+08:00">2025-02-12</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-06"  rel="bookmark" >
              <h2 class="card-title">Little known facts about Han</h2>
            </a>
            <p class="card-text"><p>I was planning to publish this article on 2024-04-05 00:01, but rejected because it looked silly for this blog. On that day, butt hurt as usual, I watched this short-vid called <a href="https://www.douyin.com/video/7345777842376019252">Why Sichuan people were chill</a>, by the influencer 罗胖. I was quite amazed by his 3.79M many fans and more strangely, IP location: Sichuan. I followed the article he mentioned: <a href="https://www.dedao.cn/course/article?id=rykaNlMY5gn3Jq19QdJ7EAROW0DLje">1001 A.D. and How Sichuan got its name?</a> and find it quite interesting, as all history lessons are.</p>
<p>So let's explore the little known details and find out why history of Sichuan is somewhat special (Whig-style narrative alert!)</p>
<h2>The birthplace of Taoism</h2>
<p>Records shows that the birthplace of Taoism, the most chill religion ever, points to 鹤鸣山 at 大邑, and the 青城山 nearby was considered a holy mountain. Some say 龙虎山 at 江西 as an alternative, but in my opinion its where the <em>tianshi</em> (prophet) 张道陵 pactice his alchemy rather than the developing the belief，The real deal including Wudoumi movement clearly originates from 龙门 mountain ranges on the western of Chengdu plain.</p>
<h2>Inspired by Buddhism</h2>
<p>When I was searching for tourist attactions I found that 鹤鸣山 were suspiciously connected to Buddhism. Chinese Buddhism were first landed at 白马寺 at then capital 洛阳 at 68 B.C. But 白马寺 itself wasn't supposed to be a <em>temple</em> per se, but rather a settlement sponsored by the imperial court. There were nine houses of governance established by Han court covering Justice, Sacrifices, Royal affairs, Carriages and so on, one of them is 鸿胪寺 for Royal Hospitality. The 白马寺 was built by the order of the Second Emperor of E. Han as a guest house to translate the <em>42 chapters of Sutra</em> acting like a 鸿胪寺. Some 6 years later, after the job were done, the two buddhist monks, 迦什摩腾 and 竺法兰, went to Sichuan seeking a legendary mountain called 雾中山 according a prophecy. The prophecy were carved on a Ming-era stele 开化寺碑记, describes the Buddha Shakyamuni, when about to enter Nirvana in the city of Kushinagar, once said to his disciple Sariputta:</p>
<blockquote>
<p>“我灭去七百年，尔往震旦雾中大光明山。山脉发源于昆仑，有七十二峰，为古佛弥陀道化之所。严密保护，嗣后圣者来居。”</p>
</blockquote>
<p>So the two Indian monks built a real Buddhism temple 开化寺 on 雾中山 and began spreading the religion there. It's said the temple had a collection of Pāli Canon transcribing Theravada Buddhism, one of the O.G. version of two Buddhism major branches in Asia.</p>
<p>So what's the connection anyway? The first prophet of Taoism, <em>tianshi</em> Zhang, chose 鹤鸣山 somewhere 10km near the first Buddhism temple</p>
<p><img alt="" src="/images/2024/stdout-06-01.jpg" /></p>
<p>And later Taoism flourished in Sichuan, like Wudoumi, and ultimately, its variant Taiping-Tao, wrecked the mighty Han empire.</p>
<p>I also commented this travia <a href="https://news.ycombinator.com/item?id=42254106">on HN</a></p>
<p>The doctrine of religious Taoism and Buddhism were strikingly similar, which leds to series of conflicts and accusations over the millennia. The most famous example, <em>Laozi Converted the Barbarians 老子化胡经</em> were publicly debated in Mongol-era imperial court and Taoist lost the battle.</p>
<h2>Silk</h2>
<p>Also an interesting article from HN <a href="https://news.ycombinator.com/item?id=42297733#42305823">Evidence of the use of silk by Bronze Age civilization</a>, which I also commented, because some guy suggests Sichuan were once non-Han, it triggered me. TFA states (with my edits): </p>
<blockquote>
<p>HuangDi lived on the hill of Xuanyuan and married the daughter of Xiling clan. HuangDi's consort Leizu of Xiling taught others to raise silkworms, and the legend Leizu is from the people of Chengdu in Sichuan. <em>Shu</em> refers to “mulberry worms” aka “silkworm larvae”. The character <em>Shu</em> is related to the initial sericulture, referring to the beginning of the Shu State and the people, for whom sericulture was central to their economic activities.</p>
</blockquote>
<h2>HuangDi</h2>
<p>For those who aren't familiar, <em>HuangDi</em> the Yellow Emperor was considered the ancester of the Han, the Hun, the Hmong and Xianbei of the Siberians. The second son of <em>HuangDi</em>, married ChangPu from the Shu clan. Their son <em>zhuānxū</em> was another <em>Di</em>, out of the <em>5 Di of Ancient Kings 五帝</em></p>
<h2>Baijiu</h2>
<p>Baijiu, the Kaoliang liquor, strong distilled from great millet, were first introduced in Sichuan known as 蜀黍. Even today top notch brands like <em>Maotai</em> were from  the Chishui Valley of Sichuan (administratively divided to Guizhou by purpose)</p>
<h2>Han</h2>
<p>But what does <em>Han</em> has anything to do with Sichuan? Well everything does. The literal meaning of "Han" traces back to LiuBang, the Great King of Han, founder and first ruler of the Han dynasty, literally settled his fief over Sichuan (Ba, Shu, Hanzhong and its 41 counties). Liubang spent his next 5 years elimilated all his enemies and began the first Pax Sinica of 300 years.</p>
<p>The second Pax Sinica, led by the Great Worrier Li Shimin, also titled <em>Yizhou Acting Desk of the Supreme Book</em>. To explain, <em>the Supreme Book</em> refers to 尚书, the source of great power, the source of ultimate authority, one and only text that describes how Chinese civilization came into being since ancient times. The Desk is the government body where the book operates, Yizhou Acting Desk is like the copy that covers Sichuan, aliased Sichuan. The soldiers of Sichuan, as the last reserve force led by general 窦轨, joined Li Shimin for the final attack on Dou JianDe on 620 A.D. at the Hulao Pass, which leds to the live capture of two kings, and helped Li Shimin rose to throne.</p>
<h2>8 Partners of Oath</h2>
<p>The fighting spirit of Sichuan soldiers dates back. An oath was taken between Zhou and 8 partner states, including Shu, as described in <em>the Supreme Book</em> on Zhou chapter 4, to rebel against the cruel Shang dynasty. The battle took place at 牧野 on 1046 B.C. where the Ba people performed a war dance on the frontline and Shang army collapsed upon witness.</p>
<h2>Libai and the Great Prose Masters</h2>
<p>Libai, the God of Poetry, was raised in Sichuan, but where he's born is debatable. However, four out of the Eight Great Prose Masters, were born in Sichuan. So it's either Libai a Sichuanese or Ouyang Xiu, or both.</p>
<h2>... and there's more</h2>
<p>That's all of the trivia I could think of, for now! Leave a comment if you think otherwise. Feel free to correct my English mistakes please, as I am an ESL blogger without use of any AI</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-12-03T22:26:00+08:00">2024-12-03</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-24"  rel="bookmark" >
              <h2 class="card-title">ss命令抓linux下偶发端口访问</h2>
            </a>
            <p class="card-text"><p>Linux服务器一直有个TCP连上来发数据，跑到对应的机器上发现连接已经断了，对应的进程也退出了。估计是某种定时任务。</p>
<p>排查代码无果，只能通过命令行来监控。这里直接上<code>ss</code>命令</p>
<pre><code>  while true; do pid=$(ss -tanpe state established 'dst 10.11.22.33:4455'  | awk 'match($0,/pid=([0-9]+)/,a){print a[1]}'); [[ -n $pid ]] &amp;&amp; tr '\0' ' ' &lt;/proc/$pid/cmdline ; sleep 0.2; done;
</code></pre>
<p>解释下：</p>
<ol>
<li><code>while true; do ...; sleep 0.2; done;</code>每0.2s反复刷新执行指定命令。</li>
<li><code>ss -tanpe state established 'dst 10.11.22.33:4455'</code><br />
 - <code>-t</code> 选项表示显示 TCP 连接。<br />
 - <code>-a</code> 显示所有连接。<br />
 - <code>-n</code> 不解析主机名、端口。<br />
 - <code>-p</code> 显示进程信息。<br />
 - <code>-e</code> 显示额外的详细信息。<br />
 - <code>state established</code> TCP已连接<br />
 - <code>dst 10.11.22.33:4455</code> 过滤TCP目标地址+端口</li>
<li><code>awk 'match($0,/pid=([0-9]+)/,a){print a[1]}'</code> 提取出 pid</li>
<li><code>[[ -n $pid ]] &amp;&amp; tr '\0' ' ' &lt;/proc/$pid/cmdline</code>  从procfs读取该进程启动时的命令和参数。且把空字符 <code>\0</code>替换为空格</li>
</ol>
<p>综合起来：不断地查询目标 IP 地址和端口的网络连接，找到与之相关的进程 ID，并显示该进程的命令行。每隔 0.2 秒刷新一次，持续监控这个连接对应的进程。</p>
<p>跑了一阵子，发现 $pid 可能有多行。囧，只能用双层 <code>while</code> 了：</p>
<pre><code>  while true; do ss -tanp state established 'dport = 2333' | awk 'match($0,/pid=([0-9]+)/,m){print m[1]}' | while read -r pid; do echo $(date '+%F %T') $pid $(readlink -f /proc/$pid/cwd) $(tr '\0' ' ' &lt;/proc/$pid/cmdline); done ;  done;
</code></pre></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-11-28T09:45:00+08:00">2024-11-28</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-23"  rel="bookmark" >
              <h2 class="card-title">白嫖百度网盘“单次转存数”500限制</h2>
            </a>
            <p class="card-text"><p>找了个资源，点击保存，居然提示充SVIP。看了下免费用户每次最多保存500份文件。本来找资源就白嫖，让我充钱？</p>
<p>研究了一会儿，发现可以搞。</p>
<ol>
<li>首先你去你网盘里建立个目录 <code>0000-0500</code>，准备存文件。这么起名字是因为你在自己网盘里多选也是最多选500个，所以每次存一个目录用来对照数量</li>
<li>分享链接里文件列表默认只展示前100条，是惰性加载，所以请用鼠标一直反复向下滚，务必拉到底，然后点击「名称」排序。这样方便对比有没有漏掉</li>
<li>F12打开 console 并粘贴下面的js。如果这一步看不懂建议直接放弃  <br />
    Array.prototype.slice.apply(document.querySelectorAll(<br />
      '.share-list dd.open-enable&gt;span'<br />
    ), [0, 500]).forEach((x)=&gt;x.click())<br />
这样就等效点击了前500个文件。点击保存。</li>
<li>等全部存好，再次执行上一段代码，取消点击前500个文件。</li>
<li>去你的网盘里新建个目录 <code>0500-1000</code> ，用来保存下一批</li>
<li>把上面代码里的 <code>[0,500]</code> 改成 <code>[500,1000]</code> 然后再执行一遍，保存到刚才创建的目录里。</li>
<li>如果有更多的文件，在执行一遍 <code>[500,1000]</code> 这一批，取消点击；然后改成 <code>[1000,1500]</code> 如此反复。</li>
</ol></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-11-01T00:15:00+08:00">2024-11-01</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-22"  rel="bookmark" >
              <h2 class="card-title">Linux删除了 .ru 帐号？我查了一下</h2>
            </a>
            <p class="card-text"><p><a href="https://www.zhihu.com/question/1783342926">发生了什么事</a>？</p>
<blockquote>
<p>日前，Linux 内核主要维护者之一 Greg Kroah-Hartman (Greg K-H) 提交了一项不寻常的“文档”更新，将数名具有 &lt;.ru&gt; 顶级域名邮箱的维护者，和一名明确为俄罗斯身份的维护者从 MAINTAINERS（维护者名录）文件除名。<br />
这一提交已于上周日被 Linus Torvalds 拉取并包含于 6.12-rc4 版本的代码中。<br />
已有来自于 AOSC 的开发者提交了 revert(尚未合并)，而 Linus 本人在评论中声明其对先前的 commit 知情并支持</p>
</blockquote>
<p>一开始，我以为是 “反向” <a href="https://x.com/siyuanbear/status/1848644797076279545">厚脸皮PR</a></p>
<p><img referrerpolicy="no-referrer" src="https://pbs.twimg.com/media/Gae0pQdbEAE-0JJ?format=jpg&name=medium" /></p>
<p>一般来说， github 上混一个 contributor 得贡献代码，很多人就改改文档、翻译就拿到一个“贡献者”称号（我也干过哈哈哈）。甚至还有离了大谱的，直接提一个 pull request 内容是把自己加到 contributors 文件里。。</p>
<p>我以为是 Linux Foundation 发疯了，为了某种 “合规” 或者 sanction，掩耳盗铃，把 作者名字列表.txt 改改掩人耳目</p>
<p>仔细看了下，发现好像并不是那么简单。这里是diff</p>
<p><a href="https://github.com/torvalds/linux/commit/6e90b675cf942e50c70e8394dfb5862975c3b3b2">https://github.com/torvalds/linux/commit/6e90b675cf942e50c70e8394dfb5862975c3b3b2</a></p>
<p>这里是更改后完整的 <code>MAINTAINERS</code> 内容：</p>
<p><a href="https://github.com/torvalds/linux/blob/6e90b675cf942e50c70e8394dfb5862975c3b3b2/MAINTAINERS">https://github.com/torvalds/linux/blob/6e90b675cf942e50c70e8394dfb5862975c3b3b2/MAINTAINERS</a></p>
<p>直接通过 github API 拿到原始的 diff</p>
<p><code>curl -H'Accept: application/vnd.github.diff'  -sk 'https://api.github.com/repos/torvalds/linux/commits/6e90b675cf942e50c70e8394dfb5862975c3b3b2'</code></p>
<p>乱写几个 prompt 丢给 gpt-4o，可以看到大概做了下列几处更改：</p>
<table>
<thead>
<tr>
<th><strong>Device/Module</strong></th>
<th><strong>Probable Date</strong></th>
<th><strong>Author</strong></th>
<th><strong>Email</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Acer Aspire 1 Embedded Controller</td>
<td>~2018</td>
<td>Nikita Travkin</td>
<td>nikita@trvn.ru</td>
</tr>
<tr>
<td>Alpha Port (Ivan Kokshaysky removed)</td>
<td>~1992</td>
<td>Ivan Kokshaysky (removed)</td>
<td>ink@jurassic.park.msu.ru</td>
</tr>
<tr>
<td>ARM/Cirrus Logic CLPS711X Architecture</td>
<td>~1996</td>
<td>Alexander Shiyan</td>
<td>shc_work@mail.ru</td>
</tr>
<tr>
<td>Baikal-T1 PVT Hardware Monitor</td>
<td>~2015</td>
<td>Serge Semin</td>
<td>fancer.lancer@gmail.com</td>
</tr>
<tr>
<td>GRE Demultiplexer Driver</td>
<td>~2000</td>
<td>Dmitry Kozlov</td>
<td>xeb@mail.ru</td>
</tr>
<tr>
<td>LIBATA PATA Drivers</td>
<td>~2003</td>
<td>Sergey Shtylyov</td>
<td>s.shtylyov@omp.ru</td>
</tr>
<tr>
<td>LIBATA SATA AHCI Synopsys DWC Driver</td>
<td>~2014</td>
<td>Serge Semin</td>
<td>fancer.lancer@gmail.com</td>
</tr>
<tr>
<td>Media Drivers for Ascot2E</td>
<td>~2010</td>
<td>Sergey Kozlov, Abylay Ospan</td>
<td>serjk@netup.ru, aospan@netup.ru</td>
</tr>
<tr>
<td>Media Drivers for CXD2841ER</td>
<td>~2015</td>
<td>Sergey Kozlov, Abylay Ospan</td>
<td>serjk@netup.ru, aospan@netup.ru</td>
</tr>
<tr>
<td>Media Drivers for Helene</td>
<td>~2017</td>
<td>Abylay Ospan</td>
<td>aospan@netup.ru</td>
</tr>
<tr>
<td>Media Drivers for Horus3A</td>
<td>~2018</td>
<td>Sergey Kozlov, Abylay Ospan</td>
<td>serjk@netup.ru, aospan@netup.ru</td>
</tr>
<tr>
<td>Media Drivers for LNBH25</td>
<td>~2012</td>
<td>Sergey Kozlov, Abylay Ospan</td>
<td>serjk@netup.ru, aospan@netup.ru</td>
</tr>
<tr>
<td>NetUP PCI Universal DVB Devices</td>
<td>~2010</td>
<td>Sergey Kozlov, Abylay Ospan</td>
<td>serjk@netup.ru, aospan@netup.ru</td>
</tr>
<tr>
<td>MIPS Baikal-T1 Platform</td>
<td>~2015</td>
<td>Serge Semin</td>
<td>fancer.lancer@gmail.com</td>
</tr>
<tr>
<td>NTB IDT Driver</td>
<td>~2014</td>
<td>Serge Semin</td>
<td>fancer.lancer@gmail.com</td>
</tr>
<tr>
<td>PPTP Driver</td>
<td>~1996</td>
<td>Dmitry Kozlov</td>
<td>xeb@mail.ru</td>
</tr>
<tr>
<td>Renesas Ethernet AVB Driver</td>
<td>~2013</td>
<td>Sergey Shtylyov</td>
<td>s.shtylyov@omp.ru</td>
</tr>
<tr>
<td>Renesas R-Car SATA Driver</td>
<td>~2015</td>
<td>Sergey Shtylyov</td>
<td>s.shtylyov@omp.ru</td>
</tr>
<tr>
<td>Renesas SuperH Ethernet Driver</td>
<td>~2000</td>
<td>Sergey Shtylyov</td>
<td>s.shtylyov@omp.ru</td>
</tr>
<tr>
<td>Synopsys DesignWare APB SSI Driver</td>
<td>~2010</td>
<td>Serge Semin</td>
<td>fancer.lancer@gmail.com</td>
</tr>
<tr>
<td>UFS Filesystem</td>
<td>~1974</td>
<td>Evgeniy Dushistov</td>
<td>dushistov@gmail.com</td>
</tr>
</tbody>
</table>
<p>如果说作者 @gregkh 作出这个改动的动机说</p>
<blockquote>
<p>Remove some entries due to various compliance requirements </p>
</blockquote>
<p>那么 BAIKAL 这个是明显会去掉。其余的改动，我能认出来的比较重要的有 PPTP Driver，其它都是五花八门驱动的维护者，感觉就算去掉， impact 的功能也不多。</p>
<p>当然你也可以说 first they came for the ... 我就不继续展开了</p>
<p>下面列举几个可能不那么重要，但是我觉得很容易被忽略的事实：</p>
<h3>一、 .ru 的邮箱被全部移除了吗？</h3>
<p>是的。最新版本 <a href="https://github.com/torvalds/linux/blob/master/MAINTAINERS"><code>MAINTAINERS</code></a> 文件里我搜了 <code>.ru</code>、<code>russia</code> 关键词没找到了。干干净净。当然后期会不会加回来我不知道。</p>
<h3>二、 俄国人对 Linux 的贡献被抹掉了吗？</h3>
<p>第一，上面这些人的对应代码贡献，目前并没有删掉。</p>
<p>第二，Linux 源码根目录还有一个 <a href="https://github.com/torvalds/linux/blob/master/CREDITS"><code>CREDITS</code></a> 文件，里面包含了下列俄国人：</p>
<pre><code>N: Yuri Per
E: yuri@pts.mipt.ru
D: Some smbfs fixes
S: Demonstratsii 8-382
S: Tula 300000
S: Russia

N: Alexey Kuznetsov
E: kuznet@ms2.inr.ac.ru
D: Author and maintainer of large parts of the networking stack

N: Stas Sergeev
E: stsp@users.sourceforge.net
D: PCM PC-Speaker driver
D: misc fixes
S: Russia

</code></pre>
<h3>三、 俄国人不能参与 Linux 项目了吗？</h3>
<p>我在这里想补充一个背景知识，什么是 Linux Kernel 的 <strong>maintainer</strong> ？</p>
<p>内核功能繁多，Linus 老爷子一个人照看不过来，得把拆分成各个模块，授权给相应的 负责人(maintainer)，给予他们检查、合并代码的权限。Linux基金会（注册地：美国）会给他们配置一个专用邮件列表用来主持专项议事</p>
<p>上面这句话，如何理解？可能对某些简中读者没看明白。简单的说：.ru 用户还是可以以 developer 身份向别的 maintainer 提交代码。这里不得不提到那个出名的 kernel git workflow</p>
<p>这是普通 git 项目的工作流：</p>
<p><img alt="" src="https://git-scm.com/book/ms/v2/images/centralized_workflow.png" /></p>
<p>这个是 linux kernel 的（图很老，大概这个意思）：</p>
<p><img alt="" src="https://chenweixiang.github.io/assets/linux_kernel_code_flow.jpg" /></p>
<p>普通人是没法直接向 mainline <a href="https://github.com/torvalds/linux">https://github.com/torvalds/linux</a>  提交代码的。这个社区甚至会给你一个<a href="https://www.kernel.org/doc/html/latest/process/1.Intro.html">长长的文档</a>教你一步一步如何提代码 </p>
<p>不要说新功能了，一些老功能的 patch 要赶上主线发车窗口，你手续流程都很长。</p>
<p>想给内核做贡献，你要面对的甚至都不是 Linus 本尊，恰好是这些 <code>MAINTAINERS</code> 里列举的各位把关人。世界上绝大部分的人对 Linux 内核做贡献都是这样。 maintainer 是极少数，他们可以直接向 Linus 提改动。</p>
<p>Linus 自己也说了，他是芬兰人，意思就是说他不想看到俄国人。啊这。能理解，不提倡！</p>
<h3>四、maintainer 名单变化多吗？</h3>
<p>从提交历史来看，</p>
<p><a href="https://github.com/torvalds/linux/commits/master/MAINTAINERS">https://github.com/torvalds/linux/commits/master/MAINTAINERS</a></p>
<p>人员进进出出很频繁。但是 @gregkh 这种在 <code>char-misc</code> 里搭车进去，的确偷偷摸摸。</p>
<h3>五、 .cn 会被波及吗？</h3>
<p>这个问题我无法回答，但是可以列一下现在有的：</p>
<ol>
<li>一大堆 LOONGARCH 龙芯的驱动和各种模块</li>
<li>海光 HYGON 驱动</li>
<li>简中翻译 Alex Shi <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#97;&#108;&#101;&#120;&#115;&#64;&#107;&#101;&#114;&#110;&#101;&#108;&#46;&#111;&#114;&#103;">&#97;&#108;&#101;&#120;&#115;&#64;&#107;&#101;&#114;&#110;&#101;&#108;&#46;&#111;&#114;&#103;</a> Yanteng Si <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#115;&#105;&#121;&#97;&#110;&#116;&#101;&#110;&#103;&#64;&#108;&#111;&#111;&#110;&#103;&#115;&#111;&#110;&#46;&#99;&#110;">&#115;&#105;&#121;&#97;&#110;&#116;&#101;&#110;&#103;&#64;&#108;&#111;&#111;&#110;&#103;&#115;&#111;&#110;&#46;&#99;&#110;</a></li>
<li>繁体翻译 Hu Haowen <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#50;&#48;&#50;&#51;&#48;&#48;&#50;&#48;&#56;&#57;&#64;&#108;&#105;&#110;&#107;&#46;&#116;&#121;&#117;&#116;&#46;&#101;&#100;&#117;&#46;&#99;&#110;">&#50;&#48;&#50;&#51;&#48;&#48;&#50;&#48;&#56;&#57;&#64;&#108;&#105;&#110;&#107;&#46;&#116;&#121;&#117;&#116;&#46;&#101;&#100;&#117;&#46;&#99;&#110;</a> https://github.com/srcres258/linux-doc 太原理工的人才！</li>
<li>RADOS BLOCK DEVICE (RBD) Ilya Dryomov <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#105;&#100;&#114;&#121;&#111;&#109;&#111;&#118;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;">&#105;&#100;&#114;&#121;&#111;&#109;&#111;&#118;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;</a> Dongsheng Yang <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#100;&#111;&#110;&#103;&#115;&#104;&#101;&#110;&#103;&#46;&#121;&#97;&#110;&#103;&#64;&#101;&#97;&#115;&#121;&#115;&#116;&#97;&#99;&#107;&#46;&#99;&#110;">&#100;&#111;&#110;&#103;&#115;&#104;&#101;&#110;&#103;&#46;&#121;&#97;&#110;&#103;&#64;&#101;&#97;&#115;&#121;&#115;&#116;&#97;&#99;&#107;&#46;&#99;&#110;</a> ceph-devel@vger.kernel.org</li>
<li>一大堆 @huawei.com @linux.alibaba.com的各种驱动和模块</li>
<li>可能有别的<a href="https://blog.est.im/201906/stdout-003">大陆+港澳台公司</a>邮箱我漏掉了。懒得看了。</li>
</ol>
<p>在 <code>CREDITS</code> 里鸣谢的：</p>
<pre><code>N: Chih-Jen Chang
E: chihjenc@scf.usc.edu
E: chihjen@iis.sinica.edu.tw
D: IGMP(Internet Group Management Protocol) version 2
S: 3F, 65 Tajen street
S: Tamsui town, Taipei county,
S: Taiwan 251
S: Republic of China

N: Li Yang
E: leoli@freescale.com
D: Freescale Highspeed USB device driver
D: Freescale QE SoC support and Ethernet driver
S: B-1206 Jingmao Guojigongyu
S: 16 Baliqiao Nanjie, Beijing 101100
S: People's Repulic of China

N: Tsu-Sheng Tsao
E: tsusheng@scf.usc.edu
D: IGMP(Internet Group Management Protocol) version 2
S: 2F 14 ALY 31 LN 166 SEC 1 SHIH-PEI RD
S: Taipei
S: Taiwan 112
S: Republic of China
S: 24335 Delta Drive
S: Diamond Bar, California 91765
S: USA

</code></pre>
<h3>六、结束语</h3>
<p>总的来说 Linux内核项目，包括不限于很多别的社区项目，还是英雄主义色彩很重的，这样的个人主义既可以说出“nVidia fuck you”，也完全有可能在某一天把主语丝滑切成 “Russia”。这压根就是同一个硬币的同一面（甚至都不是另一面）</p>
<p>在国际地缘政治热火朝天、段视频AI诵读、<a href="https://blog.est.im/2022/stderr-02">情绪控制终端</a>满天飞的今天，讨论这些重要吗？有用吗？</p>
<p>回答：不重要，没用</p>
<p>但是对我个人而言，或许有那么一丢丢重要，有一丁点用。</p>
<p>希望对你也有点用。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-10-24T15:26:00+08:00">2024-10-24</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-21"  rel="bookmark" >
              <h2 class="card-title">“分封制” 代替RBAC权限管理模型</h2>
            </a>
            <p class="card-text"><p>作为开发狗，手上堆的系统和任务多了，开权限就变成了一件麻烦的事。</p>
<p>一开始做一个功能X，给甲用，就做一个简单的权限关联表：<code>功能key</code>，<code>人员id</code>就完事大吉</p>
<p>后来人员调整流动，换人换得勤快，得考虑一个功能给一个团队使用，于是引入 RBAC，基于角色的鉴权控制。说到底就是个三元组 <code>功能key</code>，<code>角色</code>，<code>成员id</code>。</p>
<p>我也一度迷信这样的设计。用了这么久还是麻烦了。在一个正常官僚程度的大中型组织里，压根没人知道自己角色是啥。</p>
<p>你说他是管理人员吧，他也就管一部分；你说他负责这事吧，也就负责一阵。该给他放到哪个角色呢？</p>
<p>如果做一个自动化角色申请审批流程，他会跑来问你，该申请哪个角色啊？</p>
<p>所以问题又回到了原点。因此我琢磨出来一套具有大汉封建主义特色的，「分封制」权限控制体系。</p>
<ul>
<li>系统超管：普天之下，莫非王土；率土之宾，莫非王臣。拥有系统一切权限。但是不负责，不执行，不搞具体管理。超管只干一件事：分封</li>
<li>如何分封：把「事」交给一个信得过的领主（serf）。领主对一块业务全权负责。但代价得自己把封地采邑打下来。具体在系统层面，系统所有权限、功能都直接开放，所谓 zero-trust。但是你得从零开始搭建和配置。一旦你配置好、跑起来，这快权限和功能就是你独有的。（owner）</li>
<li>线上既有的业务权限，那也是有人配置管理和主导，你只能从别那里抢夺，或者过继。</li>
<li>领主可以给自己封臣划分部分管理权限</li>
<li>如果一个领主挂了，超管指定一个接盘的领主</li>
</ul>
<p>感觉这样开发和超管就可以不用每天处理谁负责哪个功能的麻烦事了。哈哈哈</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-10-17T15:21:00+08:00">2024-10-17</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-20"  rel="bookmark" >
              <h2 class="card-title">Install mosh for macOS arm64 with Miniconda3</h2>
            </a>
            <p class="card-text"><p>I always hate compiling and building. It's an error-prone path filled with riddles and unknowns.</p>
<p><code>mosh</code> is a great tool replacing <code>ssh</code> in many cases, sadly it does not provide an <code>arm64</code> binary download or installer for M1/M2/M3 MacBooks. Moreover I dont like XCode and protected <code>/usr/bin</code> shit so I prefer isolated envs like <code>miniconda3</code>.</p>
<p>Anyway, for such a detour, following the <a href="https://github.com/mobile-shell/mosh/wiki/Build-Instructions">official mobile-shell build wiki</a>, type these commands:</p>
<pre><code class="language-sh">conda install autoconf automake libprotobuf pkg-config tmux
# use libncursesw 6.5 since  6.4 is buggy, rpath and dyld not load LC_RPATH shit
conda install conda-forge::ncurses
git clone --depth=1 https://github.com/mobile-shell/mosh.git`
cd mosh

./autogen.sh
./configure --prefix $CONDA_PREFIX
make check
make
make install
</code></pre>
<p>And it's done. All thanks to authors for open source project and butter-smooth build scripts.</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-09-28T10:05:00+08:00">2024-09-28</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-19"  rel="bookmark" >
              <h2 class="card-title">精准 javascript 节拍器</h2>
            </a>
            <p class="card-text"><p>娃学琴，节奏感糊成一坨了。老师让抖腿打节拍，显然不work。码农特有的穷B气质让我舍不得买个实体的；去找个节拍器app，结果各大市场都是各种广告，怕给娃用不正经；甚至找了很多公众号版的，小程序版的，网页版的，普遍都是各种跳转诱导点击。</p>
<p>失望之余，想起来上次<a href="https://blog.est.im/2022/stdout-10">JS播放DTMF</a>对 WebAudio 有点感觉，要不这次自己干脆再手搓一个。<a href="https://news.ycombinator.com/item?id=20935492">调研</a>了一圈发现这玩意没那么容易，主要就是javascript在浏览器里 <code>setInterval</code> 是有时间抖动（jitter）的，不能保证节奏精确。下面的图<a href="https://meowni.ca/posts/metronomes/">来自 Monica Dinculescu</a></p>
<p><img alt="" src="https://meowni.ca/images/metronomes/2.png" /></p>
<p>即便采用了 <code>requestAnimationFrame</code> 也不行</p>
<p><img alt="" src="https://meowni.ca/images/metronomes/3.png" /></p>
<p>因为js的执行无论如何trick，本质都是在只有一个主线程的单线程。如何才能做到精准采样打节拍呢？连续精心编排 AudioContext 时间轴！因为音频播放是系统调度跟js无关</p>
<p>搜了一圈发现一位叫 <a href="https://grantjam.es/creating-a-simple-metronome-using-javascript-and-the-web-audio-api/">Grant James 已经写好</a>放在 <a href="https://github.com/grantjames/metronome">github</a> 了。那还等什么直接拿来～～针对性下列需求改了一番</p>
<ol>
<li>无广告</li>
<li>去掉 .js .css 依赖，单文件更快</li>
<li>精简不必要的代码结构，方便以后魔改</li>
</ol>
<p>改完之后发现两三个坑也跟着一起修补了：</p>
<ol>
<li>用 <code>wakeLock</code> 防止手机上使用息屏</li>
<li>突破固定的4拍子，加上可以增减的节拍控制</li>
<li>增减按钮禁止调到小于 0</li>
</ol>
<p>最后成果就放在 <a href="https://lab.est.im/metronome/">https://lab.est.im/metronome/</a> 这里了。有需要的拿去用。协议 <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="license noopener noreferrer" style="display:inline-flex;">CC BY-NC 4.0<img style="height:1em!important;margin:auto 2px auto 2px;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg"><img style="height:1em!important;margin:auto 2px auto 2px;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg"><img style="height:1em!important;margin:auto 2px auto 2px;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg"></a></p>
<p>20240929更新：</p>
<ol>
<li>支持了长按按钮一直增加减少 bpm</li>
<li>禁止长按出现菜单</li>
<li>禁止双击缩放</li>
</ol></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-09-26T22:52:00+08:00">2024-09-26</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-18"  rel="bookmark" >
              <h2 class="card-title">Edge找回丢失的右上角Copilot侧边栏图标</h2>
            </a>
            <p class="card-text"><p>右上角图标和侧边栏的官方截图：</p>
<p><img referrerpolicy="no-referrer" src="https://blogs.windows.com/wp-content/uploads/prod/sites/33/2023/12/devtools-copilot-in-edge-1.png" /></p>
<p>如果不小心关掉了，找回办法：</p>
<ol>
<li>打开 <code>edge://settings/sidebar/appSettings?hubApp=cd4688a9-e888-48ea-ad81-76193d56b1be</code></li>
<li><code>F12</code> 或者 <code>Opt+Cmd+I</code>，找到第一个“Show Copilot”开关，把它改成关闭。</li>
<li>如果第二步不会搞，输入 <code>document.querySelector('input[aria-label="Show Copilot"]').removeAttribute('disabled')</code> 可破</li>
</ol>
<p>为什么会有这个问题，因为政策的原因，Microsoft Copilot 不能在简中使用，于是右上角的按钮点一下会消失；但是开发或者集成测试的为了省事儿，就直接给隐藏掉，导致侧边栏无法点开</p>
<p>这串 hubApp 的id如何找到呢？新建一个浏览器profile，这个时候 Copilot 是有图标的。不要去点，去设置里翻 <code>edge://settings/sidebar</code> 就能看到 Copilot 的选项。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-09-22T21:49:00+08:00">2024-09-22</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-17"  rel="bookmark" >
              <h2 class="card-title">php是最好的……serverless</h2>
            </a>
            <p class="card-text"><p>php是不是最好的语言先不说，但是如果从 serverless 的角度看php：</p>
<ol>
<li>语法简单，功能丰富，10分钟就能学会</li>
<li>通过 FTP 之类的标准工具部署，而不是脑残的命令行</li>
<li>不用管理麻烦的服务器。基于非常成熟的 php-fpm 去做 scaling。也有大量巨型网站验证过这一方案</li>
<li>虽然不是 docker，但是 <code>vhost</code> 够用了。而且要容器化 <code>vhost</code> 也很容易</li>
<li>让人梦寐以求的“热更新”技术</li>
<li>超级便宜的月租。（还记得 dreamhost 吗？）</li>
<li>不会吊死在一颗树（vendor lock-in）上。全球遍地的厂商都支持</li>
</ol>
<p>你就说好不好吧。同时<a href="https://news.ycombinator.com/item?id=41358020#41364190">评论在 Hacker News</a></p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-08-27T11:06:00+08:00">2024-08-27</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-16"  rel="bookmark" >
              <h2 class="card-title">2024年玩xml真是笑死了（xsl）</h2>
            </a>
            <p class="card-text"><p>昨天大早上的6点就醒了，翻来覆去睡不着，就开始胡思乱想。忘记是什么缘起了，反正突然想到一个问题，博客这种静态站，又要输出html，又要输出rss。太冗余了。要不直接把内容存在RSS里。然后用js去<code>fetch()</code>。。。。</p>
<p>等等，死去的记忆突然攻击我。RSS不就是XML，XML似乎有个加皮肤的技术。于是就更睡不着了，起床一查，原来是 XSLT 转换成 HTML 然后就可以自由发挥了。</p>
<p>可行性没问题，准备找个前人的例子开抄。比如 <a href="https://natclark.com/tutorials/xslt-style-rss-feed/">2021年Nathan Clark的Styling an RSS Feed With XSLT</a>，<a href="https://darekkay.com/blog/rss-styling/">2023年Darek Kay的Style your RSS feed</a></p>
<p>思路就很匹配，执行效果也不错。我想百尺竿头更进一步，把 XSL 给 inline 到 RSS 里，避免额外的加载，节省一次网络请求。吗，没想到这下麻烦大了，折腾到现在才有个初步结果。直接贴源码：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;#stylesheet&quot;?&gt;

&lt;some_xml_root xmlns:shit=&quot;http://xxx&quot;&gt;

&lt;xsl:stylesheet xml:id=&quot;stylesheet&quot; version=&quot;3.0&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt;
&lt;xsl:output method=&quot;html&quot; doctype-system=&quot;about:legacy-compat&quot; version=&quot;5.0&quot; encoding=&quot;UTF-8&quot; indent=&quot;yes&quot; /&gt;
&lt;xsl:template match=&quot;/&quot;&gt;
  &lt;html&gt;
    ...
  &lt;/html&gt;

&lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;

&lt;/some_xml_root&gt;
</code></pre>
<p>这里的 <code>href="#stylesheet"</code> 方法，是<a href="https://www.w3.org/TR/xslt-30/#embedded">官方推荐的</a> 。但是要起效果，一定注意 <code>type="text/xsl"</code> 别抄成网上的 <code>application/xslt+xml</code> 了</p>
<p>主要浪费时间的坑点主要在根的 <code>xmlns</code> 上。这玩意把 xpath 给搞挂了。比如 sitemap你写</p>
<p><code>&lt;xsl:for-each select="/urlset/url"&gt;</code></p>
<p>好好的，加上 <code>xmlns</code> 就得写成：</p>
<p><code>&lt;xsl:for-each select="/*[local-name() = 'urlset']/*[local-name() = 'url']"&gt;</code></p>
<p>怪不得现在没人玩XML了。这破玩意没法直观的本地调试，还得靠各种第三方 validator，反人类啊。</p>
<p>于是把根的 xmlns 直接改成 tag namespace。也就是 <code>xmlns:shit</code> 。反正你namespace冲突了关我什么事？<s>而且说实话，xmlns这玩意除了坑各种解析器不好写之外，并没有什么卵用。我以前写都是想办法去掉 xmlns 再解析。感觉这一块真的 over-engineering 了。</s> 好像有点明白 namespace 是干嘛的了。这玩意主要解决一个sb需求：允许多个XML合并到一个文件里。这不就得考虑如何分清楚tag谁是谁的。。。。并且标准已经挖好坑了，一个XML有且只有一个root。。你把别的 tag 合并进来，那的确不容易区分。还有这样写不会造成文件体积膨胀吗？真是xsl笑死了。</p>
<p>接下来的问题就是如何生成一个规规矩矩的 html5 doctype。搜了下 <code>doctype-system</code>就可以了。本来其实可以在<code>&lt;xsl:template&gt;</code>后面加上 </p>
<p><code>&lt;xsl:text disable-output-escaping='yes'&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/xsl:text&gt;</code></p>
<p>但实际只加这个是不行的。</p>
<p>另外吐槽下 Chrome，默认的viewer把xml渲染成html了，在 devtool 里通过 <code>$x()</code> 无法直接调试xpath，还得靠别的第三方工具。(⊙﹏⊙) </p>
<p>这可能就是XSL的核心问题了——没法方便直观的调试，挂了就给你白屏。有点react那种白屏的 ptsd 感觉了。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-08-22T23:09:00+08:00">2024-08-22</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-15"  rel="bookmark" >
              <h2 class="card-title">关于 cn.cyberIdentity.certification 的一些技术信息</h2>
            </a>
            <p class="card-text"><p>搜索该app名字可以得到 </p>
<p><a href="https://apps.apple.com/cn/app/_/id1588080869">https://apps.apple.com/cn/app/_/id1588080869</a></p>
<p>各大app市场都有隐私政策页，点击可以发现网址是：</p>
<p>https://cdnrefresh.ctdidcii.cn/w1/WHClient_H5/pages/secret.html</p>
<p>甚至有一个 apk 下载页面</p>
<p>https://cdnrefresh.ctdidcii.cn/w1/WHClient_H5/Install/InstallGuide.html</p>
<p>https://cdnrefresh.ctdidcii.cn/w1/version/cyberIdentity-android.apk</p>
<p><code>whois ctdidcii.cn</code> 可以得到</p>
<blockquote>
<p>Registrant: XX部第一研究所<br />
Registrant Contact Email: songjie@anicert.cn</p>
</blockquote>
<p>可以发现该公司官网</p>
<blockquote>
<p>有限公司（以下简称“ZDAX”）是<code>**部</code>第一研究所下属全资子公司。<br />
<code>**部</code>第一研究所以国家“互联网+”可信身份认证平台（简称“CTID平台”）核心技术为依托，致力于为各级政府部门、互联网运营商、各行业应用提供权威、可信、安全、便捷的身份认证服务，并开展相关业务创新。在<code>**部</code>的直接领导下，<code>**办</code>、国家发改委、科技部等部委的大力支持下，<code>**部</code>第一研究所积极开展居民身份证网上应用研究，组织承建CTID平台，助力新时代社会治理现代化。<br />
2017年10月，<code>**部</code>第一研究所成立ZDAX公司，并授权ZDAX为CTID平台唯一合法的运营服务商，为各行业提供权威、可信、安全、便捷的网络身份认证服务，为我国“互联网+行动战略”提供强有力的支撑保障。</p>
</blockquote>
<p>以及平台介绍说明</p>
<p>https://www.anicert.cn/platform.html</p>
<blockquote>
<p>● 一次一码，超时失效<br />
● 通过国密算法加密、签名防止数据泄露、篡改和伪造<br />
根据相关行政许可设立的第三方签发、面向系统应用可作为司法采证使用的身份凭证，如电子认证服务提供者、CA机构等第三方签发的电子签名认证证书、eID等；</p>
</blockquote>
<p>得出一个结论，这玩意不<em>仅</em>是eID换皮那么简单。</p>
<p>点开发展历程可以看到 </p>
<blockquote>
<p>2020.12 《<a href="https://www.anicert.cn/upload/2020/12/25/16088934002753h4n2m.pdf">基于可信数字身份的区块链应用服务白皮书</a>》正式发布</p>
</blockquote>
<p>上面提到的厦门公司，看上去是专门做 CDIT 运营的，搜了下官网是</p>
<p>https://easyctid.cn/about</p>
<p>其中有一张最重要的架构图</p>
<p><img referrerpolicy="no-referrer" src="https://easyctid.cn/_nuxt/img/bg-3.c5fe831.png" /></p>
<p>目前不知道这个 PID 是唯一的还是可变的。要实用还是得做类似微信那种 OpenID/UnionID 才行。因为技术对接SDK需要付费签协议才能拿到，细节就无从而知了。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-08-01T15:20:00+08:00">2024-08-01</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-14"  rel="bookmark" >
              <h2 class="card-title">Valid HTTP verbs</h2>
            </a>
            <p class="card-text"><p>从<a href="https://www.v2ex.com/t/1057881">这里</a> 想到，fetch/xhr 可以发起哪些 http verb 呢？</p>
<p><code>python -m http.server</code> 随手测试了下，发现连 <code>!</code>，<code>$</code> 这种符号都可以作为 http verb，比如 <code>fetch('/asdf', {method:"$"})</code> 这样的请求是能发起的。于是去 chromium 搜了下 <code>"is not a valid HTTP method"</code> 相关的解析放在 <a href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/renderer/platform/network/http_parsers.cc;drc=fa1e0cf5238e2600039f60af6909aefbd4cf003c;l=404">blink/renderer/platform/network/http_parsers.cc</a></p>
<pre><code>// See RFC 7230, Section 3.2.6.
bool IsValidHTTPToken(const String&amp; characters) {
  if (characters.empty())
    return false;
  for (unsigned i = 0; i &lt; characters.length(); ++i) {
    UChar c = characters[i];
    if (c &gt; 0x7F || !net::HttpUtil::IsTokenChar(c))
      return false;
  }
  return true;
}

bool HttpUtil::IsTokenChar(char c) {
  return !(c &gt;= 0x7F || c &lt;= 0x20 || c == '(' || c == ')' || c == '&lt;' ||
           c == '&gt;' || c == '@' || c == ',' || c == ';' || c == ':' ||
           c == '\\' || c == '"' || c == '/' || c == '[' || c == ']' ||
           c == '?' || c == '=' || c == '{' || c == '}');
}
</code></pre>
<p>原来如此，RFC 7230呀。于是把这些字符打出来：<code>' '.join(chr(x) for x in range(0x20, 0x7f))</code></p>
<pre><code>! # $ % &amp; ' * + - . 0 1 2 3 4 5 6 7 8 9 A B C D E F G H I J K L M N O P Q R S T U V W X Y Z ^ _ ` a b c d e f g h i j k l m n o p q r s t u v w x y z | ~
</code></pre>
<p>那还搞个屁的 RESTful 啊。直接用特殊符号一把梭。不过各种服务端框架可能不是很容易做兼容。哈哈。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-07-17T09:47:00+08:00">2024-07-17</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-13"  rel="bookmark" >
              <h2 class="card-title">Cappy in a Haystack locations</h2>
            </a>
            <p class="card-text"><p>For <a href="https://fallout.fandom.com/wiki/Cappy_in_a_Haystack">the mission</a> from the beloved Fallout 4 Nuka-World DLC</p>
<pre><code>coc DLC04KiddieKingdomFunHouse01; player.moveto 06015A94
coc NukaWorldWildWestExt02; player.moveto 06015A8A
coc DLC04BottlingPlant01; player.moveto 060445DF
coc DLC04BottlingPlant01; player.moveto 0604A812
coc DLC04GalacticZoneExt04; player.moveto 06015A8E
coc DLC04GalacticZoneExt04; player.moveto 0604AD3F
coc DLC04GalacticZoneExt08; player.moveto 06015A91
coc DLC04GalacticZoneExt08; player.moveto 0604AD40
coc DLC04KiddieKingdomFunHouse01; player.moveto 0604AD3D
coc DLC04WWMineCart01; player.moveto 06015A8B
coc DLC04WWMineCart01; player.moveto 0604AA39
coc KiddieKingdomExt06; player.moveto 06015A97
coc KiddieKingdomExt06; player.moveto 0604AD3E
coc NukaWorldNukaTownUSA06; player.moveto 0604A814
coc NukaWorldNukaTownUSA06; player.moveto 0604A813
coc NukaWorldWildWestExt02; player.moveto 0604A815
coc SafariAdventure03; player.moveto 06015A9A 
coc SafariAdventure03; player.moveto 0604AA3A
coc SafariAdventure07; player.moveto 06015A9D
coc SafariAdventure07; player.moveto 06015A9D
coc SafariAdventure07; player.moveto 0604AA3B
</code></pre>
<p>idk hope it works lol.</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-07-13T09:19:00+08:00">2024-07-13</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-12"  rel="bookmark" >
              <h2 class="card-title">All Star Core locations in Fallout 4</h2>
            </a>
            <p class="card-text"><p>Arent nobody got time for this shit.</p>
<p>Open FO4Edit, locate <code>604a053</code> and find all refs:</p>
<pre><code>0601FAD1
060255A7
060255D2
06025774
060257F1
06026C7B
06026D23
06026D70
060278F7
06027917
0602791A
06027A3C
06027ACC
06027C0D
06027D5E
06027E43
06027E4C
060319E1
060319E2
060327BA
060327C4
060327D0
060327E2
06034EC6
06034F97
06034FD4
0603522E
06037CA7
060380CB
0603816F
</code></pre>
<p>And for external star cores, locate <code>0601F0E5</code> and <code>0601F0E6</code> for more refs:</p>
<pre><code>coc NWJunkyardExt; player.moveto 060319D6;
coc NukaWorldWildWestExt03; player.moveto 06031995;
coc DLC04BottlingPlant01; player.moveto 060319CE;
coc DLC04Nukacade01; player.moveto 060319CF;
coc DLC04GalacticZoneExt07; player.moveto 060319E1;
coc NukaTownMarket01; player.moveto 06054CA8;
</code></pre>
<p>Just type <code>player.moveto</code> with the code above and you can grab all <a href="https://fallout.fandom.com/wiki/Star_core">star cores</a>, and return to console <code>player.moveto 0601E359</code>, so you get the Quantum X-01 power armor from Nuka-World DLC of Fallout 4.</p>
<p>Also there's <code>coc TestCory01; 06044B4B;</code> for testing purposes.</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-07-13T06:31:00+08:00">2024-07-13</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-11"  rel="bookmark" >
              <h2 class="card-title">Making subprocess async friendly in Python</h2>
            </a>
            <p class="card-text"><p>It's been a while since i wrote something in English, mostly because there's nothing really interesting, <a href="https://blog.est.im/2024/stdout-09">until now</a>.</p>
<p>Occasionally, when facing a long running task in Python, I would choose either a distrubuted tasks queue system, or for the convenience, just the <code>subprocess</code> module. It's built-in and well designed for grabbing outputs of a child process running for a short period of time.</p>
<p>But what if the child-process takes a really, really long time? In my case it's an expensive query, or some CPU/GPU intensive task, which needs to be launched from a running Web framework, like FastAPI. </p>
<h3>Popen() fire and forget</h3>
<p>if child-process's output, end state and the return code are irrelevant, a simple Popen would do</p>
<p><code>subprocess.Popen(..., stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)</code></p>
<p>The problem is, after the child-process finishes, it will hang as a zombie, because the parents refused to claim its exit status. To fix this, add an extra parameter in <code>Popen()</code> like <code>subprocess.Popen(..., start_new_session=True)</code></p>
<p>And write a simple loop periodically check for <code>WNOHANG</code></p>
<p><code>while 1:
    try:
        chpid, retcode, res = os.wait3(os.WNOHANG)
    except ChildProcessError:
        break
    sleep(5)
    if chpid == os.getpid():
        do_sth()
        break</code></p>
<p>This can be done using <code>BackgroundTasks</code> in FastAPI/Starlette.</p>
<p>In a way, the child-process hebaves like <code>nohup</code> or screen/tmux, running in a detatched fashion.</p>
<p>If you hate this many lines of code, just <code>subprocess.run("blah.sh &amp;", shell=True)</code> and wrap your commands in <code>blah.sh</code></p>
<h3>Make <code>.communicate()</code> async</h3>
<p>Sometimes I need to monitor and handle the stdout/stderr of a child-process, like forward the outputs as an <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventSource">EventSource</a> response to the browser.</p>
<p>First I tried <code>.communicate()</code> it will block until the process quites.</p>
<p>Then I tried <code>Popen.stdout.read()</code>, it will also block. Eventually I found a great hack from Stackoverlow like this:</p>
<pre><code>p = subprocess.Popen(
    cmd, bufsize=0, text=True, stdin=subprocess.PIPE,
    stderr=subprocess.PIPE,  stdout=subprocess.PIPE, close_fds=True)
fcntl.fcntl(p.stdout.fileno(), fcntl.F_SETFL, os.O_NONBLOCK)
</code></pre>
<p>Now <code>p.stdout.read(1024)</code> would return immediately, or with a <code>TypeError</code> bnecause internal messed up with <code>None</code> as non-blocking empty return.</p>
<p>Wrap it with <code>try...except</code> inside a loop, it worked fine as expected.</p>
<p>When the parent process crashes unexpectedly, the child-process is still working, to detect this, just check for <code>BrokenPipeError</code> carefully in child-process and gracefully shutdown.</p>
<h3>Solved with <code>asyncio</code></h3>
<p>I tried harder reading the official Python docs, turns out the most easy solution is already there:</p>
<pre><code>proc = await asyncio.create_subprocess_exec(
    sys.executable, '-c', code,
    stdout=asyncio.subprocess.PIPE)

# Read one line of output.
data = await proc.stdout.readline()
line = data.decode('ascii').rstrip()

# Wait for the subprocess exit.
await proc.wait()
return line
</code></pre>
<p>I guess another lesson learned today.</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-06-22T12:26:00+08:00">2024-06-22</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-10"  rel="bookmark" >
              <h2 class="card-title">人声分离简单评测</h2>
            </a>
            <p class="card-text"><p>娃要去表演唱歌，老师要求提供MTV。。 视频是<a href="https://www.bilibili.com/video/BV1Ty4y147Sj/">这个</a>，需要去掉人声部分</p>
<p>先用 ffmpeg 提音轨 <code>ffmpeg -i v.mp4  -ac 1 1.mp3</code></p>
<p>微信小程序上的全是骗充值的，网上的服务：</p>
<ol>
<li>没卵用 https://vocalremover.org/ 名气很大，搜出来第一就这个</li>
<li>没用 https://www.conversion-tool.com/karaoke/</li>
<li>卡死 https://www.songpeel.com/song-to-karaoke</li>
<li>要安装 https://github.com/adefossez/demucs</li>
<li>要6G显存 https://github.com/Anjok07/ultimatevocalremovergui</li>
<li>效果很好！ https://tunebat.com/Vocal-Remover 推荐</li>
</ol>
<p>看来人声分离，特别是童声，还是有点难。</p>
<p>最后把得到的 a.mp3 塞回去</p>
<p><code>ffmpeg -i v.mp4 -i a.mp3 -c:v copy -map 0:v:0 -map 1:a:0 new.mp4</code></p>
<p>btw 打了这么多网址，该不会被误认为SEO吧。囧。。。。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-06-21T22:48:00+08:00">2024-06-21</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-09"  rel="bookmark" >
              <h2 class="card-title">吐槽pynsq，另外给subprocess糊了一个异步</h2>
            </a>
            <p class="card-text"><h3>pynsq太烂了</h3>
<p>起初是因为需要在 Web API 里消费一个消息队列(nsq)，给浏览器返回 <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventSource">EventSource</a> 做实时输出。但是没想到<a href="https://github.com/nsqio/pynsq/blob/master/nsq/__init__.py">官方库pynsq</a>居然写得这么渣：</p>
<pre><code>def _handle_term_signal(sig_num, frame):
    logging.getLogger(__name__).info(
        'TERM Signal handler called with signal %r', sig_num)
    tornado.ioloop.IOLoop.current().stop()

def run():
    """
    Starts any instantiated :class:`nsq.Reader` or :class:`nsq.Writer`
    """
    signal.signal(signal.SIGTERM, _handle_term_signal)
    signal.signal(signal.SIGINT, _handle_term_signal)
    tornado.ioloop.IOLoop.current().start()
</code></pre>
<p>这都什么玩意儿？一个库何德何能也敢去乱劫持 signal？最他妈逗的是这个库的推荐写法：</p>
<pre><code>import nsq
r = nsq.Reader(message_handler=handler,
        lookupd_http_addresses=['http://127.0.0.1:4161'],
        topic='nsq_reader', channel='asdf', lookupd_poll_interval=15)
nsq.run()
</code></pre>
<p>这个 <code>r</code> 莫名其妙的就能跑起来了。真是魔法。anyway，在Web API兼容这一坨是失败了，爆了一堆错，对付魔法的办法就是隔离，所以打算糊个脚本，通过多进程+PIPE来得到数据。</p>
<h3>给 subprocess 加一个异步补丁</h3>
<p>糊的时候发现，<code>subprocess</code> 模块的 <code>.communicate()</code> 方法是 blocking的， 居然不支持 async/await，于是只能继续糊：</p>
<pre><code>import subprocess, fcntl, asyncio
p = subprocess.Popen(
    cmd, bufsize=0, text=True, stdin=subprocess.PIPE,
    stderr=subprocess.PIPE,  stdout=subprocess.PIPE, close_fds=True)
fcntl.fcntl(p.stdout.fileno(), fcntl.F_SETFL, os.O_NONBLOCK)
buf = ''
while p.poll() is None:
    try:
        # read() with O_NONBLOCK might gets None thus TypeError
        buf += (p.stdout.read(1024) or '')
        contents = buf.split('\n')
        if len(contents) &lt; 2:
            raise TypeError('Not enough')
    except TypeError:
        await asyncio.sleep(1)
        yield None
        continue
    buf = contents.pop(-1)
    for x in contents:
        yield x

p.terminate()
</code></pre>
<p>这里用 <code>buf</code>、<code>contents</code> 是因为直接调用消息队列，每个消息都是分割好的；但是通过管道来读。得自己去处理字节流如何分割的问题，也就是传说简中特供的「粘包」问题。</p>
<p>另外子进程可能因为Web框架的种种原因，不自觉退出或者变僵尸进程，需要向 stdout/stderr 做输出的时候检查一下 BrokenPipeError 处理后事主动退出即可。</p>
<p>还有子进程如果输出完毕，需要代码里调用一下 <code>p.terminate()</code>，才能回收，避免变zombie</p>
<p>试了一下，也不是不能用，成功！正觉得自己又行了的时候，发现官方：</p>
<p><a href="https://docs.python.org/3.8/library/asyncio-subprocess.html">https://docs.python.org/3.8/library/asyncio-subprocess.html</a></p>
<p>啊这。白忙活。</p>
<h3>超长待机 subprocess</h3>
<p>想起来之前还有个问题，一个API调用一个subprocess，然后等它执行，不想管。这个时候可以加一个参数 detach 模式：</p>
<p><code>subprocess.Popen(..., start_new_session=True)</code></p>
<p>然后在同进程用里跑一个后台检查循环去检查子进程的 <code>WNOHANG</code>：</p>
<pre><code>while 1:
    try:
        chpid, retcode, res = os.wait3(os.WNOHANG)
    except ChildProcessError:
        break
    sleep(5)
    if chpid == os.getpid():
        do_sth()
        break
</code></pre>
<p>想了下好像也搞复杂了。要不直接跑一个 <code>sh -c "blah.sh &amp;"</code> 算了。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-06-21T09:30:00+08:00">2024-06-21</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-08"  rel="bookmark" >
              <h2 class="card-title">如何删除 C:\Windows\WinSxS 文件</h2>
            </a>
            <p class="card-text"><p>天气热得心慌，看Win10不爽，决定删几个文件玩玩</p>
<ol>
<li>首先你需要以 <code>SYSTEM</code> 用户启动 <code>cmd.exe</code><br />
Win+R 敲入：<br />
<code>"\\live.sysinternals.com@SSL\DavWWWRoot\tools\PsExec.exe" -i -s cmd.exe</code><br />
回车。确认当前身份敲入 <code>whoami</code></li>
<li>夺权：<code>takeown /F "C:\Windows\WinSxS\Backup" /A /R /D Y</code></li>
<li>授权：<code>cacls "C:\Windows\WinSxS\Backup" /T /G SYSTEM:F /C</code></li>
<li>开删：<code>rd /s /q "C:\Windows\WinSxS\Backup"</code></li>
</ol>
<p>爽！</p>
<p>当然，你也可以让系统代替你清理：</p>
<p><code>Dism.exe /online /Cleanup-Image /StartComponentCleanup /ResetBase</code></p>
<p>很老的磁盘清理工具 <code>cleanmgr.exe</code>  也可以试试，删不要的程序 <code>appwiz.cpl</code></p>
<p>老黄家的  DXCache 也十分让人不解。这破玩意还存2个地方：</p>
<ol>
<li><code>%LOCALAPPDATA%\NVIDIA\</code></li>
<li><code>%APPDATA%\NVIDIA</code></li>
</ol>
<p>老夫当年给 <code>C:</code> 装了个最慢的SSD，失策。去年（2023）那一波M.2降价潮一直等等结果错过了，拍断大腿追悔莫及。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-06-14T22:50:00+08:00">2024-06-14</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-07"  rel="bookmark" >
              <h2 class="card-title">从 Leanote 迁移到 Obsidian</h2>
            </a>
            <p class="card-text"><p>差不多积累了<a href="https://www.v2ex.com/t/133479">10年</a>的笔记，因为软件开发商跑路去做 2B 了，这玩意也没人维护了。换 Obsidian</p>
<p>Leanote 不支持导出 <code>.md</code> 但是它自己的格式就是 json，转换一下很简单。</p>
<ol>
<li>把一个目录下的笔记批量导出为 Leanote 格式，比如导出到 <code>/tmp/folder1</code></li>
<li>执行Python代码<br />
<code>import json
    dir = '/tmp/folder1'
    for n in os.listdir(dir):
    if not n.endswith('.leanote'): continue
    with open(f"{dir}{n.replace('.leanote', '.md')}", "w") as f2, open(dir+n) as f1:
        f2.write(json.load(f1)['notes'][0]['content'])
    os.remove(dir+n)</code></li>
<li>你会发现该目录下的 <code>.leanote</code> 都变成了 <code>.md</code>。拖拽到 Obsidian 即可</li>
</ol>
<p>希望对搜到这篇文章的人有所帮助。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-06-10T22:21:00+08:00">2024-06-10</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-05"  rel="bookmark" >
              <h2 class="card-title">快速入睡的技巧和原理</h2>
            </a>
            <p class="card-text"><p>随着年龄的增长，加上工作和生活的恶习，睡眠越来越不好。很多时候躺在床上明明已经非常困了，但是大脑一不小心陷入胡思乱想，然后越想越睡不着。</p>
<p><img alt="" src="/images/2024/stdout-05-01.jpg" /></p>
<p>很多人说把大脑放空就能睡着了，我也试过，放空是不可能的，大脑时时刻刻总得琢磨点什么；既然要琢磨点什么，那我们能否找一部分最容易睡着的来琢磨？这几年我倒琢磨出一个非常行之有效的方法用来入睡：</p>
<p><strong>停止理性推演！强行带入感性的、放松、舒服的回忆体验占据大脑活动</strong></p>
<p>具体展开，首先我这里对睡不着的「胡思乱想」作了一个二元分类：</p>
<ol>
<li>一种是「理性」，逻辑推演：工作上的任务如何完成，生活中的矛盾如何化解，职业和家庭面对的困难，身边人群的压力，社会环境如何改进，民族国家的命运如何？电车会是能源革命吗？巴以冲突俄乌战争如何化解？等等，这类胡思乱想基本模式是「因果」：如果我做到A，那么B就会发生；如果我避免C，那么D这个糟糕的结果就能挽回。这类事，千万不要躺在床上想，否则越想越气。</li>
<li>另一种思绪我们称之为感性，温暖的阳光下微风吹过皮肤，恋人的手轻轻搂着你的腰，碧蓝的海平面上星星点点的船帆，你躺在椅子上无忧无虑的闭上眼睛享受这一切，只要把自己带入这种你亲身经历过的让你舒服，放松的体会中，假想你现在正在亲身经历这种愉快的事，那么你很快就能入睡。</li>
</ol>
<p>或许，有人会说我命苦啊～没那么多享受可以回味。我之前也是这样，总觉得过得很匆匆没这么留下的美好回忆，有一次下班路过郊外，看到天边块落山的太阳，光线没那么刺眼，橙红色的余晖给白云描了个边，倒影在一处水塘里，没有了中午那么热的暴晒，微风刮过岸边那些稀稀拉拉的花朵和绿树。感受到美的瞬间迫使我立刻停下脚步，找个草坪坐下欣赏并且仔细观察，深怕错过任何一个细节，我当时决定把这个时刻深深记录在脑海里并反复加深印象，以备将来再也遇不到了。后来这个「场景」的确帮助我度过了很多个艰难的夜晚。</p>
<p>要训练这个区分能力没有想象那么难，但需要长期的刻意练习，大脑胡思乱想的时候很容易不自觉陷入「理性」部分，要想睡觉，就得避免。不要尝试去思考「why」。时刻对当前的大脑活动行为进行「鉴定」和归类。对事物分析、解释和总结类的事，躺着就不要去想；一旦躺下，就多回忆和假象一些「体会」和「感受」。需要额外注意，情感的大类里，有一种叫做「害怕」和「忧虑」的东西，也要特意避免，<a href="https://blog.est.im/201905/stdin-004">Zizek说过 “The only emotion that doesn't deceive is anxiety”</a>，焦虑是惟一不骗人的情感，这句话的意思是，焦虑的本质是理性和归因分析，而不是情感，所以它很「真」而且很「重」。入睡这种事就不要当「真」啦，想点轻松愉快的骗骗自己做个美梦不好么。</p>
<p>对思绪的简单的二元分类并非我独创，<a href="https://blog.est.im/2022/stdin-13">Popper的第三世界</a> 和 <a href="https://blog.est.im/2023/stderr-06">《思考快与慢》里 I、II型系统</a>都有类似的阐述。这个入睡方法是我无意中实践出来的，可能是早年无聊特别喜欢对思辨本身进行思辨，二分模式归类，睡不着是因为大脑老是琢磨事，我无聊得琢磨起琢磨本身（meta-琢磨？），于是逐渐琢磨出一个辅助入睡规律。</p>
<p>今天刚好看到另一个研究：<a href="https://www.dedao.cn/share/course/article?id=R2Mo65zY4QZ3VnmYBYKqEdNAa98jGB">德国蒂宾根大学发现，合理利用睡眠，可以提升一个人的决策能力</a></p>
<blockquote>
<p>研究过程是，招募一群8到11岁的孩子，给他们看一组很吓人的照片，比如凶猛的动物之类。当时，几乎所有的孩子都被吓到了。之后，把这些孩子分成两组，第一组让他们回去睡一觉。第二组，让他们通宵玩游戏。<br />
第二天，再给这些孩子看这些可怕的照片。结果发现，睡觉组的孩子，可以相对平静地观看照片。他们显得没那么害怕了。而通宵游戏组的孩子，被惊吓程度，跟前一天几乎没有区别。<br />
研究人员认为，这就是睡眠的作用。睡眠就像一个过滤器。当我们面对一件事时，大脑的逻辑系统和情感系统，会同时运转。比如，看到一条毒蛇。你既会产生逻辑上的识别，记住这条蛇的基本特征。同时，你也会产生情感层面的反应，也就是害怕。<br />
而睡眠的作用，就在于，过滤掉其中情感的部分，保留逻辑的部分。因此，睡觉的孩子再看到蛇时，他们就不会那么害怕，只会记得，这条蛇昨天见过。而通宵组的孩子，这个害怕的感觉还在，他们再看到蛇时，还会很害怕。<br />
这也是为什么，很多人晚上一上秤，发现自己胖了，发誓第二天早上要起来跑步。但第二天却起不来。这就是因为，你立flag时的激情，被睡眠给过滤掉了。这也是为什么有人说，睡前千万不要立flag。<br />
把这个结论再延伸一步，研究人员认为，假如你做一件事时，在很大程度上受到情绪干扰，那么你最好先去睡一会儿。这能帮助你更好地集中注意力。<br />
比如，要不要创业？不创业，觉得有点虚度青春。创业，又有点患得患失。这就是受情绪干扰太多。按照这个研究，你就应该先去睡一觉。让你的情绪脑先冷却下来，睡醒之后，再用你的逻辑脑仔细想想。<br />
其实，这个研究可以用一句话概括，不就是，一日之计在于晨吗？也就是，把需要动用逻辑思考，需要计算，需要做计划的事情，尽量放在一觉睡醒之后。</p>
</blockquote>
<p>所以睡觉就睡觉，别想那么多。自然就能睡得着了。本文也用来回答V站提问<a href="https://v2ex.com/t/1023202">《如何在睡觉的时候不胡思乱想》</a> 。 转载请注明来自est的博客 <a href="https://blog.est.im/2024/stdout-05">https://blog.est.im/2024/stdout-05</a> ，如果觉得对你有用，给我留一句评论是再好不过的了 😊 </p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-03-13T13:25:11+08:00">2024-03-13</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-04"  rel="bookmark" >
              <h2 class="card-title">1900年居然不是闰年？</h2>
            </a>
            <p class="card-text"><p>看HN讨论 <a href="https://news.ycombinator.com/item?id=39554995">昨天2024-02-29有哪些闰年的bug</a>，有一个吃惊了</p>
<pre><code>&gt;&gt;&gt; datetime.datetime.strptime('Feb 29', '%b %d')
ValueError: day is out of range for month
</code></pre>
<p>python的 <code>datetime()</code> 默认 <code>year=1900</code>。但是心里想 1900 不应该也是闰年吗？</p>
<p>查了下还真不是。囧。一年有 365.242374 天：</p>
<ul>
<li>近似看成 365.25 天就是4年一润；</li>
<li>剩余的精度 365.25-365.242374 == 0.0076 天</li>
<li>而且，0.0076 ✖️ 400 == 3.0504，也就是每400年要少润3天</li>
<li>结论就是每100年不润，但是每400年又要润</li>
<li>比如 1700, 1800, 1900, 2100, 2200, 2300, 2500, 2600 这些年都不是闰年。2000、2400是闰年。</li>
</ul>
<p>真复杂！</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-03-01T13:57:00+08:00">2024-03-01</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-03"  rel="bookmark" >
              <h2 class="card-title">穷人的supervisor OOM killer</h2>
            </a>
            <p class="card-text"><p>厂里的docker上跑了个supervisord，用来把挂掉的进程拉起来。最近的问题不是进程挂掉，而是内存泄漏</p>
<p>跑着跑着内存爆了，然后宿主机OOM随机杀掉一个进程，结果占用内存最大的那个还活着，正常的进程反而gg，该漏的继续漏，然后反复OOM。想看下哪里漏了，<code>--cap-add=SYS_PTRACE</code> 也不给加，OOM策略也不给调，思来想去只能自己做防水补漏了。做起来也简单，supervisor再跑一套bash脚本即可：</p>
<pre><code>while true; do
  p=`ps --no-headers  -xo rss,pid --sort=-rss | awk '{
    if($1 &gt; 1000000){ print $2 }
  }'`
  kill $p 2&gt;/dev/null || echo "everything fine";
  sleep 60;
done;
</code></pre>
<p><code>1000000</code> 代表1G 内存。 <code>sleep 60</code> 表示 每60秒检查一次。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-02-27T16:48:00+08:00">2024-02-27</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-02"  rel="bookmark" >
              <h2 class="card-title">从 幻兽帕鲁 Palworld 设想一下未来的联机游戏</h2>
            </a>
            <p class="card-text"><p>打开steam刷到一个新闻《<a href="https://store.steampowered.com/news/app/294100/view/5851926268001690398?l=english">Ten years of RimWorld</a>》。啊？都十年了？回想起来最近非常爆火 幻兽帕鲁 Palworld ，被大家称为缝合怪，什么都缝了。细细盘点一下我对该类别游戏大杂烩的一个评价，以及我对未来游戏机制的一个YY。</p>
<h2>Minecraft 挖矿争霸</h2>
<p>我从这玩意还没中文名字的beta时代就开始玩（盗版），从山脚下一个 1x2 穴居的第一夜，挖到自己的第一铲煤，再到湖底水晶宫，然后修建自己的铁路在广袤的平原和山间品味那让人留连忘返 procedure generated terrain ，那个时候真的能给人一种激动。</p>
<p>后来搞的什么创造模式，各种复杂的机制和道具，没那个简单的快乐了。</p>
<h2>Conan Exiles</h2>
<p>和 minecraft 的 voxel 建筑风格相比，它的建筑是由<a href="https://blog.est.im/201905/stdin-003">正三角形、正方形构造出来的奇特镶嵌</a> 。当然还有特色的 wheel of pain 驯奴系统，简直解放劳动力啊</p>
<h2>Rimworld</h2>
<p>这玩意好就好在它那套 story-teller 带来的调性，很有那个味。后来的其他作品比如 Stranded: Alien Down 虽然设施设备、机制都堆了，但是总给人一种单薄，后期没劲的感觉。Rimworld 的限制就在于 2D 而且固定尺寸地图，不是 open-world</p>
<h2>Grand Theft Auto</h2>
<p>这玩意当年从 GTA:SA 接触觉得简直是神作啊！无缝地图在当年看来就是魔法一般。而且迄今为止它也是没有太多科幻元素，完全以「现代」为题材的都市类游戏，国产的喜欢做三国、仙侠，国外的喜欢中世纪、废土和赛博。凸显了 GTA 的独特生态位。当然这玩意玩 online 就是纯纯的 grind，还好我早就通过外挂刷了几个亿，很轻松惬意。（声明：外挂只用来刷钱，并不具备其它不公平功能）。这玩意在我心目中是 open-world 当之无愧的开创者和王者。</p>
<h2>Palworld</h2>
<p>接触了一下这玩意，其实我对 pokemon 一直有耳闻但是完全不懂，现在看来有点类似收集+配种这样一个机制。想起来玩一些 MMORPG 比如 Black Desert 发现一个叫做 「family」的机制很有趣，你可以创建多个角色并切换，部分物品甚至是通用的。但是这玩意感觉除了对不同角色体验一番，并不能带来 1+1&gt;2 的效果。我当时就非常希望同一个 family 的角色能相互配合，就像「Dragon Age: Origins」里一样，在行走和打架的时候能随时切换，不同的职业甚至能打出来一些配合，那该有多好。</p>
<h2>缝合</h2>
<p>游戏里最蛋痛的一点，对资源开采的大量需求，应该可以把玩家的角色托付给AI挂机，正如 Black Desert 的 auto-fishing 一样。Palworld 这一点就缝合的相当有趣了，原版的 pokemon 据说只能抓来打架，这里变成了还可以是生产力。比 Conan Exiles 里的奴隶机制更有意思。综合我前面的设想，我觉得以后的联机游戏，player-character 应该不是一个，而是一群。有血缘或者劳动附庸关系的「家族」。玩家应该有自由度选择控制其中一个或多个，玩家离线的时候这个「家族」应该也会按照设定进行生产和劳动。。。。甚至防御！</p>
<p>如果考虑死亡掉落机制，那么可以设计一套更有趣的系统：</p>
<ol>
<li>捏脸不能全部自定义，而是类似 Red Dead Redemption 那样的双亲继承+微调</li>
<li>角色的职业，天赋点，也应该通过血缘获得，而不是生硬的数值</li>
<li>玩家控制角色可以重伤，甚至死亡。死了就真死透了。但是你可以多生育子女，选一个比如95%相似度的，继续玩。</li>
<li>玩家随身物品，如果掉落，需要家族里其他人去捞，或者发悬赏换回</li>
<li>子女太多可以交给社会化抚养，变成NPC。</li>
<li>付费玩家可以全价自定义投胎，免费玩家可以从弃养的NPC里挑选。</li>
<li>家族里其他角色可以随时控制，或者分配生产、战斗任务</li>
<li>有俘虏、雇佣，随从等「条约」系统支持跨血缘配合</li>
<li>都说文明周边会刷出来蛮族。蛮族哪里来的？超出承载能力的人口流亡出去的。一个「family」生育太多，养不起，可以放出去「自谋生路」，投靠别的部落。NPC杂兵不应该是无脑复制，而是每个角色都有个背景板。类似 Rimworld 里 colonist 被海盗抓走俘虏，颠破流离。</li>
</ol>
<p>这样的体系下，说不定可以加入家族政治勾心斗角，最后演变成类似 十字军之王 一类的策略游戏？23333</p>
<p>在家族这样的设定下，还需要解决最后一个拼图：玩家终归是要时不时AFK的。那么玩家一定会需要据点。这类 base-building 游戏也烂大街了。但是最大的问题就是，一个服务器地图是有限的，好的建家点位就那么几个，目前联机游戏一般的做法是搞一套巨复杂的防御机制，高难度陷阱防止别的玩家抄家。实际上抄家和被抄家都挺难受的。</p>
<p>我的想法是，要不干脆把  base-building 改成关卡编辑器。把你基地当成Tower of Defense 的地牢来设计，家族成员通过占位和分工设计成闯关NPC，最后把你家族里战斗力最强的配置上最好的装备和武器设计成boss。然后拿一部分家产作为其他玩家闯关成功的奖励。别的玩家来闯关，是闯你家的副本，这样不完全破坏你的家，也可以让玩家发挥自己聪明才智，让别的玩家体会会被阴、被虐的乐趣。</p>
<p>有了「家族」和「关卡」两套机制，游戏的玩家也成了游戏机制进化的一部分，可以说病毒式传播，生生不息了。反正我又不做游戏，所以随便YY，不用关心可行性和成本，谁有兴趣请自行挪用，最好做出来能邀请我内测 :)</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-02-12T14:52:00+08:00">2024-02-12</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2024/stdout-01"  rel="bookmark" >
              <h2 class="card-title">FastAPI/Starlette 长连接感知断开</h2>
            </a>
            <p class="card-text"><p>之前写过如何 <a href="/2023/stdout-12">在服务器重启的时候感知长连接</a>，最近发现折腾复杂了。</p>
<p><a href="https://github.com/encode/starlette/discussions/1776">https://github.com/encode/starlette/discussions/1776</a></p>
<p>测试代码： </p>
<pre><code>import asyncio

async def async_streamer():
    try:
        while True:
            yield b&quot;--boundary\r\nContent-Type: text/plain\r\nContent-Length: 1\r\n\r\n1\r\n&quot;
            await asyncio.sleep(0)
    except asyncio.CancelledError:
        print(&quot;caught cancelled error&quot;)

app = Starlette(routes=[
    Route('/async', async_endpoint),
])
</code></pre>
<p>跑起来： <code>uvicorn stream:app</code></p>
<p>这段代码粗一看没啥大不了的，但是神奇的地方在于，如果去掉 <code>try ... except asyncio.CancelledError</code> ，代码也能正常跑</p>
<pre><code>
async def async_streamer():
    while True:
        yield b&quot;--boundary\r\nContent-Type: text/plain\r\nContent-Length: 1\r\n\r\n1\r\n&quot;
        await asyncio.sleep(0)
</code></pre>
<p>而且不会报错！最蛋痛的是，这玩意因为是个 <code>while True</code>，如果你里面有打开的数据库连接，是不会中断的，也不会回收的。因为这个 coroutine 没有继续 <code>async for</code> 来消费，就一直挂在进程里当僵尸了！</p>
<p>加上 <code>try ... except asyncio.CancelledError</code>，能捕获出错，也能处理善后了。</p>
<p>真是神奇啊。不知道是 uvicorn 的特性，还是 ASGI 都这样。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2024-01-18T14:44:12+08:00">2024-01-18</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-19"  rel="bookmark" >
              <h2 class="card-title">不能忘却的记忆</h2>
            </a>
            <p class="card-text"><p>由于小爱同学不能导出就挨个手打出来。纪念这个日子。</p>
<p><img alt="" src="/images/2023/stdout-19-01.jpg" /></p>
<p>一年前这几天，孩子和爱人相继病倒，我本来以为苟住了能以幸免结果在家人好转的时候一测体温发现偏高。于是赶紧洗了个澡，把小卧室腾出来，弄好电暖气、电吹风，装满开水壶，把mbp和其它个人物品搬进去，因为我知道接下来的日子将会无比煎熬。</p>
<table>
<thead>
<tr>
<th>date</th>
<th>℃</th>
</tr>
</thead>
<tbody>
<tr>
<td>2022-12-18 16:41</td>
<td>37.3</td>
</tr>
<tr>
<td>2022-12-18 16:43</td>
<td>37.3</td>
</tr>
<tr>
<td>2022-12-18 17.31</td>
<td>38.1</td>
</tr>
<tr>
<td>2022-12-18 17:46</td>
<td>38.3</td>
</tr>
<tr>
<td>2022-12-18 18:33</td>
<td>39.3</td>
</tr>
<tr>
<td>2022-12-18 18.41</td>
<td>38.7</td>
</tr>
<tr>
<td>2022-12-18 19:07</td>
<td>38.3</td>
</tr>
<tr>
<td>2022-12-18 19:15</td>
<td>38.7</td>
</tr>
<tr>
<td>2022-12-18 20:01</td>
<td>38.6</td>
</tr>
<tr>
<td>2022-12-18 21:11</td>
<td>39.5</td>
</tr>
<tr>
<td>2022-12-18 21:20</td>
<td>38.9</td>
</tr>
<tr>
<td>2022-12-18 21:26</td>
<td>39.1</td>
</tr>
<tr>
<td>2022-12-18 21:41</td>
<td>39.2</td>
</tr>
<tr>
<td>2022-12-18 23:30</td>
<td>38.4</td>
</tr>
<tr>
<td>2022-12-19 02:38</td>
<td>39.3</td>
</tr>
<tr>
<td>2022-12-19 02:48</td>
<td>38.3</td>
</tr>
<tr>
<td>2022-12-19 10:05</td>
<td>38.5</td>
</tr>
<tr>
<td>2022-12-19 10:12</td>
<td>37.9</td>
</tr>
<tr>
<td>2022-12-19 10:36</td>
<td>37.4</td>
</tr>
<tr>
<td>2022-12-19 11:19</td>
<td>37.7</td>
</tr>
<tr>
<td>2022-12-19 14:03</td>
<td>37.7</td>
</tr>
<tr>
<td>2022-12-19 14:29</td>
<td>37.0</td>
</tr>
<tr>
<td>2022-12-19 15:18</td>
<td>37.7</td>
</tr>
<tr>
<td>2022-12-19 16:33</td>
<td>37.6</td>
</tr>
<tr>
<td>2022-12-19 18:05</td>
<td>38.1</td>
</tr>
<tr>
<td>2022-12-19 18:44</td>
<td>37.8</td>
</tr>
<tr>
<td>2022-12-19 19:12</td>
<td>37.2</td>
</tr>
<tr>
<td>2022-12-19 19:47</td>
<td>37.8</td>
</tr>
<tr>
<td>2022-12-19 20:00</td>
<td>37.6</td>
</tr>
<tr>
<td>2022-12-19 21:09</td>
<td>37.2</td>
</tr>
<tr>
<td>2022-12-19 21:44</td>
<td>37.2</td>
</tr>
<tr>
<td>2022-12-19 22:57</td>
<td>36.9</td>
</tr>
<tr>
<td>2022-12-20 00:19</td>
<td>37.2</td>
</tr>
<tr>
<td>2022-12-20 06:55</td>
<td>37.1</td>
</tr>
<tr>
<td>2022-12-20 09:03</td>
<td>37.0</td>
</tr>
<tr>
<td>2022-12-20 09:34</td>
<td>37.0</td>
</tr>
<tr>
<td>2022-12-20 10:49</td>
<td>36.8</td>
</tr>
<tr>
<td>2022-12-20 11:41</td>
<td>38.0</td>
</tr>
<tr>
<td>2022-12-20 11:59</td>
<td>38.4</td>
</tr>
<tr>
<td>2022-12-20 14:47</td>
<td>38.6</td>
</tr>
<tr>
<td>2022-12-20 15:51</td>
<td>38.1</td>
</tr>
<tr>
<td>2022-12-20 16:32</td>
<td>38.0</td>
</tr>
<tr>
<td>2022-12-20 18:22</td>
<td>38.3</td>
</tr>
<tr>
<td>2022-12-20 22:31</td>
<td>38.4</td>
</tr>
<tr>
<td>2022-12-21 09:12</td>
<td>38.1</td>
</tr>
<tr>
<td>2022-12-21 09:59</td>
<td>38.2<code>*</code></td>
</tr>
<tr>
<td>2022-12-21 11:57</td>
<td>38.2</td>
</tr>
<tr>
<td>2022-12-21 13:46</td>
<td>37.5</td>
</tr>
<tr>
<td>2022-12-21 15:10</td>
<td>37.5</td>
</tr>
<tr>
<td>2022-12-21 16.44</td>
<td>37.2</td>
</tr>
<tr>
<td>2022-12-21 17:07</td>
<td>37.0</td>
</tr>
<tr>
<td>2022-12-21 20:37</td>
<td>37.2</td>
</tr>
<tr>
<td>2022-12-21 20:54</td>
<td>37.7</td>
</tr>
<tr>
<td>2022-12-21 22:54</td>
<td>38.3</td>
</tr>
<tr>
<td>2022-12-21 23:05</td>
<td>38.4</td>
</tr>
<tr>
<td>2022-12-22 09:23</td>
<td>36.7</td>
</tr>
<tr>
<td>2022-12-22 09:43</td>
<td>37.3</td>
</tr>
<tr>
<td>2022-12-22 12:44</td>
<td>37.6</td>
</tr>
</tbody>
</table>
<p><code>*</code>: 布洛芬已用完</p>
<p>可能大家只是看到一串冷冰冰的数字，但是我打字都是颤抖的，每一刻时间和体温都是刻骨铭心的记忆。</p>
<p>NEVER FORGET!</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-12-21T20:43:47+08:00">2023-12-21</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-18"  rel="bookmark" >
              <h2 class="card-title">京加高铁</h2>
            </a>
            <p class="card-text"><p>今天了解到这么一件事，白令海峡原来也就 82.5km 宽，水深55米，对于现代工程技术来说修桥和隧道都不是问题。</p>
<p><img alt="" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0e/BeringSt-close-VE.jpg/600px-BeringSt-close-VE.jpg" /></p>
<p>如果中间那个岛做个中转站，那么两侧都各自30km左右。所以理论上从北京修一条到西雅图/加州的高铁完全没有问题。。</p>
<p><img alt="" src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/37/North_pole_map.jpeg/800px-North_pole_map.jpeg" /></p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-12-18T23:10:40+08:00">2023-12-18</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-17"  rel="bookmark" >
              <h2 class="card-title">query git notes with Github GraphQL</h2>
            </a>
            <p class="card-text"><p>git notes is an interesting feature, you can use it like </p>
<pre><code class="language-bash">git notes add -m &quot;hello test git notes&quot;
git push origin 'refs/notes/*'
</code></pre>
<p>Github supported them back <a href="https://github.blog/2010-08-25-git-notes-display/">in 2010</a> then gave up LMAO.</p>
<p>If you need to retrive them with Github API, try GraphQL like this</p>
<pre><code>  {
    repository(owner: "est", name: "snippets") {
      refs(refPrefix:"refs/notes/",first:1) {
        nodes{
          ... on Ref{
            target {
              oid
              ... on Commit{
                changedFilesIfAvailable
                message
                tree{
                  oid
                  entries{
                    oid
                    path
                    size
                    lineCount
                    mode
                    object{
                      ... on Blob{
                        byteSize
                        text
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
</code></pre>
<p>It will return something like:</p>
<pre><code>  {
    "data": {
      "repository": {
        "refs": {
          "nodes": [
            {
              "target": {
                "oid": "bfdfda121f3d8a2d6aa399e3e8f0d58b3db0a543",
                "changedFilesIfAvailable": 1,
                "message": "Notes added by 'git notes add'",
                "tree": {
                  "oid": "2ab3e6a8b0dff6596fa60ecfb3c61bf91e5b4e1f",
                  "entries": [
                    {
                      "oid": "404d353a254ffbc97b2e16d17b8c100461aef586",
                      "path": "4fb1272f1e235580f87e3ec071984658de050dc9",
                      "size": 21,
                      "lineCount": 1,
                      "mode": 33188,
                      "object": {
                        "byteSize": 21,
                        "text": "hello test git notes\n"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  }
</code></pre>
<p>Here <code>"path": "4fb1272f1e235580f87e3ec071984658de050dc9"</code> is the commit SHA.</p>
<p>If you add more filter parameters in <code>refs()</code> you can fetch all the notes.</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-11-27T09:06:11+08:00">2023-11-27</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-16"  rel="bookmark" >
              <h2 class="card-title">VPS推荐：Hosteon</h2>
            </a>
            <p class="card-text"><p>继续<a href="/202012/stderr-012">上次 Racknerd</a> 之后发现这家还行。写了个<a href="https://github.com/est/snippets/blob/master/vps_scan/main.py">爬虫</a>扒了一下各色配置，独立服除外，有需要的自取</p>
<table>
<thead>
<tr>
<th>pid</th>
<th>spec</th>
<th>Disk</th>
<th>Bandwidth</th>
<th>Annual $</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=1">1</a></td>
<td>1C512M</td>
<td>5GB</td>
<td>100Mbps</td>
<td>$27.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=7">7</a></td>
<td>6C8G</td>
<td>100GB</td>
<td>100Mbps</td>
<td>$270.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=77">77</a></td>
<td>1C1G</td>
<td>10GB</td>
<td>1Tbps</td>
<td>$21.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=78">78</a></td>
<td>2C1.5G</td>
<td>20GB</td>
<td>2Tbps</td>
<td>$36.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=79">79</a></td>
<td>2C2G</td>
<td>25GB</td>
<td>3Tbps</td>
<td>$45.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=80">80</a></td>
<td>2C2.5G</td>
<td>30GB</td>
<td>4Tbps</td>
<td>$54.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=81">81</a></td>
<td>3C3G</td>
<td>40GB</td>
<td>5Tbps</td>
<td>$63.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=83">83</a></td>
<td>3C5G</td>
<td>50GB</td>
<td>8Tbps</td>
<td>$90.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=84">84</a></td>
<td>6C10G</td>
<td>120GB</td>
<td>12Tbps</td>
<td>$180.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=85">85</a></td>
<td>10C12G</td>
<td>150GB</td>
<td>15Tbps</td>
<td>$270.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=86">86</a></td>
<td>14C20G</td>
<td>200GB</td>
<td>20Tbps</td>
<td>$450.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=87">87</a></td>
<td>20C30G</td>
<td>300GB</td>
<td>30Tbps</td>
<td>$675.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=110">110</a></td>
<td>1C1G</td>
<td>15GB</td>
<td>2Tbps</td>
<td>$21.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=111">111</a></td>
<td>2C2G</td>
<td>20GB</td>
<td>4Tbps</td>
<td>$39.99</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=112">112</a></td>
<td>3C3G</td>
<td>30GB</td>
<td>6Tbps</td>
<td>$49.50</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=113">113</a></td>
<td>4C4G</td>
<td>40GB</td>
<td>8Tbps</td>
<td>$59.99</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=119">119</a></td>
<td>1C512M</td>
<td>10GB</td>
<td>500Gbps</td>
<td>$24.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=120">120</a></td>
<td>1C1G</td>
<td>15GB</td>
<td>1Tbps</td>
<td>$36.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=121">121</a></td>
<td>2C2G</td>
<td>30GB</td>
<td>2Tbps</td>
<td>$72.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=122">122</a></td>
<td>2C3G</td>
<td>50GB</td>
<td>3Tbps</td>
<td>$108.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=123">123</a></td>
<td>2C4G</td>
<td>70GB</td>
<td>4Tbps</td>
<td>$144.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=124">124</a></td>
<td>4C5G</td>
<td>90GB</td>
<td>5Tbps</td>
<td>$180.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=126">126</a></td>
<td>6C6G</td>
<td>100GB</td>
<td>6Tbps</td>
<td>$216.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=127">127</a></td>
<td>6C7G</td>
<td>120GB</td>
<td>7Tbps</td>
<td>$252.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=128">128</a></td>
<td>8C8G</td>
<td>140GB</td>
<td>8Tbps</td>
<td>$288.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=129">129</a></td>
<td>8C9G</td>
<td>150GB</td>
<td>9Tbps</td>
<td>$324.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=130">130</a></td>
<td>10C10G</td>
<td>170GB</td>
<td>10Tbps</td>
<td>$360.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=131">131</a></td>
<td>10C11G</td>
<td>180GB</td>
<td>11Tbps</td>
<td>$396.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=132">132</a></td>
<td>12C12G</td>
<td>200GB</td>
<td>12Tbps</td>
<td>$432.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=154">154</a></td>
<td>1C1G</td>
<td>20GB</td>
<td>4Tbps</td>
<td>$33.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=155">155</a></td>
<td>2C2G</td>
<td>30GB</td>
<td>6Tbps</td>
<td>$40.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=156">156</a></td>
<td>3C3G</td>
<td>40GB</td>
<td>8Tbps</td>
<td>$60.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=157">157</a></td>
<td>4C4G</td>
<td>50GB</td>
<td>10Tbps</td>
<td>$84.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=158">158</a></td>
<td>5C5G</td>
<td>60GB</td>
<td>12Tbps</td>
<td>$105.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=159">159</a></td>
<td>6C6G</td>
<td>70GB</td>
<td>14Tbps</td>
<td>$130.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=160">160</a></td>
<td>7C7G</td>
<td>80GB</td>
<td>16Tbps</td>
<td>$145.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=161">161</a></td>
<td>8C8G</td>
<td>90GB</td>
<td>18Tbps</td>
<td>$170.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=162">162</a></td>
<td>9C9G</td>
<td>100GB</td>
<td>20Tbps</td>
<td>$190.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=163">163</a></td>
<td>10C10G</td>
<td>110GB</td>
<td>22Tbps</td>
<td>$210.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=164">164</a></td>
<td>11C11G</td>
<td>120GB</td>
<td>24Tbps</td>
<td>$240.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=165">165</a></td>
<td>12C12G</td>
<td>130GB</td>
<td>26Tbps</td>
<td>$260.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=166">166</a></td>
<td>8C8G</td>
<td>50GB</td>
<td>30Tbps</td>
<td>$98.99</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=167">167</a></td>
<td>4C4G</td>
<td>25GB</td>
<td>15Tbps</td>
<td>$56.99</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=168">168</a></td>
<td>4C4G</td>
<td>25GB</td>
<td>15Tbps</td>
<td>$79.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=169">169</a></td>
<td>8C8G</td>
<td>50GB</td>
<td>30Tbps</td>
<td>$158.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=170">170</a></td>
<td>12C12G</td>
<td>75GB</td>
<td>30Tbps</td>
<td>$235.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=171">171</a></td>
<td>16C16G</td>
<td>100GB</td>
<td>30Tbps</td>
<td>$318.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=172">172</a></td>
<td>20C20G</td>
<td>125GB</td>
<td>30Tbps</td>
<td>$399.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=173">173</a></td>
<td>24C24G</td>
<td>150GB</td>
<td>30Tbps</td>
<td>$480.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=174">174</a></td>
<td>28C28G</td>
<td>175GB</td>
<td>30Tbps</td>
<td>$575.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=175">175</a></td>
<td>32C32G</td>
<td>200GB</td>
<td>30Tbps</td>
<td>$660.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=176">176</a></td>
<td>36C36G</td>
<td>225GB</td>
<td>30Tbps</td>
<td>$730.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=177">177</a></td>
<td>40C40G</td>
<td>250GB</td>
<td>30Tbps</td>
<td>$810.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=178">178</a></td>
<td>1C1G</td>
<td>20GB</td>
<td>2Tbps</td>
<td>$21.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=179">179</a></td>
<td>32C32G</td>
<td>1TB</td>
<td>1Gbps</td>
<td>$540.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=180">180</a></td>
<td>64C64G</td>
<td>1TB</td>
<td>1Gbps</td>
<td>$725.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=181">181</a></td>
<td>128C128G</td>
<td>2x</td>
<td>1Gbps</td>
<td>$1850.00</td>
</tr>
</tbody>
</table></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-11-19T22:10:55+08:00">2023-11-19</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-15"  rel="bookmark" >
              <h2 class="card-title">太阳系天体的 unicode 符号</h2>
            </a>
            <p class="card-text"><p>发现<a href="https://en.wikipedia.org/wiki/Astronomical_symbols">Astronomical symbols</a>，<a href="https://en.wikipedia.org/wiki/Planet_symbols">Planet symbols<br />
</a> 及 <a href="https://en.wikipedia.org/wiki/Alchemical_symbol#Unicode">Alchemical symbol</a></p>
<table>
<thead>
<tr>
<th>IAU</th>
<th>七金</th>
<th>符号</th>
<th>名</th>
<th>name</th>
<th>星期</th>
<th>七曜</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>金</td>
<td>☉︎</td>
<td>太阳</td>
<td>Sun</td>
<td>星期天</td>
<td>日曜</td>
<td></td>
</tr>
<tr>
<td></td>
<td>银</td>
<td>☾</td>
<td>月球</td>
<td>Moon</td>
<td>星期一</td>
<td>月曜</td>
<td>也可以画成 ☽︎ <br>或者月相 🌑︎🌒︎🌓︎🌔︎🌕︎🌖︎🌗︎🌘︎，🌚︎🌛︎︎🌝︎︎🌜︎︎</td>
</tr>
<tr>
<td>H</td>
<td>汞</td>
<td>☿</td>
<td>水星</td>
<td>Mercury</td>
<td>星期三</td>
<td>水曜</td>
<td>赫耳墨斯(Hermes)，罗马人称 Mercury<br>现代人称「爱马仕」的双盘蛇带翼权杖 Caduceus <font size="5">☤</font></td>
</tr>
<tr>
<td>V</td>
<td>铜</td>
<td>♀</td>
<td>金星</td>
<td>Venus</td>
<td>星期五</td>
<td>金曜</td>
<td>维纳斯</td>
</tr>
<tr>
<td>E</td>
<td></td>
<td>🜨</td>
<td>地球</td>
<td>Earch</td>
<td></td>
<td></td>
<td><em>Bible</em> 里说的四条河把地球分成四洲<br>另外的符号是 ♁ 表示十字架钉个球 <em>globus cruciger</em></td>
</tr>
<tr>
<td>M</td>
<td>铁</td>
<td>♂</td>
<td>火星</td>
<td>Mars</td>
<td>星期二</td>
<td>火曜</td>
<td>符号是战神盾牌和长矛</td>
</tr>
<tr>
<td>J</td>
<td>锡</td>
<td>♃</td>
<td>木星</td>
<td>Jupiter</td>
<td>星期四</td>
<td>木曜</td>
<td>字母 Zeta（大写Ζ小写ζ）加一杠，代表宙斯/朱庇特</td>
</tr>
<tr>
<td>S</td>
<td>铅</td>
<td>♄</td>
<td>土星</td>
<td>Saturn</td>
<td>星期六</td>
<td>土曜</td>
<td>字母 kappa-rho ，表示 Kronos 加一杠<br>泰坦 克罗诺斯，宙斯他爹</td>
</tr>
<tr>
<td>U</td>
<td></td>
<td>⛢</td>
<td>天王星</td>
<td>Uranus</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>N</td>
<td></td>
<td>♅</td>
<td>海王星</td>
<td>Neptune</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>几点：</p>
<ul>
<li>其中 金星/火星 符号被拿来代表 女/男 是1750年代Carl Linnaeus干的。 </li>
<li>冥王星 Pluto 发现的晚，占星术还没来得及改版就惨遭除名成矮行星。</li>
<li>星期和对应的天体意义，<a href="https://en.wikipedia.org/wiki/Names_of_the_days_of_the_week">全世界惊人的一致</a></li>
</ul>
<p>其它各种卫星，小行星的名字就懒得贴了。</p>
<p>有了这些符号，我们可以画一个比如托勒密的简化版太阳系模型：</p>
<p><img alt="" src="/images/2023/stdout-15-01.jpg" /></p>
<p>本文源自《<a href="https://www.cricetuscricetus.co.uk/post/copernicus-galileo-kepler-they-all-lacked-proof">哥白尼、伽利略、开普勒都是脱离证据拍脑袋撕逼</a>》一文。<a href="https://news.ycombinator.com/item?id=38300902">HN</a></p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-11-18T16:15:51+08:00">2023-11-18</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-14"  rel="bookmark" >
              <h2 class="card-title">Getting started blogging on Win10</h2>
            </a>
            <p class="card-text"><p>I am planning to setup by blogging environment on my Windows PC.</p>
<ul>
<li>OS: Windows 10</li>
<li>Shell: Bash on WSL1</li>
<li>Program: <code>pelican</code> on Miniconda3 with Python 3.11</li>
</ul>
<p>My objective today is get rid of the <code>static/js/core.js</code> from <code>aether-pelican</code> theme and replace it with <a href="https://jsfiddle.net/t78mf7jb/3/">a simple CSS</a>, and it turns out quite challenging.</p>
<h3>WSL1 and file system</h3>
<p>As it turns out, the installed Ubuntu root filesystem on WSL1 is located here:</p>
<p><code>%localappdata%\Packages\CanonicalGroupLimited.UbuntuonWindows_79rhkp1fndgsc\LocalState\rootfs</code></p>
<p>I plan to move my home dir (at least) to another SSD on my PC, as the <code>C:\</code> drive is an old SanDisk Plus240, which is unforgivablly slow these days. I tried to <code>mv ~ /mnt/d/home</code>, ok but the permission gets weird.</p>
<p>So I tried to copy the folder on Windows to <code>D:\home</code>, and <code>mklink</code> back. I tried both <code>mklink /D</code> and <code>mklink /J</code> ( the <code>/D</code> switch works on a remote drive whereas the <code>/J</code> junction works on local NTFS disks only) and they both failed be recognized by WSL1. The bash yields <code>Broken stdout/stdin</code> upon launch</p>
<p>So OK, default home dir then. Bad luck for me.</p>
<h3>Ubuntu 22</h3>
<p>I just found out my <code>cat /etc/lsb-release</code> shows Ubuntu 18, which is the default distro installed on <code>WSL1</code> I assume. I tried to install Ubuntu 22 from the Microsoft Store, after several wasted minutes (curse the slow Internet in Mainland!) it turns out for WSL2 only. Luckily the Windows Subsystem for Linux was successfully upgraded to latest version:</p>
<pre><code>C:\&gt; wsl --version
WSL version: 1.2.5.0
Kernel version: 5.15.90.1
WSLg version: 1.0.51
MSRDC version: 1.2.3770
Direct3D version: 1.608.2-61064218
DXCore version: 10.0.25131.1002-220531-1700.rs-onecore-base2-hyp
Windows version: 10.0.19045.3570
</code></pre>
<p>the <code>wsl --list --online</code> commands stuck for a total of 10 minutes and returns nothing (curse the AS4134 163NET!)</p>
<h3>Getting Python, Miniconda and Pelican</h3>
<p>So linux distro setup was back to where started, I only have Python to mess with. Miniconda3 gets insalled easily, now that's a some progress. The static site generator I am using <code>pip install pelican[markdown]</code> finishes ok, the pypi was not blocked? Keke.</p>
<p>Then I typed <code>make</code>. It was not part of WSL1? Blaspheme!</p>
<p>Manually running <code>python -m pelican.server</code>, and voila! The Windows asks for firewall listening permission, granted, open up browser, BAM! My blog setup process is done and now I can write and tweak it on Windows. </p>
<p>Oh, and there's <code>git config core.fileMode false</code> needs to be checked!</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-11-11T10:31:11+08:00">2023-11-11</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-13"  rel="bookmark" >
              <h2 class="card-title">火星上怎么结算工资</h2>
            </a>
            <p class="card-text"><p>看到个段子</p>
<p><img alt="" src="/images/2023/stdout-13-01.jpg" /></p>
<p>突然让我想起个事，如果去火星打工，薪资该怎么计算？摘录 wikipedia</p>
<blockquote>
<p>火星的恒星时长 <code>24小时37分钟22.663秒</code>，而太阳日则长 <code>24小时39分钟35.24409</code> 秒。而地球的恒星时和太阳日则分别是 <code>23小时56分钟4.0916秒</code> 及 <code>24小时</code>。在比较之下，一火星太阳日等于1.027491地球太阳日，即比地球太阳日长2.7%。</p>
</blockquote>
<p>怎么有两个天？继续搜</p>
<blockquote>
<p>太阳日（英语：solar day）是依据太阳运动，所定义的时间，可以分为视觉太阳日和平均太阳日。一太阳日传统称为一“日”、一“天”或一“昼夜”。</p>
</blockquote>
<p><img alt="" src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/67/Sidereal_day_%28prograde%29.png/600px-Sidereal_day_%28prograde%29.png" /></p>
<p>英语里把火星的一天叫做一个 <code>Sol</code>。一个火星年在英文的 wikipedia 有讲</p>
<blockquote>
<p>sidereal year ... is about 686.98 Earth solar days (≈ 1.88 Earth years), or <code>668.5991</code> sols 。也就是说火星一年有 668.5991 火星天。。。</p>
</blockquote>
<p>火星因为有<code>25.19°</code>的自转倾角，跟地球相近，所以也可以划分四季。但问题是，火星的轨道长这样：</p>
<p><img alt="" src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Mars_earth_orbit.png/600px-Mars_earth_orbit.png" /></p>
<p>所以如果按照四个季节划分，最长的季节有 <code>194 个 Martian Sols</code>，最短的 <code>142 Martian sols</code></p>
<p>那么问题来了。在火星上怎么算工资呢？我觉得得安天结了。还有，假如亲爱的读者小伙伴将来到火星务工，应聘的时候一定确认好是按地球年结算还是火星年哦。谨防火星历诈骗！</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-11-09T15:50:11+08:00">2023-11-09</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-12"  rel="bookmark" >
              <h2 class="card-title">FastAPI/Starlette graceful shutdown server-sent events</h2>
            </a>
            <p class="card-text"><h3>缘起</h3>
<p>假如你用 FastAPI/Starlette框架，写了一段 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events">Server-sent Events</a></p>
<pre><code class="language-python">@app.get('/api/my_stream')
async def api_stream():
  async def gen():
    while 1:
      yield &quot;data: {}\n\n&quot;
      await asyncio.sleep(1.0)

  return StreamingResponse(gen, media_type=&quot;text/event-stream&quot;, headers={
    'X-Accel-Buffering': 'no',
    'Cache-Control': &quot;no-cache&quot;,
    'Connection': &quot;keep-alive&quot;,
  })
</code></pre>
<h3>FastAPI 事件</h3>
<p>然后你重启了服务器，比如 gunicorn+uvicorn，你会发现这个连接不会断开，一直输出结果。直到 worker 进程超过配置里的 <code>timeout</code> 参数（默认60秒），被 master 强行杀死然后重启。</p>
<p>一开始尝试了 <a href="https://fastapi.tiangolo.com/advanced/events/#shutdown-event">FastAPI 官方的 <code>shutdown</code> 事件</a>，再在代码的 <code>while 1</code> 加一个 <code>if</code> 判断。发现不管用</p>
<pre><code class="language-python">@app.on_event('shutdown')
def on_server_shutdown():
    app.state.running = False
</code></pre>
<p>发现这段代码执行是执行了，但是是在杀死worker的时候生效的。得更加提前。用<a href="https://asgi.readthedocs.io/en/latest/specs/lifespan.html">ASGI推荐的<code>lifespan</code></a>和 <a href="https://asgi.readthedocs.io/en/latest/specs/www.html#disconnect-receive-event"><code>http.disconnect</code></a> 太复杂，放弃。</p>
<h3>Linux signal</h3>
<p>尝试暴力监听 worker signal</p>
<pre><code class="language-python">import signal
signal.signal(signal.SIGINT, on_server_shutdown)  # ctrl+c
signal.signal(signal.SIGUSR2, on_server_shutdown)
signal.signal(signal.SIGTERM, on_server_shutdown)
signal.signal(signal.SIGWINCH, on_server_shutdown)
signal.signal(signal.SIGHUP, on_server_shutdown)
signal.signal(signal.SIGQUIT, on_server_shutdown)
</code></pre>
<p>发现也不管用。研究了半天，似乎是 <code>UvicornWorker.init_signals</code> 的时候<a href="https://github.com/encode/uvicorn/issues/894">给<code>signal.SIG_DFL</code>了</a>。无语ing</p>
<h3>uvicorn shutdown 流程</h3>
<p>看gunicorn日志：</p>
<pre><code>[2023-11-02 09:50:38 +0800] [25918] [INFO] Shutting down
[2023-11-02 09:50:38 +0800] [25918] [INFO] Waiting for application shutdown.
[2023-11-02 09:50:38 +0800] [25918] [INFO] Waiting for connections to close. (CTRL+C to force quit)
....
[2023-11-02 09:51:18 +0800] [25918] [INFO] Application shutdown complete.
[2023-11-02 09:51:18 +0800] [25918] [INFO] Finished server process [25918]
[2023-11-02 09:51:18 +0800] [25918] [INFO] Worker exiting (pid: 25918)
</code></pre>
<p>观察到 Waiting for connections to close 之后卡住。</p>
<p>属于 uvicorn 的 <a href="](https://github.com/encode/uvicorn/blob/07c2b36455b5475ff7edfa54068ff2c0581a2be1/uvicorn/server.py#L303)"><code>Server.shutdown()</code></a> 方法</p>
<p>这个方法调用链：</p>
<ol>
<li><code>Server.install_signal_handlers</code> 里注册 signal </li>
<li><code>Server.handle_exit</code> 里设置 <code>Server.should_exit = True</code></li>
<li>每秒一次的 <code>Server.on_tick</code> 就会打断 <code>Server.main_loop()</code> 死循环</li>
<li>调用 <code>Server.shutdown</code></li>
</ol>
<p>如果能拿到 <code>Server.should_exit</code> 自行判断就好了，但是 ASGI 是容器无感的，只继续研究</p>
<h3>断开http连接</h3>
<p>上面日志有一个比较关键：</p>
<pre><code class="language-python"># Request shutdown on all existing connections.
for connection in list(self.server_state.connections):
    connection.shutdown()
    await asyncio.sleep(0.1)
</code></pre>
<p>其http连接关闭方法实现为：</p>
<pre><code class="language-python">def shutdown(self):
    &quot;&quot;&quot;
    Called by the server to commence a graceful shutdown.
    &quot;&quot;&quot;
    if self.cycle is None or self.cycle.response_complete:
        self.transport.close()
    else:
        self.cycle.keep_alive = False
</code></pre>
<p>这里应该走的是 <code>else</code> 分支。所以解决方法就是去代码里拿到 <code>cycle.keep_alive</code> 这个属性。</p>
<h3>ASGI 接口</h3>
<p>跟了一会儿，发现ASGI 在  starlette 里如下流程：</p>
<ol>
<li><code>Route()</code> 初始化 <code>self.app = request_response(endpoint)</code></li>
<li><code>Route().handle()</code> 的时候会调用 <code>self.app(scope, receive, send)</code></li>
<li><code>unicorn</code> 的 <code>run_asgi</code> 会 <code>result = await app(self.scope, self.receive, self.send)</code> 。其中 <code>app</code> 就是 starlette 的 <code>Route()</code> 实例</li>
</ol>
<p>所以解决方案逐渐明朗了</p>
<h3>黎明的前夜</h3>
<p>通过 FastAPI/Starlette 请求的 <code>.receive</code> 属性的 <code>__self__</code> 拿到 unicorn 的 <code>cycle</code> 实例，然后定时判断上面 <code>shutdown</code> 赋值的 <code>self.cycle.keep_alive = False</code></p>
<pre><code class="language-python">@app.get('/api/my_stream')
async def api_stream(req: Request):
  async def gen():
    while 1:
      yield &quot;data: {}\n\n&quot;
      await asyncio.sleep(1.0)
      if getattr(req.receive.__self__, 'keep_alive', None) is False:
        break

  return StreamingResponse(...
</code></pre>
<p>这里用了个 <code>getattr()</code> 是保证这个 hack 在非 unicorn 下代码也能正常跑</p>
<p><code>git commit . -m "haha"</code> 上机联调，发现坑了。。。我特么。。。。这个 <code>cycle.keep_alive</code> 默认就是 <code>False</code></p>
<h3>扭转 keep_alive</h3>
<p>这玩意一直为 <code>False</code> 的原因是，unicorn 的 <code>HttpToolsProtocol.on_headers_complete</code> 赋值过程：</p>
<p><code>self.cycle = RequestResponseCycle(..., keep_alive=http_version != "1.0")</code></p>
<p>这里 <code>http_version</code> 可以通过  <code>req.scope['http_version']</code> 得到，打印了一下，你猜怎么着，还真tm是。。。原因就是厂里反代 <a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_http_version">nginx的proxy_http_version</a>没配置。这里是个常见的坑，非常影响性能，因为每个请求会生成一个新的 http 连接。</p>
<p>但是也等不急SA去改配置了。于是直接在代码 <code>async def gen():</code> 前面写死：</p>
<p><code>req.receive.__self__.keep_alive = True</code> 。提交，再试。。。咦，怎么 <code>keep_alive</code> 依然为 <code>False</code>？？？？明明刚刚赋值了？</p>
<p>继续读代码，发现第二个坑，发现 unicorn 的 <code>RequestResponseCycle.send()</code> 方法里，在构造返回的时候，有一句</p>
<pre><code class="language-python">for name, value in headers:
    elif name == b&quot;connection&quot; and value.lower() == b&quot;close&quot;:
        self.keep_alive = False
</code></pre>
<p>好吧。。。那么解决方法就是，把 <code>keep_alive = True</code> 挪到返回内部。先完成返回构造，再强行改值。</p>
<h4>最后的代码</h4>
<pre><code class="language-python">@app.get('/api/my_stream')
async def api_stream(req: Request):
  # req.receive.__self__.keep_alive = True  # doesn't work here
  async def gen():
    req.receive.__self__.keep_alive = True  # works here
    while 1:
      yield &quot;data: {}\n\n&quot;
      await asyncio.sleep(1.0)
      if req.receive.__self__.keep_alive is False:
        break

  return StreamingResponse(gen, media_type=&quot;text/event-stream&quot;, headers={
    'X-Accel-Buffering': 'no',
    'Cache-Control': &quot;no-cache&quot;,
    'Connection': &quot;keep-alive&quot;,
  })
</code></pre>
<p>测试重启 worker，该连接在1秒后断开，worker平稳重启。完美。</p>
<p>苦逼撸业务的一天又开始了。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-11-02T09:44:12+08:00">2023-11-02</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-11"  rel="bookmark" >
              <h2 class="card-title">浏览器拉起钉钉客户端并跳转OA工单</h2>
            </a>
            <p class="card-text"><p>又是 corporate software engineering 吃屎的一天。用户在内部系统走流程，厂里用的是钉钉自带的OA工单审批。已经接入了API创建、完成工单</p>
<p>问题在于发起工单之后，用户并没有感知，不知道工单去哪里了，流程就断了，向钉钉官方售后发起咨询，对方丢了一句：不支持。无语</p>
<p>只能自己鼓捣。已知工单链接，在钉钉聊天窗口内部的最短的网址为：</p>
<pre><code>  https://aflow.dingtalk.com/dingtalk/mobile/homepage.htm?corpid=...&amp;procInstId=...#approval
</code></pre>
<p>对方丢了一个 <a href="https://open.dingtalk.com/document/isvapp/webapp-unified-routing-protocol#title-kkq-kgx-lbq">dingtalk:// 跳转协议</a></p>
<p>反复尝试，发现一个很有用：</p>
<blockquote>
<p>桌面端打开URL <br />
<code>dingtalk://dingtalkclient/page/link</code> <br />
侧边栏： <code>pc_slide=true</code> <br />
大容器（类似工作台容器）<code>ddtab=true</code>   </p>
</blockquote>
<p>于是构造一个试试：</p>
<pre><code>  dingtalk://dingtalkclient/page/link?url=https%3A%2F%2Faflow.dingtalk.com%2Fdingtalk%2Fpc%2Fquery%2Fpchomepage.htm%3Fcorpid%3D...%26procInstId%3D...%23%2Fapproval
</code></pre>
<p>然后果然ok了。</p>
<p>钉钉给人的感觉就是各个部门 hack 强行揉合起来一个怪物。各种不完善、不一致的问题。有空写一下吐槽。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-10-18T14:57:00+08:00">2023-10-18</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-10"  rel="bookmark" >
              <h2 class="card-title">SVG放在 img 中不能加载图片/字体</h2>
            </a>
            <p class="card-text"><p>最近想在 markdown 里搞图文混排，遇到一个大图把版面占完了，想缩小一些，由于 .md 渲染器安全限制，没法直接指定宽高</p>
<p>只能从图片本身想办法，首先最直接的手段就是服务器再缩放一次，但是蛋痛的问题是缩放之后文件怎么存，怎么给静态文件路由，怎么保障图片可用性，怎么兼容各种尺寸，想想都头大。</p>
<p>想到一个 hack，要不直接放一个 .svg 进去，因为 svg 支持加载位图资源，所以把 svg 位图缩小一点，让浏览器渲染 svg 不就行了。</p>
<p>没想到就被这个 hack 坑了。原因是 svg 如果被 <code>&lt;img&gt;</code> 标签渲染，那么禁止加载任何外部资源，脚本也禁止执行。</p>
<p>为了证明这个限制，我写了个 demo 放在 <a href="https://lab.est.im/shit_svg/">https://lab.est.im/shit_svg/</a></p>
<p>这个问题太隐蔽了。stackoverflow 上只有 <a href="https://stackoverflow.com/a/30467585/41948">Robert Longson</a>、<a href="https://stackoverflow.com/a/69160093/41948">ThangLeQuoc</a>、<a href="https://stackoverflow.com/a/18244035/41948#18244035">TheHippo<br />
</a> 的答案提到隐约线索：</p>
<p>后来搜了到 <a href="https://supercodepower.com/en/svg-img-use-font">skychx</a> 把这个问题研究透了。罪魁祸首 <a href="https://www.w3.org/wiki/SVG_Security">SVG Security</a></p>
<blockquote>
<p>If an SVG file is fetched as image, then certain requirements apply to this document:   </p>
<ul>
<li>The SVG document is not allowed to fetch any resources. This also applies to scripts, stylesheets or images.   </li>
<li>Fonts shouldn't be loaded as well. The situation in UAs seems to still be unclear though.<br />
Scripts must not be executed.   </li>
<li>Event listeners must be disabled at all times.   </li>
</ul>
</blockquote>
<p>浪费我好多时间。SVG2里把这个说得很明白了 <a href="https://www.w3.org/TR/SVG2/conform.html#processing-modes">https://www.w3.org/TR/SVG2/conform.html#processing-modes</a></p>
<blockquote>
<p>When external references are disabled in an SVG document, any attempt to fetch a document through an external reference must instead be treated as if a network error occurred and no data was received.</p>
</blockquote>
<p>不过查阅资料的时候发现个好玩的，<a href="https://www.w3.org/TR/SVG11/single-page.html#linking-LinksIntoSVG">SVG 1.1 支持 URL fragments</a></p>
<p>比如：</p>
<ul>
<li>原图 <a href="https://lab.est.im/shit_svg/1.svg">https://lab.est.im/shit_svg/1.svg</a> <embed src="https://lab.est.im/shit_svg/1.svg"></li>
<li>放大 <a href="https://lab.est.im/shit_svg/1.svg#svgView(viewBox(20,20,60,60))">https://lab.est.im/shit_svg/1.svg#svgView(viewBox(20,20,60,60))</a> <embed src="https://lab.est.im/shit_svg/1.svg#svgView(viewBox(20,20,60,60))"></li>
</ul></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-10-17T22:13:18+08:00">2023-10-17</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-09"  rel="bookmark" >
              <h2 class="card-title">市以上行政区划去掉后缀</h2>
            </a>
            <p class="card-text"><p>今天才知道，中国一共333个市一级行政单位。数据来源是 <a href="https://www.mca.gov.cn/n156/index.html">民政部首页 ➡ 民政数据</a></p>
<pre><code>import re

def short_name(name):
    m = re.search(r'''
        (\S+?)
        (?:
            壮族|回族|维吾尔|省|自治区|特别|  # 省
            (?:侗|傈僳|傣|哈尼|回|土家|壮|布依|彝|景颇|朝鲜|白|羌|苗|藏)族|
            蒙古|柯尔克孜|哈萨克|
            地区|市|盟|自治州|自治县
        ).*$
    ''', name, re.VERBOSE)
    if m:
        return m.group(1)
    return name
</code></pre>
<p>这段代码的作用是把比如 <code>"黔南布依族苗族自治州"</code> 这样的名字，缩短成 <code>"黔南"</code>。</p>
<p>有一个小坑是，市一级行政区包含 <code>蒙古|柯尔克孜|哈萨克</code> 这三个名字后面没有 <code>族</code> 字。</p>
<p>有一些 <code>XX林区</code> <code>XX矿区</code> 什么的，我觉得保留比较好。</p>
<p>Python的 <code>re.VERBOSE</code> 真是好东西！</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-10-12T20:01:23+08:00">2023-10-12</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-07"  rel="bookmark" >
              <h2 class="card-title">在py3里同步/异步混合使用 httpx 调用</h2>
            </a>
            <p class="card-text"><p>比如开发需求是请求一个 http API，得到数据，解析一下返回，那么一般的做法是封装一个方法，比如</p>
<pre><code>import httpx


def get_sth(p1, default=MY_VAL):
    # network
    r = httpx.get(API_URL, params={'t1': p1})
    # parsing
    res = r.json().get('my_key') or MY_VAL
</code></pre>
<p>但是如果想在 async/await 里用这段代码，就得改成</p>
<pre><code>import httpx


async def get_sth(p1, default=MY_VAL):
    # network
    with http.AsyncClient() as client:
        r = await client.get(API_URL, params={'t1': p1})
    # parsing
    res = r.json().get('my_key') or MY_VAL
</code></pre>
<p>注意其中 <code>def get_sth()</code> 也必须改成 <code>async def get_sth</code> 。这就是所谓 async/await 传染性</p>
<p>这个时候，如果你想把这块代码抽象出来，让同步/异步的库都能调用，我在最近重构里找到一个最佳实践：</p>
<pre><code>import httpx


def get_sth(p1, default=MY_VAL):
    r = httpx.Request('GET', API_URL, params={'t1': p1})
    r.parse = lambda x: (x.get('my_key') or MY_VAL)

# 同步调用：
with httpx.Client() as client:
    r = client.send(get_sth())
r.request.parse(r.json())

# 异步调用：
async with httpx.AsyncClient() as client:
    r = await client.send(get_sth())
r.request.parse(r.json())
</code></pre>
<p>思路是 逻辑和 transport解耦，也是某种意义上的 <a href="https://sans-io.readthedocs.io/">Sans-IO</a> 了吧？</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-07-05T17:39:54+08:00">2023-07-05</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-06"  rel="bookmark" >
              <h2 class="card-title">git切换马甲</h2>
            </a>
            <p class="card-text"><p>如果你有多个 github、bitbucket、gitlab 账号需要来回切换，那么这个方法或许对你有用。</p>
<p>使用git你需要配置一个 <code>~/.ssh/id_rsa</code>，如果你有多个身份就麻烦了。传统网上搜到的办法是编辑 <code>~/.ssh/config</code> 然后加入个类似这样的配置：</p>
<pre><code>  Host estgit
  HostName github.com
  Port 22
  User git
  IdentityFile ~/.ssh/est_github
  IdentitiesOnly yes
</code></pre>
<p>这样做也不是不行，就是你输入命令的时候得把主机名改了。比如</p>
<p><code>git clone git@github.com:est/aether-pelican.git</code></p>
<p>你需要改成 </p>
<p><code>git@estgit:est/aether-pelican.git</code></p>
<p>当然这还不是最蛋痛的。最蛋痛的是如果你用了 <code>git submodules</code> 那么你切换马甲变得非常麻烦。因为别人用你的项目没法解析 <code>git@estgit</code> 这样的玩意。</p>
<p>我研究出来了一个hack，直接改repo的 <code>.git/config</code> 可以达到同样的效果。比如</p>
<pre><code>  [core]
      sshCommand = /usr/bin/ssh -o IdentitiesOnly=yes -i ~/.ssh/est_github -a
  [user]
      name = est
      email = ...@...
</code></pre>
<p>这样你可以随意在不同的repo切换n个 ssh identity 身份。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-06-26T16:27:28+08:00">2023-06-26</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-08"  rel="bookmark" >
              <h2 class="card-title">Rimworld 1.4 Biotech Xenogene/Endogene code names</h2>
            </a>
            <p class="card-text"><p>I found out the corresponding gene code by accident, for Yuran Race mod it's located under</p>
<p><code>~/Library/Application\ Support/Steam/SteamApps/workshop/content/*/2844129100/Bio1.4/Defs/YuranBioTitle.xml</code></p>
<p>So the official description can be found at (or <a href="https://rimworldwiki.com/wiki/Modding_Tutorials/Xenotypes">wiki</a>):</p>
<p><code>~/Library/Application\ Support/Steam/SteamApps/common/RimWorld/RimWorldMac.app/Data/Biotech/Defs/GeneDefs/</code></p>
<p>I need to use the dev tool to modify gene of my pawn, so here's the table:</p>
<pre><code>import os
import xml.etree.ElementTree as ET
p = os.path.expanduser('~/Library/Application Support/Steam/SteamApps/common/RimWorld/RimWorldMac.app/Data/Biotech/Defs/GeneDefs/')
fields = 'defName label description biostatCpx biostatMet biostatArc'.split()
print('| %s |' % ' | '.join(fields))
print('|--------' * len(fields) + '|')
for f in os.listdir(p):
    root = ET.fromstring(open(p + f).read())
    for elem in root.findall('GeneDef'):
        vals = [t.text if isinstance(t:=elem.find(x), ET.Element) else '' for x in fields]
        if vals[0]:
            print('| %s |' % ' | '.join(vals))
</code></pre>
<p>The result is:</p>
<style type="text/css" id="pre-table">
    style#pre-table + table{
        font-size: 65%;
    }
</style>

<table>
<thead>
<tr>
<th>defName</th>
<th>label</th>
<th>description</th>
<th>biostatCpx</th>
<th>biostatMet</th>
<th>biostatArc</th>
</tr>
</thead>
<tbody>
<tr>
<td>Hair_BaldOnly</td>
<td>no hair</td>
<td>Carriers of this gene grow no hair on the head.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Hair_ShortOnly</td>
<td>short-haired</td>
<td>Carriers of this gene can only grow short hair.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Hair_LongOnly</td>
<td>long-haired</td>
<td>Carriers of this gene grow hair on the head very quickly.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Hair_Grayless</td>
<td>grayless hair</td>
<td>Carriers of this gene keep their natural hair color as they age.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Beard_BushyOnly</td>
<td>only bushy beards</td>
<td>Male carriers of this gene experience rapid beard growth and are uncomfortable cutting their beards.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Beard_NoBeardOnly</td>
<td>beardless</td>
<td>Carriers of this gene grow no facial hair.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Beard_Always</td>
<td>unisex beards</td>
<td>Carriers of this gene always have thick facial hair, even women.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Skin_InkBlack</td>
<td>ink black skin</td>
<td>Carriers of this gene produce a pigment that turns their skin a pale black color almost as dark as ink.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Skin_SlateGray</td>
<td>slate gray skin</td>
<td>Carriers of this gene produce a pigment that turns their skin slate gray.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Skin_LightGray</td>
<td>light gray skin</td>
<td>Carriers of this produce a light-gray pigment in their skin.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Skin_SheerWhite</td>
<td>sheer white skin</td>
<td>Carriers of this gene have sheer white skin, unlike natural skin tones, due to a special engineered reflective cell covering.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Skin_Blue</td>
<td>blue skin</td>
<td>Carriers of this gene produce a pigment that turns their skin a blue color.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Skin_Purple</td>
<td>purple skin</td>
<td>Carriers of this gene produce a pigment that gives their skin a purple color.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Skin_PaleRed</td>
<td>pale red skin</td>
<td>Carriers of this gene produce a pigment that turns their skin a moderate red color.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Skin_DeepRed</td>
<td>deep red skin</td>
<td>Carriers of this gene produce a deep-red pigment that gives their skin an almost bloody appearance.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Skin_PaleYellow</td>
<td>pale yellow skin</td>
<td>Carriers of this gene produce a pigment that turns their skin a grayish yellow color.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Skin_DeepYellow</td>
<td>deep yellow skin</td>
<td>Carriers of this gene produce a pigment that gives their skin a deep yellow color.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Skin_Orange</td>
<td>orange skin</td>
<td>Carriers of this gene produce a pigment that gives their skin an orange color.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Skin_Green</td>
<td>green skin</td>
<td>Carriers of this gene produce a pigment that gives their skin a green color.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Furskin</td>
<td>furskin</td>
<td>Carriers of this gene grow thick fur all over their body, which protects them from cold temperatures.</td>
<td>1</td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>Eyes_Red</td>
<td>red eyes</td>
<td>Carriers of this gene have deeply red-pigmented eyes.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Eyes_Gray</td>
<td>gray eyes</td>
<td>Carriers of this gene have pale white-gray eyes.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Brow_Heavy</td>
<td>heavy brow</td>
<td>Carriers of this gene have a prominent brow.</td>
<td>0</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Tail_Furry</td>
<td>furry tail</td>
<td>Carriers of this gene grow a fluffy tail which partially protects them from cold temperatures.</td>
<td>1</td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>Tail_Smooth</td>
<td>smooth tail</td>
<td>Carriers of this gene grow a slender tail that can act as a dexterous fifth limb.</td>
<td>1</td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>FacialRidges</td>
<td>facial ridges</td>
<td>Carriers of this gene grow raised ridges of skin on their face.</td>
<td>0</td>
<td></td>
<td></td>
</tr>
<tr>
<td>MinTemp_SmallIncrease</td>
<td>cold weakness</td>
<td>Carriers of this gene are slightly less comfortable in cold temperatures.</td>
<td></td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>MinTemp_SmallDecrease</td>
<td>cold tolerant</td>
<td>Carriers of this gene are slightly more comfortable in cold temperatures.</td>
<td></td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>MinTemp_LargeDecrease</td>
<td>cold super-tolerant</td>
<td>Carriers of this gene are much more comfortable in cold temperatures.</td>
<td></td>
<td>-2</td>
<td></td>
</tr>
<tr>
<td>MaxTemp_LargeIncrease</td>
<td>heat super-tolerant</td>
<td>Carriers of this gene are more comfortable in warm temperatures.</td>
<td></td>
<td>-2</td>
<td></td>
</tr>
<tr>
<td>MaxTemp_SmallIncrease</td>
<td>heat tolerant</td>
<td>Carriers of this gene are slightly more comfortable in warm temperatures.</td>
<td></td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>MaxTemp_SmallDecrease</td>
<td>heat weakness</td>
<td>Carriers of this gene are slightly less comfortable in warm temperatures.</td>
<td></td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>PsychicAbility_Deaf</td>
<td>psychically deaf</td>
<td>Carriers of this gene are deaf to all psychic energy and influence outside their own minds. They cannot be affected by psychic influence, nor can they ever wield psychic power.</td>
<td></td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>PsychicAbility_Dull</td>
<td>psychically dull</td>
<td>Carriers of this gene are less psychically-sensitive than others.</td>
<td></td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>PsychicAbility_Enhanced</td>
<td>psy-sensitive</td>
<td>Carriers of this gene are more psychically-sensitive than average.</td>
<td></td>
<td>-2</td>
<td></td>
</tr>
<tr>
<td>PsychicAbility_Extreme</td>
<td>super psy-sensitive</td>
<td>Carriers of this gene are much more psychically-sensitive than most.</td>
<td>2</td>
<td>-5</td>
<td></td>
</tr>
<tr>
<td>MoveSpeed_Slow</td>
<td>slow runner</td>
<td>Carriers of this gene move more slowly than normal.</td>
<td></td>
<td>3</td>
<td></td>
</tr>
<tr>
<td>MoveSpeed_Quick</td>
<td>fast runner</td>
<td>Carriers of this gene move more quickly than normal.</td>
<td></td>
<td>-3</td>
<td></td>
</tr>
<tr>
<td>MoveSpeed_VeryQuick</td>
<td>very fast runner</td>
<td>Carriers of this gene move much more quickly than normal.</td>
<td></td>
<td>-5</td>
<td></td>
</tr>
<tr>
<td>Beauty_VeryUgly</td>
<td>very unattractive</td>
<td>Carriers of this gene have misshapen, asymmetrical facial structures and blotchy skin. They're hard to look at.</td>
<td></td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>Beauty_Ugly</td>
<td>unattractive</td>
<td>Carriers of this gene have exaggerated facial features and poor skin that are generally considered ugly.</td>
<td></td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>Beauty_Pretty</td>
<td>attractive</td>
<td>Carriers of this gene have unusually symmetrical, balanced facial features and extra-clear skin which gives them a pleasing appearance.</td>
<td></td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>Beauty_Beautiful</td>
<td>very attractive</td>
<td>Carriers of this gene have remarkably precise and symmetrical faces. Their features are distinctive and strong without being exaggerated, and their skin is nearly perfect. They are generally seen as beautiful.</td>
<td></td>
<td>-2</td>
<td></td>
</tr>
<tr>
<td>Learning_Slow</td>
<td>slow study</td>
<td>Carriers of this gene have deficient long-term memories and don't understand new ideas quickly. They are slow at learning new skills and knowledge.</td>
<td></td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>Learning_Fast</td>
<td>quick study</td>
<td>Carriers of this gene have excellent memories and grasp new ideas quickly. They learn faster than others.</td>
<td>2</td>
<td>-3</td>
<td></td>
</tr>
<tr>
<td>Mood_Depressive</td>
<td>very unhappy</td>
<td>Carriers of this gene are highly predisposed to negative emotion. They'll see the bad in every situation and have a much lower mood than others.</td>
<td></td>
<td>5</td>
<td></td>
</tr>
<tr>
<td>Mood_Pessimist</td>
<td>unhappy</td>
<td>Carriers of this gene are predisposed to pessimistic perceptions. They'll tend to interpret things negatively and have lower mood than others.</td>
<td></td>
<td>3</td>
<td></td>
</tr>
<tr>
<td>Mood_Optimist</td>
<td>happy</td>
<td>Carriers of this gene are predisposed to optimistic feelings. They'll have higher mood than others.</td>
<td>2</td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>Mood_Sanguine</td>
<td>very happy</td>
<td>Carriers of this gene are highly predisposed to optimism and not at all inclined to think negatively. They'll have much higher mood than others.</td>
<td>3</td>
<td>-2</td>
<td></td>
</tr>
<tr>
<td>ToxResist_Partial</td>
<td>tox resistance</td>
<td>Carriers of this gene are resistant to toxic buildup from any source. This includes pollution, toxic fallout, tox gas, and direct attacks with venom or injected poison. They'll gain half the amount of toxic buildup compared to others.\n\nCellular filters in the lung and skin reduce the dose of toxins entering the bloodstream.</td>
<td></td>
<td>-2</td>
<td></td>
</tr>
<tr>
<td>ToxResist_Total</td>
<td>tox immunity</td>
<td>Carriers of this gene are totally immune to toxic buildup from all sources including polluted terrain, toxic fallout, tox gas, and direct attacks with venom or injected poison. They are also not bothered by acidic smog.\n\nThe carrier's biochemical pathways are modified to route around interference from nearly all known toxins. Along with enhancements to the kidneys and liver, this keeps carriers comfortable in even the most toxic of environments.</td>
<td>2</td>
<td>-4</td>
<td></td>
</tr>
<tr>
<td>Delicate</td>
<td>delicate</td>
<td>Carriers of this gene take greater injuries than others from the same damage. They have thin, brittle bones and less binding molecules in joints and flesh.</td>
<td></td>
<td>3</td>
<td></td>
</tr>
<tr>
<td>Robust</td>
<td>robust</td>
<td>Carriers of this gene take less injuries than others from the same damage. They have thickened, densified bones, nearly-solid ribcages, and strengthened binding factors in joints and flesh.</td>
<td></td>
<td>-2</td>
<td></td>
</tr>
<tr>
<td>Pain_Reduced</td>
<td>reduced pain</td>
<td>Carriers of this gene feel half as much pain compared to a baseliner. Reduced neuron activity in the brain's nociception centers makes pain dull and faint. This can be advantageous sometimes, and dangerous other times.</td>
<td></td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>Pain_Extra</td>
<td>extra pain</td>
<td>Carriers of this gene feel more pain than others given the same injuries. Neuron activity in the brain's nociception center is amplified, so pain feels extra-intense and fiery. This can be protective, but overall it's considered a negative and makes it hard to push through difficult situations.</td>
<td></td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>Aggression_DeadCalm</td>
<td>dead calm</td>
<td>Carriers of this gene feel calm in every situation and have a very placid demeanor. They will never start social fights or have aggressive mental breaks.</td>
<td></td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>Aggression_Aggressive</td>
<td>aggressive</td>
<td>Carriers of this gene are quick to anger. They are twice as likely to start social fights. When they have mental breaks, they are twice as likely to choose an aggressive kind of break.</td>
<td></td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>Aggression_HyperAggressive</td>
<td>hyper-aggressive</td>
<td>Carriers of this gene are hormonally high-strung and very aggressive. They are three times as likely to start social fights. Any mental break they have will be of an aggressive type.</td>
<td></td>
<td>3</td>
<td></td>
</tr>
<tr>
<td>VerySleepy</td>
<td>very sleepy</td>
<td>Carriers of this gene get tired much faster than others.</td>
<td></td>
<td>4</td>
<td></td>
</tr>
<tr>
<td>Sleepy</td>
<td>sleepy</td>
<td>Carriers of this gene get tired somewhat faster than others.</td>
<td></td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>LowSleep</td>
<td>low sleep</td>
<td>Carriers of this gene get tired less quickly than others.</td>
<td>2</td>
<td>-4</td>
<td></td>
</tr>
<tr>
<td>Neversleep</td>
<td>never sleep</td>
<td>Carriers of this gene have a unique metabolic process which allows clusters of neurons to sleep while the rest of the brain stays awake. They never need to sleep.</td>
<td>3</td>
<td>-6</td>
<td></td>
</tr>
<tr>
<td>MeleeDamage_Weak</td>
<td>weak melee damage</td>
<td>Carriers of this gene do less damage in close-quarters combat. Weak fast-twitch muscle fibers make their strikes shaky and weak.</td>
<td></td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>MeleeDamage_Strong</td>
<td>strong melee damage</td>
<td>Carriers of this gene do more damage in close-quarters combat. Extra-strong fast-twitch muscle fibers make their strikes accurate and powerful.</td>
<td></td>
<td>-2</td>
<td></td>
</tr>
<tr>
<td>UVSensitivity_Mild</td>
<td>mild UV sensitivity</td>
<td>Carriers of this gene have biological compounds in their skin that react painfully to UV radiation. They are unusually sensitive to sunlight.</td>
<td></td>
<td>3</td>
<td></td>
</tr>
<tr>
<td>UVSensitivity_Intense</td>
<td>intense UV sensitivity</td>
<td>Carriers of this gene have biological compounds in their skin that react dangerously to UV radiation. They are intensely sensitive to sunlight.</td>
<td>2</td>
<td>4</td>
<td></td>
</tr>
<tr>
<td>Libido_Low</td>
<td>low libido</td>
<td>Carriers of this gene are less likely to engage in lovin' with their partner.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Libido_High</td>
<td>high libido</td>
<td>Carriers of this gene are more likely to engage in lovin' with their partner.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>FireSpew</td>
<td>fire spew</td>
<td>Carriers are able to spew flammable bile generated by a special organ in their neck. The bile sticks to anything in a small area and can ignite people, objects, and the ground.</td>
<td></td>
<td>-2</td>
<td></td>
</tr>
<tr>
<td>FoamSpray</td>
<td>foam spray</td>
<td>Carriers grow glands in the neck that generate and store a fire-retardant foam. They can spew this foam over an area to extinguish fires.</td>
<td></td>
<td>-2</td>
<td></td>
</tr>
<tr>
<td>LongjumpLegs</td>
<td>longjump legs</td>
<td>Carriers have special hemogen-powered muscle fibers in their legs which allow them to jump great distances.</td>
<td></td>
<td>-2</td>
<td></td>
</tr>
<tr>
<td>AnimalWarcall</td>
<td>animal warcall</td>
<td>Carriers of this gene can perform an animal warcall, using a powerful bellow and psychic connection to call an animal to fight for them.</td>
<td>1</td>
<td>-3</td>
<td></td>
</tr>
<tr>
<td>Bloodfeeder</td>
<td>bloodfeeder</td>
<td>Carriers of this gene have small retractable fangs and an organ on the roof of the mouth which can extract hemogen from fresh warm blood. They can bite an unresisting person, suck the blood, and gain hemogen directly.</td>
<td></td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>Coagulate</td>
<td>coagulate</td>
<td>Carriers of this gene have special glands on their hands and wrists, as well as a unique salivary compound that they can use to rapidly tend wounds.</td>
<td></td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>XenogermReimplanter</td>
<td>gene implanter</td>
<td>Carriers of this gene can implant a copy of their xenogerm into another person through a somewhat gross-looking injector organ. Their own genetic material will then regrow very slowly. If they implant while their genes are regrowing, they will die. Germline genes will be unaffected.</td>
<td>3</td>
<td></td>
<td>1</td>
</tr>
<tr>
<td>PiercingSpine</td>
<td>piercing spine</td>
<td>Carriers grow an opening in their upper chest along with a quiver of keratin spines. Using a hemogen-powered chemical reaction, they can fire these spines at high speed at nearby targets with surprising accuracy.</td>
<td></td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>AcidSpray</td>
<td>acid spray</td>
<td>Carriers grow glands in the neck that generate and store a sticky acid substance, along with acid-tolerant tissues in the mouth. They can spew this acid over an area, where it will stick to enemies and burn them over time.</td>
<td></td>
<td>-2</td>
<td></td>
</tr>
<tr>
<td>Body_Fat</td>
<td>fat body</td>
<td>Carriers can have fat bodies. A person can have more than one body type gene; one body type will be chosen among those that are allowed.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Body_Thin</td>
<td>thin body</td>
<td>Carriers can have thin bodies. A person can have more than one body type gene; one body type will be chosen among those that are allowed.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Body_Hulk</td>
<td>hulk body</td>
<td>Carriers can have large bodies. A person can have more than one body type gene; one body type will be chosen among those that are allowed.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Body_Standard</td>
<td>standard body</td>
<td>Carriers can have average-shaped bodies. A person can have more than one body type gene; one body type will be chosen among those that are allowed.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Ears_Human</td>
<td>human ears</td>
<td>Carriers of this gene have regular human ears.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Ears_Pig</td>
<td>pig ears</td>
<td>Carriers of this gene will grow pointed pig-like ears.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Ears_Floppy</td>
<td>floppy ears</td>
<td>Carriers of this gene grow long, floppy hound-like ears.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Ears_Cat</td>
<td>cat ears</td>
<td>Carriers of this gene have cat-like ears.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Ears_Pointed</td>
<td>pointed ears</td>
<td>Carriers of this gene have pointed ears.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Nose_Human</td>
<td>human nose</td>
<td>Carriers of this gene have regular human noses.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Nose_Pig</td>
<td>pig nose</td>
<td>Carriers of this gene have pig-like snouts.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Jaw_Baseline</td>
<td>human jaw</td>
<td>Carriers of this gene have regularly-shaped jaws.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Jaw_Heavy</td>
<td>heavy jaw</td>
<td>Carriers of this gene have large jaws.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Head_Gaunt</td>
<td>gaunt head</td>
<td>Carriers of this gene have a pinched, gaunt appearance in their face and head.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Hands_Human</td>
<td>human hands</td>
<td>Carriers of this gene have regular human hands.</td>
<td>0</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Hands_Pig</td>
<td>trotter hands</td>
<td>Carriers of this gene have hands that partially resemble pig trotters. This reduces their ability to manipulate objects.</td>
<td>1</td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>ElongatedFingers</td>
<td>elongated fingers</td>
<td>Long, delicate fingers improve the carrier's manipulation capacity. This aids with many tasks, especially crafting and construction.</td>
<td>1</td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>Headbone_Human</td>
<td>human headbone</td>
<td>Carriers of this gene have regular human skulls.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Headbone_MiniHorns</td>
<td>mini-horns</td>
<td>Carriers of this gene grow two small horns protruding from the forehead.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Headbone_CenterHorn</td>
<td>center-horn</td>
<td>Carriers of this gene grow a single horn protruding from the center of the forehead.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Voice_Human</td>
<td>human voice</td>
<td>Carriers of this gene have regular human vocal chords.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>VoicePig</td>
<td>pig voice</td>
<td>Carriers have a squealing voice like that of a pig.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>VoiceRoar</td>
<td>roar voice</td>
<td>Carriers have an animal-like roaring voice.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Hemogenic</td>
<td>hemogenic</td>
<td>Carriers of this gene have a reserve of biological strength powered by a resource called hemogen. The resource can be gained and spent in various ways, all of which are unlocked by other genes.\n\nCarriers lose 2 hemogen per day from biological entropy.</td>
<td>1</td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>HemogenDrain</td>
<td>hemogen drain</td>
<td>Carriers lose an additional 8 hemogen per day from biological entropy.</td>
<td>1</td>
<td>6</td>
<td></td>
</tr>
<tr>
<td>FireWeakness</td>
<td>tinderskin</td>
<td>Carriers have dry, thin skin which burns easily from fire, and their immune systems react very poorly to this kind of threat. Damage from fire is multiplied by 4.</td>
<td></td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>FireTerror</td>
<td>pyrophobia</td>
<td>Carriers of this gene have an intense fear of fire. When fires are close, there is a chance they will have a mental breakdown at any moment.</td>
<td></td>
<td>4</td>
<td></td>
</tr>
<tr>
<td>PerfectImmunity</td>
<td>perfect immunity</td>
<td>Carriers of this gene have archite-enhanced immune systems which intelligently destroy invaders. They are totally immune to most normal illnesses.</td>
<td>3</td>
<td></td>
<td>1</td>
</tr>
<tr>
<td>DiseaseFree</td>
<td>non-senescent</td>
<td>Carriers of this gene do not go through senescence in the normal way. They never get chronic age-related diseases like cancer, bad back, cataracts, or dementia.</td>
<td>3</td>
<td></td>
<td>1</td>
</tr>
<tr>
<td>TotalHealing</td>
<td>scarless</td>
<td>Carriers of this gene have a special type of regenerator cell which can heal old wounds and chronic illnesses like bad back.</td>
<td>4</td>
<td></td>
<td>1</td>
</tr>
<tr>
<td>Deathrest</td>
<td>deathrest</td>
<td>Carriers of this gene must periodically regenerate themselves in a special coma called deathrest. Deathrest takes days, but can confer substantial bonuses. Deathrest can be accelerated and its effects enhanced by the use of a variety of special buildings and technologies.\n\nThose who put off deathresting will suffer from deathrest exhaustion.</td>
<td></td>
<td>6</td>
<td></td>
</tr>
<tr>
<td>Ageless</td>
<td>ageless</td>
<td>Carriers of this gene have archites in the bloodstream which continuously reverse the process of aging. Starting at the age of 13, carriers begin to biologically age slower. By 18, the aging process stops completely.</td>
<td>3</td>
<td></td>
<td>1</td>
</tr>
<tr>
<td>Deathless</td>
<td>deathless</td>
<td>Carriers of this gene have archites in the blood which will sustain their life processes no matter what. As long as the brain remains intact, a carrier of this gene will never die.</td>
<td>7</td>
<td></td>
<td>1</td>
</tr>
<tr>
<td>ArchiteMetabolism</td>
<td>archite metabolism</td>
<td>Carriers of this gene have special archites in their cells that facilitate and optimize metabolism. This improves overall genetic and metabolic quality.</td>
<td>6</td>
<td>6</td>
<td>2</td>
</tr>
<tr>
<td>WoundHealing_Slow</td>
<td>slow wound healing</td>
<td>Carriers of this gene heal from wounds half as fast as normal.</td>
<td></td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>WoundHealing_Fast</td>
<td>fast wound healing</td>
<td>Carriers of this gene heal from wounds twice as fast as normal.</td>
<td></td>
<td>-2</td>
<td></td>
</tr>
<tr>
<td>WoundHealing_SuperFast</td>
<td>superfast wound healing</td>
<td>Carriers of this gene heal from wounds four times as fast as normal.</td>
<td></td>
<td>-3</td>
<td></td>
</tr>
<tr>
<td>Immunity_Weak</td>
<td>weak immunity</td>
<td>Carriers of this gene gain immunity to diseases more slowly than normal. They may die from infections that others would survive.</td>
<td></td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>Immunity_Strong</td>
<td>strong immunity</td>
<td>Carriers of this gene gain immunity to diseases faster than normal.</td>
<td></td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>Immunity_SuperStrong</td>
<td>super immunity</td>
<td>Carriers of this gene gain immunity to diseases considerably faster than normal.</td>
<td>2</td>
<td>-2</td>
<td></td>
</tr>
<tr>
<td>ToxicEnvironmentResistance_Partial</td>
<td>partial antitoxic lungs</td>
<td>Carriers of this gene are resistant to environmental toxins. They get less toxic buildup from tox gas, polluted terrain, and toxic fallout, but are still vulnerable to direct attacks with venom or injected poison. Additionally, they build up rot stink exposure slower.</td>
<td></td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>ToxicEnvironmentResistance_Total</td>
<td>total antitoxic lungs</td>
<td>Carriers of this gene are immune to environmental toxins, but not from direct toxic attacks. They get no toxic buildup from tox gas, polluted terrain, or toxic fallout, and they are not bothered by acidic smog. They are still vulnerable to direct attacks like venom and injected poison. Additionally, they are immune to rot stink exposure.</td>
<td>2</td>
<td>-3</td>
<td></td>
</tr>
<tr>
<td>Sterile</td>
<td>sterile</td>
<td>Carriers of this gene cannot reproduce by natural means.</td>
<td></td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>Fertile</td>
<td>fertile</td>
<td>Carriers of this gene have a higher chance of becoming pregnant or impregnating others.</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>Superclotting</td>
<td>superclotting</td>
<td>Carriers of this gene have extra-power coagulating factors in their blood, and will stop bleeding very quickly when wounded.</td>
<td></td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>KindInstinct</td>
<td>kind instinct</td>
<td>Carriers of this gene are high in trait agreeableness and are very conscientious. They rarely insult others and will sometimes offer kind words to brighten the moods of those around them. They also never judge people by their appearance.</td>
<td></td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>ViolenceDisabled</td>
<td>violence disabled</td>
<td>Carriers of this gene are emotionally and mentally incapable of engaging in violence. They are overwhelmingly resistant to and horrified by the idea of hurting another.</td>
<td></td>
<td>3</td>
<td></td>
</tr>
<tr>
<td>Nearsighted</td>
<td>nearsighted</td>
<td>Carriers of this gene have difficulty seeing at a distance. Their shooting accuracy at long ranges is reduced.</td>
<td></td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>StrongStomach</td>
<td>strong stomach</td>
<td>Carriers of this gene have an extra toxin-filtering organ in their stomach and will never suffer from food poisoning even after eating rotten food.</td>
<td></td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>DarkVision</td>
<td>dark vision</td>
<td>Carriers of this gene see well in low light and are unaffected by mood penalties related to darkness. They have a reflective layer behind the retina that amplifies their ability to see in the dark.</td>
<td></td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>KillThirst</td>
<td>kill thirst</td>
<td>Carriers of this gene lust for the feeling of ending another's life. They will become irritated if they go for too long without killing someone in close combat.</td>
<td></td>
<td>4</td>
<td></td>
</tr>
<tr>
<td>FireResistant</td>
<td>fire resistant</td>
<td>Carriers of this gene have special fast-acting sweat glands and heat-resistant skin. They only take 25% of the normal damage from fire. The chance of them catching on fire is also drastically reduced.</td>
<td></td>
<td>-2</td>
<td></td>
</tr>
<tr>
<td>Inbred</td>
<td>inbred</td>
<td>This genetic condition affects a person's fertility, immunity, and mental capacity.</td>
<td></td>
<td>-2</td>
<td></td>
</tr>
<tr>
<td>RobustDigestion</td>
<td>robust digestion</td>
<td>Carriers of this gene grow a multi-fold stomach, allowing them to digest raw foods more efficiently than baseline humans. In general, they get the same nutrition from raw food as from if it is cooked. They also don't mind the taste of raw food at all.</td>
<td>2</td>
<td>-2</td>
<td></td>
</tr>
<tr>
<td>Instability_Mild</td>
<td>mild cell instability</td>
<td>Carriers of this gene need less metabolic energy to stay alive, at the cost of reduced stability in their cell-replication machinery.</td>
<td></td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>Instability_Major</td>
<td>major cell instability</td>
<td>Carriers of this gene need much less metabolic energy to stay alive, at the cost of greatly-reduced stability in their cell-replication machinery.</td>
<td></td>
<td>4</td>
<td></td>
</tr>
<tr>
<td>PsychicBonding</td>
<td>psychic bonding</td>
<td>Carriers of this gene have a special neural organ that makes them psychically bond with a lover for life. As long as the lovers are together, they will be happy. If they are physically separated, they will be disturbed by the distance. If one dies, the other's mind will be badly disrupted.</td>
<td>1</td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>PollutionRush</td>
<td>pollution stimulus</td>
<td>Carriers of this gene get a chemical rush from being exposed to pollution. This makes them move faster and helps them think clearer. A similar gene is found in combat-engineered mega-insects.</td>
<td>1</td>
<td>-1</td>
<td></td>
</tr>
<tr>
<td>Unstoppable</td>
<td>unstoppable</td>
<td>Carriers of this gene are not slowed down when taking damage.</td>
<td>1</td>
<td>-2</td>
<td></td>
</tr>
<tr>
<td>NakedSpeed</td>
<td>naked speed</td>
<td>Carriers of this gene move slower while clothed, and faster while naked.</td>
<td>1</td>
<td>2</td>
<td></td>
</tr>
</tbody>
</table></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-06-12T23:13:48+08:00">2023-06-12</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-05"  rel="bookmark" >
              <h2 class="card-title">如何在出远门的时候关闭洗碗机定时启动</h2>
            </a>
            <p class="card-text"><p>家里有个「美的」的某型号洗碗机，一般是积累了当天的碗筷餐具，每天23:00低谷电价之后自动开始定时洗碗。这个功能可以在app上设置实现，还可以设置烘干和通风保存，第二天就能拿出来洁净且干燥的碗筷使用，平时日常这样用起来挺不错。</p>
<p>但是这也导致一个问题，如果节假日出门旅行几天，这个洗碗机里即便没有碗筷，也会傻傻的启动浪费水电，所以需要禁用几天，我的操作流程是：</p>
<ol>
<li>掏出手机，解锁屏幕，找到「美的美居」 app并打开</li>
<li>欣赏该厂家运营设置的精美开屏广告并等待</li>
<li>打开「场景」</li>
<li>找到自动化 - 已开启 列表里，关于洗碗机的部分</li>
<li>找到进入每天自动洗碗的选项，编辑，选择关闭</li>
<li>保存设置，退出 app</li>
<li>回到家，又需要按照上面的流程操作一番启用该流程</li>
</ol>
<p>每次想起这个事，真是又繁琐又蛋痛。特别是回来如果忘记启用，第二天早上起来会发现一篮子未洗的碗筷傻眼。</p>
<p>这次五·一假，我压根忘记了禁用定时洗碗的事。但是回到家添加洗碗粉的时候发现，这几天洗碗机并未启动。问了下是我老婆操作的，她的流程是：</p>
<ol>
<li>给洗碗机门板开一条缝</li>
</ol>
<p>洗碗机不会在门没关严的情况下启动，所以。。。。</p>
<p>我问她这样做是故意的还是不小心的，她说故意不小心的。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-05-13T06:11:28+08:00">2023-05-13</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-04"  rel="bookmark" >
              <h2 class="card-title">当前版本gpt的根本弱点</h2>
            </a>
            <p class="card-text"><p>下面的东西仅限当前，不是不可以解决的。</p>
<ol>
<li>gpt系列数学能力不行，是因为它把每一个数字当成一个整体在背加法表、乘法表。没理解到十进制的精髓</li>
</ol>
<p><img alt="" src="/images/2023/stdout-04-01.webp" /></p>
<p>上图来自<a href="https://arxiv.org/abs/2005.14165">2020年 GPT-3 论文</a> 22页。主要还是因为 BPE 太糙。 </p>
<ol start="2">
<li>
<p>gpt-4能通过一些文字材料和描述感知到每个字母大概长什么样，甚至知道一些简单汉字的结构，但是确切的书写结构它是不知道的。<br />
所以要避免你的想法被 gpt 感知学会，得考虑每个字的偏旁部首作文章，而且你的变形得很少见。估计这个技巧在将来被AI监视的生活里会被用得上。</p>
</li>
<li>
<p>还有一些语音漂移它知道概念但是因为没发音器官所以不能直接感知。但这也不是不能解决，只要语料够大也能摸到规律。相比英语等拼音文字而言，汉字这类表意但是又有同音的文字应该是文本类 AI 的普遍弱点。</p>
</li>
</ol>
<p>如果你要秘密表达一些观点，可以通过描述发音、形状或者动作但是不直接写出来让对方领会。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-03-31T15:07:02+08:00">2023-03-31</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stderr-08"  rel="bookmark" >
              <h2 class="card-title">Google 和 Facebook 为什么不行了</h2>
            </a>
            <p class="card-text"><p>Google 最先搞出来 word2vec，最先搞出来transformer 和 BERT，最先搞出来被员工发现 sentient 的 LaMDA，被 ChatGPT 骑脸之后匆忙推出个半成品 Bard </p>
<p>这一切为啥呢？我觉得很可能是 <a href="https://www.google.com/search/howsearchworks/our-approach/">Google的愿景</a>：</p>
<blockquote>
<p>Google's mission is to organize the world's information and make it universally accessible and useful.</p>
</blockquote>
<p>全世界的信息，可以说已经被 Google 成功的「组织」起来了。只不过很可惜，它并没有想要全部「理解」和「消化吸收」，把信息变成「通识」。ChatGPT 正在尝试做到这一点。</p>
<p><a href="https://www.microsoft.com/en-us/about">微软的愿景</a>是什么呢？ </p>
<ul>
<li>"Be what's next." (2010-2012)</li>
<li>"Empowering us all"</li>
</ul>
<p>所以它很快收购了 Skype 推出 Teams，收购 Github 然后投资 OpenAI，结合 Codex (code-davinci-002) 推出 Github Copilot，然后顺理成章搞出来 Office 系列的 Copilot。工具性拉满。</p>
<p>然后说下为啥 Facebook 要 All in metaverse。这个在 <a href="https://www.scribd.com/document/399594551/2015-06-22-MARK-S-VISION">2015-06-22 有个 leaked memo</a> 说得很清楚</p>
<blockquote>
<p>Our vision is that VR / AR will be the next major computing platform after mobile in about 10 years. It can be even more ubiquitous than mobile – especially once we reach AR – since you can always have it on. It’s more natural than mobile since it uses our normal human visual and gestural systems. It can even be more economical, because once you have a good VR / AR system, you no longer need to buy phones or TV’s or many other physical objects – they can just become apps in a digital store. ... We are vulnerable on mobile to Google and Apple because they make major mobile platforms. We would like a stronger strategic position... We can achieve this only by building both a major platform as well as key apps.<br />
我们的愿景是，在大约十年后，VR / AR将成为继移动设备之后的下一个主要计算平台。它甚至可以比移动设备更普及 - 特别是一旦我们达到AR - 因为您可以随时随地使用它。它比移动设备更自然，因为它使用我们正常的人类视觉和手势系统。它甚至可以更经济，因为一旦您拥有了一个好的VR / AR系统，您就不再需要购买手机、电视或许多其他物理物品 - 它们只能成为数字商店中的应用程序。我们在移动设备上对谷歌和苹果公司非常脆弱，因为它们制作了主要的移动平台。我们希望拥有更强大的战略地位... 我们只有通过建立一个主要平台和关键应用程序才能实现这一点。</p>
</blockquote>
<p>问题是，VR/AR 并不是手机的下一代。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-03-28T21:49:11+08:00">2023-03-28</time></p>
<p>stdout</p>            </div>
          </article>
        </div>

    </main>
    <nav class="pagination-nav side-padding">
<a href="/category/stdout.02.html" class="pagination-older">Older Posts &gt;</a>    </nav>


  </body>
</html>