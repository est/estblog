<!DOCTYPE html>
<html>
  <head>
    <title>est の 输入输出</title>

    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <link href="https://feeds.feedburner.com/initiative" type="application/rss+xml" rel="alternate" title="est の 输入输出 RSS Feed" />

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="This blog is rated 🔞, viewer discretion is advised" />

    <meta property="og:url" content="https://blog.est.im">
    <meta property="og:type" content="website">
    <meta property="og:title" content="est の 输入输出">
    <meta property="og:description" content="This blog is rated 🔞, viewer discretion is advised">

    <link rel="stylesheet" href="/theme/css/normalize.min.css" />
    <link rel="stylesheet" href="/theme/css/style.css" />


    <style>
      body {
        background: #ecedef url("/theme/img/ignasi_pattern_s.png") repeat;
      }
    </style>
  </head>
  <body class="list-body">
<nav class="nav-bar side-padding">
  <h1 class="nav-header"><a href="/" class="nav-text">
    est の 输入输出
  </a></h1>
  <div class="hamburger-menu">
    <button>
      <span></span>
      <span></span>
    </button>
    <ul id="menu" class="hamburger-menu-overlay">
      <li><a href="/" class="hamburger-menu-overlay-link">Home</a></li>
      <li><a href="https://feeds.feedburner.com/initiative" class="hamburger-menu-overlay-link">RSS</a></li>
      <li><a href="/about" class="hamburger-menu-overlay-link">About</a></li>

      <li><a href="/category/archive" class="hamburger-menu-overlay-link">archive</a></li>
      <li><a href="/category/stderr" class="hamburger-menu-overlay-link">stderr</a></li>
      <li><a href="/category/stdin" class="hamburger-menu-overlay-link">stdin</a></li>
      <li><a href="/category/stdout" class="hamburger-menu-overlay-link">stdout</a></li>

    </ul>
  </div>
</nav>    <main class="card-container side-gutter">
      <header class="list-header">
        <p class="list-header-subtext">This blog is rated 🔞, viewer discretion is advised</p>
        <!-- <h1 class="list-header-title">est の 输入输出</h1> -->
      </header>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-18"  rel="bookmark" >
              <h2 class="card-title">京加高铁</h2>
            </a>
            <p class="card-text"><p>今天了解到这么一件事，白令海峡原来也就 82.5km 宽，水深55米，对于现代工程技术来说修桥和隧道都不是问题。</p>
<p><img alt="" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0e/BeringSt-close-VE.jpg/600px-BeringSt-close-VE.jpg" /></p>
<p>如果中间那个岛做个中转站，那么两侧都各自30km左右。所以理论上从北京修一条到西雅图/加州的高铁完全没有问题。。</p>
<p><img alt="" src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/37/North_pole_map.jpeg/800px-North_pole_map.jpeg" /></p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-12-18T23:10:40+08:00">2023-12-18</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-17"  rel="bookmark" >
              <h2 class="card-title">query git notes with Github GraphQL</h2>
            </a>
            <p class="card-text"><p>git notes is an interesting feature, you can use it like </p>
<pre><code class="language-bash">git notes add -m &quot;hello test git notes&quot;
git push origin 'refs/notes/*'
</code></pre>
<p>Github supported them back <a href="https://github.blog/2010-08-25-git-notes-display/">in 2010</a> then gave up LMAO.</p>
<p>If you need to retrive them with Github API, try GraphQL like this</p>
<pre><code>  {
    repository(owner: "est", name: "snippets") {
      refs(refPrefix:"refs/notes/",first:1) {
        nodes{
          ... on Ref{
            target {
              oid
              ... on Commit{
                changedFilesIfAvailable
                message
                tree{
                  oid
                  entries{
                    oid
                    path
                    size
                    lineCount
                    mode
                    object{
                      ... on Blob{
                        byteSize
                        text
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
</code></pre>
<p>It will return something like:</p>
<pre><code>  {
    "data": {
      "repository": {
        "refs": {
          "nodes": [
            {
              "target": {
                "oid": "bfdfda121f3d8a2d6aa399e3e8f0d58b3db0a543",
                "changedFilesIfAvailable": 1,
                "message": "Notes added by 'git notes add'",
                "tree": {
                  "oid": "2ab3e6a8b0dff6596fa60ecfb3c61bf91e5b4e1f",
                  "entries": [
                    {
                      "oid": "404d353a254ffbc97b2e16d17b8c100461aef586",
                      "path": "4fb1272f1e235580f87e3ec071984658de050dc9",
                      "size": 21,
                      "lineCount": 1,
                      "mode": 33188,
                      "object": {
                        "byteSize": 21,
                        "text": "hello test git notes\n"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  }
</code></pre>
<p>Here <code>"path": "4fb1272f1e235580f87e3ec071984658de050dc9"</code> is the commit SHA.</p>
<p>If you add more filter parameters in <code>refs()</code> you can fetch all the notes.</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-11-27T09:06:11+08:00">2023-11-27</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-16"  rel="bookmark" >
              <h2 class="card-title">VPS推荐：Hosteon</h2>
            </a>
            <p class="card-text"><p>继续<a href="/202012/stderr-012">上次 Racknerd</a> 之后发现这家还行。写了个<a href="https://github.com/est/snippets/blob/master/vps_scan/main.py">爬虫</a>扒了一下各色配置，独立服除外，有需要的自取</p>
<table>
<thead>
<tr>
<th>pid</th>
<th>spec</th>
<th>Disk</th>
<th>Bandwidth</th>
<th>Annual $</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=1">1</a></td>
<td>1C512M</td>
<td>5GB</td>
<td>100Mbps</td>
<td>$27.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=7">7</a></td>
<td>6C8G</td>
<td>100GB</td>
<td>100Mbps</td>
<td>$270.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=77">77</a></td>
<td>1C1G</td>
<td>10GB</td>
<td>1Tbps</td>
<td>$21.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=78">78</a></td>
<td>2C1.5G</td>
<td>20GB</td>
<td>2Tbps</td>
<td>$36.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=79">79</a></td>
<td>2C2G</td>
<td>25GB</td>
<td>3Tbps</td>
<td>$45.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=80">80</a></td>
<td>2C2.5G</td>
<td>30GB</td>
<td>4Tbps</td>
<td>$54.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=81">81</a></td>
<td>3C3G</td>
<td>40GB</td>
<td>5Tbps</td>
<td>$63.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=83">83</a></td>
<td>3C5G</td>
<td>50GB</td>
<td>8Tbps</td>
<td>$90.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=84">84</a></td>
<td>6C10G</td>
<td>120GB</td>
<td>12Tbps</td>
<td>$180.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=85">85</a></td>
<td>10C12G</td>
<td>150GB</td>
<td>15Tbps</td>
<td>$270.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=86">86</a></td>
<td>14C20G</td>
<td>200GB</td>
<td>20Tbps</td>
<td>$450.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=87">87</a></td>
<td>20C30G</td>
<td>300GB</td>
<td>30Tbps</td>
<td>$675.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=110">110</a></td>
<td>1C1G</td>
<td>15GB</td>
<td>2Tbps</td>
<td>$21.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=111">111</a></td>
<td>2C2G</td>
<td>20GB</td>
<td>4Tbps</td>
<td>$39.99</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=112">112</a></td>
<td>3C3G</td>
<td>30GB</td>
<td>6Tbps</td>
<td>$49.50</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=113">113</a></td>
<td>4C4G</td>
<td>40GB</td>
<td>8Tbps</td>
<td>$59.99</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=119">119</a></td>
<td>1C512M</td>
<td>10GB</td>
<td>500Gbps</td>
<td>$24.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=120">120</a></td>
<td>1C1G</td>
<td>15GB</td>
<td>1Tbps</td>
<td>$36.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=121">121</a></td>
<td>2C2G</td>
<td>30GB</td>
<td>2Tbps</td>
<td>$72.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=122">122</a></td>
<td>2C3G</td>
<td>50GB</td>
<td>3Tbps</td>
<td>$108.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=123">123</a></td>
<td>2C4G</td>
<td>70GB</td>
<td>4Tbps</td>
<td>$144.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=124">124</a></td>
<td>4C5G</td>
<td>90GB</td>
<td>5Tbps</td>
<td>$180.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=126">126</a></td>
<td>6C6G</td>
<td>100GB</td>
<td>6Tbps</td>
<td>$216.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=127">127</a></td>
<td>6C7G</td>
<td>120GB</td>
<td>7Tbps</td>
<td>$252.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=128">128</a></td>
<td>8C8G</td>
<td>140GB</td>
<td>8Tbps</td>
<td>$288.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=129">129</a></td>
<td>8C9G</td>
<td>150GB</td>
<td>9Tbps</td>
<td>$324.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=130">130</a></td>
<td>10C10G</td>
<td>170GB</td>
<td>10Tbps</td>
<td>$360.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=131">131</a></td>
<td>10C11G</td>
<td>180GB</td>
<td>11Tbps</td>
<td>$396.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=132">132</a></td>
<td>12C12G</td>
<td>200GB</td>
<td>12Tbps</td>
<td>$432.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=154">154</a></td>
<td>1C1G</td>
<td>20GB</td>
<td>4Tbps</td>
<td>$33.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=155">155</a></td>
<td>2C2G</td>
<td>30GB</td>
<td>6Tbps</td>
<td>$40.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=156">156</a></td>
<td>3C3G</td>
<td>40GB</td>
<td>8Tbps</td>
<td>$60.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=157">157</a></td>
<td>4C4G</td>
<td>50GB</td>
<td>10Tbps</td>
<td>$84.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=158">158</a></td>
<td>5C5G</td>
<td>60GB</td>
<td>12Tbps</td>
<td>$105.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=159">159</a></td>
<td>6C6G</td>
<td>70GB</td>
<td>14Tbps</td>
<td>$130.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=160">160</a></td>
<td>7C7G</td>
<td>80GB</td>
<td>16Tbps</td>
<td>$145.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=161">161</a></td>
<td>8C8G</td>
<td>90GB</td>
<td>18Tbps</td>
<td>$170.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=162">162</a></td>
<td>9C9G</td>
<td>100GB</td>
<td>20Tbps</td>
<td>$190.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=163">163</a></td>
<td>10C10G</td>
<td>110GB</td>
<td>22Tbps</td>
<td>$210.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=164">164</a></td>
<td>11C11G</td>
<td>120GB</td>
<td>24Tbps</td>
<td>$240.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=165">165</a></td>
<td>12C12G</td>
<td>130GB</td>
<td>26Tbps</td>
<td>$260.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=166">166</a></td>
<td>8C8G</td>
<td>50GB</td>
<td>30Tbps</td>
<td>$98.99</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=167">167</a></td>
<td>4C4G</td>
<td>25GB</td>
<td>15Tbps</td>
<td>$56.99</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=168">168</a></td>
<td>4C4G</td>
<td>25GB</td>
<td>15Tbps</td>
<td>$79.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=169">169</a></td>
<td>8C8G</td>
<td>50GB</td>
<td>30Tbps</td>
<td>$158.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=170">170</a></td>
<td>12C12G</td>
<td>75GB</td>
<td>30Tbps</td>
<td>$235.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=171">171</a></td>
<td>16C16G</td>
<td>100GB</td>
<td>30Tbps</td>
<td>$318.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=172">172</a></td>
<td>20C20G</td>
<td>125GB</td>
<td>30Tbps</td>
<td>$399.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=173">173</a></td>
<td>24C24G</td>
<td>150GB</td>
<td>30Tbps</td>
<td>$480.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=174">174</a></td>
<td>28C28G</td>
<td>175GB</td>
<td>30Tbps</td>
<td>$575.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=175">175</a></td>
<td>32C32G</td>
<td>200GB</td>
<td>30Tbps</td>
<td>$660.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=176">176</a></td>
<td>36C36G</td>
<td>225GB</td>
<td>30Tbps</td>
<td>$730.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=177">177</a></td>
<td>40C40G</td>
<td>250GB</td>
<td>30Tbps</td>
<td>$810.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=178">178</a></td>
<td>1C1G</td>
<td>20GB</td>
<td>2Tbps</td>
<td>$21.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=179">179</a></td>
<td>32C32G</td>
<td>1TB</td>
<td>1Gbps</td>
<td>$540.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=180">180</a></td>
<td>64C64G</td>
<td>1TB</td>
<td>1Gbps</td>
<td>$725.00</td>
</tr>
<tr>
<td><a href="https://my.hosteons.com/aff.php?aff=2128&amp;pid=181">181</a></td>
<td>128C128G</td>
<td>2x</td>
<td>1Gbps</td>
<td>$1850.00</td>
</tr>
</tbody>
</table></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-11-19T22:10:55+08:00">2023-11-19</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-15"  rel="bookmark" >
              <h2 class="card-title">太阳系天体的 unicode 符号</h2>
            </a>
            <p class="card-text"><p>发现<a href="https://en.wikipedia.org/wiki/Astronomical_symbols">Astronomical symbols</a>，<a href="https://en.wikipedia.org/wiki/Planet_symbols">Planet symbols<br />
</a> 及 <a href="https://en.wikipedia.org/wiki/Alchemical_symbol#Unicode">Alchemical symbol</a></p>
<table>
<thead>
<tr>
<th>IAU</th>
<th>七金</th>
<th>符号</th>
<th>名</th>
<th>name</th>
<th>星期</th>
<th>七曜</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>金</td>
<td>☉︎</td>
<td>太阳</td>
<td>Sun</td>
<td>星期天</td>
<td>日曜</td>
<td></td>
</tr>
<tr>
<td></td>
<td>银</td>
<td>☾</td>
<td>月球</td>
<td>Moon</td>
<td>星期一</td>
<td>月曜</td>
<td>也可以画成 ☽︎ <br>或者月相 🌑︎🌒︎🌓︎🌔︎🌕︎🌖︎🌗︎🌘︎，🌚︎🌛︎︎🌝︎︎🌜︎︎</td>
</tr>
<tr>
<td>H</td>
<td>汞</td>
<td>☿</td>
<td>水星</td>
<td>Mercury</td>
<td>星期三</td>
<td>水曜</td>
<td>赫耳墨斯(Hermes)，罗马人称 Mercury<br>现代人称「爱马仕」的双盘蛇带翼权杖 Caduceus <font size="5">☤</font></td>
</tr>
<tr>
<td>V</td>
<td>铜</td>
<td>♀</td>
<td>金星</td>
<td>Venus</td>
<td>星期五</td>
<td>金曜</td>
<td>维纳斯</td>
</tr>
<tr>
<td>E</td>
<td></td>
<td>🜨</td>
<td>地球</td>
<td>Earch</td>
<td></td>
<td></td>
<td><em>Bible</em> 里说的四条河把地球分成四洲<br>另外的符号是 ♁ 表示十字架钉个球 <em>globus cruciger</em></td>
</tr>
<tr>
<td>M</td>
<td>铁</td>
<td>♂</td>
<td>火星</td>
<td>Mars</td>
<td>星期二</td>
<td>火曜</td>
<td>符号是战神盾牌和长矛</td>
</tr>
<tr>
<td>J</td>
<td>锡</td>
<td>♃</td>
<td>木星</td>
<td>Jupiter</td>
<td>星期四</td>
<td>木曜</td>
<td>字母 Zeta（大写Ζ小写ζ）加一杠，代表宙斯/朱庇特</td>
</tr>
<tr>
<td>S</td>
<td>铅</td>
<td>♄</td>
<td>土星</td>
<td>Saturn</td>
<td>星期六</td>
<td>土曜</td>
<td>字母 kappa-rho ，表示 Kronos 加一杠<br>泰坦 克罗诺斯，宙斯他爹</td>
</tr>
<tr>
<td>U</td>
<td></td>
<td>⛢</td>
<td>天王星</td>
<td>Uranus</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>N</td>
<td></td>
<td>♅</td>
<td>海王星</td>
<td>Neptune</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>几点：</p>
<ul>
<li>其中 金星/火星 符号被拿来代表 女/男 是1750年代Carl Linnaeus干的。 </li>
<li>冥王星 Pluto 发现的晚，占星术还没来得及改版就惨遭除名成矮行星。</li>
<li>星期和对应的天体意义，<a href="https://en.wikipedia.org/wiki/Names_of_the_days_of_the_week">全世界惊人的一致</a></li>
</ul>
<p>其它各种卫星，小行星的名字就懒得贴了。</p>
<p>有了这些符号，我们可以画一个比如托勒密的简化版太阳系模型：</p>
<p><img alt="" src="/images/2023/stdout-15-01.jpg" /></p>
<p>本文源自《<a href="https://www.cricetuscricetus.co.uk/post/copernicus-galileo-kepler-they-all-lacked-proof">哥白尼、伽利略、开普勒都是脱离证据拍脑袋撕逼</a>》一文。<a href="https://news.ycombinator.com/item?id=38300902">HN</a></p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-11-18T16:15:51+08:00">2023-11-18</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-14"  rel="bookmark" >
              <h2 class="card-title">Getting started blogging on Win10</h2>
            </a>
            <p class="card-text"><p>I am planning to setup by blogging environment on my Windows PC.</p>
<ul>
<li>OS: Windows 10</li>
<li>Shell: Bash on WSL1</li>
<li>Program: <code>pelican</code> on Miniconda3 with Python 3.11</li>
</ul>
<p>My objective today is get rid of the <code>static/js/core.js</code> from <code>aether-pelican</code> theme and replace it with <a href="https://jsfiddle.net/t78mf7jb/3/">a simple CSS</a>, and it turns out quite challenging.</p>
<h3>WSL1 and file system</h3>
<p>As it turns out, the installed Ubuntu root filesystem on WSL1 is located here:</p>
<p><code>%localappdata%\Packages\CanonicalGroupLimited.UbuntuonWindows_79rhkp1fndgsc\LocalState\rootfs</code></p>
<p>I plan to move my home dir (at least) to another SSD on my PC, as the <code>C:\</code> drive is an old SanDisk Plus240, which is unforgivablly slow these days. I tried to <code>mv ~ /mnt/d/home</code>, ok but the permission gets weird.</p>
<p>So I tried to copy the folder on Windows to <code>D:\home</code>, and <code>mklink</code> back. I tried both <code>mklink /D</code> and <code>mklink /J</code> ( the <code>/D</code> switch works on a remote drive whereas the <code>/J</code> junction works on local NTFS disks only) and they both failed be recognized by WSL1. The bash yields <code>Broken stdout/stdin</code> upon launch</p>
<p>So OK, default home dir then. Bad luck for me.</p>
<h3>Ubuntu 22</h3>
<p>I just found out my <code>cat /etc/lsb-release</code> shows Ubuntu 18, which is the default distro installed on <code>WSL1</code> I assume. I tried to install Ubuntu 22 from the Microsoft Store, after several wasted minutes (curse the slow Internet in Mainland!) it turns out for WSL2 only. Luckily the Windows Subsystem for Linux was successfully upgraded to latest version:</p>
<pre><code>C:\&gt; wsl --version
WSL version: 1.2.5.0
Kernel version: 5.15.90.1
WSLg version: 1.0.51
MSRDC version: 1.2.3770
Direct3D version: 1.608.2-61064218
DXCore version: 10.0.25131.1002-220531-1700.rs-onecore-base2-hyp
Windows version: 10.0.19045.3570
</code></pre>
<p>the <code>wsl --list --online</code> commands stuck for a total of 10 minutes and returns nothing (curse the AS4134 163NET!)</p>
<h3>Getting Python, Miniconda and Pelican</h3>
<p>So linux distro setup was back to where started, I only have Python to mess with. Miniconda3 gets insalled easily, now that's a some progress. The static site generator I am using <code>pip install pelican[markdown]</code> finishes ok, the pypi was not blocked? Keke.</p>
<p>Then I typed <code>make</code>. It was not part of WSL1? Blaspheme!</p>
<p>Manually running <code>python -m pelican.server</code>, and voila! The Windows asks for firewall listening permission, granted, open up browser, BAM! My blog setup process is done and now I can write and tweak it on Windows. </p>
<p>Oh, and there's <code>git config core.fileMode false</code> needs to be checked!</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-11-11T10:31:11+08:00">2023-11-11</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-13"  rel="bookmark" >
              <h2 class="card-title">火星上怎么结算工资</h2>
            </a>
            <p class="card-text"><p>看到个段子</p>
<p><img alt="" src="/images/2023/stdout-13-01.jpg" /></p>
<p>突然让我想起个事，如果去火星打工，薪资该怎么计算？摘录 wikipedia</p>
<blockquote>
<p>火星的恒星时长 <code>24小时37分钟22.663秒</code>，而太阳日则长 <code>24小时39分钟35.24409</code> 秒。而地球的恒星时和太阳日则分别是 <code>23小时56分钟4.0916秒</code> 及 <code>24小时</code>。在比较之下，一火星太阳日等于1.027491地球太阳日，即比地球太阳日长2.7%。</p>
</blockquote>
<p>怎么有两个天？继续搜</p>
<blockquote>
<p>太阳日（英语：solar day）是依据太阳运动，所定义的时间，可以分为视觉太阳日和平均太阳日。一太阳日传统称为一“日”、一“天”或一“昼夜”。</p>
</blockquote>
<p><img alt="" src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/67/Sidereal_day_%28prograde%29.png/600px-Sidereal_day_%28prograde%29.png" /></p>
<p>英语里把火星的一天叫做一个 <code>Sol</code>。一个火星年在英文的 wikipedia 有讲</p>
<blockquote>
<p>sidereal year ... is about 686.98 Earth solar days (≈ 1.88 Earth years), or <code>668.5991</code> sols 。也就是说火星一年有 668.5991 火星天。。。</p>
</blockquote>
<p>火星因为有<code>25.19°</code>的自转倾角，跟地球相近，所以也可以划分四季。但问题是，火星的轨道长这样：</p>
<p><img alt="" src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/55/Mars_earth_orbit.png/600px-Mars_earth_orbit.png" /></p>
<p>所以如果按照四个季节划分，最长的季节有 <code>194 个 Martian Sols</code>，最短的 <code>142 Martian sols</code></p>
<p>那么问题来了。在火星上怎么算工资呢？我觉得得安天结了。还有，假如亲爱的读者小伙伴将来到火星务工，应聘的时候一定确认好是按地球年结算还是火星年哦。谨防火星历诈骗！</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-11-09T15:50:11+08:00">2023-11-09</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stderr-15"  rel="bookmark" >
              <h2 class="card-title">跟孩子掰扯活着的意义</h2>
            </a>
            <p class="card-text"><p>今天趁着11·11买了个 GZ104 黄轴键盘，感觉之前随便买的青轴的好了很多，于是手痒想打字。哈哈</p>
<h2>人的意义 是什么</h2>
<p>娃今天吃饭的时候突然问了我一个问题：「人活着的意义是什么呀」，很不凑巧我也闲来无事琢磨过这事，但是想要在孩子面前把这事说清楚可能没那么容易。</p>
<p>于是我换了个思路，我问他，如果你是一个动物，你觉得意义是什么？他没回答，我又问，如果你是一块石头，石头会考虑自己的意义嘛？</p>
<p>孩子也没回答。最后我说，人活着的意义呀，可能很多人也不知道，但是有一点可以确定，正因为你有一个聪明的小脑袋，才会去思考「什么是意义」这样的问题</p>
<h2>国家是什么</h2>
<p>他又问到，为什么世界上有那么多国家呢，为什么联合国不是一个国家。怎么样才能统一全世界成为一个国家。</p>
<p>我的回答又把刚才的套路重复了一遍。如果你是一只动物，你会觉得自己属于某个国家吗？娃想了下，可能不会吧。我看到碗里的饭说，如果你是一粒大米，你会觉得自己有国家吗，孩子也不说话。最后我说，国家有很多个定义，但是正是因为人有了大脑，有了想象力，才会产生国家这个概念。所谓国家，就是一个想象的共同体。</p>
<h2>反思</h2>
<p>这可能是我会记录的最无聊的两件事。因为我真的想拿着键盘痛快的打一打字哈哈。</p>
<p>或许我的回答都不是最好的，现在想起来真的有很多改进之处。比如没能鼓励孩子进一步对这个问题进行探索。</p>
<p>蹲茅坑的时候想了一下，我们小时候哪里会思考这些问题呀。小时候都在为了作业发愁，心思都花在了怎么玩上面。现在的孩子能思考这些问题说明生活条件比较好了。人在穷的时候，物质匮乏的时候是不会去思考存在的意义的，都忙着奔波生活去了。生存都照顾不过来，如何去顾及意义呢。</p>
<p>生命或许最大的意义就是生存。仅仅丰衣足食之后，才有闲心来考虑一下奋斗折腾这么大半辈子，究竟是图了个啥。</p>
<h1>后记</h1>
<p>本文完成于 2023-11-05 22:39:59。  </p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-11-05T22:26:35+08:00">2023-11-05</time></p>
<p>stderr</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-12"  rel="bookmark" >
              <h2 class="card-title">FastAPI/Starlette graceful shutdown server-sent events</h2>
            </a>
            <p class="card-text"><h3>缘起</h3>
<p>假如你用 FastAPI/Starlette框架，写了一段 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events">Server-sent Events</a></p>
<pre><code class="language-python">@app.get('/api/my_stream')
async def api_stream():
  async def gen():
    while 1:
      yield &quot;data: {}\n\n&quot;
      await asyncio.sleep(1.0)

  return StreamingResponse(gen, media_type=&quot;text/event-stream&quot;, headers={
    'X-Accel-Buffering': 'no',
    'Cache-Control': &quot;no-cache&quot;,
    'Connection': &quot;keep-alive&quot;,
  })
</code></pre>
<h3>FastAPI 事件</h3>
<p>然后你重启了服务器，比如 gunicorn+uvicorn，你会发现这个连接不会断开，一直输出结果。直到 worker 进程超过配置里的 <code>timeout</code> 参数（默认60秒），被 master 强行杀死然后重启。</p>
<p>一开始尝试了 <a href="https://fastapi.tiangolo.com/advanced/events/#shutdown-event">FastAPI 官方的 <code>shutdown</code> 事件</a>，再在代码的 <code>while 1</code> 加一个 <code>if</code> 判断。发现不管用</p>
<pre><code class="language-python">@app.on_event('shutdown')
def on_server_shutdown():
    app.state.running = False
</code></pre>
<p>发现这段代码执行是执行了，但是是在杀死worker的时候生效的。得更加提前。用<a href="https://asgi.readthedocs.io/en/latest/specs/lifespan.html">ASGI推荐的<code>lifespan</code></a>和 <a href="https://asgi.readthedocs.io/en/latest/specs/www.html#disconnect-receive-event"><code>http.disconnect</code></a> 太复杂，放弃。</p>
<h3>Linux signal</h3>
<p>尝试暴力监听 worker signal</p>
<pre><code class="language-python">import signal
signal.signal(signal.SIGINT, on_server_shutdown)  # ctrl+c
signal.signal(signal.SIGUSR2, on_server_shutdown)
signal.signal(signal.SIGTERM, on_server_shutdown)
signal.signal(signal.SIGWINCH, on_server_shutdown)
signal.signal(signal.SIGHUP, on_server_shutdown)
signal.signal(signal.SIGQUIT, on_server_shutdown)
</code></pre>
<p>发现也不管用。研究了半天，似乎是 <code>UvicornWorker.init_signals</code> 的时候<a href="https://github.com/encode/uvicorn/issues/894">给<code>signal.SIG_DFL</code>了</a>。无语ing</p>
<h3>uvicorn shutdown 流程</h3>
<p>看gunicorn日志：</p>
<pre><code>[2023-11-02 09:50:38 +0800] [25918] [INFO] Shutting down
[2023-11-02 09:50:38 +0800] [25918] [INFO] Waiting for application shutdown.
[2023-11-02 09:50:38 +0800] [25918] [INFO] Waiting for connections to close. (CTRL+C to force quit)
....
[2023-11-02 09:51:18 +0800] [25918] [INFO] Application shutdown complete.
[2023-11-02 09:51:18 +0800] [25918] [INFO] Finished server process [25918]
[2023-11-02 09:51:18 +0800] [25918] [INFO] Worker exiting (pid: 25918)
</code></pre>
<p>观察到 Waiting for connections to close 之后卡住。</p>
<p>属于 uvicorn 的 <a href="](https://github.com/encode/uvicorn/blob/07c2b36455b5475ff7edfa54068ff2c0581a2be1/uvicorn/server.py#L303)"><code>Server.shutdown()</code></a> 方法</p>
<p>这个方法调用链：</p>
<ol>
<li><code>Server.install_signal_handlers</code> 里注册 signal </li>
<li><code>Server.handle_exit</code> 里设置 <code>Server.should_exit = True</code></li>
<li>每秒一次的 <code>Server.on_tick</code> 就会打断 <code>Server.main_loop()</code> 死循环</li>
<li>调用 <code>Server.shutdown</code></li>
</ol>
<p>如果能拿到 <code>Server.should_exit</code> 自行判断就好了，但是 ASGI 是容器无感的，只继续研究</p>
<h3>断开http连接</h3>
<p>上面日志有一个比较关键：</p>
<pre><code class="language-python"># Request shutdown on all existing connections.
for connection in list(self.server_state.connections):
    connection.shutdown()
    await asyncio.sleep(0.1)
</code></pre>
<p>其http连接关闭方法实现为：</p>
<pre><code class="language-python">def shutdown(self):
    &quot;&quot;&quot;
    Called by the server to commence a graceful shutdown.
    &quot;&quot;&quot;
    if self.cycle is None or self.cycle.response_complete:
        self.transport.close()
    else:
        self.cycle.keep_alive = False
</code></pre>
<p>这里应该走的是 <code>else</code> 分支。所以解决方法就是去代码里拿到 <code>cycle.keep_alive</code> 这个属性。</p>
<h3>ASGI 接口</h3>
<p>跟了一会儿，发现ASGI 在  starlette 里如下流程：</p>
<ol>
<li><code>Route()</code> 初始化 <code>self.app = request_response(endpoint)</code></li>
<li><code>Route().handle()</code> 的时候会调用 <code>self.app(scope, receive, send)</code></li>
<li><code>unicorn</code> 的 <code>run_asgi</code> 会 <code>result = await app(self.scope, self.receive, self.send)</code> 。其中 <code>app</code> 就是 starlette 的 <code>Route()</code> 实例</li>
</ol>
<p>所以解决方案逐渐明朗了</p>
<h3>黎明的前夜</h3>
<p>通过 FastAPI/Starlette 请求的 <code>.receive</code> 属性的 <code>__self__</code> 拿到 unicorn 的 <code>cycle</code> 实例，然后定时判断上面 <code>shutdown</code> 赋值的 <code>self.cycle.keep_alive = False</code></p>
<pre><code class="language-python">@app.get('/api/my_stream')
async def api_stream(req: Request):
  async def gen():
    while 1:
      yield &quot;data: {}\n\n&quot;
      await asyncio.sleep(1.0)
      if getattr(req.receive.__self__, 'keep_alive', None) is False:
        break

  return StreamingResponse(...
</code></pre>
<p>这里用了个 <code>getattr()</code> 是保证这个 hack 在非 unicorn 下代码也能正常跑</p>
<p><code>git commit . -m "haha"</code> 上机联调，发现坑了。。。我特么。。。。这个 <code>cycle.keep_alive</code> 默认就是 <code>False</code></p>
<h3>扭转 keep_alive</h3>
<p>这玩意一直为 <code>False</code> 的原因是，unicorn 的 <code>HttpToolsProtocol.on_headers_complete</code> 赋值过程：</p>
<p><code>self.cycle = RequestResponseCycle(..., keep_alive=http_version != "1.0")</code></p>
<p>这里 <code>http_version</code> 可以通过  <code>req.scope['http_version']</code> 得到，打印了一下，你猜怎么着，还真tm是。。。原因就是厂里反代 <a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_http_version">nginx的proxy_http_version</a>没配置。这里是个常见的坑，非常影响性能，因为每个请求会生成一个新的 http 连接。</p>
<p>但是也等不急SA去改配置了。于是直接在代码 <code>async def gen():</code> 前面写死：</p>
<p><code>req.receive.__self__.keep_alive = True</code> 。提交，再试。。。咦，怎么 <code>keep_alive</code> 依然为 <code>False</code>？？？？明明刚刚赋值了？</p>
<p>继续读代码，发现第二个坑，发现 unicorn 的 <code>RequestResponseCycle.send()</code> 方法里，在构造返回的时候，有一句</p>
<pre><code class="language-python">for name, value in headers:
    elif name == b&quot;connection&quot; and value.lower() == b&quot;close&quot;:
        self.keep_alive = False
</code></pre>
<p>好吧。。。那么解决方法就是，把 <code>keep_alive = True</code> 挪到返回内部。先完成返回构造，再强行改值。</p>
<h4>最后的代码</h4>
<pre><code class="language-python">@app.get('/api/my_stream')
async def api_stream(req: Request):
  # req.receive.__self__.keep_alive = True  # doesn't work here
  async def gen():
    req.receive.__self__.keep_alive = True  # works here
    while 1:
      yield &quot;data: {}\n\n&quot;
      await asyncio.sleep(1.0)
      if req.receive.__self__.keep_alive is False:
        break

  return StreamingResponse(gen, media_type=&quot;text/event-stream&quot;, headers={
    'X-Accel-Buffering': 'no',
    'Cache-Control': &quot;no-cache&quot;,
    'Connection': &quot;keep-alive&quot;,
  })
</code></pre>
<p>测试重启 worker，该连接在1秒后断开，worker平稳重启。完美。</p>
<p>苦逼撸业务的一天又开始了。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-11-02T09:44:12+08:00">2023-11-02</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-11"  rel="bookmark" >
              <h2 class="card-title">浏览器拉起钉钉客户端并跳转OA工单</h2>
            </a>
            <p class="card-text"><p>又是 corporate software engineering 吃屎的一天。用户在内部系统走流程，厂里用的是钉钉自带的OA工单审批。已经接入了API创建、完成工单</p>
<p>问题在于发起工单之后，用户并没有感知，不知道工单去哪里了，流程就断了，向钉钉官方售后发起咨询，对方丢了一句：不支持。无语</p>
<p>只能自己鼓捣。已知工单链接，在钉钉聊天窗口内部的最短的网址为：</p>
<pre><code>  https://aflow.dingtalk.com/dingtalk/mobile/homepage.htm?corpid=...&amp;procInstId=...#approval
</code></pre>
<p>对方丢了一个 <a href="https://open.dingtalk.com/document/isvapp/webapp-unified-routing-protocol#title-kkq-kgx-lbq">dingtalk:// 跳转协议</a></p>
<p>反复尝试，发现一个很有用：</p>
<blockquote>
<p>桌面端打开URL <br />
<code>dingtalk://dingtalkclient/page/link</code> <br />
侧边栏： <code>pc_slide=true</code> <br />
大容器（类似工作台容器）<code>ddtab=true</code>   </p>
</blockquote>
<p>于是构造一个试试：</p>
<pre><code>  dingtalk://dingtalkclient/page/link?url=https%3A%2F%2Faflow.dingtalk.com%2Fdingtalk%2Fpc%2Fquery%2Fpchomepage.htm%3Fcorpid%3D...%26procInstId%3D...%23%2Fapproval
</code></pre>
<p>然后果然ok了。</p>
<p>钉钉给人的感觉就是各个部门 hack 强行揉合起来一个怪物。各种不完善、不一致的问题。有空写一下吐槽。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-10-18T14:57:00+08:00">2023-10-18</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-10"  rel="bookmark" >
              <h2 class="card-title">SVG放在 img 中不能加载图片/字体</h2>
            </a>
            <p class="card-text"><p>最近想在 markdown 里搞图文混排，遇到一个大图把版面占完了，想缩小一些，由于 .md 渲染器安全限制，没法直接指定宽高</p>
<p>只能从图片本身想办法，首先最直接的手段就是服务器再缩放一次，但是蛋痛的问题是缩放之后文件怎么存，怎么给静态文件路由，怎么保障图片可用性，怎么兼容各种尺寸，想想都头大。</p>
<p>想到一个 hack，要不直接放一个 .svg 进去，因为 svg 支持加载位图资源，所以把 svg 位图缩小一点，让浏览器渲染 svg 不就行了。</p>
<p>没想到就被这个 hack 坑了。原因是 svg 如果被 <code>&lt;img&gt;</code> 标签渲染，那么禁止加载任何外部资源，脚本也禁止执行。</p>
<p>为了证明这个限制，我写了个 demo 放在 <a href="https://lab.est.im/shit_svg/">https://lab.est.im/shit_svg/</a></p>
<p>这个问题太隐蔽了。stackoverflow 上只有 <a href="https://stackoverflow.com/a/30467585/41948">Robert Longson</a>、<a href="https://stackoverflow.com/a/69160093/41948">ThangLeQuoc</a>、<a href="https://stackoverflow.com/a/18244035/41948#18244035">TheHippo<br />
</a> 的答案提到隐约线索：</p>
<p>后来搜了到 <a href="https://supercodepower.com/en/svg-img-use-font">skychx</a> 把这个问题研究透了。罪魁祸首 <a href="https://www.w3.org/wiki/SVG_Security">SVG Security</a></p>
<blockquote>
<p>If an SVG file is fetched as image, then certain requirements apply to this document:   </p>
<ul>
<li>The SVG document is not allowed to fetch any resources. This also applies to scripts, stylesheets or images.   </li>
<li>Fonts shouldn't be loaded as well. The situation in UAs seems to still be unclear though.<br />
Scripts must not be executed.   </li>
<li>Event listeners must be disabled at all times.   </li>
</ul>
</blockquote>
<p>浪费我好多时间。SVG2里把这个说得很明白了 <a href="https://www.w3.org/TR/SVG2/conform.html#processing-modes">https://www.w3.org/TR/SVG2/conform.html#processing-modes</a></p>
<blockquote>
<p>When external references are disabled in an SVG document, any attempt to fetch a document through an external reference must instead be treated as if a network error occurred and no data was received.</p>
</blockquote>
<p>不过查阅资料的时候发现个好玩的，<a href="https://www.w3.org/TR/SVG11/single-page.html#linking-LinksIntoSVG">SVG 1.1 支持 URL fragments</a></p>
<p>比如：</p>
<ul>
<li>原图 <a href="https://lab.est.im/shit_svg/1.svg">https://lab.est.im/shit_svg/1.svg</a> <embed src="https://lab.est.im/shit_svg/1.svg"></li>
<li>放大 <a href="https://lab.est.im/shit_svg/1.svg#svgView(viewBox(20,20,60,60))">https://lab.est.im/shit_svg/1.svg#svgView(viewBox(20,20,60,60))</a> <embed src="https://lab.est.im/shit_svg/1.svg#svgView(viewBox(20,20,60,60))"></li>
</ul></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-10-17T22:13:18+08:00">2023-10-17</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-09"  rel="bookmark" >
              <h2 class="card-title">市以上行政区划去掉后缀</h2>
            </a>
            <p class="card-text"><p>今天才知道，中国一共333个市一级行政单位。数据来源是 <a href="https://www.mca.gov.cn/n156/index.html">民政部首页 ➡ 民政数据</a></p>
<pre><code>import re

def short_name(name):
    m = re.search(r'''
        (\S+?)
        (?:
            壮族|回族|维吾尔|省|自治区|特别|  # 省
            (?:侗|傈僳|傣|哈尼|回|土家|壮|布依|彝|景颇|朝鲜|白|羌|苗|藏)族|
            蒙古|柯尔克孜|哈萨克|
            地区|市|盟|自治州|自治县
        ).*$
    ''', name, re.VERBOSE)
    if m:
        return m.group(1)
    return name
</code></pre>
<p>这段代码的作用是把比如 <code>"黔南布依族苗族自治州"</code> 这样的名字，缩短成 <code>"黔南"</code>。</p>
<p>有一个小坑是，市一级行政区包含 <code>蒙古|柯尔克孜|哈萨克</code> 这三个名字后面没有 <code>族</code> 字。</p>
<p>有一些 <code>XX林区</code> <code>XX矿区</code> 什么的，我觉得保留比较好。</p>
<p>Python的 <code>re.VERBOSE</code> 真是好东西！</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-10-12T20:01:23+08:00">2023-10-12</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stderr-14"  rel="bookmark" >
              <h2 class="card-title">B站百大up 和 国拟</h2>
            </a>
            <p class="card-text"><p>bilibili.com 是国内热门长视频网站，俗称B站，百大UP是头部百万粉丝的视频上传者，前段时间无聊看了下《<a href="https://www.bilibili.com/video/BV17N411E7ry/">征集两万份问卷！全站最受欢迎的UP主居然是..?</a>》，这部视频作者 <code>-LKs-</code> 抛出了一个惊世骇俗（对我而言）的理论：</p>
<p><img alt="" src="/images/2023/stderr-14-01.webp" /></p>
<blockquote>
<p>频道和频道之间，天生就有占领心智和认知上的高低之分<br />
记忆点排名：人设≥情绪≈观点&gt;颜值&gt;知识/新闻`<br />
一般来说输出情绪和观点的频道，它一定会比那些输出知识和资讯的频道，要更容易被人记住和喜欢。因为前者的拟态更接近人，后者的拟态更接近「书」</p>
</blockquote>
<p>注意它这句话有前提：</p>
<ol>
<li>第一他说的是，一个频道作为一个品牌如何被人记住和喜欢</li>
<li>第二他说是记住和喜欢，并没有说频道的内容一定正确或者有效</li>
<li>第三它不是说一个频道对你有多少帮助。完全有可能你偶然遇到或者搜到一个频道帮你解决了一个问题但是你把频道的名字得一干二净</li>
</ol>
<p>想起来，这也是为啥youtube/bilibili上很多视频封面都是各种大头照，以 LinusTechTips为例：</p>
<p><img alt="" src="/images/2023/stderr-14-03.webp" /></p>
<p>让人们记住一个鲜明的大活人，人设最重要啊。</p>
<p>无独有偶，今天又看到一则奇闻《<a href="https://zhuanlan.zhihu.com/p/660461624">不得不出“国区特供版”的波兰球，是怎么火进小学生圈子里的？</a>》，简单的说 Steam 上出了一款波兰球游戏「Bang On Balls Chronicles」结果波兰球这个亚文化早就在国内流传开并在小学生里成功的「娘」化了</p>
<p><img alt="" src="/images/2023/stderr-14-02.webp" /></p>
<p>得出一个道理：自己对世界的理解，要去人化，祛魅脱敏；对品牌和迷因的传播，要拟人化萌娘化。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-10-10T21:34:41+08:00">2023-10-10</time></p>
<p>stderr</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stderr-13"  rel="bookmark" >
              <h2 class="card-title">核心阶级和国家认同</h2>
            </a>
            <p class="card-text"><p>最近看到个巨扯谈的视频《<a href="https://www.bilibili.com/video/BV1U94y1h7th/">个人主义盛行的美国是怎么建立国家认同的</a>》</p>
<details>
  <summary>剧透</summary>
  美国早期本来是一个松散的13邦联盟，互相尿不到一壶里去，但是联邦政府作为一个可以名义上筹钱筹人的机构，在1803年的Louisiana Purchase得到了大量的未开发土地，种植园主和牧场主为了个人的发财梦，去和北美土著诸部火并，拿起枪杆子保卫自己亲自或者祖辈抢来的土地，13邦的边界虽然明确，但是联邦政府在默许拓边这一行为，并且应允境外白人用 税款 换取 联邦指派治安官和联邦武力的庇护。在对北美土著采取离间驱逐的过程中逐渐形成国家认同。
</details>

<p>实际上，美国这一血腥的国家认同，正是在上个世纪30年代<a href="https://www.washingtonpost.com/outlook/2021/07/13/long-history-american-nazism-why-we-cant-forget-it-today/">纳粹主义的渊源之一（wapo有讲）</a>。简单的说，发现美洲之后，敢离开老欧洲漂洋过海的人都是胆大包天的亡命之徒。它们信奉的昭昭天命就是「应许之地」，加上新教核心理念就是「sola fide」，我强我有理，有理我就强，所以我就是比其他物种优越。最后发展成种族主义，实施对其他 race 的压迫。</p>
<p>这个视频的 up 主是「思维实验室」，他们家的视频有一些说不清道不明的诡异但的地方但是题材比较有趣。这个视频很方便的忽略了一个更有趣 whataboutism 的问题：太平洋对岸的国家认同是怎么建立的？</p>
<p>有理由相信，华夏的国家认同建立正是<a href="https://www.zhihu.com/question/361172362">武装殖民</a>。</p>
<p><img alt="" src="/images/2023/stderr-13-01.jpg" /></p>
<p>白寿彝版《中国通史》在论述周初分封制直接说这就是武装殖民。</p>
<blockquote>
<p>周初的分封是一种武装驻防事业，其目的主要在于作为王室的助手，以监视被征服的各族人民，实际上它具有武装部落殖民的性质。我们知道，周王当时所能直接统治的只有王巍之地。王畿是以镐京和洛邑为两个焦点，其范围现在不能确考，但可知其北不过黄河，南不到汉水，东不达淮水，西则镐京已接近边陲。王畿之外，周室先后封立了很多诸侯国，诸侯对王室的义务不过按期纳贡朝觐，出兵助王征伐，以及救济畿内的灾患而已。诸侯国的内政几乎完全自主，而王室开国初年的武王成王过去以后，诸侯对王室的义务也就成了具文。<br />
另一方面，所有新建的封国大都是以少数周族奴隶主贵族统治多数被征服族人，其土既非周人所有，其民也与周人不类，这些新来者的统治地位，如果没有坚强的武力作其后盾是支持不住的。姜太公封到东方的营邱，史书说太公就东国，“夜衣而行，犁（黎）明至国。莱侯来伐，与之争营丘。”“营丘边莱，莱人，夷也”（均见《史记·齐太公世家》），新来的统治者占有其土地，拥有其人民，因而起来反抗。《礼记·檀弓上》云：“太公封于营丘，比及五世，皆反葬于周”，可见当时武装殖民之不易。当时被封的周族奴隶主贵族及其所率领的周族公社农民进入广大占领区后，首先建立一个军事据点，这在古代文献中名之曰“城”，只有如此，才能进行武力镇压。《诗经·小雅·黍苗》中召穆公营谢，诗人描述军族集镇之况云：“我任我辇，我车我牛，我行既集，盖云归哉！我徒我御，我师我旅，我行既集，盖云归处！”周人及其姻戚联盟，造邦筑城，镇戍征服地区，也见于周金铭文，例如《中甗》虽然铭文残泐，颇难卒读，但其大意，尚可通晓。意谓：王派中巡省南国，筑城殖民，并派兵镇戍。《班毁》记毛公伐东国■戎，■令班“■（以）乃族从父（毛父）征，■（出）■（城）卫。”毛公东征“三年静东国”。这里的■（城）就是征服筑城之证。</p>
</blockquote>
<p>这个段子说，姜子牙去山东「上任」，实际上也就给了一点亲兵和战车，地盘要自己去抢，城要自己去建，太公当年差点被山东当地一个叫「莱」的土著部落给搞死……</p>
<p>为什么少数民族总是「能歌善舞」，并且大多住在偏远的山区？是不是换个译法就是 …… tribal reservation？</p>
<p>这让我想起另一个段子：<a href="https://www.zhihu.com/question/618318252">《封神》导演乌尔善说【汉族称谓】形成于元代。</a></p>
<p>下面有个评论就很应景：「汉族是不是起源自元代，我不知道，但是我知道，“我是汉人”的意识是这些其它民族一遍一遍给我加强的」</p>
<p>这里有个感觉，无论是「通天纹大妈」，还是玩梗的「正米字旗」老不列颠，还是「红旗下长大」的大院子弟，对阶级的认同度远远大于普通国民。因为天下是他们或者他们的祖辈打下来的，有一种「股东感」。如果是普通人，和平年代的国籍无非是身份证件上的可以花代价更改的一行字罢了。</p>
<p>如果你读到这里，一定要暂停一下。如果你觉得这个太宏观，那么假想一下你去了个新公司。你跟普通同事交谈的是，今天做了哪些工作，明天又有哪些该死的任务下来；但是公司里总有那么一戳人，他们跟你讲公司的视角完全不同。他们会告诉你 A 这个市场是当年谁谁大干30天拿下的，B 这个股份是谁谁奋斗了几年才成为合伙人得到的，C 这个部门之前没有，是谁谁带资进组专门成立的。D 这个烂摊子之所以一直没解决是因为负责人跑路到友商，等等。那么把同等的视角换到国家，统治者或者他们的家属后代会明确告诉你，某某领土的由来就是谁谁当年打下来的，而且他们在这样的一种「传承」体系中，非常自豪。</p>
<p>这就是为啥平时很多 XX盟 XX旗 XX喇嘛教 会看不起汉人的根本原因。别人对某一篇山川有「ownership」的感觉。汉文化一个比较短视缺陷就是把天下看成一种零和博弈，「百姓」需要把自己一部分权力让渡给「君主」，人权需要迁就主权，但从唯物的角度来说，国家总是由一小部分人打下来的，大多数被土地绑定的人，并没有太多选择，作为 X国人 或 X朝人 的资格，只能是来自统治者的「施舍」。所以鱼肉百姓也是理所当然顺理其章的事了。因为人口就脱离了人的属性，只是附属和资产。</p>
<p>又联系起最近看马督工的 睡前消息652期《<a href="https://www.zhihu.com/question/618318252">只靠民间热情，“山河大学”建不起来</a>》，里面谈到高中 - 职校分流问题，现实中全世界成功的职业教育有且只有德国一家。职校前身实际上是行业 (学术概念：基尔特) 里师徒制的正规化(1969 <em>Berufsausbildungsgesetz</em>)。我有一个偏激的观点，职校早期雏形是条顿军官团拿来生产军需屯田和筹款的产物。容克军户在和平年代转型生产制造和银行业，大量的德意志职校几乎都是围绕汽车产业进行布局，归根结底就是一堆战备产业。</p>
<p>所以谁才是国家的主人？血与火铸成的核心利益阶级(class)</p>
<p>Class 是一个神奇的词汇，OOP的「类」和社会的「阶级」有异曲同工之妙。如果按照本篇思路推演下去，可以拿历朝历代作为例子总结一下朝代的消亡的实质，就是核心class的消解：</p>
<ul>
<li>周人的核心阶级是老姬家。三家分晋之后gg。公卿代替天子</li>
<li>大秦是一个神奇的国度，变法之后不分种族和阶级，以法治世，但是功勋升级系统在大一统之后达到武力扩张极限被玩坏反噬了。汉王定三秦，算老秦人第二次统一中国。</li>
<li>老刘家彻底扫平沛县集团还得等到刘彻的大手笔。当时看 渤海小吏 的 《<a href="https://space.bilibili.com/504934876/channel/collectiondetail?sid=1589161">汉武大帝</a>》系列就有如同看开篇第一个视频讲的美国西部精神，牛仔风范那种爽片一样。李广难封，老刘家对野心家封无可封就造就了曹阿瞒加九锡这种操作</li>
<li>老李家核心阶级是关陇集团。安世之乱就是河北土著（主要是汉人）和陕西外籍雇佣军团冲突</li>
<li>辽金的核心阶级显然是拓跋部和猛安谋克，大怂国本质是一群胸无大志但是筹款能力比其他朝代强的节度使混日子</li>
<li>元的核心阶级就是千户制达鲁花赤老爷们</li>
<li>明的核心阶级是军户供养皇族养猪。军户跑光了也该亡国了</li>
<li>大清的核心阶级是八旗。满城沦陷就完蛋</li>
<li>本朝的核心阶级是 ☭ </li>
</ul>
<p>除了核心阶级所形成的可以继承的利益集团，其他人要么是归顺的食邑劳动力，要么是“穷凶极恶”的印第安人。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-10-07T07:34:04+08:00">2023-10-07</time></p>
<p>stderr</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stderr-12"  rel="bookmark" >
              <h2 class="card-title">无为，智力和因果论</h2>
            </a>
            <p class="card-text"><p>最近看渤海小吏讲汉文帝、汉景帝的《<a href="https://www.bilibili.com/video/BV1Yu4y1v7Bo/">秦汉帝国完全体99%</a>》很有收获，特别是 23:00 这段：</p>
<blockquote>
<p>总体而言，汉代初期的官僚人数少，制度简单，政府没有整体干预经济的想法，所以超级省钱。养活当时的整个官僚，每年所需的粮食不过几十万石。哪怕按一百万石算，只用全国大约八百分之一的土地就可以养活这个官僚系统。这是整个中国历史上政府运营成本自成一档的优秀存在。<br />
这套体制虽然简约，但却并不简单。中央对于局势的控制力度一点也没有弱化。这段时间，反而是整个有汉一朝，刑事案件与社会矛盾最少的年代。<br />
《道德经》曾经讲过这么一句话：“太上，下知有之。其次，亲而誉之。其次，畏之。其次，侮之。”<br />
- 最牛的水平，是下面的人仅仅知道有这么个领导。<br />
- 水平差点的，是下面的人赞美夸奖这个领导。<br />
- 再差点的，是所有人害怕这个领导。<br />
- 最次的，是所有人都在骂这个货。</p>
</blockquote>
<p>总觉得这段话在骂谁呢？没想到<a href="https://zhuanlan.zhihu.com/p/58655382">汉景帝的七国之乱</a>也是折腾出来的。看完这视频我又在琢磨，皇权、王权、相权三权分立是什么？</p>
<p>看这一系列的视频总给人一种强烈 黄老之术讲究的一个「无为」，也不是很懂；</p>
<hr />
<p>周末又昏昏沉沉看了了《长安三千里》，给我感动得，然后重新认识 李白 那种商人之子想通过刷干谒文当官，我心里一直在嘀咕，李白家里有钱，为啥非得要去当官？可能是，在那个时代，你有钱也没有安全感。权力一张纸就可以让你的财富化为灰烬。但是李白明明修道，却一辈子没能实现自己的政治抱负，最终取了功名的反而是 高适。</p>
<hr />
<p>然后又看到一篇《<a href="https://www.zhihu.com/question/618248946">gpt4开发人员拿柯尔莫哥洛夫复杂度数学上严格约束并解释gpt4的智力产生原因</a>》。让我想起来前段时间看到的离谱故事：<a href="https://aclanthology.org/2023.findings-acl.426/">Gzip+ kNN文本分类竟然击败Transformers：无需预训练、14行代码实现</a></p>
<p><img alt="" src="/images/2023/stderr-12-01.webp" /></p>
<p><img alt="" src="/images/2023/stderr-12-02.webp" /></p>
<hr />
<p>看起来风马牛不相及的三个生活经历，在今天产生了奇妙的化学反应。我突然想明白，无为的意思，就是承认因果律的局限性。</p>
<p>人的主观能动性——作为，有一个经常被忽略的大前提，你得抱着一定的「目的」才可能去作为，也就是拿着预设的最终结果去改变现状。准确的目的设定，需要对真实世界的反复推演和总结因果律。因果律的掌握程度就是智力水平，智力的高低就看你掌握的是有损压缩还是无损压缩，因为压缩的本质就是用更少的信息去模拟真实的全部信息。聪明就是用更小的成本去还原更多的事物，笨就是还原成本更高。这个成本，在学术上的定义就是 Kolmogorov复杂度。它有个上限但是不可及算，某些可计算的变体，比如conditional time-bounded Kolmogorov 复杂度是 NP 问题，不可知也。</p>
<p>以前一直不知道信息论学了有什么用，现在似乎摸到了一些门道。信息是中性的，但是因果就有得失和优劣之分。以前不会用，是因为不知道武器的哪一端是剑柄才能握住挥舞。</p>
<p>生活中许多东西是需要去「作为」的，但是需要区分哪些是自然事物，那些是人为的设置。人这个神奇的动物可以把<a href="/201910/stdout-006">不存在的实体看成实体</a>。</p>
<p>胡思乱想一些心得，记录一下，或许将来可以整理得更清晰。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-08-22T22:27:47+08:00">2023-08-22</time></p>
<p>stderr</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdin-10"  rel="bookmark" >
              <h2 class="card-title">为啥Linux下病毒比较少</h2>
            </a>
            <p class="card-text"><p><img alt="" src="/images/2023/stdin-10-01.webp" /></p>
<blockquote>
<p>最近下载了一个Linux的病毒，把它解包了。<br />
尝试用root身份运行，发现啥也没有。<br />
Google了俩小时，发现这病毒没解包到 /usr/local/bin 而是解压到了 malware 用户没有写入权限的 /usr/bin，于是病毒创建不了进程文件。<br />
从某个中文论坛里找到了修改过的 .configure 和 .make 文件，重新编译重新运行了一下。<br />
病毒说它需要 cmalw-lib-2.0，结果发现这玩意是 CentOS 里的，Ubuntu 里没有。Google 了好几个小时找到了从源码构建 .deb 包的方法。<br />
这病毒总算开始跑了，然后打出来几行日志，吐了个 core dump 就 crash 了。翻了一个小时日志发现这病毒假定自己跑在 ext4 文件系统上然后调用了 ext4 的加密 API。但是在 btrfs 里这个 API 已经弃用了，内核发现了这个问题然后把这个分区变成只读的了。<br />
打开源文件，grep 搜索出病毒里的 BTC 钱包地址然后出于同情给它打了 $5。</p>
</blockquote>
<p>哈哈虽然现在linux病毒也多，但是这个也太搞笑了 <a href="https://t.me/rvalue_daily/4255">via</a></p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-08-22T15:04:30+08:00">2023-08-22</time></p>
<p>stdin</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdin-09"  rel="bookmark" >
              <h2 class="card-title">北京，为什么会没有大家说的那么繁华？</h2>
            </a>
            <p class="card-text"><p>看了这篇文章之后，感受颇深。强烈推荐阅读</p>
<p><a href="https://mp.weixin.qq.com/s/hqIMDADiPDVSWp8EKh5gbw">https://mp.weixin.qq.com/s/hqIMDADiPDVSWp8EKh5gbw</a></p>
<p>之前看到行业说法，北京便利店少的原因是“三个半”，即由于纬度高，天气寒冷，只能做“半年”生意，每日只能做“半天”生意，马路宽隔绝了人流，只能做“半条路”的生意。</p>
<p>当时不知道为啥北京有这么多栏杆，现在知道了，原来是模仿苏联的城市规划。</p>
<p>文章里提到</p>
<blockquote>
<p>“窄马路、密路网、路口多”这种在风水上叫做“雍聚”，是上上之选，有利于聚财、聚气、增加流动性、繁荣商业、降低拥堵。那种“宽马路、大广场、路口少”叫做“散迭”，会造成西北风煞冲散街区的热气，导致地气不旺、商业冷落萧条。城市变成睡城、死城，民众精气散迭，日渐贫穷衰落。</p>
</blockquote>
<p>搜了下，居然这个说法是公众号里早就有之的洗稿文。不过从另一个角度想，你分析blah那么一大堆，给没耐心或者没文化的小学生讲这个道理，不如就简化成：雍聚是上上之选。有的时候「道理」被过度复杂化了。不如直接给出上 - 中 - 下这种线性结论杀伤力更大。</p>
<p>想到现在政策层面反复炒作的「烟火气」，又想起2016年那个「不再建设封闭式小区」，当时被好多人骂来着。</p>
<p>最后感觉这篇文章讲的故事，如果放在网络社区上，也是同样的结论。把流量都往「主干道」「主旋律」上赶，必然会有大量的舆论翻车事故，最后得到的一定是商业上的萧条。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-08-14T16:10:06+08:00">2023-08-14</time></p>
<p>stdin</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdin-11"  rel="bookmark" >
              <h2 class="card-title">张雪峰论男人</h2>
            </a>
            <p class="card-text"><p>在这个下落和迷茫的时代，有的时候一段不经意的话真的很打动人：</p>
<p><a href="https://www.bilibili.com/video/BV12V4y1y71a/">张雪峰，男生本来就一无所有，你怕什么？放手干就行了</a> <a href="https://twitter.com/est/status/1710637565391601825">视频备份</a></p>
<blockquote>
<p>男生，咋是爷们。咋男生咋没什么所谓好失去的，为什么？你本就一无所有啊！你怕什么。 <br />
你有什么好失去的呢？大不了从头再来，对吧？ <br />
但行好事，莫问前程，皇天不负有心人。   </p>
</blockquote>
<p>之前有个感悟，人的理性其实是一个很狭窄的波普，下限是死亡，上限是吃多了撑的。如果死亡都不怕，其实没啥好怕的；人吃撑了，才会有心思去发展琴棋书画，探讨抱负和情感。在死不了和吃不饱之间其实是完全没必要，干就完了。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-08-11T14:29:28+08:00">2023-08-11</time></p>
<p>stdin</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stderr-10"  rel="bookmark" >
              <h2 class="card-title">从中介合理争取自己的利益</h2>
            </a>
            <p class="card-text"><p>感慨并记录一下，打交道的一些油腻的门门道道。房屋出租给某知名绿色logo中介，由于怕麻烦，参与了他们某个打包N年固定收益的出租方案，好处是所有问题该中介包干，确定收益，就算没租出去也是公司补贴收益；坏处是租金比理想市场价低一些。我自己判断，如果仅由中介帮你打广告，或者自己独自去招揽散客，很可能空档期导致还不如全打包。</p>
<p>这个条约有个很扯的费用，每年扣800维修基金。恰好今天租客很气愤的找到中介，说空调损坏。评估维修成本700左右。中介又找到我，说这属于维修基金不能覆盖的「大额支出」。</p>
<p>我当时听到菊花一紧，这疫情结束以来才起租，钱没挣多少，花费又多一截了。于是采取一边了解细节，一边不正面答应的策略。</p>
<p>想到，这空调不可能无缘无故损坏，维修那么贵可能是一口价宰人。于是我决定我的底线是「分摊」这笔费用，据理力争，几个回合下来，成功的把这个费用。。。。。全免了</p>
<p>事后回顾了一下。恰好看到网上一个<a href="https://www.xcar.com.cn/bbs/viewthread.php?tid=99217765">类似的例子</a>：</p>
<p>大概意思是一场交通事故，保险理赔一个大灯，发现大灯非原厂而是后期改装过，于是提出让车主自费。</p>
<p>后面大家的讨论是：</p>
<blockquote>
<p>12378，一个（举报）电话就搞定。很多时候定损员希望你走这步，他也不用上下为难了，又不是从他包包头掏钱出来</p>
</blockquote>
<p>这个道理让我的思路豁然开朗。用在我这个case上，可能是中介惯用的一个套路。首先这个合同不是跟中介签的，是跟中介所在的公司一个整包出租的项目签的。所以这里中介其实和房租收益没有「利益相关」，他只是从公司这个项目里拿到固定比例分成或者工资。至于这个出租项目整体亏了还是赚了，与中介自身无关。他只需要找到合适的客源，以合适的价格出租出去，把出租过程中所有的事摆平。剩下的问题都是公司开发这个项目的精算师的责任了。</p>
<p>一个中介办事员吃饭的本钱是什么？跟所在片区客户融洽的关系。所以得罪客户，让客户为难是下下策。公司就算这个项目亏本，跟办事员自己有一毛钱关系？就算公司明天倒闭，销售型员工换哪一家公司不是干？</p>
<p>那个车险的例子也一样。定损员吃饱了才会去找车主的茬，就算节约下来理赔的钱，也跟定损员自己没有一分钱「利益关系」。但之所以定损员会挑这样一个让客户难堪的毛病，无非是完成制度规定的一套动作。所以这个时候车主大可不必跟理赔员发火和吵架，只需要让理赔员有一个台阶站在自己这一边，整个问题的天平就会倾斜。</p>
<p>这是一个发生在我身边，如何同成年人争取自己利益的故事。油腻指数 ★★★★☆</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-07-13T17:30:36+08:00">2023-07-13</time></p>
<p>stderr</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-07"  rel="bookmark" >
              <h2 class="card-title">在py3里同步/异步混合使用 httpx 调用</h2>
            </a>
            <p class="card-text"><p>比如开发需求是请求一个 http API，得到数据，解析一下返回，那么一般的做法是封装一个方法，比如</p>
<pre><code>import httpx


def get_sth(p1, default=MY_VAL):
    # network
    r = httpx.get(API_URL, params={'t1': p1})
    # parsing
    res = r.json().get('my_key') or MY_VAL
</code></pre>
<p>但是如果想在 async/await 里用这段代码，就得改成</p>
<pre><code>import httpx


async def get_sth(p1, default=MY_VAL):
    # network
    with http.AsyncClient() as client:
        r = await client.get(API_URL, params={'t1': p1})
    # parsing
    res = r.json().get('my_key') or MY_VAL
</code></pre>
<p>注意其中 <code>def get_sth()</code> 也必须改成 <code>async def get_sth</code> 。这就是所谓 async/await 传染性</p>
<p>这个时候，如果你想把这块代码抽象出来，让同步/异步的库都能调用，我在最近重构里找到一个最佳实践：</p>
<pre><code>import httpx


def get_sth(p1, default=MY_VAL):
    r = httpx.Request('GET', API_URL, params={'t1': p1})
    r.parse = lambda x: (x.get('my_key') or MY_VAL)

# 同步调用：
with httpx.Client() as client:
    r = client.send(get_sth())
r.request.parse(r.json())

# 异步调用：
async with httpx.AsyncClient() as client:
    r = await client.send(get_sth())
r.request.parse(r.json())
</code></pre>
<p>思路是 逻辑和 transport解耦，也是某种意义上的 <a href="https://sans-io.readthedocs.io/">Sans-IO</a> 了吧？</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-07-05T17:39:54+08:00">2023-07-05</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2023/stdout-06"  rel="bookmark" >
              <h2 class="card-title">git切换马甲</h2>
            </a>
            <p class="card-text"><p>如果你有多个 github、bitbucket、gitlab 账号需要来回切换，那么这个方法或许对你有用。</p>
<p>使用git你需要配置一个 <code>~/.ssh/id_rsa</code>，如果你有多个身份就麻烦了。传统网上搜到的办法是编辑 <code>~/.ssh/config</code> 然后加入个类似这样的配置：</p>
<pre><code>  Host estgit
  HostName github.com
  Port 22
  User git
  IdentityFile ~/.ssh/est_github
  IdentitiesOnly yes
</code></pre>
<p>这样做也不是不行，就是你输入命令的时候得把主机名改了。比如</p>
<p><code>git clone git@github.com:est/aether-pelican.git</code></p>
<p>你需要改成 </p>
<p><code>git@estgit:est/aether-pelican.git</code></p>
<p>当然这还不是最蛋痛的。最蛋痛的是如果你用了 <code>git submodules</code> 那么你切换马甲变得非常麻烦。因为别人用你的项目没法解析 <code>git@estgit</code> 这样的玩意。</p>
<p>我研究出来了一个hack，直接改repo的 <code>.git/config</code> 可以达到同样的效果。比如</p>
<pre><code>  [core]
      sshCommand = /usr/bin/ssh -o IdentitiesOnly=yes -i ~/.ssh/est_github -a
  [user]
      name = est
      email = ...@...
</code></pre>
<p>这样你可以随意在不同的repo切换n个 ssh identity 身份。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2023-06-26T16:27:28+08:00">2023-06-26</time></p>
<p>stdout</p>            </div>
          </article>
        </div>

    </main>
    <nav class="pagination-nav side-padding">
<a href="/index.html" class="pagination-newer">&lt; Newer Posts</a><a href="/index.03.html" class="pagination-older">Older Posts &gt;</a>    </nav>


  </body>
</html>