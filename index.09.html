<!DOCTYPE html>
<html>
  <head>
    <title>est の 输入 输出和出入</title>

    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <link href="https://feeds.feedburner.com/initiative" type="application/rss+xml" rel="alternate" title="est の 输入 输出和出入 RSS Feed" />

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="This blog is rated 🔞, viewer discretion is advised" />

    <meta property="og:url" content="https://blog.est.im">
    <meta property="og:type" content="website">
    <meta property="og:title" content="est の 输入 输出和出入">
    <meta property="og:description" content="This blog is rated 🔞, viewer discretion is advised">

    <link rel="stylesheet" href="/theme/css/normalize.min.css" />
    <link rel="stylesheet" href="/theme/css/style.css" />


    <style>
      body {
        background: #ecedef url("/theme/img/ignasi_pattern_s.png") repeat;
      }
    </style>
  </head>
  <body class="list-body">
<nav class="nav-bar side-padding">
  <h1 class="nav-header"><a href="/" class="nav-text">
    est の 输入 输出和出入
  </a></h1>
  <div class="hamburger-menu">
    <button>
      <span></span>
      <span></span>
    </button>
    <ul id="menu" class="hamburger-menu-overlay">
      <li><a href="/" class="hamburger-menu-overlay-link">Home</a></li>
      <li><a href="https://feeds.feedburner.com/initiative" class="hamburger-menu-overlay-link">RSS</a></li>
      <li><a href="/about" class="hamburger-menu-overlay-link">About</a></li>

      <li><a href="/category/archive" class="hamburger-menu-overlay-link">archive</a></li>
      <li><a href="/category/stderr" class="hamburger-menu-overlay-link">stderr</a></li>
      <li><a href="/category/stdin" class="hamburger-menu-overlay-link">stdin</a></li>
      <li><a href="/category/stdout" class="hamburger-menu-overlay-link">stdout</a></li>

    </ul>
  </div>
</nav>    <main class="card-container side-gutter">
      <header class="list-header">
        <p class="list-header-subtext">This blog is rated 🔞, viewer discretion is advised</p>
        <!-- <h1 class="list-header-title">est の 输入 输出和出入</h1> -->
      </header>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2021/stdout-010"  rel="bookmark" >
              <h2 class="card-title">shell script to graceful restart gunicorn with source code reloading</h2>
            </a>
            <p class="card-text"><p>I always thought restart <a href="https://gunicorn.org/">gnicorn</a> is as easy as <code>kill -HUP &lt;pid&gt;</code>, but there are two pitfalls:</p>
<p>First of all the code might be loaded in master process then fork'ed into workers, so the <code>HUP</code> signal won't reload the source code, only gunicorn config is updated.</p>
<p>Then there might be some bugs and your new code won't boot correctly, the worker will quit and drags down the master process along with it.</p>
<p>I discovered a new trick from github issues that can spawn new worker first, check if new code loads correctly then restart the whole rack.</p>
<p>According to <a href="https://docs.gunicorn.org/en/latest/signals.html#upgrading-to-a-new-binary-on-the-fly">the docs</a> you need to send several signals and blah blah, the author tried to explain in great detail of how it works rather than providing a simple option to do so.</p>
<p>So I wrote a shell script to do that instead.</p>
<pre><code>  #!/bin/bash

  oldpid=$(&lt;./deploy/gunicorn.pid)
  # forget the old kill -HUP 
  kill -USR2 $oldpid
  sleep 1
  timeout=5
  while [[ $timeout -gt 0 ]]; do
    newpid=$(&lt;./deploy/gunicorn.pid.2) &amp;&amp; kill -0 $newpid
    if [[ $? -eq 0 ]]; then
      break
    else
      sleep 0.5
      (( timeout-- ))
    fi
  done;

  # shutdown old
  echo "success. newpid=$newpid"
  kill -WINCH $oldpid
  sleep 1
  kill -TERM $oldpid
</code></pre>
<p>The script will check for new master pid to be alive then kill the old master in a maximium timeout of 5 seconds.</p>
<p>It works perfectly to replace the simple <code>HUP</code> signal as intended.</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-08-21T00:53:20+08:00">2021-08-21</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2021/stderr-008"  rel="bookmark" >
              <h2 class="card-title">记一次离奇的梦</h2>
            </a>
            <p class="card-text"><p>先是梦见去一个泥泞的乡间瞎逛，路上看到田间地上躺一人，很脸熟，左看右看发现长得极像中学同学W；</p>
<p>W居然失去了双臂（这个点很奇怪但是梦里就是这样），而且一直神志不清胡言乱语，沟通很是困难无法确认身份。于是找到附近乡民，询问得知这是流落到这里不久。</p>
<p>然后就想怎么帮忙打听询问一下是不是真的是老同学W。辗转很久联系上了他的妻子，也陷入了一连串关于中学时期的回忆和还原，以及他的身世经历逐渐展开。原来W是跟同班同学L结婚的，L是班上才女，W的事业十分成功而且励志，属于英雄抱得美人归的那种。（此处穿插各种回忆杀）</p>
<p>他妻子表示W前几个月出差去了然后就一直失联了，于是感觉眼前这位极有可能就是出了事的W，赶紧向当地警力报案，然后从蛛丝马迹里找出W流落所在一家农户里可能就是迫害W的凶手。（此处省略侦探寻找线索情节若干），最后是我拿着推理过程判决书把真相大白于众人，L也远道而来，抱着W痛哭，算是一个比较惨但是比较好的结局。</p>
<p>这个梦按理说就结束了。但是接下来这个梦的骚操作是我没预料到的。</p>
<p>W看着抱着他痛哭的L，居然大惊失色，慌张失措，像见到鬼一样害怕至极。。。我当时心里一下就嘀咕了，莫非L才是幕后黑手？从证据A B C和推理 X Y Z来看极有可能是这样。莫非L对W的态度有隐情？当时妈的整个人都错乱了，鸡皮疙瘩一下子就起来了。然后。。。然后突然就醒了。</p>
<p>按照这个情节说不定可以一路把之前所有的蛛丝马迹都反转，比如L本来想策划一场完美谋杀，结果被我偶然遇见并且揭露的翻转情节，想想都很 thrill。</p>
<p>起床洗漱之后，对这个故事还在回味。突然又想到一层：既然L是幕后黑手，那她为啥要主动来认亲投案？</p>
<p>配乐声起……………………完。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-08-05T10:42:29+08:00">2021-08-05</time></p>
<p>stderr</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2021/stderr-007"  rel="bookmark" >
              <h2 class="card-title">Privacy或许应该被翻译成「个体权」而不是隐「私」</h2>
            </a>
            <p class="card-text"><p>Privacy 是我们每天都碰到的一个词，但也是英语里<a href="https://plato.stanford.edu/entries/privacy/">没有被精确定义和系统分析的过</a>的一个概念。</p>
<p>个体权的历史，被白人攀附上溯至古希腊亚里士多德，他老人家把人生分成两个空间，一个是公共空间 <em>polis</em>，本意是「大都市里的政治或者宗教核心街区」，另一个空间是 <em>oikos</em>，本意是「家」（有三层意思：家人/族，家产和家族产业，和宅子）。前者是「公共和庙堂生活」，后者是「私人和民事生活」。</p>
<p>光绪年间，北美的出版业发达，出现了八卦私人的<a href="https://en.wikipedia.org/wiki/Yellow_journalism">yellow journalism</a>产业，加上 Kodak Brownie (1884) 这种便携式相机普及，各种震惊体添油加醋的报纸头条搞得民生沸腾</p>
<p><img alt="Brownie2" src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d7/Brownie2_overview3.jpg/640px-Brownie2_overview3.jpg" /></p>
<p>所以老美就立法细化(Warren and Brandeis, 1890)，哪些「东西」是私人的，不应该被指责和打扰。但虚拟的事物算不算「东西」？根据英美的祖宗法有个「堡喻」判例传统，也就是说中世纪，有城堡的人才有私产，谁未经允许进堡就等于宣战；后来工业革命进步了，有个家就算一个「堡」，谁闯家谁就是贼；现在狗仔队满地走，所以干脆连一个实体的「堡」都不需要了。直接立法罗列一番哪些实体和虚拟的东西算 private property。但是 privacy 这个定义在不同的国家和不同的历史时期范围也是变化的。比如 William Prosser 1960就列举了4大privacy:</p>
<ol>
<li>Intrusion upon a person’s seclusion or solitude, or into his private affairs.</li>
<li>Public disclosure of embarrassing private facts about an individual.</li>
<li>Publicity placing one in a false light in the public eye.</li>
<li>Appropriation of one’s likeness for the advantage of another (Prosser 1960, 389).</li>
</ol>
<p>所以俺觉得，非实体的，信息层面上的Privacy应该被更好的翻译成：个体权。它是跟群体权相对而言的，是指每个个体用来自我行事、自我理解和自我表达的权力。</p>
<p>「隐私」这个翻译坏处在于，「私」在儒家文化圈里不是一个好词，「大公无私」是褒义，那么根据中国特色二极管逻辑，「私」必然就是坏事。</p>
<p>「隐私」如果翻译回英文，大概类似于 pose to hide egoism ？哈哈。</p>
<p>回过头，欧美还是有杠精反对 privacy 的。首先因为人身和财产是自古以来就被保护的权力(Thomson, 1975)。其次，隐私从经济上来说对整个社会不是最优的(Posner, 1981)，甚至有人打拳，说女性的隐私保护实际上是男权用来控制女性的手段(MacKinnon, 1989)。哈哈哈</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-07-23T14:18:10+08:00">2021-07-23</time></p>
<p>stderr</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2021/stdin-006"  rel="bookmark" >
              <h2 class="card-title">美国国家航空航天局（NASA）在1966年的黑科技</h2>
            </a>
            <p class="card-text"><p>我 2018-09-29 在 <a href="https://www.zhihu.com/question/61925305/answer/500667495">zhihu 上</a>回答一个老贴。问题是「美国国家航空航天局（NASA）有什么黑科技」，存到自己 blog 上留档</p>
<p>转载一个故事 <a href="http://www.worldofindie.co.uk/?p=682">McMoon: How the Earliest Images of the Moon Were so Much Better than we Realised</a></p>
<h3>1966 年</h3>
<p>这个时候我国在做什么，大家可以回忆一下。这是一个胶片相机还是精密仪器的时代，2年前，东京奥运会被称为第一个有电视机奥运会。</p>
<p>NASA为了探测月球，发射了5个探测器Lunar Orbiter I 到 V。需要传回月球图片</p>
<p>那么请问没有任何数码手段如何把图片传回来？那个时候的美国间谍飞机到我国上空侦查，是要派飞行员来飞，而且要回去洗照片的。美国的侦察卫星，也是需要定期弹射胶卷回地球，然后地面部队回收，这个回收率很低的，有的纯粹是摔坏了，或者掉到山里河里海里找不到了。如果胶卷用完了卫星寿命也就报废了。</p>
<p>NASA 这个探月任务，飞行器又不可能弹射胶卷回地球，如何传回数据？再次提醒那个时候都是模拟相机模拟信号，数码相机是1975年Kodak发明的！</p>
<p>NASA这样做：</p>
<ol>
<li>70mm胶片拍摄，并且洗出来</li>
<li>用200 lines/mm 的 5微米的扫描仪扫描负片</li>
<li>用 lossless 的模拟信号算法把数据传回地球。这个无损算法叫 vestigial sideband</li>
</ol>
<p>注意这里是充满了极端气温和宇宙辐射的外太空环境完成的。等于在外太空搞了个60年代的冲印店和扫描仪。。。相当了不起。可以看一下资料</p>
<p>http://www.moonviews.com/2012/06/lunar-orbiters-classified-heritage.html</p>
<p>最后收到图片，解码打印出来的结果是这样的</p>
<p><img alt="" src="/images/2021/stdin-006-1.jpg" /></p>
<p>地球上一共三个地面站收到了信号。这些数据被保存在Ampex FR-900 磁带机上。这些磁带机当年的售价是 $300,000 一台。</p>
<p><img alt="" src="/images/2021/stdin-006-2.jpg" /></p>
<p>当然了，这特么都半个多世纪过去了，原始的磁带肯定被人到处乱丢没人管。当然也有蛋痛的爱好者尝试去找古老的磁带玩。基本就是去吃灰的仓库里找古董的感觉</p>
<p><img alt="" src="/images/2021/stdin-006-3.jpg" /></p>
<p>当年没那么多图片格式或者压缩算法， 都是直接保存原始点阵。一张图就是2G 大。。。NASA冲印出来都是 1.58x0.4米的照片。</p>
<p><img alt="" src="/images/2021/stdin-006-4.jpg" /></p>
<p><img alt="" src="/images/2021/stdin-006-5.jpg" /></p>
<p>当这帮蛋痛的爱好者自己尝试DIY的思路，把磁带里的数据，通过自己的方法再次读出来，看到的照片的瞬间惊呆了。两张图放在一起作为对比：</p>
<p>当年NASA公布的照片 vs 爱好者自己读取原始磁盘复原的照片对比：</p>
<p><img alt="" src="/images/2021/stdin-006-6.jpg" /></p>
<p>这个图片可能看起来没感觉。爱好者修复得到的图片 JPEG 有55M 大，分辨率 37134 × 16200 。你们可以下载下来感受下。</p>
<p>https://loirp.arc.nasa.gov/loirp/jpeg/LOIMAGEFULL.jpg</p>
<p>这图片放在10年前普通 WinXP 机器打开，能把预览工具直接卡死。</p>
<p>为毛差别这么大？原来，当年 NASA 怕自己技术太叼吓着苏联人了，故意降低了分辨率并加入了噪音。以免苏联根据照片反推侦查能力。。。。。</p>
<p>更多的照片，现在已经响应国会山的号召，信息透明政务公开，可以在网站上查阅下载了。</p>
<p>https://loirp.arc.nasa.gov/loirp_gallery/</p>
<p>这一年是1966年。</p>
<p>3年之后，美国把2活个人送上了月球，还电视直播。</p>
<p>并且返回了回来。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-07-06T23:13:17+08:00">2021-07-06</time></p>
<p>stdin</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/2021/stdout-009"  rel="bookmark" >
              <h2 class="card-title">macOS 设置 TCP 握手连接超时，提升浏览器在糟糕网络下的访问体验</h2>
            </a>
            <p class="card-text"><p>多年的疑惑今天居然被偶然解开了。</p>
<p>由于墙内糟糕的网络环境，而且ISP甚至wifi内还有墙中墙，所以很多域名是打不开的。</p>
<p>每次看浏览器在傻乎乎的转菊花，就觉得浪费时间。</p>
<pre><code>  sudo sysctl  net.inet.tcp.keepinit=3000
</code></pre>
<p>这一条指令可以直接设置 macOS 的 TCP Keepalive 心跳包初始化时间设置为3000毫秒。</p>
<p><code>net.inet.tcp.keepinit</code>默认值是 75000 ，单位是毫秒。注意 Linux 下没这设置，而且单位是 秒</p>
<p>这句话学究式的解释可以通过 <code>man 4 tcp</code> 得到，摘录几条：</p>
<blockquote>
<p>TCP_CONNECTIONTIMEOUT  The TCP_CONNECTIONTIMEOUT option allows to specify the timeout, in seconds, for new, non established TCP connections. This option can be useful for both active and passive TCP connections. The default value is specified by the MIB variable net.inet.tcp.keepinit.<br />
tcp.keepinit Timeout, in milliseconds, for new, non-established TCP connections.</p>
</blockquote>
<p>换句话说，就是 TCP 第一个 syn 包最多给3秒等待。超过3秒就拉倒，直接报 <code>ERR_CONNECTION_TIMED_OUT</code> 完事。</p>
<p>我觉得，如果一个域名和TCP端口3秒钟内无法完成握手，就别执着了。你再干等75秒也不可能连上。这个值只会影响初始连接的超时，一旦连上了怎么idle都不影响，所以不会影响游戏的tcp或者websocket的长连接。也不影响udp。</p>
<p>2021-07-06 补充：</p>
<p>重启保持有效：</p>
<pre><code>  echo net.inet.tcp.keepinit=3000 | sudo tee -a /etc/sysctl.conf
</code></pre>
<p>2021-09-21 补充：</p>
<p>新版macOS 把 /etc/sysctl.conf 这文件给换位置了。应该是</p>
<pre><code>  "/Users/Shared/Relocated Items/Configuration/private/etc/sysctl.conf"
</code></pre></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-07-02T15:51:19+08:00">2021-07-02</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/202106/stdout-008"  rel="bookmark" >
              <h2 class="card-title">MySQL on duplicate key in SQLAlchemy</h2>
            </a>
            <p class="card-text"><p>A simple function to upsert something atomically into MySQL</p>
<pre><code>  def upsert(val1, val2, **kwargs):
      """upsert val1-val2 pair into mysql and return the pk"""
      from sqlalchemy.dialects.mysql import insert
      from sqlalchemy.sql.expression import func

      # this val1-val2 pair should have UNIQUE KEY constraint in MySQL table.
      stmt = insert(MyModel.__table__).values(col1=val1, col2=val2)
      if kwargs:
          stmt = stmt.on_duplicate_key_update(kwargs)
      else:
          # get lastrowid https://stackoverflow.com/a/29722203/41948
          stmt = stmt.on_duplicate_key_update(id=func.LAST_INSERT_ID(MyModel.id))
      # inserted_primary_key (dbapi, return 0 when only insert) or lastrowid (mysql)
      pk = db.session().execute(stmt).lastrowid
      if not pk:
          pk = MyModel.query.options(load_only('id')).filter_by(
              col1=val1, col2=val2
          ).first().id
      return pk
</code></pre>
<p>Writing complex SQL is hard, sqlalchemy makes it harder. Prefer other ORMs in Python.</p>
<p>I really hate fighting the infamous sqlalchemy API. Everything wrong about it can be shown in this one-liner:</p>
<pre><code>  from sqlalchemy.orm import Load, load_only, joinedload
</code></pre>
<p>You have the three styles of CamelCase, under_score, and concatfunctionnames fucked up together. Bad and leaky abstraction.</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-06-29T11:55:13+08:00">2021-06-29</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/202106/stdout-007"  rel="bookmark" >
              <h2 class="card-title">古墓丽影9（Tomb Raider 2013）治3D眩晕必备FOV补丁+禁镜头晃动</h2>
            </a>
            <p class="card-text"><p>断断续续把<a href="https://steamcommunity.com/id/electronixtar/recommended/203160">买</a>的<a href="https://store.steampowered.com/app/203160/Tomb_Raider/">古墓丽影9</a>打完了。这款2013年的游戏放在今天看也很不错。</p>
<p>唯一的巨大问题就是3D头晕。网上找了一些办法。</p>
<h3>禁止镜头晃动</h3>
<p>虽然故事和镜头都很好，但是这晃动太烦人了，很容易头晕。值得庆幸的是 PC 平台可以彻底根治这问题。下载 <a href="https://community.pcgamingwiki.com/files/file/1166-tomb-raider-2013-yamatai-patch/">Yamatai Patch</a>。按图修改</p>
<p><img alt="" src="/images/2021/stdout-007-1.png" /></p>
<h3>增大 FOV</h3>
<p>这是多年的经验。头晕的主要问题就是视野太窄。</p>
<p>去下载 <a href="https://cheatengine.org/">Cheat Engine</a> 安装并打开，然后下载<a href="https://community.pcgamingwiki.com/files/file/1148-tomb-raider-2013-fov-cheat-table/">内存修改表</a>，按图修改。</p>
<p><img alt="" src="/images/2021/stdout-007-2.jpg" /></p>
<p>以上修改都需要有管理员权限并且保证游戏正在进行中。顺便说下 Yamatai patch 还可以治好 Lara Croft 胸部发育不良的毛病。好顶赞！</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-06-26T14:32:36+08:00">2021-06-26</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/202106/stdin-005"  rel="bookmark" >
              <h2 class="card-title">[zz]为什么古代汉族人不能在蒙古草原游牧？</h2>
            </a>
            <p class="card-text"><p><a href="https://www.zhihu.com/question/462005682/answer/1947378432">回答这个问题</a>（快照<a href="http://web.archive.org/web/20210621141823/https://www.zhihu.com/question/462005682/answer/1947378432">1</a>, <a href="https://archive.md/Wxq0C">2</a>）的是个蒙古族人 <em>那你说我该叫什么</em></p>
<blockquote>
<p>我就是蒙古族，我来说一下吧。<br />
理论上汉人可以游牧，没人管你是什么族的，可是入乡随俗，你来游牧肯定要住帐篷赶车放牧吧，这么一弄谁还知道你是哪个族的。<br />
所以没有汉人不能游牧一说，而是大部分时候你并不知道他是什么族的。但是确实有一个实际原因导致汉人无法游牧，或者说无法以汉人的身份游牧。<br />
那就是汉人没有自己的营盘点。<br />
什么叫营盘点，就是你扎营的位置。跟很多人想的不一样，古代时候的游牧不是真的“游”，而是半定居。太多人把游牧部落想的很原始，其实并不是这样的。<br />
蒙古包并不是简单的折叠帐篷，而是一堆木棍，一大堆皮接合而成的房屋。拆卸安装可能要个把小时，最后变成一个小房子。而且包群的外面还要做篱笆，防御工事，哨岗等，里面还要有粪坑，火种点，食物/燃料/羊毛储存点这些基本配置。防水防虫防火都要做好。而且冬季牧场，夏季牧场都分的很清楚，哪里冬天暖和，哪里夏天没有那么炎热。不出意外是不会出现一些答主说的冬天冻死几千只羊，全靠长生天保佑过活这种的。游牧部落不是野人，不可能扛着帐篷蒙着眼睛跑着养羊的，连最简单的RTS都不可能做的这么简单，现实怎么可能啊。要是这样搞游牧民族早就死光了。<br />
游牧部落的本质是一座沿着固定路线移动的城市。有商铺有店家，有政府，有匠人。区别只不过是房屋是可拆卸后放在牛车上拉走。<br />
也就是说，游牧其实是游到一个地方，扎下，呆几个月，换地方。<br />
而这么做的原因是，一片草原，草的数量是有限的，羊啃了几个月之后，可能一段时间长不起来，牲畜就不够吃了。这时候就要游，也就是去给羊找草。<br />
但是其实草原适合放牧的地方没多少，能放牧的地方必须靠近河流，没水你放什么牧。草原虽大，但是靠近水的地方也就那些。<br />
草原人祖祖辈辈早就把这些有水的地方摸清楚了。哪里草好，哪里草坏，哪里背风，哪里阴冷，哪里容易白毛风，哪里容易起蚊子，哪里靠近山脉容易躲风，哪里高不容易被水淹了等等，这些部落领导们早就知道了。<br />
不是很多人想的，游牧是没头苍蝇一样跑到哪算哪，那各族贸易怎么搞，结婚去哪找亲家去，订了婚第二天游走了怎么办，那些出去办事的牧民，打仗的士兵去哪找家去，回来家游走了么。<br />
实际上各族游牧路线，早就订好了，一个草原的这些大部落们会定期商议一下未来多长时间以内的游牧计划。<br />
确保三件事：<br />
1，那些啃过的地方，养养草，暂时别啃了，啃秃了就麻烦了。因为你啃的差不多养一养，次年就能长起来。你啃的太狠了可能两三年缓不过来。<br />
2，各部游牧地方错开，各干各的，别打架<br />
3，好地方归哪个部落（就是那些水源充足，阳光舒适，地形平坦等等等的地方），次地方归谁<br />
而如果谈不拢，那就要靠马刀解决问题了，war！war！war！<br />
不然草原各部天天在打什么，其实说穿了就两件事<br />
“凭啥你的草比我好？”<br />
“你为啥偷着啃我的草？”<br />
什么世仇，族仇，最后的根源都是这个，“<br />
那种没头苍蝇一样游的，要么是吃了败仗被打散的部民，要么是犯了错被撵出去的倒霉蛋，只能走的远点吃点别人不要的地，风险极高。<br />
因为这些地方都是没“探”过的，或者已经探过了确定就是烂地或者没水。你就想一下，一块地有水，它还没人去，它肯定有问题的啊。你去这些地方指不定把营扎在白毛风必经点上了，第二天就被扬了。要是你敢去偷别人的草吃，第二天就有二十个大汉拿着马刀弓箭追你。你也别打算趁着对面还没到或者走了偷啃，部落都会在将要去的营盘点和已经离开的点布置岗哨的，你敢啃就虽远必诛。<br />
因为草是牧民的命，你把人家部落的草啃了等于杀了人家。移动不是一件简单的事情，可能要提前一个月准备移动时候的粮食，草料，燃料等等，而且都是定额的。如果一个部落好不容易到了新草场，人困马乏的时候发现这地方被啃过了，那就大麻烦了，严重的全部落饥荒也有可能。而你经过的草场要是秃了会被所有部落一起声讨，估计那片明年还是你的。因为“本来应该一年长起来，你给啃秃了，你不去谁去？” <br />
就算你说不是你啃的你也说不清楚，你自己照看不了自己的草场本来就是问题。所以“偷着吃别人的草”是非常非常严重的越界行为，是绝对要动刀子的。<br />
然而实际上就算你谁也没招惹，依然有生命危险，因为没有部落给你撑腰，别人杀了你抢了你是无责任的。<br />
所以你也没有办法进行贸易，因为对面抢你永远比跟你做买卖来的便宜。你甚至要躲着人走，因为你不知道他会不会抢你。一个人流浪在草原上，你最好会自己制造一切东西，不然就要荒地求生了。<br />
所以你就懂了，在那时候的草原，有个“部落”很重要，没有部落的人不是在游牧，是在流浪，是在等死。没有一个大“家族”撑腰，你在草原上基本活不下去。<br />
那问题就来了，一个汉族人孤身到草原上语言不通，也没有自己的部落，要怎么活呢。如果再连规矩都不懂，游到别人的营盘上，那真是等着被剁了。。<br />
要是一个汉人真就在草原加入了某个部落，也站住了，还打出了名堂融入了集体，那一代人以后估计就改名换姓了游牧民族化了，你也看不出他是汉族后裔了。<br />
要是一群汉人流民跑到草原上，保留汉族文化，硬创建一个汉族部落，站住了。。。。。。@@这事听起来太像小说了，我觉得不大可能。。。。。。，得各部承认你，你才是个部落。不然你就是没部落的。就你这个人口，那些草原部落就得惦记着。要是再有些个女人，能抢疯了，反正没人在意多纳几个妾吧。男的可以抓来，瘦弱的当奴隶，强壮的做部民。要是你有军人背景，身强力壮，弓马娴熟，刀枪功夫也不错，还会给你配个女人。毕竟人口可是很重要的，军事人才更是宝贝。<br />
（草原奴隶跟其他的农耕民族的奴隶不是一个东西。草原奴隶其实类似内地的佃户。可以依靠自己意愿结婚生子，可以有自己的包。只不过所放养的马群羊群不是他的，而是他的主人家的。他的主人定期给他工钱。不犯错的情况下，就算是主人也没资格任意惩罚他们。所以在那个年代的草原当“奴隶”并不是那么惨的事情，基本等于打工人。成吉思汗的开国四杰中就有两位奴隶出身的。木华黎和赤拉温）<br />
其实都可能不需要抢，游牧部落去南下的时候都会有意的带走人口的。更别是这种流民了，直接就收编了。而且你作为流民，你肯定是穷的只剩命了对吧，甚至抢你都没啥可抢的，那你是缺衣少食在草原上荒野求生好，还是加入一个游牧部落好呢，哪怕开始可能因为各种原因受点气，这很明显对吧，傻子才不加入呢。一边需要人口一边需要资源，各取所需合并了不是很简单。<br />
你要是说一群兵强马壮，自保能力MAX，有军事素养的汉人来游牧。。。。。。这些人在古代内地起码是个军爷吧，来草原干啥，吃饱了撑的么，你们怕不是来远征的吧( ˙˘˙ )</p>
</blockquote>
<p>配合这篇《<a href="https://blog.est.im/202011/stdin-016">牦牛为什么「要价」这么贵</a>》更能理解 eurasia steppe 上的经济形态。</p>
<p>摘录几条评论：</p>
<blockquote>
<p>谜之美食家谜之美食家 <code>2021-06-21 08:24</code> 看到抢草场那里，感觉和福建古时候抢水源田地差不多了，谈不拢就要械斗了。<br />
松鼠对打仓鼠昨天 <code>2021-06-21 09:21</code> 还有个误解，古代游牧可以天天吃肉喝牛奶[惊喜]<br />
那你说我该叫什么 (作者) 回复松鼠对打仓鼠 <code>2021-06-21 09:23</code> 理论上奶可以喝，不过是羊奶，那时候没人喝牛奶，牛奶要给小牛喝，牛是最金贵的牲畜，没有牛拉车整个部落都走不动了，可以没有马不能没有牛。羊是一切东西的生产者，牛是部落还能动的保证，其次才是马。先要保证前两个，不饿死，能动，然后才有战争需求需要养大量的马匹。连资源都没有，马匹就是负担，因为这玩意不能给你提供资源。<br />
那你说我该叫什么 (作者) 回复 我已不会飞 <code>2021-06-21 11:34</code> 是的[doge]，游牧唯一的好处应该就是剥削手段比较少，底层人民相对而言被压迫的不严重。因为一个可以随时骑马走的地方，你压迫严重了人家全跑了，你的部落散了你也完了，所以部落贵族一般起码要保证下面的人的温饱。也就这点好处，但是没啥上限，年年半饥半饱[doge]<br />
那你说我该叫什么 (作者) 回复我已不会飞 <code>2021-06-21 11:39</code> 而且古代游牧的话，其实放羊确实轻松，有狗帮忙不用怕狼。如果有人来抢羊你回去报告就行了，不用你上去给对面好多人拼命。其实累的是后面的：1. 捡羊粪（燃料），剪羊毛（衣服），挤羊奶（饮品），杀羊（肉食，油），给羊接生（产新羊）。2. 以及再后面的制作干酪，做衣服等等。 3. 还有营盘挖坑，建造工事。因为移动起来不能开工，所以必须要加班加点搞，一年都很忙。跟很多人想的寂寞不一样，那年头蒙古人忙死了哪来的时间寂寞[doge]</p>
</blockquote>
<p>又让我想起了前几天看的<a href="https://blog.est.im/202106/stderr-005">大猩猩种田节目</a>。看来养羊是很关键的东西啊。</p>
<p>至于 eurasia steppe 上究竟有多适合放牧，有个老贴《<a href="https://www.zhihu.com/question/34856776/answer/1048893096">怎么有效地区分和理顺历史上中国北方的各游牧民族，他们互相之间有什么关联？</a>》(快照<a href="http://web.archive.org/web/20210621141544/https://www.zhihu.com/question/34856776/answer/1048893096">1</a>, <a href="https://archive.md/ftAtP">2</a>)有几个图记个大概很有用的。</p>
<p>按照最上面答主的说法，营盘地"必须靠近河流，没水你放什么牧。草原虽大，但是靠近水的地方也就那些"。那么有了第一张图：</p>
<p><img alt="" src="/images/2021/stdin-005-1.jpg" /></p>
<p>可见放牧的地方就是贝加尔湖延伸出来的各个水系。</p>
<p>然后最直接的震撼是到欧洲距离其实没想象那么远。游着游着说不定就到了。</p>
<p><img alt="" src="/images/2021/stdin-005-2.jpg" /></p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-06-21T21:54:52+08:00">2021-06-21</time></p>
<p>stdin</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/202106/stderr-006"  rel="bookmark" >
              <h2 class="card-title">自由意志</h2>
            </a>
            <p class="card-text"><p>人有自由意志吗？今天听<a href="http://www.geekonomics10000.com">刚哥</a> 说Robert Sapolsky 的书 <em><a href="https://book.douban.com/subject/26997370/">Behave</a></em>。书中说到：</p>
<blockquote>
<p>1980 年代，神经生理学家本杰明·李贝特（Benjamin Libet）做了一个被传诵至今的经典实验。实验中受试者要做一个简单的动作，比如选择打开还是关上一个开关。科学家使用核磁共振同时观察大脑的活动，发现在受试者意识到自己选择怎么做的几百毫秒甚至几秒之前，他的大脑其实已经做出了选择。</p>
<p>这个实验似乎证明了人没有自由意志，你的意识只是听大脑的。但是萨波斯基介绍，李贝特本人对这个现象有个更高级的说法。李贝特说，是，你没有决定往哪边按下开关的自由意志 —— 但是，当你的大脑已经做出选择之后，到你切实按下开关之前的那半秒钟之内，你的意识可以决定不按那个开关。你有最后一刻的否决权。<br />
对我来说这是非常惊人的知识，这叫“自由非意志（Free Won't）”。这是一个充满争议的解释，有很多实验研究，有的同意有的反对。<br />
但不论如何，我们姑且认为人真的有否决权，那我们要问的是，这个否决权，又是啥东西呢？那个否决权只可能是生物因素，而你不能说因为现在脑神经科学家还没有达成共识，所以人还是有自由意志的。萨波斯基承认，脑神经科学仍然在发展之中，我们并不能完全解释人的所有行为。</p>
</blockquote>
<p>挺有意思的观点。也就是说，意志恐怕不是自由的，意志还是由生命本能驱动的，但是 veto 的权力却是大脑皮质层自由裁定的？</p>
<p>先倒回去，仔细看下 <a href="https://en.wikipedia.org/wiki/Neuroscience_of_free_will#Libet_experiment">Benjamin Libet 的这个实验</a>，感觉有点 bug。他让受试者戴上 EEG 记录脑电波，然后把手自由放在桌上。你可能想时不时动一下手的位置，但是你发起动作的时候，要盯一下旁边一个秒针指的数字记录下来。然后对比 EEG 的脑波看差了多少。</p>
<p>结果是，受试者的秒针读数都比 EGG 记录的晚了 2000ms 多。。。。我在 <a href="https://www.youtube.com/watch?v=IQ4nwTTmcgs">youtube 上看到个电脑屏幕显示秒针+自由敲键盘</a> 的版本，计时更精确，结论也差不多。这个实验很著名，得到多次验证和重现。甚至有些能提前7秒预测A/B你要选哪一个。</p>
<p><img alt="" src="/images/2021/stderr-005-1.png" /></p>
<p>我怎么感觉是动一下手去看时间，需要一个下决心这过程导致的？正如电极展示的那样，人做决定有一个 build up 逐渐升高的过程。</p>
<p>简单的说，我的理解，人比如要自由意志动一根指头，可能分为100+种因素，比如你手是不是麻了，你鼻子还是脸痒了想怎么摸一下，你习惯先动哪跟指头，你是不是呼吸不畅想先侧个身而不是动一下手等等。这些100+个因素随时都在发生和变化，但是真正导致动手的可能是这几个因素全部刚好都叠加在最佳的状态。</p>
<p><strong>自由意志不是一个瞬间决定！瞬间决定不自由！</strong></p>
<p>所以你的大脑活动在潜意识，提前就开始各种 build up ，最后关头恰好决定了你要动一下手指头了，然后才传导到皮质层，给你动一下手指完成一个合理的理由编造，然后你才去调动神经指挥肌肉真正发动。</p>
<p>当然这个时候皮质层也有否定权，比如最后时刻放弃了。</p>
<p>** 就如同早上什么时候起床一样，有太多因素导致某一时刻就能起来，其他的时刻就差那么一丁点但是始终不能起来。**</p>
<p>查了下，2010年 <a href="https://www.theatlantic.com/health/archive/2019/09/free-will-bereitschaftspotential/597736/">Schurger 和他的同事针对大脑准备电位提出了一个解释</a>（<a href="https://www.huxiu.com/article/320845.html">中译版</a>）：</p>
<blockquote>
<p>我们在做出任何类型的决定之前，神经元要为各个选项搜集证据，证据来自外部感官。假如某组神经元积累了足够多的证据，越过一个阈值之后，大脑就会做出决定。大脑准备电位其实就是大脑神经活动涨落时的涨潮部分，只是之后正巧对应着一个决定而已</p>
</blockquote>
<p>和俺猜的一模一样。哈哈。但更有意思的是，Schurger并没有解决自由意志的问题，反而加深了这个问题的难度：</p>
<blockquote>
<p>如果我们所有的行为都是被外部环境和内部神经细胞所建立的完整因果链所决定的，那么这不就反而说明我们没有自由意志了吗？「自由」到底意味着什么？ <a href="https://www.zhihu.com/question/376235382/answer/1062884972">Sithferia</a></p>
</blockquote>
<p>btw Libet 还做过皮肤痛觉实验，发现人感受到痛觉的时刻要早于痛觉信号传输到大脑的时刻，这？？？？</p>
<p>又想起 <em>Behave</em> 这本书前面一个章节讲人的选择，很多时候是收到先前潜意识的影响。比如</p>
<blockquote>
<p>如果你跟人聊天的时候坐的那把椅子很“硬”，你会更倾向于判断对方的态度“缺乏弹性”。如果你手里拿着一杯“冰”水，你会觉得对方的态度也很“冷淡”。<br />
而反过来，如果你阅读小说的时候喝的是“热”咖啡，你对书中人物性格的评价也会偏向于“温暖”。</p>
</blockquote>
<p>所以你是否按下一个按钮，选择红药丸还是蓝药丸，很有可能就是之前环境在干扰你。这又让我想起了《盗梦空间》里，富商斋藤为了不让竞争对手的儿子 Fischer 继承公司财产，植入一个 Fischer 他爸临终那句名言“I was disappointed that you tried” 哈哈。</p>
<p>不过这也证实了我之前一个猜想。<a href="https://blog.est.im/201910/stdout-006">我之前是一个机械唯物主义者</a>，认为只要知道初始条件就能预测未来。后来我知道了海森堡测不准，你要么能知道粒子的初始速度，要么你知道粒子的位置，但是你不能两者同时知道；后来又知道了混沌理论，有些东西你无法求的解析解（解析的作用是，知道它一些结构性质比如对称，这样可以对半简化模型），只能用迭代法（比如有限元）无穷去逼近；一只蝴蝶翅膀能带来一场风暴，但是谁也说不准，因为预测的计算量太大，你甚至赶不上事物变化的速度和复杂程度。所以即便可以预测，也是徒劳的。更后来知道了 NP-P，有些事情即便你能计算和预测，但是你永远不知道你计算对没有。因为验算或许比计算还麻烦。</p>
<p>所以自由意志是什么呢？我觉得自由意志就是一个神经网络去拟合一个混沌系统。它有部分可能不太准的可预测性。但是微扰因素会让你的预测在很多时候和结果大相径庭。人的某些自由意志受条件限制可以大范围剪枝被预测，但是说不定一念之差就变成完全相反的结果。</p>
<p>可以测，但是你测不准，甚至你不知道你是否测准(false positive)了。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-06-19T00:13:16+08:00">2021-06-19</time></p>
<p>stderr</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/202106/stderr-005"  rel="bookmark" >
              <h2 class="card-title">Clarkson's Farm 观后感</h2>
            </a>
            <p class="card-text"><p><a href="https://www.imdb.com/title/tt10541088/"><em>Clarkson's Farm</em></a> 居然是我对现代机械化农业入门的第一个的片子。乱写一些</p>
<ol>
<li>兰博基尼的拖拉机(Lamborghini R8 270 DCR)真是 nb。40个前进档，40个后退档。不过 clarkson 好像买的二手4w刀</li>
<li>第一集没太明白，为啥必须一定先耕地再播种？直接雇佣另外一个人跟着耕过的地马上播种不就行了么</li>
<li>下雨的时候应该也能耕地吧。国内很多种水稻的田都是蓄水后再耕地。据长辈们说比旱地更容易。可能是怕拖拉机陷进泥浆？</li>
<li>拖拉机耕田弯弯曲曲的问题，应该可以通过LIDAR +　SLAM 解决？四轴无人机来个小区域精确导航？</li>
<li>那个 S 形状来回耕田的确不好调头，但是为什么不走 回 字形状画圆圈呢？</li>
<li>无人驾驶拖拉机耕田是不是下一个趋势？</li>
<li>那个公羊的 ball 是真的大！平均30-40cm 我日</li>
<li>把母羊搞怀孕还打个标记。。。这脑洞发明啊。。</li>
<li>那个很辣很贵的 wasabi，查了下，本来是 山葵，被误翻译成 芥末 了。。。</li>
<li>感觉如果有一个 app 能够根据输入的参数，预估完成剩下的任务所需要的时间和最优解就好了。。特别是需要根据不规则面积做计算的</li>
<li>农业真是看天吃饭。土豆收上来说变质就变质。。。</li>
<li>原来 lamb 生下来，公的就要被阉割。。防止近亲繁殖。。。我日。。。</li>
<li>羊子产双胞胎真多啊。而且要做个表格跟踪生产情况防止抱错了或者母羊攻击别人的小羊。真复杂啊。</li>
<li>喷雾那个农机，两侧臂展各12米。所以要在播种的时候提前规划它的行经路径。参考第四条。</li>
<li>装鸡蛋那个盒子 egg box，整个欧盟只有3个地方生产，Covid-19 给关停了俩。。。</li>
<li>读了一下访谈《<a href="https://www.bilibili.com/read/cv7081554">猩车评：兰博基尼拖拉机</a>》：我也很不擅长“条播”。这就是我们这帮农民用来指代“种植”的高级词汇。为啥说高级呢，因为要想正确操作，你必须装上那种NASA用来计算重返大气层角度的精确电脑。而这则是另一项我不会的农活了：计算机编程。这也就是为什么我的犁痕有些相距10英尺，而有些能歪到约克郡去。</li>
<li>第一次见把康拜因拍摄得这么有美感的片子！我也觉得这玩意简直是魔法。。。。因为我真的见过手工收割油茶籽有多麻烦。</li>
<li>看来现代农业，退税和补贴是重要的一环。没这个很多农场直接破产。还有那个填补贴申报要自己查农作物对应的 code 太神了。。人肉数据字典啊这。。</li>
</ol>
<p>2021-06-28 增加：</p>
<ol start="19">
<li>Kaleb 是 farming contractor，我觉得翻译成汉语，就是「佃农」。古代货币经济不发达，只能通过把产出作为交地租。</li>
</ol>
<p>总的来说这部片子拍得太棒了。强烈建议观看。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-06-14T08:31:17+08:00">2021-06-14</time></p>
<p>stderr</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/202106/stdout-006"  rel="bookmark" >
              <h2 class="card-title">行车记录仪视频ffmpeg合并转录存档，跳过重复的漏秒</h2>
            </a>
            <p class="card-text"><p>手上有几个行车记录仪</p>
<ul>
<li>VOSONIC 勤宇V10，也叫群华 路不平，用的 联咏 Novatek NT96550BG 的芯片，1080p</li>
<li>BLACKVIEW 凌度A12，采用 安霸(Ambarella) A12 方案，2k</li>
<li>PAPAGO 趴趴狗，GoSafe 560WiFi，采用 NT96670 芯片+IMX415的 sony CMOS，4k</li>
</ul>
<p>特点是每5分钟切割成一个单独的文件，为了防止每两个视频之间漏秒，所以会额外重复写入1秒的内容</p>
<p>现在想把一段时间的视频合并成一个存档，并且要<a href="https://www.v2ex.com/t/248037">跳过那些额外的1秒</a>，上 ffmpeg。</p>
<p>首先前摇，生成需要合并的视频文件路径列表</p>
<p><code>ls -fd1 /Volumes/SD_CARD/DCIM/xxxxx/*</code> </p>
<p>的结果写成如下格式：</p>
<pre><code>  file 'input1.mov'
  inpoint 10
  outpoint 300
  file 'input2.mov'
  # comment
  outpoint 300 
  file 'input3.mov'
  outpoint 300
  ... 
  file 'inputN.mov'
  outpoint 300
</code></pre>
<p><code>inpoint 10</code> 就是从10秒开始算，<code>outpoint 300</code> 就是到300秒结束。保存上面的为 1.txt</p>
<p>然后念 ffmpeg 咒语</p>
<p><code>ffmpeg -hwaccel cuda -hwaccel_output_format cuda -safe 0 -r 48  -f concat -i 1.txt -an -vf "select=concatdec_select,scale_cuda=w=1280:h=720:interp_algo=lanczos,setpts=0.125*PTS" -c:v h264_nvenc -preset:v p7 -profile:v high -tune:v hq -cq:v 19 -qmax 22 -b:v 0 -maxrate 8M -rc vbr out.mp4</code></p>
<p>逐个解释下：</p>
<ul>
<li><code>-hwaccel cuda</code> 用nVIDIA的 H.264 解码器硬件加速解码行车记录仪的原始 .MOV 文件。如果没显卡有 Intel 处理器可以 把 cuda 换成 qsv 也有加速效果。也可以换成 cuvid 但是速度更慢</li>
<li><code>-hwaccel_output_format cuda</code> 生成  out.mp4 的时候也采用 nVIDIA 显卡H.264编码器加速。这里如果和上面都是 <code>cuda</code> 那么直接显存对拷，避免了内存和 PCI 拷贝速率瓶颈。</li>
<li><code>-safe 0</code> 允许读写外部文件</li>
<li><code>-r 48</code>  和后面的 <code>setpts=0.125*PTS</code>  一起，把帧率提高到 48fps ，把回放速度提高 8倍。方便存档。不需要的可以去掉</li>
<li><code>-f concat</code>  和 <code>select=concatdec_select</code> 就是通过前摇的 <code>1.txt</code> 指定合并哪些文件（并且去掉时间起止点之外的）</li>
<li><code>-an</code> 丢掉音轨。如果保留的话应该是 <code>-v:a copy</code></li>
<li><code>-vf</code> 后面指定一系列巨复杂的ffmpeg滤镜操作。</li>
<li><code>scale_cuda=w=1280:h=720:interp_algo=lanczos</code>，用显卡 CUDA 操作缩放操作。lanczos是一种 downsampling 算法让画面更加平滑。如果你自己编译的还可以把 scale_cuda 换成 scale_npp 进一步提速。</li>
<li>如果没有独显换成软缩放 <code>-vf "select=concatdec_select,scale=1280x720,setsar=1,setpts=0.125*PTS" -sws_flags lanczos</code></li>
<li><code>-c:v h264_nvenc</code> 视频压缩引擎：nVIDIA 的 H.264 编码器。如果没有独显可以改成 libx264</li>
<li><code>-preset:v p7</code> 这里代替之前的 slow fast 等选项。参考 <a href="https://docs.nvidia.com/video-technologies/video-codec-sdk/nvenc-preset-migration-guide/">HEVC Preset Migration</a></li>
<li><code>-profile:v high</code> 如果你要兼容初代 iPad 等古董设备就只能用 <code>main</code></li>
<li><code>-tune:v hq</code> 面向画质优化（而不是码率或者延时）</li>
<li><code>-cq:v 19</code> 画质非常接近无损的。但是体积也变大。一般22中等配置不能再大了。H.265 可以设置成 26。如果是 <code>libx264</code> 改成 <code>-crf 19</code> 指定</li>
<li><code>-qmax 22</code> 上面的值最大为 22</li>
<li><code>-b:v 0</code> 取消码率指定</li>
<li><code>-maxrate 8M</code> 最高码率 8Mbps</li>
<li><code>-rc vbr</code> 可变码率。注意 vbr_hq 之类的已经不在支持了。</li>
</ul>
<p>还有一些坑点：</p>
<ul>
<li>2k@60fps的分辨率需要指定 <code>-level 51</code>。因为默认的 <a href="https://en.wikipedia.org/wiki/Advanced_Video_Coding#Levels">H.264 级别</a>太低frame size支持不了。。。</li>
<li>如果不缩放原始尺寸压制，很有可能会出错 No decoder surfaces left. Error while decoding stream #0:0: Invalid data found when processing input。这是 <a href="https://trac.ffmpeg.org/ticket/7562">ffmpeg 4.1 以后的 bug</a> 解决方案是 <code>-extra_hw_frames 2</code> 或者更大。但是 CUDA 最多支持32所以估计会报错，就只能 CPU 负责解码 GPU 负责编码。</li>
<li>压制的时候发现 TF 卡或者是读卡器20M/s是瓶颈。拷到本地发现 GPU decoder 是100%，encoder只有30%左右。</li>
<li>2k分辨率20Mbps码率30fps的原始视频占用体积太大，1080p 16Mbps码率效果比 720p 8Mbps好不了多少。最后选择的是8M码率。在超快移动的时候有色块，其他堵车的时候画质很高。识别车牌几乎不受影响</li>
</ul>
<p>总的来说，ffmpeg 真是操作糟糕而功能强大的工具的典型。以上参数为东拼西凑撞大运偶得，如有不对敬请指正。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-06-05T20:42:15+08:00">2021-06-05</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/202105/stdin-004"  rel="bookmark" >
              <h2 class="card-title">Sandy Munro 看不懂 美的Midea 的注塑工艺</h2>
            </a>
            <p class="card-text"><p>看了好多 Tesla 的拆车视频，对 Youtube 上这个 <a href="https://www.youtube.com/c/MunroLive/videos">Sandy Munro 老爷子</a>还是挺有好感的。查了下</p>
<blockquote>
<p>桑迪·蒙罗（Sandy Munro）是一个汽车工程师，专门研究机床和制造，在加拿大安大略省的温莎出生长大，后来加入了Valiant Machine＆Tool公司，这个公司主要为通用汽车提供配套，1978年加入福特公司，成为制造工程师，改进了发动机组装方法，1988年在密歇根州开办了自己的咨询公司。</p>
</blockquote>
<p>搜到他一个讨论电动车的视频，比较有意思</p>
<p><a href="https://youtu.be/MrvvVSwEgmE?t=1411">https://youtu.be/MrvvVSwEgmE?t=1411</a></p>
<blockquote>
<p>It's not China cheap anymore, that's for sure. And then when it comes to tooling oh my god, they make some plastic injection molded parts that I have no clue how they how they uh how they made them at all, none.<br />
I don't know how they could crank out a mold that that would have that many motions to to make all these things happen, and that's that was my trade. They they basically learned and then eclipsed most of what's going on here in the U.S, yeah so it's a big change, a huge change</p>
</blockquote>
<p>美的啥时候这么猛了？</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-05-25T15:46:14+08:00">2021-05-25</time></p>
<p>stdin</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/202105/stdin-003"  rel="bookmark" >
              <h2 class="card-title">金朝汉化不成功，很大程度上也是一个“建国神话”范式</h2>
            </a>
            <p class="card-text"><p>下面内容转载自 <a href="https://www.zhihu.com/pin/1380452379582644224">zhihu/叶思泰</a></p>
<blockquote>
<p>最近打算写一个暴论：金朝汉化不成功，很大程度上也是一个“建国神话”范式。<br />
很多强盛的少数民族王朝都会有这种问题：开国一代人确实武功赫赫，打下了，好大一片积液，但是子孙后代往往被这样伟大的建国神话所迷惑，将一切原因归功于本民族的独特风俗习惯，而忽略了开国一代的艰辛睿智。<br />
金朝上下就普遍存在着这样一种认识：太祖太宗两朝吞辽灭宋武力强盛，那是因为当时的女真人风俗质朴，所以只要勒令女真人保持建国时期的风俗，就能保持军队的战斗力。<br />
这种刻舟求剑的建国神话痴迷和太平洋岛国土著的船货崇拜没区别，如果这些人真的细究一下本国的建国历史，就会意识到：耶律阿保机的契丹和孙万荣的契丹是完全不一致的，完颜阿骨打时代的女真和完颜函普时代也大相径庭，李元昊时代的党项和拓跋思恭相比也有本质的进步——他们开创的辉煌基业，正是在变化的基础上实现的，后世却刻舟求剑的将原因都归结于具体的一个个风俗上。<br />
金人为了维持女真旧俗费了很大的功夫，猛安谋克户实行父子相聚而耕的原始村社，还屡次商议重新均贫富平分地产。直接结果就是落后的生产关系导致军户经营极差，根本竞争不过周围的汉族农民，国家屡次拘刷良田供给他们，大大激化了金朝的民族矛盾。<br />
再就是对建国神话的痴迷导致了对女真人武力的过度想象，即使在金末时期，也妄想建立“北族超人军队”，继续实行汉族耕田供给女真人打仗的愚蠢制度。<br />
联想到前些年某些地方不思政务，完全忘却了为人民服务的宗旨，整天举办重走某某路、唱某某歌的活动，以为这就能天下倾心，万姓拥护，这就能不忘初心，继续奋斗了，所作所为，可付之一笑。</p>
</blockquote>
<p>想起之前 <a href="/post/80234879432">Steve Jobs 一段话</a>：</p>
<blockquote>
<p>公司规模扩大之后，就会变得因循守旧，他们觉得只要遵守流程，就能奇迹般地继续成功，于是开始推行严格的流程制度，很快员工就把遵守流程和纪律当作工作本身。</p>
</blockquote>
<p>所以人到中年，为什么会去追求所谓的「稳定」呢？或许这只是追求一个「流程」。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-05-25T10:53:19+08:00">2021-05-25</time></p>
<p>stdin</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/202105/stderr-004"  rel="bookmark" >
              <h2 class="card-title">育儿心得：语音日记(a-log)</h2>
            </a>
            <p class="card-text"><p>娃越来越大，作为家长就不可避免的内心越来越卷。老师要求的繁杂的作业，搜集好句好文，我看来是非常吃力和浪费时间的。因为小孩的书写速度太慢了。而且年纪很低，很多词汇还不会，只能用蹩脚的拼音代替。个人观点是小学3年级以前超过10分钟的书写劳动都是一种煎熬而不是提高。</p>
<p>今天突然灵机一动，想到了语音日记。就拿着 MIUI 手机实践了一下：</p>
<p><img alt="audio log" src="/images/2021/stderr-004-1.jpg" /></p>
<p>上面的文本是 MIUI Notes 的识别结果，准确率不高，但是看个大概意思没问题。语音日记的好处很多：</p>
<ol>
<li>说话比写字快得多，词汇也大得多。</li>
<li>可以思考好了一口气说出来。写字更容易思绪被干扰或者打断</li>
<li>不会出现写错了反复擦除修改浪费时间</li>
<li>可以家长现场纠正，马上改进</li>
<li>因为手机笔记软件和语音识别技术的成熟，可以立刻看到实时语音转文本结果。回顾遣词造句水平和段落结构</li>
<li>练习标准普通话发音才能让 app 更好识别语音</li>
<li>可以训口头表达能力，语句连贯性。</li>
</ol>
<p>想起来现在很多 Interweb celeb 都喜欢做 vlog 来发泄，但是小学生通过audio log，a-log 进行20分钟的语音日记，说不定效果不错。</p>
<p>准备坚持一下。说不定找个地方记录一下，作为成长的轨迹。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-05-10T22:01:21+08:00">2021-05-10</time></p>
<p>stderr</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/202104/stdout-005"  rel="bookmark" >
              <h2 class="card-title">Win10 自动设置开机锁屏壁纸</h2>
            </a>
            <p class="card-text"><p>Win10启动后，锁屏界面有一些每天更新的漂亮的墙纸，但是每个用户进去却只能看到默认的墙纸，不能自动切换。很是遗憾，于是搞了一段小脚本弥补。</p>
<p>找个地方比如桌面，右键新建一个 <code>est_win10_auto_wallpaper.bat</code></p>
<pre><code>  @if (@X)==(@Y) @end /* JScript comment
  @echo off

  cscript //E:JScript %~n0.bat

  exit /b %errorlevel%
  */

  var oShell = new ActiveXObject("WScript.Shell") ;
  var oFSO = new ActiveXObject("Scripting.FileSystemObject");

  var sWinDir = oFSO.GetSpecialFolder(0);
  var sPath = oShell.ExpandEnvironmentStrings('%LOCALAPPDATA%\\Packages\\Microsoft.Windows.ContentDeliveryManager_cw5n1h2txyewy\\LocalState\\Assets\\')

  var oFolderEnum = new Enumerator(oFSO.GetFolder(sPath).Files);
  var aFiles = []
  for (;!oFolderEnum.atEnd();oFolderEnum.moveNext()) {
      // var item = oFolderEnum.item()
      aFiles.push(oFolderEnum.item())
  }
  var aFiles2 = aFiles.sort(function(x,y){return new Date(y.DateLastAccessed).getTime() - new Date(x.DateLastAccessed).getTime()}).slice(3)
  var sWallpaper;
  // for (var i=0;i&lt;aFiles2.length;i++){
  for (var i in aFiles2){
      // WScript.Echo('check ' + aFiles2[i].name + ' size: ' + aFiles2[i].size);
      if(aFiles2[i].size &gt; 500000){  // guess &gt; 500KB is good wallpaper
          sWallpaper = aFiles2[i].path
          break;
      }    
  }
  if(sWallpaper){
      // or fso.GetStandardStream(1) for stdout, 2 for stderr
      // WScript.Echo('set to ' + sWallpaper);
      oShell.RegWrite("HKCU\\Control Panel\\Desktop\\Wallpaper", sWallpaper);
      oShell.Run("%windir%\\System32\\RUNDLL32.EXE user32.dll,UpdatePerUserSystemParameters 1, True");
  }
</code></pre>
<p>Win+R输入 <code>shell:startup</code> 回车，把刚才的 <code>est_win10_auto_wallpaper.bat</code> 在这里创建一个快捷方式</p>
<p>解释下为啥要在 <code>shell:startup</code> 里创建快捷方式而不是直接放 .bat 。因为快捷方式可以设置当前运行目录，这样代码里的 <code>%~n0</code> 才能生效。懒得查询完整路径如何写了。。</p>
<p>然后这段代码其实用了一个比较高级的 <a href="https://stackoverflow.com/a/28250760/41948">.js .bat 混合格式</a>。因为 Windows Smart Screen 会拦截 WScript 的直接执行，认为特别危险。但是如果你在 cmd 里执行系统就觉得很安全。。。。嗯。。</p>
<p>吐槽1： 开始 → 启动 菜单都不见了。。。</p>
<p>吐槽2：好久没写 WScript 了感觉都忘完了。vbs 是肯定不会的了。<a href="https://docs.microsoft.com/en-us/previous-versions//hbxc2t98(v=vs.85)?redirectedfrom=MSDN">JScript 居然是 ESMAScript3</a>。好多现代写法都不支持。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-04-11T22:35:12+08:00">2021-04-11</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/202104/stdout-004"  rel="bookmark" >
              <h2 class="card-title">Mac 命令行终端里获得视频文件的长度</h2>
            </a>
            <p class="card-text"><p>记录一下，Mac OS X 10.6.8 或更高版本：</p>
<pre><code>  mdls -name kMDItemDurationSeconds -name kMDItemFSName  1.mp4
</code></pre>
<p>这命令有一个很神经病的一点，同一个 .mp4 文件，获取只读的 TF 卡上的就没法获得视频长度，复制到可以读写的本地硬盘上就可以读出来。</p>
<p>或者在 Finder 里新建一个叫  <code>Movies</code> 的文件夹，把视频文件放进去，然后列表展示，表头右键，就可以选择显示长度。。</p>
<p>同理，建立一个叫  <code>Pictures</code> 的文件夹，可以列表展示图片尺寸。。</p>
<p>来自 <a href="https://superuser.com/questions/1024894/">superuser</a> 。真是神一般的设定。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-04-04T12:01:30+08:00">2021-04-04</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/202103/stdout-003"  rel="bookmark" >
              <h2 class="card-title">FastAPI/Starlette+Requests实现反向代理</h2>
            </a>
            <p class="card-text"><p>因为某些拉垮的业务需要，不得不在代码里去反向代理别的 HTTP API</p>
<p>一般格式如下：</p>
<pre><code>  @app.get('/other/{other_path:path}')
  @app.post('/other/{other_path:path}')
  async def other_api(other_path: str, req: Request):
      """透传 API"""
      host = 'http://example.intranet'
      url = '{}/other/{}'.format(host, other_path)
      body = bytes(await req.body()) or None
      r = requests.request(
          req.method, url,
          headers={
              'Cookie': req.headers.get('cookie') or '',
              'Content-Type': req.headers.get('Content-Type')},
          params=req.query_params, data=body, stream=True,
          allow_redirects=False)

      h = dict(r.headers)
      h.pop('Content-Length', None)
      return StreamingResponse(r.raw, headers=h, status_code=r.status_code)
</code></pre>
<p>解释一下为啥要这么写：</p>
<ol>
<li>采用 <code>stream=True</code> + <code>StreamingResponse</code>，防止上游给你返回一个GB体量的文件把 FastAPI 进程内存撑爆</li>
<li>只摘取浏览器的 <code>Cookie</code> + <code>Content-Type</code> 两个头。别的不给上游。</li>
<li>要去掉返回的 Content-Length 头。因为 StreamingResponse 会自己定义返回长度。</li>
</ol>
<p>这样写基本能跑起来了，但是有2个问题：</p>
<ol>
<li>如果上游返回一个 302/303/307 的跳转，那么很有可能把内网的跳转网址直接返回给浏览器了。因为 <a href="https://tools.ietf.org/html/rfc2616#section-14.30">HTTP/1.1 的标准 RFC2616</a> 强制规定，<code>Location</code> 的值必须是一个绝对网址。所以这个时候就冒犯一下这个规定，强行截断：<pre><code>    loc = h.pop('Location', '')
    if loc.startswith(host):
        h['Location'] = loc[len(host):]
</code></pre>
</li>
</ol>
<p>注意这里不要用 <code>.lstrip()</code> 。这方法和你想象的完全不是一回事。它是基于单个字符的挨个替换而不是整个字符串。<br />
2. 实测这种在业务代码实现的「软」反向代理性能堪忧。上游4s左右的整个页面加载时间，反向代理之后就变成了 120s 左右。盲猜是 <code>StreamingResponse</code> 是一个字节一个字节去遍历迭代器？实测并不是。主要的锅还是 <code>Requests</code> 的 <code>.raw</code> 是按照 <code>chunked</code> 一段一段返回的。最好还是准备个 4KB 的 buffer，提高性能。解决方案是把  <code>r.raw</code> 改成 <code>r.raw.stream(4096000)</code> 性能一下就高了。注意这里不要用官方文档提供的 <code>.iter_contents()</code> 或者 <code>.iter_lines()</code> 这两者又会自作聪明的去解析文本编码或者换行符，降低了性能。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-03-30T15:07:01+08:00">2021-03-30</time></p>
<p>stdout</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/202103/stderr-003"  rel="bookmark" >
              <h2 class="card-title">纪念 Sewall Wright</h2>
            </a>
            <p class="card-text"><p>在这个3月即将结束的特殊日子里，纪念 Sewall Wright。尤其是那石破天惊的从相关性反推因果性的豚鼠花色实验。</p>
<p>豚鼠的花色，按照我们一般的理解是遗传的。但是两只豚鼠很多代近亲繁殖也不可能生产出纯色的豚鼠。那花色和遗传的因果性能通过相关性推出吗？</p>
<p>这位大神还真推断出来了</p>
<p><img alt="Sewall Wright first path diagram guinea pigs" src="/images/2021/stderr-003-1.jpg" /></p>
<p>插图来自最近听的一本书 <em>The Book of Why: The New Science of Cause and Effect</em> 第二章 From Buccaneers to Guinea Pigs: The Genesis of Causal Inference 。网上有 pdf 直接看：</p>
<p><a href="http://bayes.cs.ucla.edu/WHY/why-ch2.pdf">http://bayes.cs.ucla.edu/WHY/why-ch2.pdf</a></p>
<p>要知道他做出这个研究的时候，遗传学也就孟德尔水平，DNA 尚未发现！他假设豚鼠双亲各自有遗传因素 <code>H''</code> 和 <code>H'''</code> ，然后精子卵子 混合，一共有四种可能，<code>G</code>, <code>G'</code>, <code>G''</code>, <code>G'''</code>，如果他们生下2胎，那么他们各自的遗传因素为 <code>H</code> 和 <code>H'</code> 。他假设花色还收到相同的怀孕因素 <code>D</code> 影响，以及出生后生长的共同的环境因素 <code>E</code> 影响。那么要根据因果性预测花色，就像解方程一样计算每根路径的权重。</p>
<p>这位 Sewall Wright，人称 现代演化三杰（R.A.Fisher, J.B.S Haldane），逝世于 1988-03-03，真是君生我未生，我生君已去。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-03-25T23:56:41+08:00">2021-03-25</time></p>
<p>stderr</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/202102/stderr-002"  rel="bookmark" >
              <h2 class="card-title">Clubhouse 一些感受</h2>
            </a>
            <p class="card-text"><p>clubhouse 总体感觉，自从被那啥之后，群体就基本一岸两地的人，和大陆留学生为主了。而且真的以学生为主。如果有家业压力人，要么就是创投圈要么就是币圈大佬。</p>
<p>第一次发言是在一个 English Lounge 里面有几个英语老师在聊 dyslexia 。这单词我都不认识但是还是强行尬聊了。</p>
<p>我当时就胡扯说中文这种文字为载体的语言，符号和读音分离，可能压根就不存在拼音字母类语言的发音乱序导致的理解能力的问题。</p>
<p>房主后来因为要去讨论女权，就早早的关闭了房间。不知道是被我的暴论或无知吓到了。我也因为时间太晚就睡了。第二天醒来，觉得不过瘾，就去搜了一下  dyslexia 这个概念。发现果然汉语里也是存在的。而且 HK 有个调查发现有这个问题的学生比例(10%)比 UK (5%-7%) 还高。</p>
<p>我又自己回味了一下，可能真的有这么回事。于是去 V 站发了个贴《<a href="https://www.v2ex.com/t/752905">有哪些你一直认错、读反的词语你过了很久才发现？</a>》。第一个回帖就给我当头一棒，天赋异禀这个词，我是的确很长时间读成  天赋bing yi 的。</p>
<p>但是这个问题也有有趣，这个词在口语中很少用到，也不至于成为我对这个词语的理解障碍，所以假设人群中发生 dyslexia 比例是差不多的，但是不同的语言结构造成的后果和代价还是有不同的？</p>
<p>接下来的日子使用 Clubhouse 的感受是，大多数房间都是拉家常。挺无聊的。偶然能遇到一些非常有意思的非人文的，然后我又能听得懂的话题。</p>
<p>但是用起来这个 clubhouse 的严重短板就出现了：房间秩序很难维护。某人说了一个炸鱼的观点，大家争相反驳，但是并没有一个谁先举手谁先说的机制，然后加上网络延迟，你停了等别人，别人也出于礼貌停了等你，这样race condition死锁了。并且往往第一个反驳的人，还夹杂了自己的另外一个有问题的观点，然后大家就跑题到更远的地方去了。</p>
<p>总的感受，一个好的发言秩序是很难自发形成的。比如得靠信号好不掉线而且强有力的主持人。app 本身非常缺乏 civil conversation 的机制。这个和现实中的泡吧聊天还是有区别的。因为大家可能会看别人的嘴和动作判断自己是否需要去插嘴。也没办法从别人的表情和情绪判断环境和气氛是否融洽。</p>
<p>比如今天有个房间讨论生命的意义，大家吵得很厉害，就有人提议说怎么有个 Moderator 不说话，看简介是  UCLA 心理学从业人士。让他说说。结果好家伙，他一上来就说人死后其实意识还是存在的，有转世，有 afterlife。呃。无言以对。继续听下去的意义真的不大了。</p>
<p>而且真的有那么一两个志同道合，你也没法像现实中那样，拉他们单独对线。</p>
<p>但是这些其实都是可以通过 app 的交互解决的问题。比如</p>
<ul>
<li>允许大家做 emoji response 。表情回复。</li>
<li>比如给主持人一个 mute 按钮</li>
<li>搞个发言倒计时</li>
<li>跑题投票？</li>
<li>发言队列。排队说话。</li>
<li>搜索房间标题！</li>
<li>cue 别的房间。合并房间。</li>
</ul></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-02-12T23:18:45+08:00">2021-02-12</time></p>
<p>stderr</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/202101/stderr-001"  rel="bookmark" >
              <h2 class="card-title">双亲+子女组成核心家庭(Nuclear Family)</h2>
            </a>
            <p class="card-text"><p>最近几个月最大的认知冲击是，我们这一代人可能是人类作为灵长类动物历史上非常罕见的核心家庭时期。</p>
<p>所谓「核心家庭」是 <a href="https://en.wikipedia.org/wiki/Nuclear_family">nuclear family</a> 这一概念的直译，表示一个最小、最基本的家庭单元。与该概念相对的是单亲家庭(single-parent family)，或者家族(extended family，四代同堂、三代同堂那种大家庭)</p>
<p><img alt="guan video" src="/images/2021/stderr-001-1.png" /></p>
<p><a href="https://youtu.be/ashExaHC9cg?t=909">马前卒说</a>，「三五个人组成的小家庭，彻底成为独立的基层单位，在中国是80年代以后的事情」，所以差不多就是我们这代才人发生的。而且更为奇葩的是我们这一带是前无古人后无来者的独生子女一代。</p>
<p>无独有偶，在<a href="https://news.ycombinator.com/item?id=25723851">Hacker News上</a>也看到一篇趣文 「<a href="https://boyle.substack.com/p/can-zoom-save-the-american-family">视频聊天软件 ZOOM 能拯救美式家庭吗 Can Zoom Save the American Family?</a>」</p>
<blockquote>
<p>Corporate families, as defined by Steven Ruggles, a professor of history at the University of Minnesota, were the dominant family structure throughout the 1800s, named “corporate” because the family revolved around the family business. In the case of most American families in the pre-Industrial era, the family business was farming and many children were needed to sustain the land. Until 1850, three quarters of older Americans lived with their children and grandchildren in large family units. Industrialization changed this model. According to Brooks, the nuclear family had replaced the corporate family by 1920. By the 1960s, more than three quarters of all children were living with two parents, away from their extended families.</p>
</blockquote>
<p>简单的说，在19世纪(18xx年)，美国的「产业式家族」是绝对主流，一个大家族围绕着某个生意。在工业化之前普遍的情况是北美农业，需要很多子女和孙子辈才能维持土地经营。1960年，也就是核子时代到来之后，全美有多达3/4比例的子女跟父母组成的「核心家庭」，才变成主流。</p>
<p>但是核心家庭是否稳定呢？美国的情况是1920年以后离婚率飙升，生育率下降。只有有钱人才有能力撑起一个 extended family。这段时期是个体的解放，家庭的衰败。「The Michelle Obama podcast」更是说，70年代那种街坊邻居帮照看小孩是旧时代残留的一种投射，但是也造就了她的成功。她说</p>
<blockquote>
<p>“It felt easier in those times to have a family unit because … success wasn’t defined by your ability to leave your nuclear unit and make it on your own…Every elder lived with someone. They shared expenses. They shared households. They shared duties in raising kids. There wasn’t this feeling that you were supposed to… raise a family on your own. That seems to be a new thing. The neighborhood I grew up in operated on this notion. It wasn’t just up to a parent to provide stability and love.”</p>
</blockquote>
<p>这让我突然有个启发，工业化不是生育率下降的根本原因，工业化造就的核心家庭才是。因为双亲既要双份收入，又要独立承担繁杂的扶养责任，这样的压力太大了。更严重的问题是孩子从小缺乏能走心的玩伴，以及亲身接触大人的生产劳动场面。成人的生产技能是很难直接传授给子女的，所以子女的成长压力又转嫁到学业。人类学家发现，在<a href="https://news.ycombinator.com/item?id=25386501">捕猎采集社会里一个幼儿是被30+个熟人带大的</a>。突然我对我自己童年的孤独感到释然了，也对我的娃产生了一种担忧。他们的玩伴呢？在大城市的小区里，他们也很少能接触到能教授他们技能和经验长辈熟人。</p>
<p>诺姆·乔姆斯基（就是 MIT 搞生成语法的那位<a href="https://zh.wikipedia.org/zh-cn/%E4%B9%94%E5%A7%86%E6%96%AF%E5%9F%BA%E8%B0%B1%E7%B3%BB">大佬</a>，Type-1图灵机，Type-2上下文相关，Type-3 Context-free，Type-4有限状态自动机的那个Chomsky）<a href="https://news.ycombinator.com/item?id=15847273">说</a>：</p>
<blockquote>
<p>“Neoliberal democracy. Instead of citizens, it produces consumers. Instead of communities, it produces shopping malls. The net result is an atomized society of disengaged individuals who feel demoralized and socially powerless.<br />
In sum, neoliberalism is the immediate and foremost enemy of genuine participatory democracy, not just in the United States but across the planet, and will be for the foreseeable future.”</p>
</blockquote>
<p>核心家庭也在瓦解民主社会。不过我倒是觉得也在反面催生另一种政治生态，比如美国黑人对 gang 的认同就超过了对单亲家庭的认同。</p>
<p>最后推荐一篇关于这个话题的长篇著作：《<a href="https://www.theatlantic.com/magazine/archive/2020/03/the-nuclear-family-was-a-mistake/605536/">The Nuclear Family Was a Mistake</a>》。<a href="https://www.thepaper.cn/newsDetail_forward_7260341">thepaper 有中文翻译</a>。作者是 NYT 的专栏 David Brooks。HN 的评论区<a href="https://news.ycombinator.com/item?id=22292660">1</a>, <a href="https://news.ycombinator.com/item?id=22288351">2</a> 也非常精彩。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2021-01-26T05:49:36+08:00">2021-01-26</time></p>
<p>stderr</p>            </div>
          </article>
        </div>

    </main>
    <nav class="pagination-nav side-padding">
<a href="/index.08.html" class="pagination-newer">&lt; Newer Posts</a><a href="/index.10.html" class="pagination-older">Older Posts &gt;</a>    </nav>


  </body>
</html>