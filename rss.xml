<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"><channel><title>est の 输入 输出和出入</title><link>https://blog.est.im/</link><description>This blog is rated 🔞, viewer discretion is advised</description><lastBuildDate>Thu, 17 Oct 2024 15:21:00 +0800</lastBuildDate><item><title>“分封制” 代替RBAC权限管理模型</title><link>https://blog.est.im/2024/stdout-21</link><description>&lt;p&gt;作为开发狗，手上堆的系统和任务多了，开权限就变成了一件麻烦的事。&lt;/p&gt;
&lt;p&gt;一开始做一个功能X，给甲用，就做一个简单的权限关联表：&lt;code&gt;功能key&lt;/code&gt;，&lt;code&gt;人员id&lt;/code&gt;就完事大吉&lt;/p&gt;
&lt;p&gt;后来人员调整流动，换人换得勤快，得考虑一个功能给一个团队使用，于是引入 RBAC，基于角色的鉴权控制。说到底就是个三元组 &lt;code&gt;功能key&lt;/code&gt;，&lt;code&gt;角色&lt;/code&gt;，&lt;code&gt;成员id&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;我也一度迷信这样的设计。用了这么久还是麻烦了。在一个正常官僚程度的大中型组织里，压根没人知道自己角色是啥。&lt;/p&gt;
&lt;p&gt;你说他是管理人员吧，他也就管一部分；你说他负责这事吧，也就负责一阵。该给他放到哪个角色呢？&lt;/p&gt;
&lt;p&gt;如果做一个自动化角色申请审批流程，他会跑来问你，该申请哪个角色啊？&lt;/p&gt;
&lt;p&gt;所以问题又回到了原点。因此我琢磨出来一套具有大汉封建主义特色的，「分封制」权限控制体系。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;系统超管：普天之下，莫非王土；率土之宾，莫非王臣。拥有系统一切权限。但是不负责，不执行，不搞具体管理。超管只干一件事：分封&lt;/li&gt;
&lt;li&gt;如何分封：把「事」交给一个信得过的领主（serf）。领主对一块业务全权负责。但代价得自己把封地采邑打下来。具体在系统层面，系统所有权限、功能都直接开放，所谓 zero-trust。但是你得从零开始搭建和配置。一旦你配置好、跑起来，这快权限和功能就是你独有的。（owner）&lt;/li&gt;
&lt;li&gt;线上既有的业务权限，那也是有人配置管理和主导，你只能从别那里抢夺，或者过继。&lt;/li&gt;
&lt;li&gt;领主可以给自己封臣划分部分管理权限&lt;/li&gt;
&lt;li&gt;如果一个领主挂了，超管指定一个接盘的领主&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;感觉这样开发和超管就可以不用每天处理谁负责哪个功能的麻烦事了。哈哈哈&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Thu, 17 Oct 2024 15:21:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-10-17:/2024/stdout-21</guid><category>stdout</category></item><item><title>“中庸”的艺术 - 如跟需求方讨价还价</title><link>https://blog.est.im/2024/stdin-15</link><description>&lt;p&gt;翻到一个神贴 &lt;a href="https://news.ycombinator.com/item?id=41794566"&gt;&lt;em&gt;How to make Product give a shit about your architecture proposal&lt;/em&gt;&lt;/a&gt; ，标题直译就是《如何让沙雕产品经理接受技术改造》&lt;/p&gt;
&lt;p&gt;具体故事，原文非常值得一看。搞了这么多研发，产品经理各种水平的都遇到过一堆，最大的烦恼就是“我有个想法”，“今天就要”而全然不顾你当前技术架构的问题。到底是技术优先，还是业务优先？开发人员和销售非常普遍的冲突怎么处理？&lt;/p&gt;
&lt;p&gt;产品经理，老板，甲方，销售，实际上是研发的衣食父母。他们所有的诉求：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;产品不管你的技术问题，他们也不懂。他们只关心 &lt;em&gt;产品&lt;/em&gt; 本身&lt;/li&gt;
&lt;li&gt;产品需要的是一个 &lt;em&gt;结果&lt;/em&gt;，而不是一个白板上巨复杂的分布式系统架构图&lt;/li&gt;
&lt;li&gt;产品是人，产品为人服务。他们也能理解有工程方面的顾虑，这也是他们找开发的原因。他们是来“讨价还价”的！&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;开发是“乙方”，正如那个文章里的 水管工 故事一样，实际上是 “赢得信任” 的实施方。所以接下来的套路是：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;你先不要 what about，先别反驳说 but 。先按照理想的条件，全部答应下来，&lt;/li&gt;
&lt;li&gt;做一个理想化，全套，SSVIP，贵宾级别的报价，所谓 &lt;em&gt;platinum package&lt;/em&gt;。内部需求就把人力、服务器、时间、排期等成本按最坏的估计全部算出来。&lt;/li&gt;
&lt;li&gt;拿这套方案，给到需求方，一定要让他们很诧异的问出：“&lt;em&gt;why&lt;/em&gt;” ，怎么这么麻烦啊！？&lt;/li&gt;
&lt;li&gt;这就是让产品对你的技术问题关心的机会！接下来，开发需要有礼貌，不卑不亢的，有理有据的把你的处境讲出来，要展示你的专业能力和素养。&lt;/li&gt;
&lt;li&gt;接下来需要让对方陷入自我怀疑，内心：“&lt;em&gt;Do I really need all this?&lt;/em&gt; 是不是这要求有点过份！？”&lt;/li&gt;
&lt;li&gt;最终结论，还是要做，换更经济的方式去做，要么不做。如果这件事是能挣钱的，那么的确投入人力物力时间去征服麻烦啊。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;文章也讨论了，话也说回来，一个粗糙的结果，和没有结果，哪个更讨人厌？实际上是粗糙的结果。就好比故事里的水管工，你下水道漏了，又舍不得大修，就缝缝补补。结果过一段时间又漏了。这还不如不修。烦呐！&lt;/p&gt;
&lt;p&gt;所以一般的经验是，要么不做，要么就把一个事彻底解决最好。&lt;strong&gt;不要交付半吊子工程！&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;当然，这个时候要思路灵活。水管坏了不一定要在原地修补啊，说不定换一个管线完全绕过以前的大坑呢？&lt;/p&gt;
&lt;p&gt;所以就回到了这篇blog的主题：tradeoff&lt;/p&gt;
&lt;p&gt;以前我不知道如何准确翻译这个词，一直把叫“妥协”。但是这似乎有点贬义。或许叫 折衷，取舍 更好？。&lt;/p&gt;
&lt;p&gt;我觉得装逼的翻译是 —— 中庸。&lt;/p&gt;
&lt;p&gt;成年人的世界哪有那么多“既要……又要”，乃至“……还要”。&lt;/p&gt;
&lt;p&gt;以前上学的时候，就喜欢“中庸”，60分及格万岁，一个知识点了解个大概就行，平庸，和稀泥，不表态，无原则，优柔寡断。结果贻害无穷。一只吃亏到而立之年，发现中了孔老二的圈套。&lt;/p&gt;
&lt;p&gt;对中庸最大的误会是它丫的压根就不应该是一个“方法论”，而是一个“对结果的欣然承认”态度；&lt;/p&gt;
&lt;p&gt;作为方法论，我的心得是，才接触一个事，就要走极端。抓东西就从一个“抓手”入手，如果恰好能抓住“主要”矛盾那就最好不过，而且最好只抓一个。抓住，抓稳了之后，再去了解事物的全貌和corner case，这个时候事半功倍势如破竹。&lt;/p&gt;
&lt;p&gt;就好比，以前打 CS 1.5，突然转角处出现两个敌人，你慌乱之中，既不向A也不朝B开枪，而是瞄准他俩的中间空隙biu～biu～biu～。然后就躺了。这种遭遇战就应该训练自己的下意思，必须集中火力，断其一指。&lt;/p&gt;
&lt;p&gt;做事也一样，认准一个方向，全力推到超出它极限为止；然后再停下来，考虑有没有更好的方案，做到周全；其次考虑对方接受程度，该省省能砍砍；最后一看，嘿，也就一般般。&lt;/p&gt;
&lt;p&gt;好吧。其实我也不懂中庸，也不想懂，更不想revision中庸，就是纯粹想附会，如果是个误会也无所谓。就这样吧。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Thu, 10 Oct 2024 15:24:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-10-10:/2024/stdin-15</guid><category>stdin</category></item><item><title>Install mosh for macOS arm64 with Miniconda3</title><link>https://blog.est.im/2024/stdout-20</link><description>&lt;p&gt;I always hate compiling and building. It's an error-prone path filled with riddles and unknowns.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;mosh&lt;/code&gt; is a great tool replacing &lt;code&gt;ssh&lt;/code&gt; in many cases, sadly it does not provide an &lt;code&gt;arm64&lt;/code&gt; binary download or installer for M1/M2/M3 MacBooks. Moreover I dont like XCode and protected &lt;code&gt;/usr/bin&lt;/code&gt; shit so I prefer isolated envs like &lt;code&gt;miniconda3&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Anyway, for such a detour, following the &lt;a href="https://github.com/mobile-shell/mosh/wiki/Build-Instructions"&gt;official mobile-shell build wiki&lt;/a&gt;, type these commands:&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-sh"&gt;conda install autoconf automake libprotobuf pkg-config tmux
# use libncursesw 6.5 since  6.4 is buggy, rpath and dyld not load LC_RPATH shit
conda install conda-forge::ncurses
git clone --depth=1 https://github.com/mobile-shell/mosh.git`
cd mosh

./autogen.sh
./configure --prefix $CONDA_PREFIX
make check
make
make install
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And it's done. All thanks to authors for open source project and butter-smooth build scripts.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Sat, 28 Sep 2024 10:05:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-09-28:/2024/stdout-20</guid><category>stdout</category></item><item><title>javascript 节拍器</title><link>https://blog.est.im/2024/stdout-19</link><description>&lt;p&gt;娃学琴，节奏感糊成一坨了。老师让抖腿打节拍，显然不work。码农特有的穷B气质让我舍不得买个实体的；去找个节拍器app，结果各大市场都是各种广告，怕给娃用不正经；甚至找了很多公众号版的，小程序版的，网页版的，普遍都是各种跳转诱导点击。&lt;/p&gt;
&lt;p&gt;失望之余，想起来上次&lt;a href="https://blog.est.im/2022/stdout-10"&gt;JS播放DTMF&lt;/a&gt;对 WebAudio 有点感觉，要不这次自己干脆再手搓一个。&lt;a href="https://news.ycombinator.com/item?id=20935492"&gt;调研&lt;/a&gt;了一圈发现这玩意没那么容易，主要就是javascript在浏览器里 &lt;code&gt;setInterval&lt;/code&gt; 是有时间抖动（jitter）的，不能保证节奏精确。如何才能做到精准采样打节拍呢？连续精心编排 AudioContext 时间轴！&lt;/p&gt;
&lt;p&gt;搜了一圈发现一位叫 &lt;a href="https://grantjam.es/creating-a-simple-metronome-using-javascript-and-the-web-audio-api/"&gt;Grant James 已经写好&lt;/a&gt;放在 &lt;a href="https://github.com/grantjames/metronome"&gt;github&lt;/a&gt; 了。那还等什么直接拿来～～针对性的改进了：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;无广告&lt;/li&gt;
&lt;li&gt;去掉 .js .css 依赖，单文件更快&lt;/li&gt;
&lt;li&gt;精简不必要的代码结构，方便以后魔改&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;改完之后发现两三个坑也跟着一起修补了：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;用 &lt;code&gt;wakeLock&lt;/code&gt; 防止手机上使用息屏&lt;/li&gt;
&lt;li&gt;突破固定的4拍子，加上可以增减的节拍控制&lt;/li&gt;
&lt;li&gt;增减按钮禁止调到小于 0&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;最后成果就放在 &lt;a href="https://lab.est.im/metronome/"&gt;https://lab.est.im/metronome/&lt;/a&gt; 这里了。有需要的拿去用。协议 &lt;a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="license noopener noreferrer" style="display:inline-flex;"&gt;CC BY-NC 4.0&lt;img style="height:1em!important;margin:auto 2px auto 2px;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg"&gt;&lt;img style="height:1em!important;margin:auto 2px auto 2px;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg"&gt;&lt;img style="height:1em!important;margin:auto 2px auto 2px;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg"&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;20240929更新：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;支持了长按按钮一直增加减少bpm&lt;/li&gt;
&lt;li&gt;禁止长按出现菜单&lt;/li&gt;
&lt;li&gt;禁止双击缩放&lt;/li&gt;
&lt;/ol&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Thu, 26 Sep 2024 22:52:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-09-26:/2024/stdout-19</guid><category>stdout</category></item><item><title>Edge找回丢失的右上角Copilot侧边栏图标</title><link>https://blog.est.im/2024/stdout-18</link><description>&lt;p&gt;右上角图标和侧边栏的官方截图：&lt;/p&gt;
&lt;p&gt;&lt;img referrerpolicy="no-referrer" src="https://blogs.windows.com/wp-content/uploads/prod/sites/33/2023/12/devtools-copilot-in-edge-1.png" /&gt;&lt;/p&gt;
&lt;p&gt;如果不小心关掉了，找回办法：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;打开 &lt;code&gt;edge://settings/sidebar/appSettings?hubApp=cd4688a9-e888-48ea-ad81-76193d56b1be&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;F12&lt;/code&gt; 或者 &lt;code&gt;Opt+Cmd+I&lt;/code&gt;，找到第一个“Show Copilot”开关，把它改成关闭。&lt;/li&gt;
&lt;li&gt;如果第二步不会搞，输入 &lt;code&gt;document.querySelector('input[aria-label="Show Copilot"]').removeAttribute('disabled')&lt;/code&gt; 可破&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;为什么会有这个问题，因为政策的原因，Microsoft Copilot 不能在简中使用，于是右上角的按钮点一下会消失；但是开发或者集成测试的为了省事儿，就直接给隐藏掉，导致侧边栏无法点开&lt;/p&gt;
&lt;p&gt;这串 hubApp 的id如何找到呢？新建一个浏览器profile，这个时候 Copilot 是有图标的。不要去点，去设置里翻 &lt;code&gt;edge://settings/sidebar&lt;/code&gt; 就能看到 Copilot 的选项。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Sun, 22 Sep 2024 21:49:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-09-22:/2024/stdout-18</guid><category>stdout</category></item><item><title>归属感</title><link>https://blog.est.im/2024/stdin-14</link><description>&lt;p&gt;偶然看到&lt;a href="https://x.com/alexdong/status/1837711442058838300"&gt;一张图&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img referrerpolicy="no-referrer" src="https://pbs.twimg.com/media/GYDczzFb0AE5CoP?format=jpg&amp;name=900x900" /&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The link between imagination and place is no trivial matter. The existential question, 'Where do I belong?' is addressed to the imagination. To inhabit a place physically, but to remain unaware of what it means or how it feels, is a deprivation more profound than deafness at a concert or blindness in an art gallery. Humans in this condition belong no where.&lt;br /&gt;
— Eugene Walter, &lt;em&gt;Placeways&lt;/em&gt;, 1988&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这句话比较难翻译，我尝试一下：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;遐想与所在地的关系不可忽视。“我属于这里吗？”这一挑战存在感的问题，往往被归结于遐想。现实中，你住在一个地方，对其渊源、历史、意义等感受一无所知的话，就好比聋子听音乐会、瞎子看美术展。在这种状态的人，无家可归。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;总感觉漏掉了点什么，或者想多了？展开一点的说：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;北京意义是一块八旗、南方贵族聚居的飞地，普通人的归属感不会超过骆驼祥子&lt;/li&gt;
&lt;li&gt;上海的渊源只有从租界开始，如果你的人生跟通商口岸没交集也很难找到归属感&lt;/li&gt;
&lt;li&gt;深圳的历史比大部分居民寿命短&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Sun, 22 Sep 2024 21:22:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-09-22:/2024/stdin-14</guid><category>stdin</category></item><item><title>创始人模式</title><link>https://blog.est.im/2024/stdin-13</link><description>&lt;p&gt;外网&lt;a href="https://x.com/foxshuo/status/1830914171925602788"&gt;吹&lt;/a&gt;的油爆爆，看了下，&lt;a href="https://paulgraham.com/foundermode.html"&gt;pg的文章&lt;/a&gt;，应该是受这个视频的启发&lt;/p&gt;
&lt;p&gt;&lt;a href="https://youtu.be/ia6Di_ytiSE?t=2792"&gt;https://youtu.be/ia6Di_ytiSE?t=2792&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Brian 说世界上每 $1500 交易中，就有 $1 是给了 airbnb，挺新鲜。他接着用了个”爬山“喻。创业就好比爬山，创始人好不容易爬上一个山头，这个时候你找一个职业经理人空降到团队，他有能力带领大家去攀登下一个山峰吗？&lt;/p&gt;
&lt;p&gt;Brian 说得很有道理。很多人能进大企业，迅速掌握组织架构里的生存技巧，但是出来从 0 建立一套东西不是人人都会的。因为创业的本质就是打破陈见，敲碎现状，更需要说服拿工资老保们跟着一起去打破。&lt;/p&gt;
&lt;p&gt;Brian 又说，创始人有三点无可替代：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;是生理父母（不是抚养父母）。你亲自生出来的娃，就是你自己。这种母爱和对外部事物的喜欢有根本的不同&lt;/li&gt;
&lt;li&gt;有permission。有些事跟外边小朋友不会讲，但是给自己娃会说。Brian比喻说如果有必要，他可以给公司改名字。职业经理人敢吗？&lt;/li&gt;
&lt;li&gt;创始人既然创建了一件事，也能重建它。职业经理人能打理清楚，避免出岔子就不错了。Brian 又用了个精彩的比喻，只有创始人才知道公司的冰点和沸腾点。他随手拿起个杯子，说只有创始人才知道这杯子设计之初是啥样，这杯子怎么来的，比如铝合金从哪家订的。这不仅仅是管理问题，而是掌握如何建造的过程。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Brian 又说 创始人有2点不足：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;不清楚如何把生意 scale 到大公司级别的管理&lt;/li&gt;
&lt;li&gt;创始人精力和生命有限。如何接班？&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Brian 又读了下他给 AirBNB 发的全员信。有句话很俏皮：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;You must design the culture you want, otherwise, it'll be designed for you, you might not like what emerges&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;然后就开始喷 HR 部门。。。哈哈。那什么是culture呢？他说&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Your culture is the shared way to do things (and often they're) based on the lessons you've learned ..... Your culture is the behaviour of the leaders that get mimicked all the way down every single person... The way a leader designes the culture is not by writing out list of values, it's by basically leading by example every single day.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;culture 就是做事风格，随时表率，迭代更新的。&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;由于视频太长了我没继续看了。反过来我觉得 pg 看重的点，和 Brian 访谈里的不太一样。可能是我找错视频了？&lt;/p&gt;
&lt;p&gt;pg 文章里核心的点是，manager 做事有一条潜规则：严禁越级报告。这个规则又导致，CXO们都是职场向上管理的老油条。&lt;/p&gt;
&lt;p&gt;大厂出来的manager都喜欢把组织架构的子节点当成“黑箱”，然后只用跟直属同事(direct reports)做IO就能遥控功能。&lt;/p&gt;
&lt;p&gt;pg 指出：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Whatever founder mode consists of, it's pretty clear that it's going to break the principle that the CEO should engage with the company only via his or her direct reports. "Skip-level" meetings will become the norm instead of a practice so unusual that there's a name for it. And once you abandon that constraint there are a huge number of permutations to choose from.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;这个创始人模式，目前是什么大家都不清楚，但是无论如何，很明显核心就是要打破层级，做跨级(skip-level)沟通。但是创始人不可能在2000员工里的公司里也像20个人团队一样直接沟通，所以还是需要一定程度的托管。至于托管自治的边界在哪里，pg也不知道。他只说了看具体行业具体赛道具体阶段有不同。你越级管理过渡，还可能变成运输大队长那种“微操战神”。&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;founder vs manager 这个说法，我感觉可能太笼统了。这个模式可以进一步抽象为：无限兜底 vs 完成指定 的模式区别。&lt;/p&gt;
&lt;p&gt;founder 知道哪些事能做，哪些不能做；manager 只能在划定好的职权内做事；&lt;/p&gt;
&lt;p&gt;founder 做事是黑名单模式，除了某些选项排除掉，别的所有已知的未知的都得去对付，能动用全公司资源。manager则是白名单模式，一亩三分地，只管把业绩指标操完了事。甚至给下任挖坑。往往留下一下很 toxic 的实践，实践久了就成了习惯最后成了习俗。&lt;/p&gt;
&lt;p&gt;这两种模式，归根结底在于，如何定义“事”，有些事和业务，跳出自身角色局限性，其实压根不存在，甚至可以更低成本解决。我个人体会，遇到的某些麻烦，隔壁部门明明稍微改进一下就能解决，但是这个因为不算对方绩效，就推不动，不上心。所以就得花额外高昂的成本。大企业病的所有问题都来源于部门和指责切分，业务是垂直的，但是技术和赋能最高效往往是水平的。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Wed, 04 Sep 2024 10:25:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-09-04:/2024/stdin-13</guid><category>stdin</category></item><item><title>php是最好的……serverless</title><link>https://blog.est.im/2024/stdout-17</link><description>&lt;p&gt;php是不是最好的语言先不说，但是如果从 serverless 的角度看php：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;语法简单，功能丰富，10分钟就能学会&lt;/li&gt;
&lt;li&gt;通过 FTP 之类的标准工具部署，而不是脑残的命令行&lt;/li&gt;
&lt;li&gt;不用管理麻烦的服务器。基于非常成熟的 php-fpm 去做 scaling。也有大量巨型网站验证过这一方案&lt;/li&gt;
&lt;li&gt;虽然不是 docker，但是 &lt;code&gt;vhost&lt;/code&gt; 够用了。而且要容器化 &lt;code&gt;vhost&lt;/code&gt; 也很容易&lt;/li&gt;
&lt;li&gt;让人梦寐以求的“热更新”技术&lt;/li&gt;
&lt;li&gt;超级便宜的月租。（还记得 dreamhost 吗？）&lt;/li&gt;
&lt;li&gt;不会吊死在一颗树（vendor lock-in）上。全球遍地的厂商都支持&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;你就说好不好吧。同时&lt;a href="https://news.ycombinator.com/item?id=41358020#41364190"&gt;评论在 Hacker News&lt;/a&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Tue, 27 Aug 2024 11:06:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-08-27:/2024/stdout-17</guid><category>stdout</category></item><item><title>2024年玩xml真是笑死了（xsl）</title><link>https://blog.est.im/2024/stdout-16</link><description>&lt;p&gt;昨天大早上的6点就醒了，翻来覆去睡不着，就开始胡思乱想。忘记是什么缘起了，反正突然想到一个问题，博客这种静态站，又要输出html，又要输出rss。太冗余了。要不直接把内容存在RSS里。然后用js去&lt;code&gt;fetch()&lt;/code&gt;。。。。&lt;/p&gt;
&lt;p&gt;等等，死去的记忆突然攻击我。RSS不就是XML，XML似乎有个加皮肤的技术。于是就更睡不着了，起床一查，原来是 XSLT 转换成 HTML 然后就可以自由发挥了。&lt;/p&gt;
&lt;p&gt;可行性没问题，准备找个前人的例子开抄。比如 &lt;a href="https://natclark.com/tutorials/xslt-style-rss-feed/"&gt;2021年Nathan Clark的Styling an RSS Feed With XSLT&lt;/a&gt;，&lt;a href="https://darekkay.com/blog/rss-styling/"&gt;2023年Darek Kay的Style your RSS feed&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;思路就很匹配，执行效果也不错。我想百尺竿头更进一步，把 XSL 给 inline 到 RSS 里，避免额外的加载，节省一次网络请求。吗，没想到这下麻烦大了，折腾到现在才有个初步结果。直接贴源码：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;utf-8&amp;quot;?&amp;gt;
&amp;lt;?xml-stylesheet type=&amp;quot;text/xsl&amp;quot; href=&amp;quot;#stylesheet&amp;quot;?&amp;gt;

&amp;lt;some_xml_root xmlns:shit=&amp;quot;http://xxx&amp;quot;&amp;gt;

&amp;lt;xsl:stylesheet xml:id=&amp;quot;stylesheet&amp;quot; version=&amp;quot;3.0&amp;quot; xmlns:xsl=&amp;quot;http://www.w3.org/1999/XSL/Transform&amp;quot;&amp;gt;
&amp;lt;xsl:output method=&amp;quot;html&amp;quot; doctype-system=&amp;quot;about:legacy-compat&amp;quot; version=&amp;quot;5.0&amp;quot; encoding=&amp;quot;UTF-8&amp;quot; indent=&amp;quot;yes&amp;quot; /&amp;gt;
&amp;lt;xsl:template match=&amp;quot;/&amp;quot;&amp;gt;
  &amp;lt;html&amp;gt;
    ...
  &amp;lt;/html&amp;gt;

&amp;lt;/xsl:template&amp;gt;
&amp;lt;/xsl:stylesheet&amp;gt;

&amp;lt;/some_xml_root&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这里的 &lt;code&gt;href="#stylesheet"&lt;/code&gt; 方法，是&lt;a href="https://www.w3.org/TR/xslt-30/#embedded"&gt;官方推荐的&lt;/a&gt; 。但是要起效果，一定注意 &lt;code&gt;type="text/xsl"&lt;/code&gt; 别抄成网上的 &lt;code&gt;application/xslt+xml&lt;/code&gt; 了&lt;/p&gt;
&lt;p&gt;主要浪费时间的坑点主要在根的 &lt;code&gt;xmlns&lt;/code&gt; 上。这玩意把 xpath 给搞挂了。比如 sitemap你写&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;xsl:for-each select="/urlset/url"&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;好好的，加上 &lt;code&gt;xmlns&lt;/code&gt; 就得写成：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;xsl:for-each select="/*[local-name() = 'urlset']/*[local-name() = 'url']"&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;怪不得现在没人玩XML了。这破玩意没法直观的本地调试，还得靠各种第三方 validator，反人类啊。&lt;/p&gt;
&lt;p&gt;于是把根的 xmlns 直接改成 tag namespace。也就是 &lt;code&gt;xmlns:shit&lt;/code&gt; 。反正你namespace冲突了关我什么事？&lt;s&gt;而且说实话，xmlns这玩意除了坑各种解析器不好写之外，并没有什么卵用。我以前写都是想办法去掉 xmlns 再解析。感觉这一块真的 over-engineering 了。&lt;/s&gt; 好像有点明白 namespace 是干嘛的了。这玩意主要解决一个sb需求：允许多个XML合并到一个文件里。这不就得考虑如何分清楚tag谁是谁的。。。。并且标准已经挖好坑了，一个XML有且只有一个root。。你把别的 tag 合并进来，那的确不容易区分。还有这样写不会造成文件体积膨胀吗？真是xsl笑死了。&lt;/p&gt;
&lt;p&gt;接下来的问题就是如何生成一个规规矩矩的 html5 doctype。搜了下 &lt;code&gt;doctype-system&lt;/code&gt;就可以了。本来其实可以在&lt;code&gt;&amp;lt;xsl:template&amp;gt;&lt;/code&gt;后面加上 &lt;/p&gt;
&lt;p&gt;&lt;code&gt;&amp;lt;xsl:text disable-output-escaping='yes'&amp;gt;&amp;amp;lt;!DOCTYPE html&amp;amp;gt;&amp;lt;/xsl:text&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;但实际只加这个是不行的。&lt;/p&gt;
&lt;p&gt;另外吐槽下 Chrome，默认的viewer把xml渲染成html了，在 devtool 里通过 &lt;code&gt;$x()&lt;/code&gt; 无法直接调试xpath，还得靠别的第三方工具。(⊙﹏⊙) &lt;/p&gt;
&lt;p&gt;这可能就是XSL的核心问题了——没法方便直观的调试，挂了就给你白屏。有点react那种白屏的 ptsd 感觉了。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Thu, 22 Aug 2024 23:09:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-08-22:/2024/stdout-16</guid><category>stdout</category></item><item><title>大清卷王 和 骑士</title><link>https://blog.est.im/2024/stdin-12</link><description>&lt;p&gt;看到个推：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;蕨代霜蛟 &lt;a href="https://x.com/ferntrino/status/1823188040317341731"&gt;@ferntrino 10:41 AM · Aug 13, 2024&lt;/a&gt;&lt;br /&gt;
杭州抗议骑手事件本身就不参与讨论了，难受的是自己的。但有一个细节真的非常黑色素幽默，那就是名单列表顶上的字段。系统命名时还真随手就把骑手的ID命名为Knight ID。&lt;br /&gt;
卧槽，Knight这么有历史感的单词竟然落魄卑贱到了这个地步。&lt;br /&gt;
&lt;img referrerpolicy="no-referrer" src="https://pbs.twimg.com/media/GU1D21MaoAAu8_6?format=jpg&amp;name=medium" /&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Knight这单词让我想起一个往事：&lt;/p&gt;
&lt;p&gt;先说一个公共假日：五一。之所以每年放假，这是因为&lt;a href="https://blog.est.im/2021/stdout-026"&gt;国际劳动节&lt;/a&gt; ；&lt;/p&gt;
&lt;p&gt;可能很少有人知道，这个洋节是该死的美国人发明的。具体来说是 1886年5月4号发生在北美 伊利诺伊州 芝加哥市 的 Haymarket Square；具体细节就不说了，打工人闹事，和暴力机关打了一架，死了人。更多的地方接着闹不消停。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/45/Site_of_the_Haymarket_Riot_%287199922756%29.jpg/800px-Site_of_the_Haymarket_Riot_%287199922756%29.jpg" /&gt;&lt;/p&gt;
&lt;p&gt;被后来这事被称为 &lt;a href="https://en.wikipedia.org/wiki/Haymarket_affair"&gt;Haymarket affair&lt;/a&gt; 草市事件 ；重点来了，草市事件的组织者，发起者，名字全称 &lt;strong&gt;Noble and Holy Order of the Knights of Labor 高贵与神圣的劳工骑士团&lt;/strong&gt;。简称  Knights of Labor (K of L)，缩写KOL&lt;/p&gt;
&lt;p&gt;看来骑士这名字，而且和劳动人民颇有渊源嘛。&lt;/p&gt;
&lt;p&gt;而且KOL这缩写冲突了，哈哈哈。。。不过劳动人民应改理直气壮的当意见领袖，没毛病。&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/01/Powderly-terence-1890.jpg/220px-Powderly-terence-1890.jpg" /&gt;&lt;/p&gt;
&lt;p&gt;图：劳工骑士团 总瓢把子 大工长 Terence Powderly, Grand Master Workman of the Knights of Labor &lt;/p&gt;
&lt;p&gt;无聊翻资料，发现一些有趣的细节&lt;/p&gt;
&lt;p&gt;1886年5月1日这场运动是KOL在1884年筹备的，主要诉求是8小时工作制。注意国内很多厂家把中午吃饭小休的时间排除在8小时之外，这里显然扯蛋。当年8小时工作的完整表述是：&lt;strong&gt;8小时打工，8小时睡眠，其余8小时归自己管！&lt;/strong&gt; 当年罢工这首颂歌 &lt;em&gt;Eight Hour&lt;/em&gt; 就是这么唱的：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Eight Hours for work. Eight hours for rest. Eight hours for what we will&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;可以看下B站的搬运 &lt;a href="https://www.bilibili.com/video/BV1qt411z7Te/"&gt;【中英字幕】八小时之歌 Eight hours&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;草市事件是1877年以来 &lt;a href="https://en.wikipedia.org/wiki/Great_Railroad_Strike_of_1877"&gt;Great Upheaval&lt;/a&gt;  （也称 Great Railroad Strike of 1877）系列罢工运动的高潮。&lt;/p&gt;
&lt;p&gt;早年间的KOL骑士团，强调不分宗教、种族、性别互帮互助，主要成员是低技能体力劳动者、铁路工人、移民、和钢铁工人。但是排斥五类人： bankers, land speculators, lawyers, liquor dealers and gamblers 金融、地产、律师、酒精和赌博。因为这些从业者被认为不对社会产生价值。&lt;/p&gt;
&lt;p&gt;当年骑士团吸纳了很多天主教/新教爱尔兰人。然后。。。。。。然后骑士团在还跟 chinese 干上了。据说是在北美西岸的Tacoma，这里1/10人口都是Union Pacific Railroad的铁路派遣工——来自东亚大清的卷王们。&lt;/p&gt;
&lt;p&gt;大概经过：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在南北战争期间的1862年，美国总统林肯出台了《太平洋铁路法案》，给铁路拨出了大量的土地和财政资金。负责东段的联合太平洋公司是美国政府直接扶持的半国有企业，它所雇佣的劳工里，大部分是爱尔兰移民。在南北战争时期，爱尔兰正好在闹饥荒。当时北方缺少兵员，政府许诺参军的人可以获得金钱和土地，因此一些黑心商人就去爱尔兰忽悠了很多难民，来美国参战，以骗取政府许诺的参军费。爱尔兰人的加入确实进一步增强了北方的实力，但这种让别国难民当自己内战的炮灰的不人道做法，让美国遭到了来自欧洲各国的谴责。于是到后来，剩下还没有上战场的爱尔兰人就被改派往西部，到联合太平洋公司里去当筑路工人。这些爱尔兰人逃出了饿殍满地的故土，又避免了成为炮灰，都是感恩戴德，施工很卖力，因此联合太平洋公司这一边的工程进展很顺利。&lt;br /&gt;
眼看公司快要倒闭，修建横贯大陆的铁路这项伟大工程也要夭折，加州赶超纽约的梦想也要破灭了，这时，四巨头的另外一位，负责实际建造铁路以及人力资源管理的查尔斯·克罗克（Charles Crocker）向斯坦福提出：雇用来自中国的华裔。在19世纪的50和60年代，有大量的中国人，特别是沿海地区的广东人和福建客家人，来到了加州。他们中有的是前来淘金的，也有的是为了躲避太平天国的战火。这些华人中，大多数在加州扎根成家，到了1863年，加州已经有了大约五万名华人。他们勤劳朴素的特质，也是在加州众人皆知的，克罗克正是看上了这一点，才提议将华人们招进公司，去修筑铁路。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;具体可以看&lt;a href="https://www.thepaper.cn/newsDetail_forward_2249912"&gt;《路上的美国史︱太平洋铁路：华工用汗水和鲜血浇灌的奇迹》&lt;/a&gt;。这篇文章可以看出阶级主义和民族主义叙事的差别。&lt;/p&gt;
&lt;p&gt;骑士团要求罢工，大清卷王们不干，愈演愈烈，最后搞成了种族冲突，结局就是 Rock Springs massacre 石泉屠杀。1882年，骑士团支持了臭名昭著的 Chinese Exclusion Act。骑士团所谓的“不分种族、支持移民”口号都加上了“chinese除外”的标签&lt;/p&gt;
&lt;p&gt;1886年5月的草市事件是KOL骑士团最大的成果，也是最后的辉煌，接着就迅速衰败了。被 American Federation of Labor 代替，原因是理念落后，熟练工和无技能功能的诉求差异，被天主教主教谴责导致占比很大的天主教徒离开。 &lt;/p&gt;
&lt;p&gt;1889年，在巴黎举行的第二国际第一次会议上，法国工会人士 拉维涅 Raymond Lavigne 提议将5月1日定为国际劳工节，以纪念草市事件，同时要求各国的劳工共同努力，为八小时工作制而奋斗。拉维涅的议案激励了美国和欧洲多数国家的劳工在1890年5月1日再次进行罢工。&lt;/p&gt;
&lt;p&gt;1904年，第二国际在阿姆斯特丹的会议上号召“各国社会民主党组织和工会联合会都要在每年五月一日坚决要求从法律上规定八小时工作制，拥护无产阶级的阶级要求和拥护世界和平”。大会还责成“各国的无产阶级组织，凡在有条件于五月一日停工而无损于工人利益的地方，应当争取停止工作”&lt;/p&gt;
&lt;p&gt;历史就是这么奇妙。。。或许国人在人挤人的五一这几天出游，早已忘记这个节日是怎么来的，诉求是什么，以及大清卷王如何被动在错位时代把劳动关系演变成种族冲突的。。。在如今&lt;a href="https://blog.est.im/202010/stdin-014"&gt;996问题&lt;/a&gt;、失业问题夹杂的社会主义国家里，这种黑色幽默，交错神奇，恍如昨日。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Tue, 13 Aug 2024 16:16:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-08-13:/2024/stdin-12</guid><category>stdin</category></item><item><title>两则故事：Intel Minnow，日本高分子化学</title><link>https://blog.est.im/2024/stdin-11</link><description>&lt;p&gt;&lt;a href="https://www.zhihu.com/question/663238830/answer/3582110938"&gt;英特尔第二财季营收低于预期，第四财季暂停派息，公司将裁员超1.5万人，盘后股价大跌20%，如何解读？&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;老狼&lt;/code&gt; 2021 年度新知答主 雨花、yang元祐 等 946 人赞同了该回答&lt;br /&gt;
前大樱桃员工来回答一下个人的观点。Intel是个好公司，对员工的尊重和职业路径的培养，公司上下对技术的推崇，宽松的企业文化，可以说是绝大多数国内外公司所不能比拟的。尽管有很多人因为各种各样的原因离职了，也在各种前员工群里面各种吐槽，但都是小骂大帮忙，主要是哀其不幸，怒其不争，对Intel从心底还是希望它好的。这么个好公司，为什么越来越不行了呢？&lt;br /&gt;
Intel逐渐崩盘的开始点在于10nm的难产，从那以后就没有再好过，只有一蟹不如一蟹。病发于工厂（Fab），根子则是美国制造不行了。一个前美国同事告诉我，美国人丢失了“CAN DO”的精神，只能做高端的设计、娱乐、金融这种营生，苦哈哈的制造不愿意干了，逼着干也干不了。&lt;br /&gt;
曾经发生的一件事，可以一窥美国制造的窘境。我的团队和美国Peer团队一起合作了几个开源硬件项目，这对Intel非常重要，我们计划建立x86的类似树莓派硬件矩阵，但是更加开放，这个项目就是Minnow计划。Minnow的第二代Minnow Max（基于Baytrail）非常成功，其中一个很大原因，就是我们选取了ADI做硬件供应商，而ADI的产线在深圳，主板质量非常好，避免了一代老化测试没有做，生命周期太短的问题。我们打算趁热打铁，推出Minnow3，选择在当时颇有竞争力的APL CPU，价格看能不能做到100美金左右。&lt;br /&gt;
计划开始就不太顺利，硬件设计被美国team抢走了，他们非要选择一个美国小厂来生产。在付出了延迟半年的等待后，硬件工程师终于告诉我们下周就可以回板了，我们都非常兴奋。结果，又等了三个月，才正在拿到几片板子（首批应该拿到十几片），而且根本跑不到GOP驱动那里，感觉是高速总线信号有问题。开会时，美国的PM（韩国人）告诉我们一个惊人的消息，说那个小厂生产了一百片板子，没有一个可用，我们的硬件工程师（一个年轻的老美）被迫自己到产线上用焊枪手搓主板，这几片就是他几周手搓出来的！他的毅力让我佩服（手搓主板仙人？），但还是不能用啊，谁让你换美国小厂的？于是我们每次项目周会都会催他啥时候能给我们可用的主板，过了几周，他从此再也没有在周会上出现。&lt;br /&gt;
项目于是又停滞了几个月，我们催PM，PM告诉我们他找不到这个工程师了，就是他的经理也不知道他去哪里了，就差要报警了。就在我以为过一阵就要换个硬件工程师的时候，事情发生了令人瞠目结舌的转折。&lt;br /&gt;
各位看管，这里有一个好消息，和一个坏消息，你们想先听哪个？好吧，好消息是硬件工程师找到了，坏消息是硬件工程师将公司告了！说因为我们总是催他进度，导致他患上了严重的抑郁症，有工伤了，现在不能好好工作，一周只能去一天公司。我心里一万个草泥马跑过，我一周和颜悦色的问一下进度（我又不是他领导，也严厉不起来），从来没有投诉他，这都能搞成工伤，是不是温室里的花朵？&lt;br /&gt;
关键是他的工伤被认可了。从此，我和PM再也不能问他进行到哪里了，可笑的是，我们既不能把他踢出项目组，也不能换个硬件工程师，这个活还必须是他干，而且还不能另起炉灶，再成立一个项目组。按照律师的说法，必须Inclusive到他。他的经理也不能辞退他，更不能给低绩效，从此有个防弹衣。他的经理从此拖了一个油瓶，在此可怜他一秒。更重要的事，项目周会从之谈风花雪月，到没人记得参加。项目再延期一年后，迎来了它的结局，无疾而终，而我从此告别了开源硬件梦。&lt;br /&gt;
这是Intel的问题吗？不，是美国的体制问题，尽管美国还拥有全世界最顶尖的人才，美国制造也永远不可能回到过去的辉煌。Intel现在扛下了美国制造的脸面，必须负重前行，但我们都知道，在路的尽头，只有特朗普的白日梦。&lt;br /&gt;
编辑于 2024-08-03 23:15・IP 属地上海&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href="https://www.zhihu.com/question/554942569/answer/3574789969"&gt;日本企业是否已经整体夕阳西下了？&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;Osteroza&lt;/code&gt; 键盘侠，接盘侠，洗盘侠 1916 人赞同了该回答&lt;br /&gt;
我说一个可能化工行业的同仁们知道的趣事。&lt;br /&gt;
美国化学家 P J Flory 是高分子化学的大师级人物，他本人获得过1974年的诺贝尔化学奖。&lt;br /&gt;
然而，Flory在晚年的许多“成就”其实是大坑，特别是涉及晶体振荡领域，他的一些结论是错误的。&lt;br /&gt;
在六十到七十年代，不少日本化学家师从Flory。这些化学家日后成为了日本化学领域的大佬级人物，决定了日本高分子化学领域的研究方向。这些大佬们继承了Flory的研究成果，包括错误的部分。在他们的带领下，直到今天，日本化工界的许多研究，依然是沿着Flory的模型一路狂奔!&lt;br /&gt;
而欧美化学界早在90年代就开始批判Flory。在这位老大哥的家乡，美国，他在大分子晶体领域的学说被“全盘反思”，今天的美国化学界没有机构会继续沿着错误的理论搞科研。&lt;br /&gt;
然而，这不妨碍日本化学界，物理界和工业界，年复一年的派学者前来美国进修，重复着一位位前辈们的实验，佐证Flory派模型的正确。只要Flory模型是正确的，也就说明当代日本化学高分子界老师们的正确，也就是证明日本化学界自七十年代来所有前辈们的努力是正确的。&lt;br /&gt;
这个行为在我这个外行看来，可以有三种解读: 1，美国实验室知道真相但忽悠日本人，反正你自愿交钱来做实验。2，日本人很固执，死不认错。3，如果最终证明日本人是正确的，那么日本人就是逆行的孤勇者。&lt;br /&gt;
事情怎么发生变化的呢。在某次物理年会上，美国国家标准局和阿克郎大学发难，派了个年轻的博士后上场，说你们日本人前段时间又来做Flory模型的实验了，据说数据很完美，你们工业界也重复了实验，数据也很完美，是不是？&lt;br /&gt;
鉴于你们实验年复一年的数据都很完美，我们很好奇，所以也做了你们的实验，结果发现了不少的问题。现在我就一条条，一步步的列出来，你们的实验每一步都有哪些问题。我们初衷是同行们间的学术交流哇，大家好好讨论一下哦。&lt;br /&gt;
讨论结果是，日本人之后再也不来参加这个物理年会了。&lt;br /&gt;
我一位高中同学当时在Akron读博，他听说这事儿以后就问了他的美国导师，“我们是不是杀死了日本人的一个行业”。他的导师回答“不，我们是给一具尸体照了次镜子”。&lt;br /&gt;
而我另一位在日本留学读博的中学同学说“日本人每次参加学术会议都一大堆人，但通常只有大佬做关键发言，小辈们发言后都要加上点感谢大佬的致辞。米帝让一个三十几岁的小辈直接怼德高望重大佬们，大佬们恐怕心境上也很难接受吧。”&lt;br /&gt;
你们觉得日本人被打脸后，默默改正了错误吗？&lt;br /&gt;
虽然，但是，如此，然而，日本学界依旧每年派人来美国实验室刷数据，继续论证Flory的模型是正确的! 日本工业界也依旧以flory的模型为基础，孜孜不倦的推进研发工作。&lt;br /&gt;
发布于 2024-07-27 01:23・IP 属地英国&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;不知道是刚编的故事，还是真就这么草台。。。。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Mon, 05 Aug 2024 17:56:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-08-05:/2024/stdin-11</guid><category>stdin</category></item><item><title>关于 cn.cyberIdentity.certification 的一些技术信息</title><link>https://blog.est.im/2024/stdout-15</link><description>&lt;p&gt;搜索该app名字可以得到 &lt;/p&gt;
&lt;p&gt;&lt;a href="https://apps.apple.com/cn/app/_/id1588080869"&gt;https://apps.apple.com/cn/app/_/id1588080869&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;各大app市场都有隐私政策页，点击可以发现网址是：&lt;/p&gt;
&lt;p&gt;https://cdnrefresh.ctdidcii.cn/w1/WHClient_H5/pages/secret.html&lt;/p&gt;
&lt;p&gt;甚至有一个 apk 下载页面&lt;/p&gt;
&lt;p&gt;https://cdnrefresh.ctdidcii.cn/w1/WHClient_H5/Install/InstallGuide.html&lt;/p&gt;
&lt;p&gt;https://cdnrefresh.ctdidcii.cn/w1/version/cyberIdentity-android.apk&lt;/p&gt;
&lt;p&gt;&lt;code&gt;whois ctdidcii.cn&lt;/code&gt; 可以得到&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Registrant: XX部第一研究所&lt;br /&gt;
Registrant Contact Email: songjie@anicert.cn&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;可以发现该公司官网&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;有限公司（以下简称“ZDAX”）是&lt;code&gt;**部&lt;/code&gt;第一研究所下属全资子公司。&lt;br /&gt;
&lt;code&gt;**部&lt;/code&gt;第一研究所以国家“互联网+”可信身份认证平台（简称“CTID平台”）核心技术为依托，致力于为各级政府部门、互联网运营商、各行业应用提供权威、可信、安全、便捷的身份认证服务，并开展相关业务创新。在&lt;code&gt;**部&lt;/code&gt;的直接领导下，&lt;code&gt;**办&lt;/code&gt;、国家发改委、科技部等部委的大力支持下，&lt;code&gt;**部&lt;/code&gt;第一研究所积极开展居民身份证网上应用研究，组织承建CTID平台，助力新时代社会治理现代化。&lt;br /&gt;
2017年10月，&lt;code&gt;**部&lt;/code&gt;第一研究所成立ZDAX公司，并授权ZDAX为CTID平台唯一合法的运营服务商，为各行业提供权威、可信、安全、便捷的网络身份认证服务，为我国“互联网+行动战略”提供强有力的支撑保障。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;以及平台介绍说明&lt;/p&gt;
&lt;p&gt;https://www.anicert.cn/platform.html&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;● 一次一码，超时失效&lt;br /&gt;
● 通过国密算法加密、签名防止数据泄露、篡改和伪造&lt;br /&gt;
根据相关行政许可设立的第三方签发、面向系统应用可作为司法采证使用的身份凭证，如电子认证服务提供者、CA机构等第三方签发的电子签名认证证书、eID等；&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;得出一个结论，这玩意不&lt;em&gt;仅&lt;/em&gt;是eID换皮那么简单。&lt;/p&gt;
&lt;p&gt;点开发展历程可以看到 &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;2020.12 《&lt;a href="https://www.anicert.cn/upload/2020/12/25/16088934002753h4n2m.pdf"&gt;基于可信数字身份的区块链应用服务白皮书&lt;/a&gt;》正式发布&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;上面提到的厦门公司，看上去是专门做 CDIT 运营的，搜了下官网是&lt;/p&gt;
&lt;p&gt;https://easyctid.cn/about&lt;/p&gt;
&lt;p&gt;其中有一张最重要的架构图&lt;/p&gt;
&lt;p&gt;&lt;img referrerpolicy="no-referrer" src="https://easyctid.cn/_nuxt/img/bg-3.c5fe831.png" /&gt;&lt;/p&gt;
&lt;p&gt;目前不知道这个 PID 是唯一的还是可变的。要实用还是得做类似微信那种 OpenID/UnionID 才行。因为技术对接SDK需要付费签协议才能拿到，细节就无从而知了。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Thu, 01 Aug 2024 15:20:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-08-01:/2024/stdout-15</guid><category>stdout</category></item><item><title>Valid HTTP verbs</title><link>https://blog.est.im/2024/stdout-14</link><description>&lt;p&gt;从&lt;a href="https://www.v2ex.com/t/1057881"&gt;这里&lt;/a&gt; 想到，fetch/xhr 可以发起哪些 http verb 呢？&lt;/p&gt;
&lt;p&gt;&lt;code&gt;python -m http.server&lt;/code&gt; 随手测试了下，发现连 &lt;code&gt;!&lt;/code&gt;，&lt;code&gt;$&lt;/code&gt; 这种符号都可以作为 http verb，比如 &lt;code&gt;fetch('/asdf', {method:"$"})&lt;/code&gt; 这样的请求是能发起的。于是去 chromium 搜了下 &lt;code&gt;"is not a valid HTTP method"&lt;/code&gt; 相关的解析放在 &lt;a href="https://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/renderer/platform/network/http_parsers.cc;drc=fa1e0cf5238e2600039f60af6909aefbd4cf003c;l=404"&gt;blink/renderer/platform/network/http_parsers.cc&lt;/a&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;// See RFC 7230, Section 3.2.6.
bool IsValidHTTPToken(const String&amp;amp; characters) {
  if (characters.empty())
    return false;
  for (unsigned i = 0; i &amp;lt; characters.length(); ++i) {
    UChar c = characters[i];
    if (c &amp;gt; 0x7F || !net::HttpUtil::IsTokenChar(c))
      return false;
  }
  return true;
}

bool HttpUtil::IsTokenChar(char c) {
  return !(c &amp;gt;= 0x7F || c &amp;lt;= 0x20 || c == '(' || c == ')' || c == '&amp;lt;' ||
           c == '&amp;gt;' || c == '@' || c == ',' || c == ';' || c == ':' ||
           c == '\\' || c == '"' || c == '/' || c == '[' || c == ']' ||
           c == '?' || c == '=' || c == '{' || c == '}');
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;原来如此，RFC 7230呀。于是把这些字符打出来：&lt;code&gt;' '.join(chr(x) for x in range(0x20, 0x7f))&lt;/code&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;! # $ % &amp;amp; ' * + - . 0 1 2 3 4 5 6 7 8 9 A B C D E F G H I J K L M N O P Q R S T U V W X Y Z ^ _ ` a b c d e f g h i j k l m n o p q r s t u v w x y z | ~
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;那还搞个屁的 RESTful 啊。直接用特殊符号一把梭。不过各种服务端框架可能不是很容易做兼容。哈哈。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Wed, 17 Jul 2024 09:47:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-07-17:/2024/stdout-14</guid><category>stdout</category></item><item><title>Cappy in a Haystack locations</title><link>https://blog.est.im/2024/stdout-13</link><description>&lt;p&gt;For &lt;a href="https://fallout.fandom.com/wiki/Cappy_in_a_Haystack"&gt;the mission&lt;/a&gt; from the beloved Fallout 4 Nuka-World DLC&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;coc DLC04KiddieKingdomFunHouse01; player.moveto 06015A94
coc NukaWorldWildWestExt02; player.moveto 06015A8A
coc DLC04BottlingPlant01; player.moveto 060445DF
coc DLC04BottlingPlant01; player.moveto 0604A812
coc DLC04GalacticZoneExt04; player.moveto 06015A8E
coc DLC04GalacticZoneExt04; player.moveto 0604AD3F
coc DLC04GalacticZoneExt08; player.moveto 06015A91
coc DLC04GalacticZoneExt08; player.moveto 0604AD40
coc DLC04KiddieKingdomFunHouse01; player.moveto 0604AD3D
coc DLC04WWMineCart01; player.moveto 06015A8B
coc DLC04WWMineCart01; player.moveto 0604AA39
coc KiddieKingdomExt06; player.moveto 06015A97
coc KiddieKingdomExt06; player.moveto 0604AD3E
coc NukaWorldNukaTownUSA06; player.moveto 0604A814
coc NukaWorldNukaTownUSA06; player.moveto 0604A813
coc NukaWorldWildWestExt02; player.moveto 0604A815
coc SafariAdventure03; player.moveto 06015A9A 
coc SafariAdventure03; player.moveto 0604AA3A
coc SafariAdventure07; player.moveto 06015A9D
coc SafariAdventure07; player.moveto 06015A9D
coc SafariAdventure07; player.moveto 0604AA3B
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;idk hope it works lol.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Sat, 13 Jul 2024 09:19:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-07-13:/2024/stdout-13</guid><category>stdout</category></item><item><title>All Star Core locations in Fallout 4</title><link>https://blog.est.im/2024/stdout-12</link><description>&lt;p&gt;Arent nobody got time for this shit.&lt;/p&gt;
&lt;p&gt;Open FO4Edit, locate &lt;code&gt;604a053&lt;/code&gt; and find all refs:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;0601FAD1
060255A7
060255D2
06025774
060257F1
06026C7B
06026D23
06026D70
060278F7
06027917
0602791A
06027A3C
06027ACC
06027C0D
06027D5E
06027E43
06027E4C
060319E1
060319E2
060327BA
060327C4
060327D0
060327E2
06034EC6
06034F97
06034FD4
0603522E
06037CA7
060380CB
0603816F
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And for external star cores, locate &lt;code&gt;0601F0E5&lt;/code&gt; and &lt;code&gt;0601F0E6&lt;/code&gt; for more refs:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;coc NWJunkyardExt; player.moveto 060319D6;
coc NukaWorldWildWestExt03; player.moveto 06031995;
coc DLC04BottlingPlant01; player.moveto 060319CE;
coc DLC04Nukacade01; player.moveto 060319CF;
coc DLC04GalacticZoneExt07; player.moveto 060319E1;
coc NukaTownMarket01; player.moveto 06054CA8;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Just type &lt;code&gt;player.moveto&lt;/code&gt; with the code above and you can grab all &lt;a href="https://fallout.fandom.com/wiki/Star_core"&gt;star cores&lt;/a&gt;, and return to console &lt;code&gt;player.moveto 0601E359&lt;/code&gt;, so you get the Quantum X-01 power armor from Nuka-World DLC of Fallout 4.&lt;/p&gt;
&lt;p&gt;Also there's &lt;code&gt;coc TestCory01; 06044B4B;&lt;/code&gt; for testing purposes.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Sat, 13 Jul 2024 06:31:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-07-13:/2024/stdout-12</guid><category>stdout</category></item><item><title>育儿成本的两座大山</title><link>https://blog.est.im/2024/stderr-13</link><description>&lt;p&gt;仅个人观点&lt;/p&gt;
&lt;h3&gt;校园里的义务教育&lt;/h3&gt;
&lt;p&gt;首先，我支持义务教育的普惠性。现代各国的义务教育，也就是K12教育，可以覆盖从5-6岁的幼儿园（K）到高中（12年级）。教育当然是非常有必要的而且最好强制性的，但是一定要关起门来在封闭校园里受教育吗？&lt;/p&gt;
&lt;p&gt;这套体系的义务性，源自于普鲁士的士官传统和军营教育。当年这事儿出发点没啥问题，但是到21世纪的大城市里，成为城镇居民育儿最大的负担。经费问题先不说，首先就是接送问题。上学、放学这个时间问题就至少要耗费一个成年劳动力脱产，校车制度和孩子自行出门回家基本看不到可行性。&lt;/p&gt;
&lt;p&gt;如果你给孩子辅导过作业就会发现，现在的统编教材是反智、反自学、反人类的。老师每天发的各种填表、通知比学科本身问题还多。城镇的孩子早就高度个性化差异化成长了，学习进度反而非常僵硬死板。成绩差的跟不上，成绩好的无法掌握更高级的知识。整天都是一个流水线作业和非标件不适配的拉扯。&lt;/p&gt;
&lt;p&gt;抱着「干不好就别干」的心态，在资讯如此发达的今天，我觉得应该把「义务」，改成 opt-out 模式。也就是对于有条件的家长，只要教育部门能把控最终毕业会考成绩就行，而不是必须按学籍在指定学校坐满9年板凳。的允许民间办学和home-school按照自己的节奏去学习和成长。到了法定年龄，不能通过会考的，做一些处罚或者补救措施。&lt;/p&gt;
&lt;p&gt;当然有人会说了，这样搞，会不会乱套？不利于集体生活，不利于团结稳定。这样的问题当然存在，可以小范围试点，按地区不同政策嘛。归根结底这是ruling class需要考虑的事，各位要杠，我只能说京爷您说的对。&lt;/p&gt;
&lt;h3&gt;“童工”问题&lt;/h3&gt;
&lt;p&gt;我觉得，孩子要么纯学习，要么纯玩，这种二元生活持续整个童年是有害的。更好的方式是，在劳动中学习，在实践中收获回报和经验。说得好听点，支持“勤工俭学”。说的更通俗点难听点，就是应该允许“童工”。这个话题可能会造成很多人敏感和不适，但是先别急。童工的准确定义，是：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;剥削性质的劳动导致孩子无法获得教育，或者精神/身体/社会/道德 上受到侵害。&lt;br /&gt;
the exploitation of children through any form of work that interferes with their ability to attend regular school, or is mentally, physically, socially and morally harmful&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;现在发达地区要找一个体力剥削活儿也不太可能了，重体力活儿，你身子板儿不行，雇主还会嫌弃你。&lt;/p&gt;
&lt;p&gt;反而是儿童的心理、社会压力很大。其中一个原因就是青春期那股劲儿没地方释放。所有的回报和赏赐都来自老师或者父母。老师和父母是典型的绝对权威，从原理上来说就是不平等沟通，诉求有不可调和的矛盾。这种人造的依附关系是高高在上、理性铸就然而架空的幻觉，这座精心维护的象牙塔会在孩子毕业那一刻轰然倒塌。孩子真正进入社会会有一种「原来是这么回事」的幻灭感。如果说高考填自愿是几乎茫然的状态去碰运气，那么应届生选择岗位更像一场赌。&lt;/p&gt;
&lt;p&gt;这个问题放在长远的人类历史压根就不是问题。自古以来，孩子都是跟着父母叔伯学习生存技能的，一个家庭本质就是一个小产业群体；脱产的学校，这玩意是近现代产物。龙生龙凤生凤，老鼠的儿子会打洞，子承父业这看起来是天经地义的事。现代很多职业分工是非常精细以至于达到变态的程度，孩子要直接上手父母的职业几乎不可能，更多依赖长久的教育和培养。&lt;/p&gt;
&lt;p&gt;农村的孩子一般从下地就开始干农活儿，城镇的娃从小接触商业那也是理所应当，甚至是必须的。比如父母开了店，孩子在暑假帮忙照看一下是很常见的。这些显然不算「童工」。基于类似的道理，没开店的家庭，支持自己娃从事一些差事，能获得一点物质回报，经历一些at stake的挣钱、交易、谈判技能肯定比看电视傻笑强。&lt;/p&gt;
&lt;p&gt;国内的例子就勤工俭学，国外也有 boy/girl scouts 卖饼干，糖水这样的活动。&lt;/p&gt;
&lt;p&gt;可能你觉得这个想法不痛不痒也没啥毛病，那么问题来了：&lt;/p&gt;
&lt;p&gt;你是否支持未成年人开通收款码、打赏账号，成为有限责任的自然人/法人？&lt;/p&gt;
&lt;p&gt;你可以说，不支持，因为法律不允许。那么接下来的问题是：这样的「保护」立法放在21世纪今天是否依然是必须的？&lt;/p&gt;
&lt;h3&gt;孩子的自我&lt;/h3&gt;
&lt;p&gt;可能有人会问，除了获得一点收益，然后呢？之前跟一个朋友聊天，他吐槽说，马斯洛那套 「人最高的追求就是自我实现」 是假的，因为他研究这么多年，发现人其实没有自我。看到这问题，我想了下，回复他，重点不是自我，是实现。&lt;/p&gt;
&lt;p&gt;这个姓马的可能功夫不如另一个姓马的。另一个姓马的26岁的时候，向全世界宣布了他的理论：人如果不打工，就会感觉不开心。&lt;/p&gt;
&lt;p&gt;以前初中时，政治老师也这样照本宣科，说劳动是人的权利，是每个人的需要。估计现在绝大部分人看到这个理论，都会哈哈大笑：“这个权利谁想要我让给他，我希望有人能把这个权利给我剥夺了，我不想劳动！哈哈哈哈。。。” &lt;/p&gt;
&lt;p&gt;这个话题叫「劳动的异化」。对这两位姓马的说法，我有一个最浅显的解释：&lt;/p&gt;
&lt;p&gt;&lt;b&gt;人，是闲不下来的。总得找点事来霍霍。&lt;/b&gt;&lt;/p&gt;
&lt;p&gt;人要实现的不一定是自我，而是实现一个想法。这个想法可能睡一觉第二天就发现很蠢，但依然是昨天「自我」一方面的冲动。所以「自我」是否准确存在，不重要。重要的是你起了这个心思，然后干成了。&lt;/p&gt;
&lt;p&gt;不得不说，劳动是人的本质特征，是人的"第一需要"。吃喝繁衍，那只是动物性。人性的体现是在「衣食足」之后，而知荣辱。&lt;/p&gt;
&lt;p&gt;人在劳动中，是需要肯定自己的，而不是否定自己。人要通过劳动感到幸福，而不是折磨。是不断发挥自己的聪明才智，而不是受到打击和摧残。&lt;/p&gt;
&lt;p&gt;学校高墙里的教育和考试，是不是也越来越异化呢？所以娃在学习之外的劳动，就显得非常有必要，而且长期缺失了。这里的劳动，也就是「做自己想做的事」。需要鼓励娃去尝试一些学科考试成绩之外的挑战，自我实现。如果这些兴趣恰好也能在成年之后从事相关的岗位，养活自己，那不就更好了？&lt;/p&gt;
&lt;h3&gt;结语&lt;/h3&gt;
&lt;p&gt;总的来说，未成年人强制去学校，和禁止劳动 这两大因素，加重了家长的负担，对娃也没啥好处。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Mon, 01 Jul 2024 09:41:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-07-01:/2024/stderr-13</guid><category>stderr</category></item><item><title>Making subprocess async friendly in Python</title><link>https://blog.est.im/2024/stdout-11</link><description>&lt;p&gt;It's been a while since i wrote something in English, mostly because there's nothing really interesting, &lt;a href="https://blog.est.im/2024/stdout-09"&gt;until now&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Occasionally, when facing a long running task in Python, I would choose either a distrubuted tasks queue system, or for the convenience, just the &lt;code&gt;subprocess&lt;/code&gt; module. It's built-in and well designed for grabbing outputs of a child process running for a short period of time.&lt;/p&gt;
&lt;p&gt;But what if the child-process takes a really, really long time? In my case it's an expensive query, or some CPU/GPU intensive task, which needs to be launched from a running Web framework, like FastAPI. &lt;/p&gt;
&lt;h3&gt;Popen() fire and forget&lt;/h3&gt;
&lt;p&gt;if child-process's output, end state and the return code are irrelevant, a simple Popen would do&lt;/p&gt;
&lt;p&gt;&lt;code&gt;subprocess.Popen(..., stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;The problem is, after the child-process finishes, it will hang as a zombie, because the parents refused to claim its exit status. To fix this, add an extra parameter in &lt;code&gt;Popen()&lt;/code&gt; like &lt;code&gt;subprocess.Popen(..., start_new_session=True)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;And write a simple loop periodically check for &lt;code&gt;WNOHANG&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;while 1:
    try:
        chpid, retcode, res = os.wait3(os.WNOHANG)
    except ChildProcessError:
        break
    sleep(5)
    if chpid == os.getpid():
        do_sth()
        break&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;This can be done using &lt;code&gt;BackgroundTasks&lt;/code&gt; in FastAPI/Starlette.&lt;/p&gt;
&lt;p&gt;In a way, the child-process hebaves like &lt;code&gt;nohup&lt;/code&gt; or screen/tmux, running in a detatched fashion.&lt;/p&gt;
&lt;p&gt;If you hate this many lines of code, just &lt;code&gt;subprocess.run("blah.sh &amp;amp;", shell=True)&lt;/code&gt; and wrap your commands in &lt;code&gt;blah.sh&lt;/code&gt;&lt;/p&gt;
&lt;h3&gt;Make &lt;code&gt;.communicate()&lt;/code&gt; async&lt;/h3&gt;
&lt;p&gt;Sometimes I need to monitor and handle the stdout/stderr of a child-process, like forward the outputs as an &lt;a href="https://developer.mozilla.org/en-US/docs/Web/API/EventSource"&gt;EventSource&lt;/a&gt; response to the browser.&lt;/p&gt;
&lt;p&gt;First I tried &lt;code&gt;.communicate()&lt;/code&gt; it will block until the process quites.&lt;/p&gt;
&lt;p&gt;Then I tried &lt;code&gt;Popen.stdout.read()&lt;/code&gt;, it will also block. Eventually I found a great hack from Stackoverlow like this:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;p = subprocess.Popen(
    cmd, bufsize=0, text=True, stdin=subprocess.PIPE,
    stderr=subprocess.PIPE,  stdout=subprocess.PIPE, close_fds=True)
fcntl.fcntl(p.stdout.fileno(), fcntl.F_SETFL, os.O_NONBLOCK)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now &lt;code&gt;p.stdout.read(1024)&lt;/code&gt; would return immediately, or with a &lt;code&gt;TypeError&lt;/code&gt; bnecause internal messed up with &lt;code&gt;None&lt;/code&gt; as non-blocking empty return.&lt;/p&gt;
&lt;p&gt;Wrap it with &lt;code&gt;try...except&lt;/code&gt; inside a loop, it worked fine as expected.&lt;/p&gt;
&lt;p&gt;When the parent process crashes unexpectedly, the child-process is still working, to detect this, just check for &lt;code&gt;BrokenPipeError&lt;/code&gt; carefully in child-process and gracefully shutdown.&lt;/p&gt;
&lt;h3&gt;Solved with &lt;code&gt;asyncio&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;I tried harder reading the official Python docs, turns out the most easy solution is already there:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;proc = await asyncio.create_subprocess_exec(
    sys.executable, '-c', code,
    stdout=asyncio.subprocess.PIPE)

# Read one line of output.
data = await proc.stdout.readline()
line = data.decode('ascii').rstrip()

# Wait for the subprocess exit.
await proc.wait()
return line
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I guess another lesson learned today.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Sat, 22 Jun 2024 12:26:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-06-22:/2024/stdout-11</guid><category>stdout</category></item><item><title>人声分离简单评测</title><link>https://blog.est.im/2024/stdout-10</link><description>&lt;p&gt;娃要去表演唱歌，老师要求提供MTV。。 视频是&lt;a href="https://www.bilibili.com/video/BV1Ty4y147Sj/"&gt;这个&lt;/a&gt;，需要去掉人声部分&lt;/p&gt;
&lt;p&gt;先用 ffmpeg 提音轨 &lt;code&gt;ffmpeg -i v.mp4  -ac 1 1.mp3&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;微信小程序上的全是骗充值的，网上的服务：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;没卵用 https://vocalremover.org/ 名气很大，搜出来第一就这个&lt;/li&gt;
&lt;li&gt;没用 https://www.conversion-tool.com/karaoke/&lt;/li&gt;
&lt;li&gt;卡死 https://www.songpeel.com/song-to-karaoke&lt;/li&gt;
&lt;li&gt;要安装 https://github.com/adefossez/demucs&lt;/li&gt;
&lt;li&gt;要6G显存 https://github.com/Anjok07/ultimatevocalremovergui&lt;/li&gt;
&lt;li&gt;效果很好！ https://tunebat.com/Vocal-Remover 推荐&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;看来人声分离，特别是童声，还是有点难。&lt;/p&gt;
&lt;p&gt;最后把得到的 a.mp3 塞回去&lt;/p&gt;
&lt;p&gt;&lt;code&gt;ffmpeg -i v.mp4 -i a.mp3 -c:v copy -map 0:v:0 -map 1:a:0 new.mp4&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;btw 打了这么多网址，该不会被误认为SEO吧。囧。。。。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Fri, 21 Jun 2024 22:48:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-06-21:/2024/stdout-10</guid><category>stdout</category></item><item><title>吐槽pynsq，另外给subprocess糊了一个异步</title><link>https://blog.est.im/2024/stdout-09</link><description>&lt;h3&gt;pynsq太烂了&lt;/h3&gt;
&lt;p&gt;起初是因为需要在 Web API 里消费一个消息队列(nsq)，给浏览器返回 &lt;a href="https://developer.mozilla.org/en-US/docs/Web/API/EventSource"&gt;EventSource&lt;/a&gt; 做实时输出。但是没想到&lt;a href="https://github.com/nsqio/pynsq/blob/master/nsq/__init__.py"&gt;官方库pynsq&lt;/a&gt;居然写得这么渣：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;def _handle_term_signal(sig_num, frame):
    logging.getLogger(__name__).info(
        'TERM Signal handler called with signal %r', sig_num)
    tornado.ioloop.IOLoop.current().stop()

def run():
    """
    Starts any instantiated :class:`nsq.Reader` or :class:`nsq.Writer`
    """
    signal.signal(signal.SIGTERM, _handle_term_signal)
    signal.signal(signal.SIGINT, _handle_term_signal)
    tornado.ioloop.IOLoop.current().start()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这都什么玩意儿？一个库何德何能也敢去乱劫持 signal？最他妈逗的是这个库的推荐写法：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import nsq
r = nsq.Reader(message_handler=handler,
        lookupd_http_addresses=['http://127.0.0.1:4161'],
        topic='nsq_reader', channel='asdf', lookupd_poll_interval=15)
nsq.run()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这个 &lt;code&gt;r&lt;/code&gt; 莫名其妙的就能跑起来了。真是魔法。anyway，在Web API兼容这一坨是失败了，爆了一堆错，对付魔法的办法就是隔离，所以打算糊个脚本，通过多进程+PIPE来得到数据。&lt;/p&gt;
&lt;h3&gt;给 subprocess 加一个异步补丁&lt;/h3&gt;
&lt;p&gt;糊的时候发现，&lt;code&gt;subprocess&lt;/code&gt; 模块的 &lt;code&gt;.communicate()&lt;/code&gt; 方法是 blocking的， 居然不支持 async/await，于是只能继续糊：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;import subprocess, fcntl, asyncio
p = subprocess.Popen(
    cmd, bufsize=0, text=True, stdin=subprocess.PIPE,
    stderr=subprocess.PIPE,  stdout=subprocess.PIPE, close_fds=True)
fcntl.fcntl(p.stdout.fileno(), fcntl.F_SETFL, os.O_NONBLOCK)
buf = ''
while p.poll() is None:
    try:
        # read() with O_NONBLOCK might gets None thus TypeError
        buf += (p.stdout.read(1024) or '')
        contents = buf.split('\n')
        if len(contents) &amp;lt; 2:
            raise TypeError('Not enough')
    except TypeError:
        await asyncio.sleep(1)
        yield None
        continue
    buf = contents.pop(-1)
    for x in contents:
        yield x

p.terminate()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;这里用 &lt;code&gt;buf&lt;/code&gt;、&lt;code&gt;contents&lt;/code&gt; 是因为直接调用消息队列，每个消息都是分割好的；但是通过管道来读。得自己去处理字节流如何分割的问题，也就是传说简中特供的「粘包」问题。&lt;/p&gt;
&lt;p&gt;另外子进程可能因为Web框架的种种原因，不自觉退出或者变僵尸进程，需要向 stdout/stderr 做输出的时候检查一下 BrokenPipeError 处理后事主动退出即可。&lt;/p&gt;
&lt;p&gt;还有子进程如果输出完毕，需要代码里调用一下 &lt;code&gt;p.terminate()&lt;/code&gt;，才能回收，避免变zombie&lt;/p&gt;
&lt;p&gt;试了一下，也不是不能用，成功！正觉得自己又行了的时候，发现官方：&lt;/p&gt;
&lt;p&gt;&lt;a href="https://docs.python.org/3.8/library/asyncio-subprocess.html"&gt;https://docs.python.org/3.8/library/asyncio-subprocess.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;啊这。白忙活。&lt;/p&gt;
&lt;h3&gt;超长待机 subprocess&lt;/h3&gt;
&lt;p&gt;想起来之前还有个问题，一个API调用一个subprocess，然后等它执行，不想管。这个时候可以加一个参数 detach 模式：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;subprocess.Popen(..., start_new_session=True)&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;然后在同进程用里跑一个后台检查循环去检查子进程的 &lt;code&gt;WNOHANG&lt;/code&gt;：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;while 1:
    try:
        chpid, retcode, res = os.wait3(os.WNOHANG)
    except ChildProcessError:
        break
    sleep(5)
    if chpid == os.getpid():
        do_sth()
        break
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;想了下好像也搞复杂了。要不直接跑一个 &lt;code&gt;sh -c "blah.sh &amp;amp;"&lt;/code&gt; 算了。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Fri, 21 Jun 2024 09:30:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-06-21:/2024/stdout-09</guid><category>stdout</category></item><item><title>如何删除 C:\Windows\WinSxS 文件</title><link>https://blog.est.im/2024/stdout-08</link><description>&lt;p&gt;天气热得心慌，看Win10不爽，决定删几个文件玩玩&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;首先你需要以 &lt;code&gt;SYSTEM&lt;/code&gt; 用户启动 &lt;code&gt;cmd.exe&lt;/code&gt;&lt;br /&gt;
Win+R 敲入：&lt;br /&gt;
&lt;code&gt;"\\live.sysinternals.com@SSL\DavWWWRoot\tools\PsExec.exe" -i -s cmd.exe&lt;/code&gt;&lt;br /&gt;
回车。确认当前身份敲入 &lt;code&gt;whoami&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;夺权：&lt;code&gt;takeown /F "C:\Windows\WinSxS\Backup" /A /R /D Y&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;授权：&lt;code&gt;cacls "C:\Windows\WinSxS\Backup" /T /G SYSTEM:F /C&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;开删：&lt;code&gt;rd /s /q "C:\Windows\WinSxS\Backup"&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;爽！&lt;/p&gt;
&lt;p&gt;当然，你也可以让系统代替你清理：&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Dism.exe /online /Cleanup-Image /StartComponentCleanup /ResetBase&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;很老的磁盘清理工具 &lt;code&gt;cleanmgr.exe&lt;/code&gt;  也可以试试，删不要的程序 &lt;code&gt;appwiz.cpl&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;老黄家的  DXCache 也十分让人不解。这破玩意还存2个地方：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;%LOCALAPPDATA%\NVIDIA\&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;%APPDATA%\NVIDIA&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;老夫当年给 &lt;code&gt;C:&lt;/code&gt; 装了个最慢的SSD，失策。去年（2023）那一波M.2降价潮一直等等结果错过了，拍断大腿追悔莫及。&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">est</dc:creator><pubDate>Fri, 14 Jun 2024 22:50:00 +0800</pubDate><guid isPermaLink="false">tag:None,2024-06-14:/2024/stdout-08</guid><category>stdout</category></item></channel></rss>