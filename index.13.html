<!DOCTYPE html>
<html>
  <head>
    <title>Est's Blog</title>

    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <link href="https://feeds.feedburner.com/initiative" type="application/rss+xml" rel="alternate" title="Est's Blog RSS Feed" />

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="This blog is rated&nbsp;&nbsp;R⃣ , viewer discretion is advised" />


    <link rel="stylesheet" href="/theme/css/normalize.min.css" />
    <link rel="stylesheet" href="/theme/css/style.css" />


    <style>
      body {
        background: #ecedef url("/theme/img/ignasi_pattern_s.png") repeat;
      }
    </style>
  </head>
  <body class="list-body">
<nav class="nav-bar side-padding">
  <h1 class="nav-header"><a href="/" class="nav-text">
    Est's Blog
  </a></h1>
  <div class="hamburger-menu">
    <button onclick="hamburgerMenuPressed.call(this)" aria-haspopup="true" aria-expanded="false" aria-controls="menu" aria-label="Menu">
      <span></span>
      <span></span>
    </button>
    <ul id="menu" class="hamburger-menu-overlay">
      <li><a href="/" class="hamburger-menu-overlay-link">Home</a></li>

        <li><a href="/category/archive.html" class="hamburger-menu-overlay-link">archive</a></li>
        <li><a href="/category/stderr.html" class="hamburger-menu-overlay-link">stderr</a></li>
        <li><a href="/category/stdin.html" class="hamburger-menu-overlay-link">stdin</a></li>
        <li><a href="/category/stdout.html" class="hamburger-menu-overlay-link">stdout</a></li>

    </ul>
  </div>
</nav>    <main class="card-container side-gutter">
      <header class="list-header">
        <p class="list-header-subtext">This blog is rated&nbsp;&nbsp;R⃣ , viewer discretion is advised</p>
        <!-- <h1 class="list-header-title">Est's Blog</h1> -->
      </header>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/48433661723"  rel="bookmark" >
              <h2 class="card-title">对于通讯的一些感受</h2>
            </a>
            <p class="card-text"><p><img alt="" src="/images/tumblr/48433661723_0.png" /></p>
<p>今天地震，然后家里就断网了，就无聊听电台。然后就听了下350MHz - 370MHz。一开始以为是跳频，后来发现是多频道时断时续而已。一些感受：</p>
<p>我觉得普通JC是最苦逼的职业。基本就是被总台呼来唤去的民工。半个小时处理的事情基本就是解决停车纠纷啊，菜市场打架啊，银行卡被盗刷500元啊之类的鸡毛蒜皮事。真心蛋痛啊我日。</p>
<p>模拟信号语音交流感觉在“微信”时代真的落后了。</p>
<p>我们需要一个更加原子化、更加 IP 化的交流通讯方式。总台可以PUSH任务到人员，人员可以update情况，这一切需要一个更加优良的 UX 设计。我观察到比如一个很苦逼的事情就是手台里说手机号码。。这个在21世纪是很尴尬的。从市民报告，到总台分配，到解决，都应该数字化。</p>
<p>前几天看到reddit众在互相通气Boston PD的scanner，后来mod出来阻止这种严重泄密危害警员安全的行为。但是同时也感觉别人社会发达，居然有人把scanner做成了Internet Radio向所有人开放！</p>
<p>加上今天地震的一些报道，我觉得这个社会的信息化还有很大发展空间。感谢伟大的MTK，智能终端的普及指日可待，智能社会正在以势不可挡地到来。</p>
<p>个人觉得码农要以时代责任感去下岗一大批吃干饭的社会工作文科生。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-04-20T08:58:33+00:00">2013-04-20</time></p>
<p>archive</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/48319644529"  rel="bookmark" >
              <h2 class="card-title">Re: python标准库貌似没有实现链表？</h2>
            </a>
            <p class="card-text"><p>发信人: draculalord ( 嗯？), 信区: Python   <br />
标  题: 也谈链表及其他Re: python标准库貌似没有实现链表？   <br />
发信站: 水木社区 (Mon Mar 21 18:49:46 2011), 转信     </p>
<p>实际上刚开始学习一些高级语言的时候我也有同样的疑问，而且即使有链表对应物的语言，链表常常也很少被实际使用。   <br />
如果是在国外听数据结构的课，老师一般会警告你这只是一个理论概念，实际应用应该实际考察，在通常情况下链表不是一个很好的结构。   <br />
通常链表会作为一个很好的反例，告诉大家脱离实际硬件环境来谈论所谓算法复杂度是没有任何意义的。   <br />
这是因为，链表已经不适合当今的计算机硬件发展。当今的计算机硬件对内存是否连续更为敏感，而链表恰恰会破坏这种顺序读取。   <br />
由于locality很差所以常常造成page fault和cache miss   <br />
这也是为什么大多数教师不再推荐使用链表的原因。而且现今的硬件内存拷贝实际相当迅速。   <br />
并且python的list算法不是通常的单项表，也不是通常的数组。   <br />
具体可以看这里：http://wiki.python.org/moin/TimeComplexity   <br />
在List末尾append/pop都是O(1)的，   <br />
如果要在头部或者中部插入是O(n),任何破坏连续性的操作都会被要求realloc,所以任何此类操作都是O(n)   <br />
但是当今的常用硬件，使用C写的链表和python的list，在insert的时候只有n&gt;50000才让链表比list快那么一点点。   <br />
这还没有考虑其他实际操作的复杂度。加上前面说的破坏locality,导致链表完全没有吸引力。在对象特别多的时候通常我们直接抽象它为数据库，也不要去想什么链表了。     </p>
<p>在需要用到linked list特性的地方，比如常常需要从头部append或者pop   <br />
这时候有python的deque. (这里我记错了，特此更正，deque如果做insert还是会导致内存拷贝/移动，这里面的关键思想就是目前硬件的内存拷贝相当快，不是相当长的东西都可以接受)   <br />
deque也不是通常的简单数据结构，它是经过认真权衡过后得到的一种混合式数据结构。   <br />
他是一个链式块结构，每个块包含62个对象，以此来平衡对locality的优化和对push, pop的优化。有人问为啥是62个而不是其他数：那是因为deque是个双向链表，一个节点64个指针，一个指向前一个指向后，剩下就是62个指针用来指向对象     </p>
<p>要做到对insert到中间的优化是用btree和array结合的办法，有个第三方包blist   <br />
但是我估计很少有应用会真正用到这个。insert是O(log n)   <br />
http://pypi.python.org/pypi/blist/     </p>
<p>其实python是大师设计的语言，他们来决定底层具体的数据结构，作为一般人，你没有必要去质疑大师们精心设计的东西。   <br />
如果你真的对性能有很大要求，python也许并不适合你，python不是作为纯粹针对高性能计算诞生的东西，   <br />
他是一种胶水语言，它只对常见的List长度，常用的算法结构进行优化。他希望达到的目的是把现实的应用抽象出来，让使用者不用关心具体的数据结构和算法。   <br />
pythonic是一种面向大众的编程态度     </p>
<p>如果你要用它来做其他事情，可以看看有没有你需要的第三方模块,或者可以用C来实现自己的一个模块，python本来就是C写的，所以这实际上也一点不困难。   <br />
比如python里面没有一个数据结构是能用来很好表示数值运算中使用的大型矩阵或者数组的，这时候就诞生了第三方包：numpy     </p>
<p><a href="http://www.v2ex.com/t/66268">via</a></p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-04-18T20:54:56+00:00">2013-04-18</time></p>
<p>archive</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/48106626563"  rel="bookmark" >
              <h2 class="card-title">Boston爆炸后偷衣服</h2>
            </a>
            <p class="card-text"><iframe width="640" height="360" src="https://www.youtube.com/embed/1hM7Ura6Q4w?feature=player_detailpage" frameborder="0" allowfullscreen></iframe>

<p><a href="http://www.reddit.com/r/videos/comments/1cfgcw/post_boston_marathon_bombing_looters_stealing/">via</a></p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-04-16T02:31:50+00:00">2013-04-16</time></p>
<p>archive</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/48024359039"  rel="bookmark" >
              <h2 class="card-title">新闻是个坏东西</h2>
            </a>
            <p class="card-text"><ul>
<li>News misleads</li>
<li>News is irrelevant</li>
<li>News has no explanatory power<blockquote>
<p>The more "news factoids" you digest, the less of the big picture you will understand. If more information leads to higher economic success, we'd expect journalists to be at the top of the pyramid. That's not the case.</p>
</blockquote>
</li>
<li>News is toxic to your body</li>
<li>News increases cognitive errors</li>
<li>News inhibits thinking</li>
<li>News works like a drug</li>
<li>News wastes time</li>
<li>News makes us passive</li>
<li>News kills creativity</li>
</ul>
<p><a href="https://news.ycombinator.com/item?id=5549054">via</a></p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-04-15T01:55:00+00:00">2013-04-15</time></p>
<p>archive</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/47677324624"  rel="bookmark" >
              <h2 class="card-title">听水车们讲大数据在国内的发展</h2>
            </a>
            <p class="card-text"><p>发信人: Nineteen (..), 信区: Database<br />
标  题: Re: cassandra集群的去中心拓扑真是帅啊<br />
发信站: 水木社区 (Sat Mar  9 10:03:09 2013), 站内</p>
<p>就像@immars提到的，开源项目们在一两年后开发出来的东西比论文原型在性能上差了一个层次，其实不仅仅是性能，其他方面差得会更多。</p>
<p>然后其他公司一看，不错，有东西能应付应付需求，接着就开始大用特用，坚持个一两年，东西尽管被改个面目全非，但仅限于补丁摞补丁，在外围小刀，想深入大改？门都没有，老板们会说了，先满足业务需求。最常听到的说法是：tmd我们都要死了，你丫还想花那么长时间大改？</p>
<p>团队规模在“快死了”的状态中不断成长，成长的另一个原因是层出不穷的运维事件和用户“永远都没办法满足的需求”，话语权也变得越来越重。</p>
<p>集群规模越来越大，最后发现确实搞不定了，一边开始上各种歪招，比如云梯居然在优化jvm；另一方面开始组织力量研发自己的系统，后者三大互联网公司貌似都尝试过，百度的yangzhengkun，腾讯的zhuhuican和阿里的wangjian。</p>
<p>但是遇到阻力很大，阻力的一部分就来自于前面提到的“团队”，抢饭碗吗？另一部分则是互联网公司缺乏大型平台的研发经验，各种没耐心，各种弯路，各种交学费。腾讯和百度是属于交了学费退学那种。</p>
<p>阿里还在向前走，远没走到头，这也是为什么阿里云梯系统还在的原因，它不仅得在，还得加强，因为淘宝业务增长太快。</p>
<p>可以看看论文出来到现在多长时间了，如果有渠道，可以去了解了解google技术进步的速度，它跑得越来越快，差距越来越大，这不是成功打击了对手是什么</p>
<p>从另一个方面也容易理解，开源出来自己的系统加强竞争对手的技术基础设施吗？还没到共产主义社会。至于傍了大腿的项目们，人开源出来的从来不是它生产环境使用的现网系统，或者过时或者阉割。</p>
<p>至于有人说“这么说开源项目都是坏的了？”，不是这样，开源的螺丝钉、离合器、甚至发动机都不差，但是指望开源的空间站、宇宙飞船没有问题...还是算了吧，凑合用用就好，真有心，还是自己造。</p>
<p>发信人: penny1983 (一只熊猫，两种表述||熊猫永不受伤), 信区: Database<br />
标  题: Re: cassandra集群的去中心拓扑真是帅啊<br />
发信站: 水木社区 (Wed Apr 10 10:31:16 2013), 站内</p>
<p>开源实现没有靠谱的啊。</p>
<p>Paxos 算法和满足实际需求的系统之间还存在大量的鸿沟, fault-tolerant sytem 即<br />
使写伪代码都不容易写对，Google开发chubby时候专门写了一个state machine <br />
语言和相应的编译器，把用state machine 表示的算法转为c++，而且在chubby一致性检<br />
验和容错方面投入了巨大的精力。</p>
<p>Google的chubby一开始也是基于第三方商业数据库，但是由于商业库的replication问<br />
题（bug，无法证明replica算法正确），google不得不自己实现kv db 用于实现multi-<br />
paxos。这一过程也是一把辛酸啊，参加google的论文<br />
Paxos made live-An Engineering View。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-04-10T23:45:00+00:00">2013-04-10</time></p>
<p>archive</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/47665235603"  rel="bookmark" >
              <h2 class="card-title">Google Street View Hyperlapse</h2>
            </a>
            <p class="card-text"><iframe src="http://player.vimeo.com/video/63653873" width="400" height="300" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>

<p><a href="http://www.reddit.com/r/videos/comments/1bzvdt/incredible_hyperlapse_made_with_google_street_view/">via</a></p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-04-10T21:21:10+00:00">2013-04-10</time></p>
<p>archive</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/47664941306"  rel="bookmark" >
              <h2 class="card-title">跟 @igrigorik 大神学前端</h2>
            </a>
            <p class="card-text"><p><a href="http://www.reddit.com/r/programming/comments/1c24s9/video_by_a_google_engineer_about_what_it_takes_to/">reddit上</a>看到的</p>
<p>ppt在<a href="https://docs.google.com/presentation/d/1qbqqcfjz3YwocRZu2led3CzhjHjcTvvQVSYET0QYyL4/preview?sle=true#slide=id.gd101c179_2_64">这里 </a></p>
<p>做点笔记：</p>
<ol>
<li>现代浏览器可以通过  performance.timing 看到载入和渲染时间记录。</li>
<li>Chrome的pagespeed插件和audit工具很有用</li>
<li>在线pagespeed <a href="https://developers.google.com/speed/pagespeed/insights">分析 critical path</a></li>
</ol>
<p>其实 @igrigorik 大神的<a href="http://www.igvita.com/">博客</a>和<a href="https://github.com/igrigorik?tab=repositories">github</a>有不少好东西！</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-04-10T21:17:00+00:00">2013-04-10</time></p>
<p>archive</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/47527143469"  rel="bookmark" >
              <h2 class="card-title">1915年，北京 盆糕 【老照片】</h2>
            </a>
            <p class="card-text"><p><img alt="" src="http://farm3.staticflickr.com/2756/4104642924_14e615c38f_z.jpg" /></p>
<p>国内把切糕的英语翻译说成 Xinjiang glutinous rice cake, nut  cake，不如这个1915年照片名字起的好：Cake Of Millet &amp; Jujubes。感觉盆糕和切糕差不多？</p>
<p>From <a href="http://www.flickr.com/photos/ralphrepo_photolog/4104642924/in/set-72157622725544786">Flickr</a> via <a href="http://www.reddit.com/r/China/comments/1bxhfr/in_light_of_the_popular_album_uploaded_a_few_days/">reddit</a></p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-04-09T04:11:00+00:00">2013-04-09</time></p>
<p>archive</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/47516526252"  rel="bookmark" >
              <h2 class="card-title">如何艹渣度的烂广告，但是保留贴吧登陆/发回帖功能</h2>
            </a>
            <p class="card-text"><p>Chrome里打开：</p>
<p>chrome://settings/contentExceptions#cookies</p>
<p><img alt="" src="/images/tumblr/47516526252_0.png" /></p>
<p>Chrome的通配符语法真是 奇葩！</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-04-09T00:07:00+00:00">2013-04-09</time></p>
<p>archive</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/47513834971"  rel="bookmark" >
              <h2 class="card-title">reddit砖家说：共产主义是NP-complete问题，所以不可能实现，除非</h2>
            </a>
            <p class="card-text"><p>除非P=NP</p>
<blockquote>
<p>Economics is interesting because it is fundamentally the attempt to solve not just lots of problems, but a single GIGANTIC problem: the "resource scarcity" problem. <br />
Basically, we are trying to split up all the resources in such a way as to maximize the overall utility of those resources to each agent.<br />
How does this relate to the question at hand? Well, As a computer scientist, its fairly obvious to me that this problem is NP-complete, meaning that it is highly unlikely that any central-planning agency (even one that had perfect information) could ever solve it to any degree of correctness in any reasonable amount of time.</p>
</blockquote>
<p>tl;dr 中央集权解决不了任何问题。计划经济其本身就是个问题。</p>
<p><a href="http://www.reddit.com/r/DepthHub/comments/1bx7i0/steve132_applies_computational_complexity_theory/">via</a></p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-04-08T23:30:00+00:00">2013-04-08</time></p>
<p>archive</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/47509512209"  rel="bookmark" >
              <h2 class="card-title">Khaleesi你肿么了！</h2>
            </a>
            <p class="card-text"><p>盯这个照片5秒钟才反应出来这<a href="http://www.imdb.com/media/rm625784832/nm3592338">是谁</a>。。。。</p>
<p><img alt="" src="http://i.imgur.com/7HRJAl.jpg" /></p>
<p><a href="http://www.reddit.com/r/pics/comments/1by450/emilia_clarke_from_game_of_thrones_with_no_makeup/">via</a></p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-04-08T22:36:21+00:00">2013-04-08</time></p>
<p>archive</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/47508910145"  rel="bookmark" >
              <h2 class="card-title">施华洛世奇元素 vs 施华洛世奇</h2>
            </a>
            <p class="card-text"><blockquote>
<p>施华洛世奇（Swarovski）实际上有两种含义，很多情况下这两种含义容易被混同。首先他是世界首屈一指的水晶制造商和水晶奢侈品生产商，两百年来，施华洛世奇一直独享和水晶切割有关的所有技术，并以此作为最高色商业秘密。由于其垄断地位和巨大名声，施华洛世奇在很多情况下已经成为水晶的代名词。而第二种含义，则是所谓的施华洛世奇元素(Swarovski Elements)，实际上，这代表的是这种产品制造中使用到人造水晶，而这很可能和真正的施华洛世奇毫无关系。</p>
</blockquote>
<p>又想起了 美素丽儿 美素佳儿，康师傅，康帅傅 了。</p>
<p>我日真坑爹。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-04-08T22:29:23+00:00">2013-04-08</time></p>
<p>archive</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/47107640485"  rel="bookmark" >
              <h2 class="card-title">Valve把source engine移植到linux的动机是——兲朝XP用户太多了</h2>
            </a>
            <p class="card-text"><p><img alt="" src="/images/tumblr/47107640485_0.png" /></p>
<p><a href="https://news.ycombinator.com/item?id=5491826">via</a></p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-04-04T10:11:58+00:00">2013-04-04</time></p>
<p>archive</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/47007003400"  rel="bookmark" >
              <h2 class="card-title">Google Spreadsheet API pitfalls</h2>
            </a>
            <p class="card-text"><ol>
<li>
<p>Don't use OAuth 2 for "Google Apps for Business", coz admin may set share option to "limit to xxx domain only", thus your poor nigga API account like "30000000000@developer.gserviceaccount.com" won't work.</p>
</li>
<li>
<p>Google Spreadsheets' CSV output format is terrible shit. Never bother touch it. It does not handle line breaks nor escapes like sane people do</p>
</li>
<li>
<p>XML-like namespace or XLST transformations is ruining JSON. Namespace everywhere, dict-inside-array is the norm which is a huge pain in the ass to parse.</p>
</li>
<li>
<p>In Spreadsheet API, use /lists/ instead of /cells/</p>
</li>
<li>
<p>The difference between /basic and /full projections is confusing. You should really use /values for read-only access</p>
</li>
<li>
<p>Never ever use OAuth2 Web service, it will ask for "whitelist" the callback URLs, if you are dev in intranet like 10.x.x.x and your IP address is DHCP dynamic, you are fucked to re-permit the callback URL. </p>
</li>
<li>
<p>The list feed contains all rows after the first row up to the first blank row. I mean, srsly WTF?</p>
</li>
</ol></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-04-03T02:41:00+00:00">2013-04-03</time></p>
<p>archive</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/46935375645"  rel="bookmark" >
              <h2 class="card-title">OS X Mountain Lion 修改 openssh sshd_config 配置</h2>
            </a>
            <p class="card-text"><p>OS X的蛋痛特性是  <code>`launched</code> 。如果你需要修改sshd的监听端口，那么</p>
<p>编辑 /System/Library/LaunchDaemons/ssh.plist </p>
<pre><code>        &lt;key&gt;Listeners&lt;/key&gt;
        &lt;dict&gt;
                &lt;key&gt;SockServiceName&lt;/key&gt;
                &lt;string&gt;ssh-alt&lt;/string&gt;
        &lt;/dict&gt;
</code></pre>
<p>然后在<code>/etc/services</code>里定义：</p>
<pre><code> ssh-alt 12345/tcp # ssh-alt
</code></pre>
<p>然后重启sshd服务：</p>
<pre><code>sudo launchctl uload /System/Library/LaunchDaemons/ssh.plist 
sudo launchctl load -w /System/Library/LaunchDaemons/ssh.plist
</code></pre>
<p>蛋碎！</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-04-02T09:52:47+00:00">2013-04-02</time></p>
<p>archive</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/46390709551"  rel="bookmark" >
              <h2 class="card-title">HAProxy like zero-copy in Python with memoryview</h2>
            </a>
            <p class="card-text"><p>开篇帖子侃一下HAProxy这个神器有什么神器之处。</p>
<p><a href="http://xiaoxia.org/2011/03/29/written-by-python-socks5-server/">写过proxy的人</a>都会写类似的语句：</p>
<pre><code>localstream.write(upstream.read(1024))
upstream.write(localstream.read(1024))
</code></pre>
<p>其中1024为业界良心艹榴网的chunk或者一个buffer size。这样的操作在各种router, proxy, firewall 里太常见了。</p>
<p>那么HAProxy有什么<a href="http://stackoverflow.com/a/2120295/41948">特别的地方</a>呢？秘密就是，上游socket的接受buffer和本地socket的发送buffer为同一块内存。也就是说，上游socket数据来了，本地socket自动发送这一块buffer的数据。效率真是高爆了。这块buffer数据还可以用内核调用<code>splice()</code> 和 <code>tee()</code> 来达到分流和分离信号的目的。</p>
<p>btw sendfile() 是不行的，源必须是可以mmap的buffer，目标必须是个socket。</p>
<p>那么弱爆了的python可否跪舔这种高级特性呢？2.7和3.X里是可以的，因为现在PEP 3118统一了各种streaming object 的buffer protocol。只需要用一个<a href="http://docs.python.org/2/library/stdtypes.html#memoryview">叫memoryview的引用</a><br />
就可以实现共享buffer而达到zero-copy的目的了。</p>
<p>C API见<a href="http://eli.thegreenplace.net/2011/11/28/less-copies-in-python-with-the-buffer-protocol-and-memoryviews/">这里</a>，python代码例子在<a href="https://profiles.google.com/116139041198229909169/buzz/SmLJKHwpLPC">这里</a>，具体核心调用就是 <code>file.readinto()</code> 和 <code>socket.recv_into()</code> 方法。具体代码留作读者课后练习。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-03-26T22:39:00+00:00">2013-03-26</time></p>
<p>archive</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/46316452252"  rel="bookmark" >
              <h2 class="card-title">GOOG 的生态系统已经完了。欢迎来到私家花园</h2>
            </a>
            <p class="card-text"><p>两个事情需要喷一下：</p>
<ol>
<li>
<p>G+团队的官方博客：<a href="http://gplusproject.appspot.com/new-apps-iphone-android">http://gplusproject.appspot.com/new-apps-iphone-android</a> 这是个什么jb飞机玩意？为啥不<a href="http://googleplusplatform.blogspot.com/">用blogger</a>?</p>
</li>
<li>
<p>看这个关于代码测试的google官方博客 <a href="http://googletesting.blogspot.sg/2013/03/testing-on-toilet-testing-state-vs.html">http://googletesting.blogspot.sg/2013/03/testing-on-toilet-testing-state-vs.html</a> 用它妈这么多javascript特效干嘛？关键是——禁用了js之后，页面就一片空白了。</p>
</li>
</ol>
<p>欢迎来到后web 2.0时代——没有首页，没有订阅，没有js就神马都不显示的web app时代。</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-03-26T00:48:33+00:00">2013-03-26</time></p>
<p>archive</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/45915290071"  rel="bookmark" >
              <h2 class="card-title">day -1</h2>
            </a>
            <p class="card-text"><p>day -3 observed performance downgrade when x-linking sites <br />
day -2 frustrated at tcp blackout <br />
day -1 punched the hole and see the light <br />
day 0 productivity.</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-03-21T11:12:00+00:00">2013-03-21</time></p>
<p>archive</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/45326795197"  rel="bookmark" >
              <h2 class="card-title">RIP Google Reader</h2>
            </a>
            <p class="card-text"><p><img alt="" src="/images/tumblr/45326795197_0.png" /></p>
<p>It was fun while it lasted.</p>
<p>FUCK GOOG</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-03-14T01:05:49+00:00">2013-03-14</time></p>
<p>archive</p>            </div>
          </article>
        </div>


        <!-- new article -->
        <div class="card blog-card">
          <article class="card-body">
            <a href="/post/45245208546"  rel="bookmark" >
              <h2 class="card-title">Unix Socket 点滴[转载]</h2>
            </a>
            <p class="card-text"><p>【Unix Socket 点滴 1】使用unix socket时，把路径名的第一个字节设为null byte（\x00），这样就不会产生实际的文件，使用起了比较方便，也不用纠结选哪个路径，随便一个字符串就行了。netstat的时候会发现，第一个字节变成了蜗牛符号</p>
<p><img alt="" src="http://ww4.sinaimg.cn/large/622a9970gw1e2g8r9fny2j.jpg" /></p>
<p>【Unix Socket 点滴 2】unix socket的DGRAM模式可以传输大数据块，而UDP单个包最大65507字节。</p>
<p>【Unix Socket 点滴 3】unix socket可以发送文件句柄。特别是大数据量交互的时候可以放在tmpfs共享内存，只把文件句柄发送过去，这样可以做到0-copy。</p>
<p>【Unix Socket 点滴 4】unix socket可以校验对端的uid和pid，这在某些场合下是一种可依赖的鉴权手段。</p>
<p>【Unix Socket 点滴 5】uninx DGRAM句柄在对端关闭时，会自动解除连接关系，端口变成unconnect状态，后续使用可以重新connect。</p>
<p>来自 <a href="http://weibo.com/codebox">CodeBox-腾讯</a> 腾讯云平台资深还是浅就那么回事儿工程师。 </p>
<p>第一点和第三点很重要~</p></p>
            <div class="card-subtext muted-text">
              <p>Posted <time datetime="2013-03-12T23:49:00+00:00">2013-03-12</time></p>
<p>archive</p>            </div>
          </article>
        </div>

    </main>
    <nav class="pagination-nav side-padding">
<a href="/index.12.html" class="pagination-newer">&lt; Newer Posts</a><a href="/index.14.html" class="pagination-older">Older Posts &gt;</a>    </nav>

<script src="/theme/js/core.js"></script>

  </body>
</html>