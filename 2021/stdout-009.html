<!DOCTYPE html>
<html>
  <head>
    <title>macOS è®¾ç½® TCP æ¡æ‰‹è¿æ¥è¶…æ—¶ï¼Œæå‡æµè§ˆå™¨åœ¨ç³Ÿç³•ç½‘ç»œä¸‹çš„è®¿é—®ä½“éªŒ - ğŸ‘â€ğŸ—¨ ğŸ’­ ğŸ’« ğŸ…±ã’</title>

    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <link href="https://feeds.feedburner.com/initiative" type="application/rss+xml" rel="alternate" title="ğŸ‘â€ğŸ—¨ ğŸ’­ ğŸ’« ğŸ…±ã’ RSS Feed" />

    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="macOS è®¾ç½® TCP æ¡æ‰‹è¿æ¥è¶…æ—¶ï¼Œæå‡æµè§ˆå™¨åœ¨ç³Ÿç³•ç½‘ç»œä¸‹çš„è®¿é—®ä½“éªŒ" />

      <link rel="canonical" href="https://blog.est.im/2021/stdout-009" />

    <link rel="stylesheet" href="/theme/css/normalize.min.css" />
    <link rel="stylesheet" href="/theme/css/style.css" />


    <style>
      body {
        background: #ecedef url("/theme/img/ignasi_pattern_s.png") repeat;
      }
    </style>
  </head>
  <body class="single-body">
<nav class="nav-bar side-padding">
  <h1 class="nav-header"><a href="/" class="nav-text">
    ğŸ‘â€ğŸ—¨ ğŸ’­ ğŸ’« ğŸ…±ã’
  </a></h1>
  <div class="hamburger-menu">
    <button onclick="hamburgerMenuPressed.call(this)" aria-haspopup="true" aria-expanded="false" aria-controls="menu" aria-label="Menu">
      <span></span>
      <span></span>
    </button>
    <ul id="menu" class="hamburger-menu-overlay">
      <li><a href="/" class="hamburger-menu-overlay-link">Home</a></li>
      <li><a href="https://feeds.feedburner.com/initiative" class="hamburger-menu-overlay-link">RSS</a></li>
      <li><a href="/about" class="hamburger-menu-overlay-link">About</a></li>

      <li><a href="/category/archive" class="hamburger-menu-overlay-link">archive</a></li>
      <li><a href="/category/stderr" class="hamburger-menu-overlay-link">stderr</a></li>
      <li><a href="/category/stdin" class="hamburger-menu-overlay-link">stdin</a></li>
      <li><a href="/category/stdout" class="hamburger-menu-overlay-link active">stdout</a></li>

    </ul>
  </div>
</nav>    <main class="content side-text-padding">


<article class="post">
  <header class="post-header">
    <h2 class="post-title">macOS è®¾ç½® TCP æ¡æ‰‹è¿æ¥è¶…æ—¶ï¼Œæå‡æµè§ˆå™¨åœ¨ç³Ÿç³•ç½‘ç»œä¸‹çš„è®¿é—®ä½“éªŒ</h2>
    <p class="post-date">Posted <time datetime="2021-07-02T15:51:19+08:00">2021-07-02</time> | <span>stdout</span></p>
  </header>

  
  <p>å¤šå¹´çš„ç–‘æƒ‘ä»Šå¤©å±…ç„¶è¢«å¶ç„¶è§£å¼€äº†ã€‚</p>
<p>ç”±äºå¢™å†…ç³Ÿç³•çš„ç½‘ç»œç¯å¢ƒï¼Œè€Œä¸”ISPç”šè‡³wifiå†…è¿˜æœ‰å¢™ä¸­å¢™ï¼Œæ‰€ä»¥å¾ˆå¤šåŸŸåæ˜¯æ‰“ä¸å¼€çš„ã€‚</p>
<p>æ¯æ¬¡çœ‹æµè§ˆå™¨åœ¨å‚»ä¹ä¹çš„è½¬èŠèŠ±ï¼Œå°±è§‰å¾—æµªè´¹æ—¶é—´ã€‚</p>
<pre><code>  sudo sysctl  net.inet.tcp.keepinit=3000
</code></pre>
<p>è¿™ä¸€æ¡æŒ‡ä»¤å¯ä»¥ç›´æ¥è®¾ç½® macOS çš„ TCP Keepalive å¿ƒè·³åŒ…åˆå§‹åŒ–æ—¶é—´è®¾ç½®ä¸º3000æ¯«ç§’ã€‚</p>
<p><code>net.inet.tcp.keepinit</code>é»˜è®¤å€¼æ˜¯ 75000 ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚æ³¨æ„ Linux ä¸‹æ²¡è¿™è®¾ç½®ï¼Œè€Œä¸”å•ä½æ˜¯ ç§’</p>
<p>è¿™å¥è¯å­¦ç©¶å¼çš„è§£é‡Šå¯ä»¥é€šè¿‡ <code>man 4 tcp</code> å¾—åˆ°ï¼Œæ‘˜å½•å‡ æ¡ï¼š</p>
<blockquote>
<p>TCP_CONNECTIONTIMEOUT  The TCP_CONNECTIONTIMEOUT option allows to specify the timeout, in seconds, for new, non established TCP connections. This option can be useful for both active and passive TCP connections. The default value is specified by the MIB variable net.inet.tcp.keepinit.<br />
tcp.keepinit Timeout, in milliseconds, for new, non-established TCP connections.</p>
</blockquote>
<p>æ¢å¥è¯è¯´ï¼Œå°±æ˜¯ TCP ç¬¬ä¸€ä¸ª syn åŒ…æœ€å¤šç»™3ç§’ç­‰å¾…ã€‚è¶…è¿‡3ç§’å°±æ‹‰å€’ï¼Œç›´æ¥æŠ¥ <code>ERR_CONNECTION_TIMED_OUT</code> å®Œäº‹ã€‚</p>
<p>æˆ‘è§‰å¾—ï¼Œå¦‚æœä¸€ä¸ªåŸŸåå’ŒTCPç«¯å£3ç§’é’Ÿå†…æ— æ³•å®Œæˆæ¡æ‰‹ï¼Œå°±åˆ«æ‰§ç€äº†ã€‚ä½ å†å¹²ç­‰75ç§’ä¹Ÿä¸å¯èƒ½è¿ä¸Šã€‚è¿™ä¸ªå€¼åªä¼šå½±å“åˆå§‹è¿æ¥çš„è¶…æ—¶ï¼Œä¸€æ—¦è¿ä¸Šäº†æ€ä¹ˆidleéƒ½ä¸å½±å“ï¼Œæ‰€ä»¥ä¸ä¼šå½±å“æ¸¸æˆçš„tcpæˆ–è€…websocketçš„é•¿è¿æ¥ã€‚ä¹Ÿä¸å½±å“udpã€‚</p>
<p>2021-07-06 è¡¥å……ï¼š</p>
<p>é‡å¯ä¿æŒæœ‰æ•ˆï¼š</p>
<pre><code>  echo net.inet.tcp.keepinit=3000 | sudo tee -a /etc/sysctl.conf
</code></pre>
<p>2021-09-21 è¡¥å……ï¼š</p>
<p>æ–°ç‰ˆmacOS æŠŠ /etc/sysctl.conf è¿™æ–‡ä»¶ç»™æ¢ä½ç½®äº†ã€‚åº”è¯¥æ˜¯</p>
<pre><code>  "/Users/Shared/Relocated Items/Configuration/private/etc/sysctl.conf"
</code></pre>

</article>


<div class="comments">
  <h2>Comments</h2>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = 'estblog';
    var disqus_identifier = '2021/stdout-009';
    var disqus_url = location.href;
    (function() {
    var dsq = document.createElement('script'); 

    dsq.type = 'text/javascript';
    dsq.defer = true;
    dsq.src = '//estblog.disqus.com/embed.js';
    (document.getElementsByTagName('body')[0] || document.getElementsByTagName('head')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the comments.</noscript>
</div>    </main>
<script src="/theme/js/core.js"></script>

  </body>

</html>